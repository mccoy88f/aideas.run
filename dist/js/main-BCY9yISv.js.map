{"version":3,"mappings":"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AAC,IAAK,QAAQ,CAClB,CAAC,CAAC,EAOWI,GAAaJ,GAAW,eAAgB,IAAI,IAAI,CACzD,CAAC,GAAI,OAAO,EACZ,CAAC,GAAI,MAAM,EACX,CAAC,GAAI,MAAM,EACX,CAAC,IAAK,QAAQ,CAClB,CAAC,CAAC,EClHWK,GAAe,IAAI,IAAI,CAChC,WACA,cACA,eACA,eACA,gBACA,mBACA,WACA,UACA,gBACA,sBACA,cACA,mBACA,oBACA,oBACA,iBACA,eACA,UACA,UACA,UACA,UACA,UACA,iBACA,UACA,UACA,cACA,eACA,WACA,eACA,qBACA,cACA,SACA,eACA,gBACA,WACA,iBACA,iBACA,UACJ,EAAE,IAAKC,GAAQ,CAACA,EAAI,YAAW,EAAIA,CAAG,CAAC,CAAC,EAC3BC,GAAiB,IAAI,IAAI,CAClC,gBACA,gBACA,gBACA,gBACA,cACA,WACA,gBACA,kBACA,WACA,cACA,WACA,oBACA,gBACA,eACA,mBACA,YACA,aACA,WACA,eACA,oBACA,eACA,cACA,cACA,mBACA,YACA,aACA,aACA,sBACA,mBACA,eACA,YACA,YACA,YACA,gBACA,sBACA,iBACA,OACA,OACA,cACA,YACA,qBACA,mBACA,mBACA,mBACA,eACA,cACA,eACA,cACA,eACA,iBACA,cACA,UACA,UACA,aACA,UACA,aACA,mBACA,mBACA,YACJ,EAAE,IAAKD,GAAQ,CAACA,EAAI,YAAW,EAAIA,CAAG,CAAC,CAAC,ECvFlCE,GAAoB,IAAI,IAAI,CAC9B,QACA,SACA,MACA,SACA,UACA,WACA,YACA,UACJ,CAAC,EACD,SAASC,GAAclO,EAAO,CAC1B,OAAOA,EAAM,QAAQ,KAAM,QAAQ,CACvC,CAIA,SAASmO,GAAiBC,EAAYC,EAAM,CACxC,IAAItC,EACJ,GAAI,CAACqC,EACD,OACJ,MAAME,IAAWvC,EAAKsC,EAAK,kBAAoB,MAAQtC,IAAO,OAASA,EAAKsC,EAAK,kBAAoB,GAC/FH,GACAG,EAAK,SAAWA,EAAK,iBAAmB,OACpChB,GACAO,GACV,OAAO,OAAO,KAAKQ,CAAU,EACxB,IAAK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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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","names":["StorageService","Dexie","primKey","obj","trans","appData","app","appId","error","options","query","tag","updates","metadata","updatedMetadata","key","apps","migrated","files","htmlFile","f","filePromises","file","defaultValue","setting","value","settings","result","action","data","eventIds","cat","deviceId","filename","ext","syncEvents","exportData","err","validApps","validCategories","favoriteApps","totalApps","totalFiles","settingsCount","lastInstall","latest","StorageService$1","toastCounter","showToast","message","type","duration","toastContainer","toastId","toast","icons","escapeHtml","closeBtn","actionBtn","removeToast","clearAllToasts","hideToast","showModal","modalId","content","modalsContainer","existingModal","modal","backdrop","closeButtons","closeModal","e","btn","handleEscape","currentFocus","focusableElements","hideModal","text","div","formatFileSize","bytes","decimals","k","dm","sizes","i","formatRelativeDate","date","dateObj","diffMs","diffSeconds","diffMinutes","diffHours","diffDays","diffWeeks","diffMonths","diffYears","generateId","prefix","isMobile","isPWASupported","getDeviceInfo","isValidUrl","url","extractDomain","getStringHash","str","hashBuffer","b","showConfirmPopup","resolve","title","icon","confirmText","cancelText","popup","iconHtml","confirmBtnClass","handleAction","handleKeydown","showDeleteAppConfirm","appName","AppLauncher","launchMode","appSpecificMode","finalLaunchMode","validation","launchId","startTime","iframe","appFiles","entryPoint","fileMap","blobUrls","blob","blobUrl","htmlContent","htmlBlob","htmlBlobUrl","newWindow","cleanup","modifiedContent","domains","patterns","match","domain","linkTag","allDomains","domainList","csp","customCSP","cachedCSP","cachedDomains","lastAnalyzed","hoursSinceAnalysis","fallbackCSP","targetUrl","repoInfo","urlApp","iframeOptions","modalContent","loadingEl","container","launchModeSelect","newMode","observer","mutations","mutation","node","iframeWindow","callback","specifiedEntry","specified","indexHtml","firstHtml","pathMap","pathSegments","justFilename","path","cleanPath","metaTags","controller","timeoutId","response","xFrameOptions","xfo","cspLower","fetchError","pattern","activeApp","a","history","window","ElementType","isTag","elem","Root","Text","Directive","Comment","Script","Style","Tag","CDATA","Doctype","Node","parent","prev","next","recursive","cloneNode","DataNode","ProcessingInstruction","name","NodeWithChildren","children","_a","Document","Element","attribs","_b","isTagRaw","isCDATA","isText","isComment","isDirective","isDocument","hasChildren","cloneChildren","clone","child","instruction","childs","xmlReplacer","xmlCodeMap","getCodePoint","index","c","encodeXML","ret","lastIdx","char","getEscaper","regex","map","escapeAttribute","escapeText","elementNames","val","attributeNames","unencodedElements","replaceQuotes","formatAttributes","attributes","opts","encode","singleTag","render","nodes","output","renderNode","ElementType.Root","ElementType.Doctype","ElementType.Directive","renderDirective","ElementType.Comment","renderComment","ElementType.CDATA","renderCdata","ElementType.Script","ElementType.Style","ElementType.Tag","renderTag","ElementType.Text","renderText","foreignModeIntegrationPoints","foreignElements","getOuterHTML","renderHTML","getInnerHTML","getText","textContent","innerText","getChildren","getParent","getSiblings","siblings","getAttributeValue","hasAttrib","getName","nextElementSibling","prevElementSibling","removeElement","childsIndex","replaceElement","replacement","appendChild","sibling","append","currNext","prependChild","prepend","filter","test","recurse","limit","find","nodeStack","indexStack","findOneChild","findOne","searchedNodes","found","existsOne","findAll","Checks","getAttribCheck","attrib","combineFuncs","compileTest","funcs","testElement","getElements","getElementById","id","getElementsByTagName","tagName","getElementsByClassName","className","getElementsByTagType","removeSubsets","idx","ancestor","DocumentPosition","compareDocumentPosition","nodeA","nodeB","aParents","bParents","current","maxIdx","sharedParent","aSibling","bSibling","uniqueSort","arr","relative","getFeed","doc","feedRoot","getOneElement","isValidFeed","getAtomFeed","getRssFeed","feed","item","entry","getMediaElements","addConditionally","href","description","fetch","pubDate","updated","MEDIA_KEYS_STRING","MEDIA_KEYS_INT","where","media","prop","elements","elems","contains","contained","isCheerio","maybeCheerio","camelCase","_","x","cssCase","domEach","array","fn","len","CharacterCode","isHtml","tagStart","tagChar","hasOwn","object","rspace","dataAttrPrefix","rboolean","rbrace","getAttr","xmlMode","setAttr","el","removeAttribute","attr","objName","objValue","getProp","setProp","property","keys","setData","readAllData","domName","jsName","parseDataValue","readData","num","dataEl","querying","element","option","values","splitNames","names","removeAttr","attrNames","attrName","hasClass","clazz","end","addClass","classNames","numElements","setClass","cn","appendClass","removeClass","classes","numClasses","removeAll","elClasses","changed","j","toggleClass","stateVal","state","elementClasses","SelectorType","AttributeAction","reName","reEscape","actionTypes","unpackPseudos","isTraversal","selector","stripQuotesFromPseudos","funescape","escaped","escapedWhitespace","high","unescapeCSS","isQuote","isWhitespace","parse","subselects","endIndex","parseSelector","selectorIndex","tokens","offset","stripWhitespace","readValueWithParenthesis","start","counter","isEscaped","pos","slashCount","ensureNotTraversal","addTraversal","addSpecialAttribute","finalizeSubselector","loop","firstChar","namespace","possibleAction","ignoreCase","quote","sectionEnd","valueStart","forceIgnore","attributeSelector","quot","boolbase","procedure","token","sortByProcedure","procs","getProcedure","procNew","proc","d","reChars","escapeRegex","caseInsensitiveAttributes","shouldIgnoreCase","attributeRules","adapter","whitespace","ZERO","NINE","formula","sign","readSign","number","readNumber","skipWhitespace","compile","parsed","absA","bMod","nthCheck","getChildFunc","filters","itext","rule","equals","func","getNCheck","currentSibling","_rule","context","dynamicStatePseudo","pseudos","firstChild","elemName","verifyPseudoArgs","subselect","argIndex","aliases","PLACEHOLDER_ELEMENT","ensureIsTag","getNextSiblings","elemIndex","copyOptions","is","compileToken","_context","s","compiled","hasElement","shouldTestNextSiblings","nextElements","compilePseudoSelector","userPseudo","stringPseudo","alias","pseudo","getElementParent","compileGeneralSelector","isFalseCache","previous","lastElement","includesScopePseudo","DESCENDANT_TOKEN","FLEXIBLE_DESCENDANT_TOKEN","SCOPE_TOKEN","absolutize","hasContext","t","sortRules","isArrayContext","finalContext","rules","first","second","compileRules","reduceRules","defaultEquals","defaultOptions","DomUtils","convertOptionFormats","_c","_d","wrapCompile","_compileToken","prepareContext","appendNextSiblings","elemsLength","nextSiblings","filterNames","isFilter","getLimit","partLimit","getDocumentRoot","groupSelectors","selectors","filteredSelectors","plainSelectors","UNIVERSAL_SELECTOR","SCOPE_PSEUDO","some","plain","filtered","sel","filterBySelector","filterByPosition","filterParsed","filterElements","filteredSelector","DomUtils.isTag","root","findFilterElements","select","results","findElements","DomUtils.uniqueSort","queryForSelector","totalLimit","filterIndex","sub","DomUtils.getChildren","remainingSelector","remainingHasTraversal","boolbase.trueFunc","DomUtils.find","els","reSiblingSelector","selectorOrHaystack","haystack","_findBySelector","select.select","_getMatcher","matchMap","postFns","matched","filterArray","_matcher","_singleMatcher","_matchUntil","nextElem","matches","innerMatcher","filterSelector","select.is","getFilterFn","_removeDuplicates","parents","parentsUntil","closest","set","selectOpts","selectFn","nextAll","nextUntil","prevAll","prevUntil","contents","newElems","each","select.filter","select.some","not","filterFn","has","last","eq","get","toArray","selectorOrNeedle","$haystack","needle","slice","add","other","selection","addBack","update","newChilds","_makeDomArray","_insert","concatenator","domSrc","dom","uniqueSplice","spliceIdx","spliceCount","spliceArgs","oldParent","prevIdx","appendTo","target","prependTo","_wrap","insert","wrapper","lastParent","wrap","wrapperDom","elInsertLocation","updateDOM","wrapInner","unwrap","wrapAll","after","insertAfter","clones","clonedSelf","before","insertBefore","targetArr","remove","replaceWith","cont","empty","html","toString","staticText","textNode","css","setCss","getCss","styles","stringify","newStyles","n","trimmed","submittableSelector","r20","rCRLF","serialize","serializeArray","$elem","getExtractDescr","descr","extract","isArray","$","Cheerio","Attributes","Traversing","Manipulation","Css","Forms","Extract","CODE_POINTS","ERR","TokenType","NS","ATTRS","DOCUMENT_MODE","TAG_NAMES","TAG_ID","State","IMPLICIT_END_TAG_REQUIRED","SCOPING_ELEMENTS_HTML","EntryType","tn","InsertionMode","ProxyService","lastError","proxyIndex","proxy","userLang","baseUrl","iconSelectors","desc","iconUrl","proxyUrl","status","AppImporter","htmlForm","htmlBtn","navButtons","sections","sectionName","section","dropZone","fileInput","urlInput","testBtn","previewContainer","githubInput","iconInput","uploadBtn","preview","currentMode","indicator","modeLabel","nameInput","startImportBtn","isValid","JSZip","manifest","fileObj","fileData","metadataSection","importBtn","previewElement","statusBadge","titleEl","urlEl","apiUrl","repoData","formData","globalLaunchMode","iconFile","manifestData","htmlMetadata","manifestUrl","titleMatch","descriptionMatch","iconMatch","appleIconMatch","fallbackError","preferredSizes","size","category","fields","fieldId","field","themeColorField","bgColorField","nameEl","descEl","versionEl","categoryEl","launchModeEl","tagsEl","iconEl","tags","show","progress","actions","percent","fill","textEl","eventName","iconPreview","reader","dataUrl","img","favicon","bodyText","AppCard","viewMode","version","lastUsed","installDate","favorite","githubUrl","displayName","displayDescription","displayCategory","appIcon","typeInfo","lastUsedFormatted","installDateFormatted","types","categories","maxLength","API_ENDPOINTS","REGEX_PATTERNS","GitHubService","owner","repo","cacheKey","cached","endpoint","ref","gistData","gist","gistId","repoMatch","pagesMatch","waitTime","remaining","reset","encrypted","timeout","syncData","gistContent","syncFile","metaFile","currentChecksum","dataBuffer","GoogleDriveService","clientId","clientSecret","usePopup","codeVerifier","codeChallenge","authParams","authUrl","reject","checkClosed","messageHandler","event","code","tokenData","tokenParams","existing","folder","parentId","folderMetadata","mimeType","fileMetadata","delimiter","close_delim","body","metadataResponse","uploadResponse","updatedFile","fileId","folderId","params","syncContent","syncFiles","metaFiles","metaContent","digest","buffer","credentials","SyncManager","provider","autoSyncInterval","direction","localData","localHash","remoteData","remoteHash","analysis","resolutions","mergedData","syncPackage","localApps","remoteApps","remoteApp","localModified","remoteModified","conflicts","conflict","resolution","change","radio","backupData","statusEl","SettingsPanel","needsUpdate","currentSettings","criticalSettings","savedSettings","feature","isDisabled","input","targetSection","fieldMapping","theme","prefersDark","language","enabled","importData","cacheNames","stats","dbSize","storageUsedEl","appsCountEl","cacheSizeEl","cacheSize","userAgentEl","platformEl","pwaSupportEl","hasServiceWorker","hasManifest","hasPushManager","pwaFeatures","g","oldValue","newValue","DEBUG","StorageService$2","m","confirmed","ErrorTracker","__publicField","AIdeasApp","SettingPanel","currentLaunchMode","loadingScreen","appContainer","sidebarToggle","sidebar","layout","mobileSearchToggle","mobileSearchClose","searchContainer","headerSearch","searchInput","searchInputEl","nav","userBtn","userDropdown","thirtyDaysAgo","appsGrid","emptyState","defaultIcon","badgeHtml","card","pressTimer","isLongPress","newStatus","link","clickedLink","clickedBtn","sectionTitle","sectionSubtitle","titleData","allCount","favoritesCount","favorites","dynamicCategories","categoryMap","categoryItems","count","currentViewBtn","sortSelect","targetEl","menuHtml","menuDiv","menu","rect","menuRect","top","left","closeMenu","targetElement","testKey","testValue","loadedValue"],"ignoreList":[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],"sources":["../../src/services/StorageService.js","../../src/utils/helpers.js","../../src/components/AppLauncher.js","../../node_modules/domelementtype/lib/esm/index.js","../../node_modules/domhandler/lib/esm/node.js","../../node_modules/entities/lib/esm/escape.js","../../node_modules/dom-serializer/lib/esm/foreignNames.js","../../node_modules/dom-serializer/lib/esm/index.js","../../node_modules/domutils/lib/esm/stringify.js","../../node_modules/domutils/lib/esm/traversal.js","../../node_modules/domutils/lib/esm/manipulation.js","../../node_modules/domutils/lib/esm/querying.js","../../node_modules/domutils/lib/esm/legacy.js","../../node_modules/domutils/lib/esm/helpers.js","../../node_modules/domutils/lib/esm/feeds.js","../../node_modules/cheerio/dist/browser/static.js","../../node_modules/cheerio/dist/browser/utils.js","../../node_modules/cheerio/dist/browser/api/attributes.js","../../node_modules/css-what/lib/es/types.js","../../node_modules/css-what/lib/es/parse.js","../../node_modules/boolbase/index.js","../../node_modules/css-select/lib/esm/sort.js","../../node_modules/css-select/lib/esm/attributes.js","../../node_modules/nth-check/lib/esm/parse.js","../../node_modules/nth-check/lib/esm/compile.js","../../node_modules/nth-check/lib/esm/index.js","../../node_modules/css-select/lib/esm/pseudo-selectors/filters.js","../../node_modules/css-select/lib/esm/pseudo-selectors/pseudos.js","../../node_modules/css-select/lib/esm/pseudo-selectors/aliases.js","../../node_modules/css-select/lib/esm/pseudo-selectors/subselects.js","../../node_modules/css-select/lib/esm/pseudo-selectors/index.js","../../node_modules/css-select/lib/esm/general.js","../../node_modules/css-select/lib/esm/compile.js","../../node_modules/css-select/lib/esm/index.js","../../node_modules/cheerio-select/lib/esm/positionals.js","../../node_modules/cheerio-select/lib/esm/helpers.js","../../node_modules/cheerio-select/lib/esm/index.js","../../node_modules/cheerio/dist/browser/api/traversing.js","../../node_modules/cheerio/dist/browser/parse.js","../../node_modules/cheerio/dist/browser/api/manipulation.js","../../node_modules/cheerio/dist/browser/api/css.js","../../node_modules/cheerio/dist/browser/api/forms.js","../../node_modules/cheerio/dist/browser/api/extract.js","../../node_modules/cheerio/dist/browser/cheerio.js","../../node_modules/parse5/dist/common/unicode.js","../../node_modules/parse5/dist/common/error-codes.js","../../node_modules/parse5/dist/common/token.js","../../node_modules/parse5/dist/common/html.js","../../node_modules/parse5/dist/tokenizer/index.js","../../node_modules/parse5/dist/parser/open-element-stack.js","../../node_modules/parse5/dist/parser/formatting-element-list.js","../../node_modules/parse5/dist/common/foreign-content.js","../../node_modules/parse5/dist/parser/index.js","../../node_modules/parse5/dist/serializer/index.js","../../src/services/ProxyService.js","../../src/components/AppImporter.js","../../src/components/AppCard.js","../../src/utils/constants.js","../../src/services/GitHubService.js","../../src/services/GoogleDriveService.js","../../src/components/SyncManager.js","../../src/components/SettingPanel.js","../../src/utils/debug.js","../../src/main.js"],"sourcesContent":["import Dexie from 'dexie';\n\n/**\n * AIdeas Storage Service - Gestione IndexedDB con Dexie.js\n * Classe singleton per gestire tutto lo storage locale dell'applicazione\n */\nclass StorageService {\n  constructor() {\n    if (StorageService.instance) {\n      return StorageService.instance;\n    }\n\n    this.db = new Dexie('AIdeas_DB');\n    this.initDatabase();\n    StorageService.instance = this;\n  }\n\n  /**\n   * Inizializza lo schema del database\n   */\n  initDatabase() {\n    this.db.version(1).stores({\n      // Apps installate dall'utente\n      apps: '++id, name, description, category, version, url, type, githubUrl, installDate, lastUsed, favorite, *tags',\n      \n      // Files delle app (per ZIP imports) \n      appFiles: '++id, appId, filename, content, size, mimeType',\n      \n      // Impostazioni utente\n      settings: 'key, value, lastModified',\n      \n      // Eventi per sincronizzazione\n      syncEvents: '++id, timestamp, action, data, synced, deviceId',\n      \n      // Catalogo app store\n      catalog: '++id, name, description, author, githubUrl, rating, downloads, featured, *categories'\n    });\n\n    // Hook per validazione dati\n    this.db.apps.hook('creating', (primKey, obj, trans) => {\n      obj.installDate = obj.installDate || new Date();\n      obj.lastUsed = obj.lastUsed || new Date();\n      obj.favorite = obj.favorite || false;\n      obj.tags = obj.tags || [];\n    });\n\n    this.db.syncEvents.hook('creating', (primKey, obj, trans) => {\n      obj.timestamp = obj.timestamp || new Date();\n      obj.synced = obj.synced || false;\n      obj.deviceId = obj.deviceId || this.getDeviceId();\n    });\n  }\n\n  /**\n   * APPS MANAGEMENT\n   */\n\n  // Installa una nuova app\n  async installApp(appData) {\n    try {\n      const app = {\n        name: appData.name,\n        description: appData.description || '',\n        category: appData.category || 'uncategorized',\n        version: appData.version || '1.0.0',\n        url: appData.url || null,\n        type: appData.type, // 'zip', 'url', 'github', 'pwa', 'html'\n        githubUrl: appData.githubUrl || null,\n        icon: appData.icon || null,\n        manifest: appData.manifest || {},\n        permissions: appData.permissions || [],\n        tags: appData.tags || [],\n        metadata: appData.metadata || {},\n        content: appData.content || null // Aggiungi campo per contenuto HTML\n      };\n\n      const appId = await this.db.apps.add(app);\n      \n      // Salva i file se  un'app ZIP\n      if (appData.files && appData.files.length > 0) {\n        await this.saveAppFiles(appId, appData.files);\n      }\n\n      // Registra evento sync\n      await this.addSyncEvent('app_installed', { appId, app });\n\n      return appId;\n    } catch (error) {\n      console.error('Errore installazione app:', error);\n      throw new Error(`Impossibile installare l'app: ${error.message}`);\n    }\n  }\n\n  // Ottieni tutte le app\n  async getAllApps(options = {}) {\n    try {\n      let query = this.db.apps.orderBy('lastUsed').reverse();\n\n      if (options.category) {\n        query = query.filter(app => app.category === options.category);\n      }\n\n      if (options.search) {\n        query = query.filter(app => \n          app.name.toLowerCase().includes(options.search.toLowerCase()) ||\n          app.description.toLowerCase().includes(options.search.toLowerCase()) ||\n          app.tags.some(tag => tag.toLowerCase().includes(options.search.toLowerCase()))\n        );\n      }\n\n      if (options.favorite) {\n        query = query.filter(app => app.favorite === true);\n      }\n\n      return await query.toArray();\n    } catch (error) {\n      console.error('Errore recupero app:', error);\n      return [];\n    }\n  }\n\n  // Ottieni app per ID\n  async getApp(appId) {\n    try {\n      return await this.db.apps.get(appId);\n    } catch (error) {\n      console.error('Errore recupero app:', error);\n      return null;\n    }\n  }\n\n  // Aggiorna app\n  async updateApp(appId, updates) {\n    try {\n      await this.db.apps.update(appId, updates);\n      await this.addSyncEvent('app_updated', { appId, updates });\n      return true;\n    } catch (error) {\n      console.error('Errore aggiornamento app:', error);\n      return false;\n    }\n  }\n\n  // Aggiorna metadati specifici di un'app (CSP, domini esterni, ecc.)\n  async setAppMetadata(appId, metadata) {\n    try {\n      const app = await this.getApp(appId);\n      if (!app) {\n        throw new Error('App non trovata');\n      }\n\n      // Unisci i metadati esistenti con quelli nuovi\n      const updatedMetadata = {\n        ...app.metadata,\n        ...metadata\n      };\n\n      await this.db.apps.update(appId, { metadata: updatedMetadata });\n      console.log(` Metadati aggiornati per app ${appId}:`, metadata);\n      return true;\n    } catch (error) {\n      console.error('Errore aggiornamento metadati app:', error);\n      return false;\n    }\n  }\n\n  // Ottieni metadati specifici di un'app\n  async getAppMetadata(appId, key = null) {\n    try {\n      const app = await this.getApp(appId);\n      if (!app || !app.metadata) {\n        return null;\n      }\n\n      if (key) {\n        return app.metadata[key] || null;\n      }\n\n      return app.metadata;\n    } catch (error) {\n      console.error('Errore recupero metadati app:', error);\n      return null;\n    }\n  }\n\n  // Migra app esistenti per aggiungere campo content se mancante\n  async migrateAppsForContent() {\n    try {\n      console.log(' Inizio migrazione app HTML...');\n      const apps = await this.db.apps.toArray();\n      console.log(` Trovate ${apps.length} app totali`);\n      \n      let migrated = 0;\n      \n      for (const app of apps) {\n        console.log(` Controllo app: ${app.name} (tipo: ${app.type})`);\n        \n        if (app.type === 'html' && !app.content) {\n          console.log(` App HTML senza contenuto trovata: ${app.name}`);\n          \n          // Per le app HTML senza contenuto, prova a recuperarlo dai file\n          const files = await this.getAppFiles(app.id);\n          console.log(` Trovati ${files.length} file per app ${app.name}`);\n          \n          const htmlFile = files.find(f => f.filename.endsWith('.html'));\n          \n          if (htmlFile) {\n            console.log(` File HTML trovato: ${htmlFile.filename}`);\n            await this.db.apps.update(app.id, { content: htmlFile.content });\n            migrated++;\n            console.log(` App ${app.name} migrata con successo`);\n          } else {\n            console.log(` Nessun file HTML trovato per app ${app.name}`);\n          }\n        }\n      }\n      \n      if (migrated > 0) {\n        console.log(` Migrate ${migrated} app HTML per aggiungere campo content`);\n      } else {\n        console.log(' Nessuna app HTML da migrare');\n      }\n      \n      return migrated;\n    } catch (error) {\n      console.error(' Errore migrazione app:', error);\n      console.error('Stack trace:', error.stack);\n      return 0;\n    }\n  }\n\n  // Elimina app\n  async deleteApp(appId) {\n    try {\n      await this.db.transaction('rw', [this.db.apps, this.db.appFiles], async () => {\n        await this.db.apps.delete(appId);\n        await this.db.appFiles.where('appId').equals(appId).delete();\n      });\n\n      await this.addSyncEvent('app_deleted', { appId });\n      return true;\n    } catch (error) {\n      console.error('Errore eliminazione app:', error);\n      return false;\n    }\n  }\n\n  // Aggiorna ultimo utilizzo\n  async updateLastUsed(appId) {\n    try {\n      await this.db.apps.update(appId, { lastUsed: new Date() });\n    } catch (error) {\n      console.error('Errore aggiornamento ultimo utilizzo:', error);\n    }\n  }\n\n  // Toggle preferito\n  async toggleFavorite(appId) {\n    try {\n      const app = await this.db.apps.get(appId);\n      if (app) {\n        await this.db.apps.update(appId, { favorite: !app.favorite });\n        return !app.favorite;\n      }\n      return false;\n    } catch (error) {\n      console.error('Errore toggle preferito:', error);\n      return false;\n    }\n  }\n\n  /**\n   * APP FILES MANAGEMENT\n   */\n\n  // Salva file di un'app\n  async saveAppFiles(appId, files) {\n    try {\n      const filePromises = files.map(file => \n        this.db.appFiles.add({\n          appId,\n          filename: file.filename,\n          content: file.content,\n          size: file.size || file.content.length,\n          mimeType: file.mimeType || this.getMimeType(file.filename)\n        })\n      );\n\n      await Promise.all(filePromises);\n      return true;\n    } catch (error) {\n      console.error('Errore salvataggio file app:', error);\n      return false;\n    }\n  }\n\n  // Ottieni file di un'app\n  async getAppFiles(appId) {\n    try {\n      return await this.db.appFiles.where('appId').equals(appId).toArray();\n    } catch (error) {\n      console.error('Errore recupero file app:', error);\n      return [];\n    }\n  }\n\n  /**\n   * SETTINGS MANAGEMENT  \n   */\n\n  // Ottieni impostazione\n  async getSetting(key, defaultValue = null) {\n    try {\n      const setting = await this.db.settings.get(key);\n      return setting ? setting.value : defaultValue;\n    } catch (error) {\n      console.error('Errore recupero impostazione:', error);\n      return defaultValue;\n    }\n  }\n\n  // Salva impostazione\n  async setSetting(key, value) {\n    try {\n      await this.db.settings.put({\n        key,\n        value,\n        lastModified: new Date()\n      });\n      return true;\n    } catch (error) {\n      console.error('Errore salvataggio impostazione:', error);\n      return false;\n    }\n  }\n\n  // Ottieni tutte le impostazioni\n  async getAllSettings() {\n    try {\n      const settings = await this.db.settings.toArray();\n      const result = {};\n      settings.forEach(setting => {\n        result[setting.key] = setting.value;\n      });\n      return result;\n    } catch (error) {\n      console.error('Errore recupero impostazioni:', error);\n      return {};\n    }\n  }\n\n  /**\n   * SYNC EVENTS MANAGEMENT\n   */\n\n  // Aggiungi evento sync\n  async addSyncEvent(action, data) {\n    try {\n      await this.db.syncEvents.add({\n        action,\n        data,\n        timestamp: new Date(),\n        synced: false,\n        deviceId: await this.getDeviceId()\n      });\n    } catch (error) {\n      console.error('Errore aggiunta evento sync:', error);\n    }\n  }\n\n  // Ottieni eventi non sincronizzati\n  async getUnsyncedEvents() {\n    try {\n      return await this.db.syncEvents.where('synced').equals(false).toArray();\n    } catch (error) {\n      console.error('Errore recupero eventi non sincronizzati:', error);\n      return [];\n    }\n  }\n\n  // Marca eventi come sincronizzati\n  async markEventsSynced(eventIds) {\n    try {\n      await this.db.syncEvents.where('id').anyOf(eventIds).modify({ synced: true });\n    } catch (error) {\n      console.error('Errore aggiornamento eventi sync:', error);\n    }\n  }\n\n  /**\n   * CATALOG MANAGEMENT\n   */\n\n  // Aggiorna catalogo\n  async updateCatalog(apps) {\n    try {\n      await this.db.catalog.clear();\n      await this.db.catalog.bulkAdd(apps);\n      return true;\n    } catch (error) {\n      console.error('Errore aggiornamento catalogo:', error);\n      return false;\n    }\n  }\n\n  // Cerca nel catalogo\n  async searchCatalog(query, options = {}) {\n    try {\n      let result = this.db.catalog.orderBy('downloads').reverse();\n\n      if (query) {\n        result = result.filter(app =>\n          app.name.toLowerCase().includes(query.toLowerCase()) ||\n          app.description.toLowerCase().includes(query.toLowerCase()) ||\n          app.categories.some(cat => cat.toLowerCase().includes(query.toLowerCase()))\n        );\n      }\n\n      if (options.category) {\n        result = result.filter(app => app.categories.includes(options.category));\n      }\n\n      if (options.featured) {\n        result = result.filter(app => app.featured === true);\n      }\n\n      return await result.limit(options.limit || 50).toArray();\n    } catch (error) {\n      console.error('Errore ricerca catalogo:', error);\n      return [];\n    }\n  }\n\n  /**\n   * UTILITY METHODS\n   */\n\n  // Ottieni ID dispositivo univoco\n  async getDeviceId() {\n    let deviceId = await this.getSetting('deviceId');\n    if (!deviceId) {\n      deviceId = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();\n      await this.setSetting('deviceId', deviceId);\n    }\n    return deviceId;\n  }\n\n  // Ottieni MIME type da filename\n  getMimeType(filename) {\n    const ext = filename.split('.').pop().toLowerCase();\n    const mimeTypes = {\n      'html': 'text/html',\n      'css': 'text/css',\n      'js': 'application/javascript',\n      'json': 'application/json',\n      'png': 'image/png',\n      'jpg': 'image/jpeg',\n      'jpeg': 'image/jpeg',\n      'gif': 'image/gif',\n      'svg': 'image/svg+xml',\n      'txt': 'text/plain'\n    };\n    return mimeTypes[ext] || 'application/octet-stream';\n  }\n\n  // Esporta tutti i dati\n  async exportAllData() {\n    try {\n      const [apps, settings, syncEvents] = await Promise.all([\n        this.db.apps.toArray(),\n        this.db.settings.toArray(),\n        this.db.syncEvents.toArray()\n      ]);\n\n      return {\n        version: '1.0.0',\n        timestamp: new Date().toISOString(),\n        deviceId: await this.getDeviceId(),\n        data: { apps, settings, syncEvents }\n      };\n    } catch (error) {\n      console.error('Errore export dati:', error);\n      throw error;\n    }\n  }\n\n  // Importa dati\n  async importData(exportData) {\n    try {\n      if (!exportData.data) {\n        throw new Error('Formato dati non valido');\n      }\n\n      const { apps, settings, syncEvents } = exportData.data;\n\n      await this.db.transaction('rw', [this.db.apps, this.db.settings, this.db.syncEvents], async () => {\n        if (apps) await this.db.apps.bulkPut(apps);\n        if (settings) await this.db.settings.bulkPut(settings);\n        if (syncEvents) await this.db.syncEvents.bulkPut(syncEvents);\n      });\n\n      return true;\n    } catch (error) {\n      console.error('Errore import dati:', error);\n      throw error;\n    }\n  }\n\n  // Assicura che il database sia aperto\n  async ensureDbOpen() {\n    if (!this.db.isOpen()) {\n      try {\n        await this.db.open();\n        console.log(' Database riaperto con successo');\n      } catch (err) {\n        console.error(' Errore riapertura database:', err);\n      }\n    }\n  }\n\n  // Ottieni statistiche\n  async getStats() {\n    try {\n      await this.ensureDbOpen();\n      // Verifica che il database sia inizializzato\n      if (!this.db || !this.db.isOpen()) {\n        console.warn('Database non inizializzato');\n        return null;\n      }\n      // Recupera tutte le app per filtrare dati corrotti\n      const allApps = await this.db.apps.toArray().catch(() => []);\n      // Filtra solo app con campi validi\n      const validApps = allApps.filter(app => app && typeof app === 'object');\n      const validCategories = validApps.map(app => app.category).filter(cat => typeof cat === 'string' && cat.length > 0);\n      const favoriteApps = validApps.filter(app => app.favorite === true).length;\n      const totalApps = validApps.length;\n      const totalFiles = await this.db.appFiles.count().catch(() => 0);\n      const settingsCount = await this.db.settings.count().catch(() => 0);\n      const lastInstall = validApps.length > 0 ? validApps.reduce((latest, app) => {\n        if (app.installDate && (!latest || new Date(app.installDate) > new Date(latest))) {\n          return app.installDate;\n        }\n        return latest;\n      }, null) : null;\n      return {\n        totalApps,\n        totalFiles,\n        settingsCount,\n        favoriteApps,\n        categories: Array.from(new Set(validCategories)).length,\n        lastInstall,\n        dbSize: await this.estimateDbSize()\n      };\n    } catch (error) {\n      console.error('Errore recupero statistiche:', error);\n      return null;\n    }\n  }\n\n  // Stima dimensione database\n  async estimateDbSize() {\n    try {\n      if ('storage' in navigator && 'estimate' in navigator.storage) {\n        const estimate = await navigator.storage.estimate();\n        return estimate.usage || 0;\n      }\n      return 0;\n    } catch (error) {\n      return 0;\n    }\n  }\n\n  // Chiudi connessione database\n  async close() {\n    if (this.db) {\n      this.db.close();\n    }\n  }\n}\n\n// Esporta istanza singleton\nexport default new StorageService();","/**\n * AIdeas - Utility Functions & Helpers\n * Funzioni di utilit per l'applicazione\n */\n\n/**\n * TOAST NOTIFICATIONS\n */\n\nlet toastCounter = 0;\n\n/**\n * Mostra una notifica toast\n * @param {string} message - Messaggio da mostrare\n * @param {string} type - Tipo: 'success', 'error', 'warning', 'info'\n * @param {number} duration - Durata in ms (default 4000)\n * @param {Object} options - Opzioni aggiuntive\n */\nexport function showToast(message, type = 'info', duration = 4000, options = {}) {\n  const toastContainer = document.getElementById('toast-container');\n  if (!toastContainer) {\n    console.warn('Toast container non trovato');\n    return;\n  }\n\n  const toastId = `toast-${++toastCounter}`;\n  const toast = document.createElement('div');\n  \n  toast.id = toastId;\n  toast.className = `toast toast-${type}`;\n  toast.setAttribute('role', 'alert');\n  toast.setAttribute('aria-live', 'polite');\n  \n  // Icone per i diversi tipi\n  const icons = {\n    success: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path d=\"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z\"/>\n    </svg>`,\n    error: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path d=\"M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z\"/>\n    </svg>`,\n    warning: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path d=\"M13,13H11V7H13M12,17.3A1.3,1.3 0 0,1 10.7,16A1.3,1.3 0 0,1 12,14.7A1.3,1.3 0 0,1 13.3,16A1.3,1.3 0 0,1 12,17.3M15.73,3H8.27L3,8.27V15.73L8.27,21H15.73L21,15.73V8.27L15.73,3Z\"/>\n    </svg>`,\n    info: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path d=\"M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z\"/>\n    </svg>`\n  };\n\n  toast.innerHTML = `\n    <div class=\"toast-icon\">\n      ${icons[type] || icons.info}\n    </div>\n    <div class=\"toast-content\">\n      <div class=\"toast-message\">${escapeHtml(message)}</div>\n      ${options.action ? `<button class=\"toast-action\">${options.action}</button>` : ''}\n    </div>\n    <button class=\"toast-close\" aria-label=\"Chiudi notifica\">\n      <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n        <path d=\"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z\"/>\n      </svg>\n    </button>\n  `;\n\n  // Event listeners\n  const closeBtn = toast.querySelector('.toast-close');\n  const actionBtn = toast.querySelector('.toast-action');\n  \n  const removeToast = () => {\n    toast.classList.add('toast-removing');\n    setTimeout(() => {\n      if (toast.parentNode) {\n        toast.parentNode.removeChild(toast);\n      }\n    }, 300);\n  };\n\n  closeBtn.addEventListener('click', removeToast);\n  \n  if (actionBtn && options.onAction) {\n    actionBtn.addEventListener('click', () => {\n      options.onAction();\n      removeToast();\n    });\n  }\n\n  // Aggiungi al container\n  toastContainer.appendChild(toast);\n  \n  // Animazione di entrata\n  requestAnimationFrame(() => {\n    toast.classList.add('toast-show');\n  });\n\n  // Auto-remove dopo duration\n  if (duration > 0) {\n    setTimeout(removeToast, duration);\n  }\n\n  return toastId;\n}\n\n/**\n * Rimuove un toast specifico\n * @param {string} toastId - ID del toast da rimuovere\n */\nexport function removeToast(toastId) {\n  const toast = document.getElementById(toastId);\n  if (toast) {\n    toast.querySelector('.toast-close').click();\n  }\n}\n\n/**\n * Rimuove tutti i toast\n */\nexport function clearAllToasts() {\n  const toasts = document.querySelectorAll('.toast');\n  toasts.forEach(toast => {\n    toast.querySelector('.toast-close').click();\n  });\n}\n\n/**\n * Nasconde un toast specifico (alias per removeToast)\n * @param {string} toastId - ID del toast da nascondere\n */\nexport function hideToast(toastId) {\n  if (toastId) {\n    removeToast(toastId);\n  } else {\n    // Se non specificato, nasconde tutti i toast\n    clearAllToasts();\n  }\n}\n\n/**\n * MODAL MANAGEMENT\n */\n\n/**\n * Mostra un modal\n * @param {string} modalId - ID del modal\n * @param {string} content - Contenuto HTML del modal\n * @param {Object} options - Opzioni aggiuntive\n */\nexport function showModal(modalId, content, options = {}) {\n  const modalsContainer = document.getElementById('modals-container');\n  if (!modalsContainer) {\n    console.warn('Modals container non trovato');\n    return;\n  }\n\n  // Rimuovi modal esistente con stesso ID\n  const existingModal = document.getElementById(modalId);\n  if (existingModal) {\n    existingModal.remove();\n  }\n\n  const modal = document.createElement('div');\n  modal.id = modalId;\n  modal.className = 'modal';\n  modal.setAttribute('role', 'dialog');\n  modal.setAttribute('aria-modal', 'true');\n  modal.setAttribute('aria-labelledby', `${modalId}-title`);\n\n  modal.innerHTML = `\n    <div class=\"modal-backdrop\"></div>\n    <div class=\"modal-dialog ${options.size || 'modal-md'}\">\n      <div class=\"modal-content\">\n        ${content}\n      </div>\n    </div>\n  `;\n\n  // Event listeners\n  const backdrop = modal.querySelector('.modal-backdrop');\n  const closeButtons = modal.querySelectorAll('.modal-close');\n\n  const closeModal = (e) => {\n    if (e) e.preventDefault();\n    modal.classList.add('modal-closing');\n    setTimeout(() => {\n      if (modal.parentNode) {\n        modal.parentNode.removeChild(modal);\n      }\n      // Ripristina focus\n      if (options.returnFocus) {\n        options.returnFocus.focus();\n      }\n    }, 300);\n  };\n\n  // Click su backdrop\n  if (!options.disableBackdropClose) {\n    backdrop.addEventListener('click', closeModal);\n  }\n\n  // Click sui pulsanti close\n  closeButtons.forEach(btn => {\n    btn.addEventListener('click', closeModal);\n  });\n\n  // Escape key\n  const handleEscape = (e) => {\n    if (e.key === 'Escape' && !options.disableEscapeClose) {\n      closeModal();\n      document.removeEventListener('keydown', handleEscape);\n    }\n  };\n  document.addEventListener('keydown', handleEscape);\n\n  // Salva focus corrente\n  const currentFocus = document.activeElement;\n  options.returnFocus = currentFocus;\n\n  // Aggiungi al DOM\n  modalsContainer.appendChild(modal);\n\n  // Animazione di entrata\n  requestAnimationFrame(() => {\n    modal.classList.add('modal-show');\n    \n    // Focus sul primo elemento focusabile\n    const focusableElements = modal.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    if (focusableElements.length > 0) {\n      focusableElements[0].focus();\n    }\n  });\n\n  return modal;\n}\n\n/**\n * Nasconde un modal\n * @param {string} modalId - ID del modal da nascondere\n */\nexport function hideModal(modalId) {\n  const modal = document.getElementById(modalId);\n  if (modal) {\n    const closeBtn = modal.querySelector('.modal-close');\n    if (closeBtn) {\n      closeBtn.click();\n    }\n  }\n}\n\n/**\n * Nasconde tutti i modal\n */\nexport function hideAllModals() {\n  const modals = document.querySelectorAll('.modal');\n  modals.forEach(modal => {\n    hideModal(modal.id);\n  });\n}\n\n/**\n * UTILITY FUNCTIONS\n */\n\n/**\n * Escape HTML per prevenire XSS\n * @param {string} text - Testo da escapare\n * @returns {string} Testo escapato\n */\nexport function escapeHtml(text) {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Formatta dimensione file in formato leggibile\n * @param {number} bytes - Dimensione in bytes\n * @param {number} decimals - Numero di decimali (default 2)\n * @returns {string} Dimensione formattata\n */\nexport function formatFileSize(bytes, decimals = 2) {\n  if (bytes === 0) return '0 Bytes';\n\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\n/**\n * Formatta data in formato locale\n * @param {Date|string|number} date - Data da formattare\n * @param {Object} options - Opzioni Intl.DateTimeFormat\n * @returns {string} Data formattata\n */\nexport function formatDate(date, options = {}) {\n  const dateObj = new Date(date);\n  if (isNaN(dateObj.getTime())) return 'Data non valida';\n\n  const defaultOptions = {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  };\n\n  return new Intl.DateTimeFormat('it-IT', { ...defaultOptions, ...options }).format(dateObj);\n}\n\n/**\n * Formatta data relativa (es. \"2 ore fa\")\n * @param {Date|string|number} date - Data da formattare\n * @returns {string} Data relativa\n */\nexport function formatRelativeDate(date) {\n  const dateObj = new Date(date);\n  if (isNaN(dateObj.getTime())) return 'Data non valida';\n\n  const now = new Date();\n  const diffMs = now - dateObj;\n  const diffSeconds = Math.floor(diffMs / 1000);\n  const diffMinutes = Math.floor(diffSeconds / 60);\n  const diffHours = Math.floor(diffMinutes / 60);\n  const diffDays = Math.floor(diffHours / 24);\n  const diffWeeks = Math.floor(diffDays / 7);\n  const diffMonths = Math.floor(diffDays / 30);\n  const diffYears = Math.floor(diffDays / 365);\n\n  if (diffSeconds < 60) return 'Proprio ora';\n  if (diffMinutes < 60) return `${diffMinutes} minut${diffMinutes === 1 ? 'o' : 'i'} fa`;\n  if (diffHours < 24) return `${diffHours} or${diffHours === 1 ? 'a' : 'e'} fa`;\n  if (diffDays < 7) return `${diffDays} giorn${diffDays === 1 ? 'o' : 'i'} fa`;\n  if (diffWeeks < 4) return `${diffWeeks} settiman${diffWeeks === 1 ? 'a' : 'e'} fa`;\n  if (diffMonths < 12) return `${diffMonths} mes${diffMonths === 1 ? 'e' : 'i'} fa`;\n  return `${diffYears} ann${diffYears === 1 ? 'o' : 'i'} fa`;\n}\n\n/**\n * Genera ID univoco\n * @param {string} prefix - Prefisso per l'ID\n * @returns {string} ID univoco\n */\nexport function generateId(prefix = 'id') {\n  return `${prefix}-${Math.random().toString(36).substr(2, 9)}-${Date.now()}`;\n}\n\n/**\n * Debounce function per ottimizzare performance\n * @param {Function} func - Funzione da eseguire\n * @param {number} wait - Millisecondi di attesa\n * @param {boolean} immediate - Esecuzione immediata\n * @returns {Function} Funzione debounced\n */\nexport function debounce(func, wait, immediate = false) {\n  let timeout;\n  return function executedFunction(...args) {\n    const later = () => {\n      timeout = null;\n      if (!immediate) func.apply(this, args);\n    };\n    const callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) func.apply(this, args);\n  };\n}\n\n/**\n * Throttle function per limitare chiamate\n * @param {Function} func - Funzione da eseguire\n * @param {number} limit - Limite in millisecondi\n * @returns {Function} Funzione throttled\n */\nexport function throttle(func, limit) {\n  let inThrottle;\n  return function executedFunction(...args) {\n    if (!inThrottle) {\n      func.apply(this, args);\n      inThrottle = true;\n      setTimeout(() => inThrottle = false, limit);\n    }\n  };\n}\n\n/**\n * Copia testo negli appunti\n * @param {string} text - Testo da copiare\n * @returns {Promise<boolean>} Successo dell'operazione\n */\nexport async function copyToClipboard(text) {\n  try {\n    if (navigator.clipboard && window.isSecureContext) {\n      await navigator.clipboard.writeText(text);\n      return true;\n    } else {\n      // Fallback per browser pi vecchi\n      const textArea = document.createElement('textarea');\n      textArea.value = text;\n      textArea.style.cssText = 'position: fixed; left: -999999px; top: -999999px;';\n      document.body.appendChild(textArea);\n      textArea.focus();\n      textArea.select();\n      \n      const success = document.execCommand('copy');\n      document.body.removeChild(textArea);\n      return success;\n    }\n  } catch (error) {\n    console.error('Errore copia negli appunti:', error);\n    return false;\n  }\n}\n\n/**\n * Verifica se il dispositivo  mobile\n * @returns {boolean} True se  mobile\n */\nexport function isMobile() {\n  return window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n}\n\n/**\n * Verifica se il dispositivo supporta le PWA\n * @returns {boolean} True se supporta PWA\n */\nexport function isPWASupported() {\n  return 'serviceWorker' in navigator && 'manifests' in window;\n}\n\n/**\n * Ottieni informazioni sul dispositivo\n * @returns {Object} Info dispositivo\n */\nexport function getDeviceInfo() {\n  return {\n    userAgent: navigator.userAgent,\n    platform: navigator.platform,\n    language: navigator.language,\n    online: navigator.onLine,\n    cookieEnabled: navigator.cookieEnabled,\n    screen: {\n      width: screen.width,\n      height: screen.height,\n      colorDepth: screen.colorDepth\n    },\n    viewport: {\n      width: window.innerWidth,\n      height: window.innerHeight\n    },\n    isMobile: isMobile(),\n    isPWASupported: isPWASupported()\n  };\n}\n\n/**\n * Valida URL\n * @param {string} url - URL da validare\n * @returns {boolean} True se valido\n */\nexport function isValidUrl(url) {\n  try {\n    new URL(url);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Estrae dominio da URL\n * @param {string} url - URL di origine\n * @returns {string} Dominio estratto\n */\nexport function extractDomain(url) {\n  try {\n    return new URL(url).hostname;\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Converte blob in base64\n * @param {Blob} blob - Blob da convertire\n * @returns {Promise<string>} Base64 string\n */\nexport function blobToBase64(blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(reader.result.split(',')[1]);\n    reader.onerror = reject;\n    reader.readAsDataURL(blob);\n  });\n}\n\n/**\n * Converte base64 in blob\n * @param {string} base64 - String base64\n * @param {string} mimeType - Tipo MIME\n * @returns {Blob} Blob risultante\n */\nexport function base64ToBlob(base64, mimeType) {\n  const byteCharacters = atob(base64);\n  const byteNumbers = new Array(byteCharacters.length);\n  \n  for (let i = 0; i < byteCharacters.length; i++) {\n    byteNumbers[i] = byteCharacters.charCodeAt(i);\n  }\n  \n  const byteArray = new Uint8Array(byteNumbers);\n  return new Blob([byteArray], { type: mimeType });\n}\n\n/**\n * Scarica file dal browser\n * @param {string|Blob} data - Dati da scaricare\n * @param {string} filename - Nome file\n * @param {string} mimeType - Tipo MIME (se data  string)\n */\nexport function downloadFile(data, filename, mimeType = 'application/octet-stream') {\n  const blob = data instanceof Blob ? data : new Blob([data], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n  \n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n}\n\n/**\n * Ottieni hash di una stringa\n * @param {string} str - Stringa di input\n * @returns {Promise<string>} Hash SHA-256\n */\nexport async function getStringHash(str) {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(str);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\n/**\n * Sleep utility per async/await\n * @param {number} ms - Millisecondi di attesa\n * @returns {Promise} Promise che si risolve dopo ms\n */\nexport function sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Mostra un popup di conferma personalizzato\n * @param {Object} options - Opzioni del popup\n * @param {string} options.title - Titolo del popup\n * @param {string} options.message - Messaggio del popup\n * @param {string} options.icon - Icona (opzionale)\n * @param {string} options.confirmText - Testo del pulsante conferma\n * @param {string} options.cancelText - Testo del pulsante annulla\n * @param {string} options.type - Tipo di popup (default, danger, warning)\n * @returns {Promise<boolean>} - True se confermato, false se annullato\n */\nexport function showConfirmPopup(options = {}) {\n  return new Promise((resolve) => {\n    const {\n      title = 'Conferma',\n      message = 'Sei sicuro di voler continuare?',\n      icon = 'question',\n      confirmText = 'Conferma',\n      cancelText = 'Annulla',\n      type = 'default'\n    } = options;\n\n    // Crea il popup\n    const popup = document.createElement('div');\n    popup.className = 'confirm-popup';\n    \n    // Icone per tipo\n    const icons = {\n      question: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"confirm-popup-icon\">\n        <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z\"/>\n      </svg>`,\n      warning: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"confirm-popup-icon\">\n        <path d=\"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z\"/>\n      </svg>`,\n      danger: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"confirm-popup-icon\">\n        <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/>\n      </svg>`,\n      info: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"confirm-popup-icon\">\n        <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z\"/>\n      </svg>`\n    };\n\n    const iconHtml = icons[icon] || icons.question;\n    const confirmBtnClass = type === 'danger' ? 'confirm-popup-btn-danger' : 'confirm-popup-btn-primary';\n\n    popup.innerHTML = `\n      <div class=\"confirm-popup-content\">\n        <div class=\"confirm-popup-header\">\n          <h3 class=\"confirm-popup-title\">\n            ${iconHtml}\n            ${title}\n          </h3>\n        </div>\n        <div class=\"confirm-popup-body\">\n          ${message}\n        </div>\n        <div class=\"confirm-popup-footer\">\n          <button class=\"confirm-popup-btn confirm-popup-btn-secondary\" data-action=\"cancel\">\n            ${cancelText}\n          </button>\n          <button class=\"confirm-popup-btn ${confirmBtnClass}\" data-action=\"confirm\">\n            ${confirmText}\n          </button>\n        </div>\n      </div>\n    `;\n\n    // Gestisci click sui pulsanti\n    const handleAction = (action) => {\n      document.body.removeChild(popup);\n      resolve(action === 'confirm');\n    };\n\n    popup.addEventListener('click', (e) => {\n      if (e.target === popup) {\n        handleAction('cancel');\n      }\n    });\n\n    popup.querySelectorAll('[data-action]').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        e.preventDefault();\n        handleAction(btn.dataset.action);\n      });\n    });\n\n    // Gestisci tasto ESC\n    const handleKeydown = (e) => {\n      if (e.key === 'Escape') {\n        document.removeEventListener('keydown', handleKeydown);\n        handleAction('cancel');\n      }\n    };\n\n    document.addEventListener('keydown', handleKeydown);\n\n    // Aggiungi al DOM\n    document.body.appendChild(popup);\n\n    // Focus sul primo pulsante\n    setTimeout(() => {\n      popup.querySelector('.confirm-popup-btn-secondary').focus();\n    }, 100);\n  });\n}\n\n/**\n * Mostra un popup di conferma per l'eliminazione di un'app\n * @param {string} appName - Nome dell'app da eliminare\n * @returns {Promise<boolean>} - True se confermato\n */\nexport function showDeleteAppConfirm(appName) {\n  return showConfirmPopup({\n    title: 'Elimina App',\n    message: `Sei sicuro di voler eliminare \"${appName}\"? Questa azione non pu essere annullata.`,\n    icon: 'danger',\n    confirmText: 'Elimina',\n    cancelText: 'Annulla',\n    type: 'danger'\n  });\n}\n\n/**\n * Mostra un popup di conferma per l'importazione di un'app\n * @param {string} appName - Nome dell'app da importare\n * @param {string} appUrl - URL dell'app\n * @returns {Promise<boolean>} - True se confermato\n */\nexport function showImportAppConfirm(appName, appUrl) {\n  return showConfirmPopup({\n    title: 'Importa App',\n    message: `Importare \"${appName}\" da ${appUrl}?`,\n    icon: 'info',\n    confirmText: 'Importa',\n    cancelText: 'Annulla',\n    type: 'default'\n  });\n}\n\n/**\n * Mostra un popup di conferma per il reset delle impostazioni\n * @returns {Promise<boolean>} - True se confermato\n */\nexport function showResetSettingsConfirm() {\n  return showConfirmPopup({\n    title: 'Reset Impostazioni',\n    message: 'Sei sicuro di voler ripristinare tutte le impostazioni ai valori predefiniti? Questa azione non pu essere annullata.',\n    icon: 'warning',\n    confirmText: 'Reset',\n    cancelText: 'Annulla',\n    type: 'danger'\n  });\n}\n\nexport default {\n  // Toast\n  showToast,\n  hideToast,\n  removeToast,\n  clearAllToasts,\n  \n  // Modal\n  showModal,\n  hideModal,\n  hideAllModals,\n  \n  // Utility\n  escapeHtml,\n  formatFileSize,\n  formatDate,\n  formatRelativeDate,\n  generateId,\n  debounce,\n  throttle,\n  copyToClipboard,\n  isMobile,\n  isPWASupported,\n  getDeviceInfo,\n  isValidUrl,\n  extractDomain,\n  blobToBase64,\n  base64ToBlob,\n  downloadFile,\n  getStringHash,\n  sleep,\n  \n  // Confirm Popup\n  showConfirmPopup,\n  showDeleteAppConfirm,\n  showImportAppConfirm,\n  showResetSettingsConfirm\n};","/**\n * AIdeas - App Launcher Component\n * Gestisce l'apertura e l'esecuzione delle applicazioni\n */\n\nimport StorageService from '../services/StorageService.js';\nimport { \n  showToast, \n  hideToast, \n  showConfirmPopup,\n  showDeleteAppConfirm,\n  showImportAppConfirm,\n  showResetSettingsConfirm,\n  showModal,\n  hideModal,\n  escapeHtml,\n  generateId\n} from '../utils/helpers.js';\n\n/**\n * Classe per gestire il lancio delle applicazioni\n */\nexport default class AppLauncher {\n  constructor() {\n    this.activeApps = new Map(); // Mappa delle app attualmente in esecuzione\n    this.launchHistory = [];\n    this.maxConcurrentApps = 5;\n    \n    // Bind methods\n    this.launch = this.launch.bind(this);\n    this.launchZipApp = this.launchZipApp.bind(this);\n    this.launchUrlApp = this.launchUrlApp.bind(this);\n    this.launchGitHubApp = this.launchGitHubApp.bind(this);\n    this.launchPWA = this.launchPWA.bind(this);\n    this.createSecureFrame = this.createSecureFrame.bind(this);\n    this.closeApp = this.closeApp.bind(this);\n    this.setupEventListeners = this.setupEventListeners.bind(this);\n  }\n\n  /**\n   * Inizializza il launcher\n   */\n  async init() {\n    this.setupEventListeners();\n    await this.loadLaunchHistory();\n  }\n\n  /**\n   * Lancia un'applicazione\n   * @param {Object} app - Dati dell'applicazione\n   * @param {Object} options - Opzioni di lancio\n   */\n  async launch(app, options = {}) {\n    try {\n      console.log(` Launching app: ${app.name} (${app.type})`);\n\n      // Carica preferenze di lancio\n      const launchMode = await StorageService.getSetting('defaultLaunchMode', 'newpage'); // Cambiato default da 'iframe' a 'newpage'\n      const appSpecificMode = app.metadata?.launchMode; // Override per app specifica\n      \n      // Determina modalit finale\n      const finalLaunchMode = options.forceMode || appSpecificMode || launchMode;\n      options.launchMode = finalLaunchMode;\n\n      // Verifica limiti concorrenti (solo per iframe)\n      if (finalLaunchMode === 'iframe' && this.activeApps.size >= this.maxConcurrentApps && !options.force) {\n        const confirmed = await this.showConcurrentAppsDialog();\n        if (!confirmed) return;\n      }\n\n      // Validazione app\n      const validation = await this.validateApp(app);\n      if (!validation.valid) {\n        throw new Error(validation.error);\n      }\n\n      // Preparazione lancio\n      const launchId = generateId('launch');\n      const startTime = Date.now();\n\n      // Mostra loading\n      showToast(`Caricamento ${app.name}...`, 'info', 0);\n\n      let iframe;\n\n      // Lancia l'app in base al tipo\n      switch (app.type) {\n        case 'zip':\n          iframe = await this.launchZipApp(app, options);\n          break;\n        case 'html':\n          iframe = await this.launchHtmlApp(app, options);\n          break;\n        case 'github':\n          iframe = await this.launchGitHubApp(app, options);\n          break;\n        case 'pwa':\n          iframe = await this.launchPWA(app, options);\n          break;\n        default:\n          iframe = await this.launchUrlApp(app, options);\n      }\n\n      // Aggiorna stato\n      this.activeApps.set(launchId, {\n        app,\n        iframe,\n        startTime: Date.now(),\n        launchMode: finalLaunchMode\n      });\n\n      // Aggiungi alla cronologia\n      this.addToHistory(app, launchId);\n\n      // Nascondi loading\n      hideToast();\n\n      return iframe;\n\n    } catch (error) {\n      console.error('Errore lancio app:', error);\n      hideToast();\n      showToast(`Errore nel lancio di ${app.name}: ${error.message}`, 'error');\n      throw error;\n    }\n  }\n\n  /**\n   * Lancia un'app ZIP\n   * @param {Object} app - Dati dell'app\n   * @param {Object} options - Opzioni di lancio\n   */\n  async launchZipApp(app, options = {}) {\n    try {\n      // Carica i file dell'app dal database\n      const appFiles = await StorageService.getAppFiles(app.id);\n      if (!appFiles.length) {\n        throw new Error('File dell\\'app non trovati');\n      }\n\n      // Trova il file entry point\n      const entryPoint = this.findEntryPoint(appFiles, app.manifest?.entryPoint);\n      if (!entryPoint) {\n        throw new Error('Entry point non trovato');\n      }\n\n      // Crea blob URLs per tutti i file\n      const fileMap = new Map();\n      const blobUrls = new Map();\n\n      for (const file of appFiles) {\n        const blob = new Blob([file.content], { type: file.mimeType });\n        const blobUrl = URL.createObjectURL(blob);\n        fileMap.set(file.filename, file);\n        blobUrls.set(file.filename, blobUrl);\n      }\n\n      // Modifica l'HTML entry point per aggiustare TUTTI i percorsi\n      let htmlContent = entryPoint.content;\n      \n      // Sostituisci TUTTI i percorsi relativi con blob URLs (pi aggressivo)\n      htmlContent = this.replaceAllLocalPaths(htmlContent, blobUrls, app);\n\n      // Crea il blob per l'entry point modificato\n      const htmlBlob = new Blob([htmlContent], { type: 'text/html' });\n      const htmlBlobUrl = URL.createObjectURL(htmlBlob);\n\n      // Determina modalit di lancio\n      if (options.launchMode === 'newpage') {\n        // Apri in nuova pagina\n        const newWindow = window.open('', `aideas_zip_${app.id}_${Date.now()}`, \n          'width=1200,height=800,scrollbars=yes,resizable=yes');\n        \n        if (!newWindow) {\n          throw new Error('Popup bloccato dal browser. Consenti i popup per AIdeas.');\n        }\n\n        // Scrivi il contenuto direttamente nella nuova finestra\n        newWindow.document.write(htmlContent);\n        newWindow.document.close();\n\n        // Inietta API AIdeas\n        this.injectAIdeasAPI({ contentWindow: newWindow }, app);\n\n        // Setup cleanup\n        const cleanup = () => {\n          for (const url of blobUrls.values()) {\n            URL.revokeObjectURL(url);\n          }\n          URL.revokeObjectURL(htmlBlobUrl);\n        };\n\n        newWindow.addEventListener('beforeunload', cleanup);\n\n        return {\n          window: newWindow,\n          external: true,\n          cleanup\n        };\n      } else {\n        // Modalit iframe (default)\n        const iframe = this.createSecureFrame(app, {\n          src: htmlBlobUrl,\n          sandbox: 'allow-scripts allow-forms allow-modals allow-popups-to-escape-sandbox allow-same-origin',\n          files: fileMap,\n          blobUrls\n        });\n\n        // Setup cleanup quando l'iframe viene chiuso\n        iframe.addEventListener('unload', () => {\n          for (const url of blobUrls.values()) {\n            URL.revokeObjectURL(url);\n          }\n          URL.revokeObjectURL(htmlBlobUrl);\n        });\n\n        return {\n          iframe,\n          window: iframe.contentWindow,\n          cleanup: () => {\n            for (const url of blobUrls.values()) {\n              URL.revokeObjectURL(url);\n            }\n            URL.revokeObjectURL(htmlBlobUrl);\n          }\n        };\n      }\n\n    } catch (error) {\n      console.error('Errore lancio app ZIP:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Lancia un'app HTML\n   * @param {Object} app - Dati dell'app\n   * @param {Object} options - Opzioni di lancio\n   */\n  async launchHtmlApp(app, options = {}) {\n    try {\n      // Validazione contenuto HTML\n      if (!app.content) {\n        throw new Error('Contenuto HTML mancante');\n      }\n\n      // Inietta CSP personalizzata basata sull'analisi del contenuto\n      let modifiedContent = await this.injectCSPForHTMLApp(app.content, app.id);\n\n      // Crea blob URL per il contenuto HTML modificato\n      const htmlBlob = new Blob([modifiedContent], { type: 'text/html' });\n      const htmlBlobUrl = URL.createObjectURL(htmlBlob);\n\n      // Determina modalit di lancio\n      if (options.launchMode === 'newpage') {\n        // Modalit nuova finestra - usa document.write per massima compatibilit\n        const newWindow = window.open('', `aideas_html_${app.id}_${Date.now()}`,\n          'width=1200,height=800,scrollbars=yes,resizable=yes');\n        if (!newWindow) {\n          throw new Error('Popup bloccato dal browser. Consenti i popup per AIdeas.');\n        }\n        \n        // Scrivi direttamente il contenuto HTML\n        newWindow.document.open();\n        newWindow.document.write(modifiedContent);\n        newWindow.document.close();\n        \n        return {\n          window: newWindow,\n          external: true,\n          cleanup: () => {\n            URL.revokeObjectURL(htmlBlobUrl);\n          }\n        };\n      } else {\n        // Modalit iframe (default) - usa blob URL con CSP corretta\n        const iframe = this.createSecureFrame(app, {\n          src: htmlBlobUrl,\n          sandbox: 'allow-scripts allow-forms allow-modals allow-popups-to-escape-sandbox allow-same-origin'\n        });\n\n        // Setup cleanup quando l'iframe viene chiuso\n        iframe.addEventListener('unload', () => {\n          URL.revokeObjectURL(htmlBlobUrl);\n        });\n\n        return {\n          iframe,\n          window: iframe.contentWindow,\n          cleanup: () => {\n            URL.revokeObjectURL(htmlBlobUrl);\n          }\n        };\n      }\n\n    } catch (error) {\n      console.error('Errore lancio app HTML:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Analizza l'HTML per trovare CDN e risorse esterne\n   * @param {string} htmlContent - Contenuto HTML da analizzare\n   * @returns {Object} - Oggetto con domini trovati per categoria\n   */\n  analyzeHTMLForExternalResources(htmlContent) {\n    const domains = {\n      scripts: new Set(),\n      styles: new Set(),\n      fonts: new Set(),\n      images: new Set(),\n      frames: new Set(),\n      connections: new Set()\n    };\n\n    // Regex per trovare URL esterni\n    const patterns = {\n      scripts: /<script[^>]*src=[\"']([^\"']+)[\"'][^>]*>/gi,\n      styles: /<link[^>]*href=[\"']([^\"']+)[\"'][^>]*>/gi,\n      fonts: /<link[^>]*href=[\"']([^\"']+)[\"'][^>]*rel=[\"'](?:preload|stylesheet)[\"'][^>]*>/gi,\n      images: /<img[^>]*src=[\"']([^\"']+)[\"'][^>]*>/gi,\n      frames: /<iframe[^>]*src=[\"']([^\"']+)[\"'][^>]*>/gi,\n      connections: /fetch\\([\"']([^\"']+)[\"']\\)|XMLHttpRequest\\([\"']([^\"']+)[\"']\\)/gi\n    };\n\n    // Estrai domini da URL\n    const extractDomain = (url) => {\n      try {\n        if (url.startsWith('//')) {\n          url = 'https:' + url;\n        } else if (url.startsWith('/')) {\n          return null; // URL relativo\n        } else if (!url.startsWith('http')) {\n          return null; // URL relativo o data URL\n        }\n        return new URL(url).hostname;\n      } catch (e) {\n        return null;\n      }\n    };\n\n    // Analizza script tags\n    let match;\n    while ((match = patterns.scripts.exec(htmlContent)) !== null) {\n      const domain = extractDomain(match[1]);\n      if (domain) domains.scripts.add(domain);\n    }\n\n    // Analizza link tags (CSS e font)\n    while ((match = patterns.styles.exec(htmlContent)) !== null) {\n      const domain = extractDomain(match[1]);\n      if (domain) {\n        // Determina se  CSS o font basandosi su rel o type\n        const linkTag = match[0];\n        if (linkTag.includes('rel=\"stylesheet\"') || linkTag.includes('type=\"text/css\"')) {\n          domains.styles.add(domain);\n        } else if (linkTag.includes('rel=\"preload\"') && linkTag.includes('as=\"font\"')) {\n          domains.fonts.add(domain);\n        }\n      }\n    }\n\n    // Analizza img tags\n    while ((match = patterns.images.exec(htmlContent)) !== null) {\n      const domain = extractDomain(match[1]);\n      if (domain) domains.images.add(domain);\n    }\n\n    // Analizza iframe tags\n    while ((match = patterns.frames.exec(htmlContent)) !== null) {\n      const domain = extractDomain(match[1]);\n      if (domain) domains.frames.add(domain);\n    }\n\n    // Analizza fetch/XMLHttpRequest calls\n    while ((match = patterns.connections.exec(htmlContent)) !== null) {\n      const url = match[1] || match[2];\n      const domain = extractDomain(url);\n      if (domain) domains.connections.add(domain);\n    }\n\n    // Converti Set in array\n    return {\n      scripts: Array.from(domains.scripts),\n      styles: Array.from(domains.styles),\n      fonts: Array.from(domains.fonts),\n      images: Array.from(domains.images),\n      frames: Array.from(domains.frames),\n      connections: Array.from(domains.connections)\n    };\n  }\n\n  /**\n   * Genera CSP personalizzata basata sui domini trovati\n   * @param {Object} domains - Domini trovati dall'analisi\n   * @returns {string} - CSP personalizzata\n   */\n  generateCustomCSP(domains) {\n    const allDomains = new Set();\n    \n    // Raccogli tutti i domini\n    Object.values(domains).forEach(domainList => {\n      domainList.forEach(domain => allDomains.add(domain));\n    });\n\n    const domainList = Array.from(allDomains);\n    \n    // CSP base con domini trovati\n    let csp = \"default-src 'self' data: blob: 'unsafe-inline' 'unsafe-eval'; \";\n    csp += \"script-src 'self' data: blob: 'unsafe-inline' 'unsafe-eval' \" + domainList.join(' ') + \"; \";\n    csp += \"style-src 'self' data: blob: 'unsafe-inline' \" + domainList.join(' ') + \"; \";\n    csp += \"img-src 'self' data: blob: \" + domainList.join(' ') + \"; \";\n    csp += \"font-src 'self' data: blob: \" + domainList.join(' ') + \"; \";\n    csp += \"connect-src 'self' data: blob: \" + domainList.join(' ') + \"; \";\n    csp += \"frame-src 'self' data: blob: \" + domainList.join(' ') + \"; \";\n    csp += \"object-src 'self' data: blob:; \";\n    csp += \"base-uri 'self'; \";\n    csp += \"form-action 'self';\";\n\n    return csp;\n  }\n\n  /**\n   * Inietta CSP personalizzata per app HTML basata sull'analisi del contenuto\n   * @param {string} htmlContent - Contenuto HTML originale\n   * @param {string} appId - ID dell'app per caching\n   * @returns {string} - Contenuto HTML con CSP modificata\n   */\n  async injectCSPForHTMLApp(htmlContent, appId = null) {\n    try {\n      let customCSP = null;\n      let domains = null;\n\n      // Se abbiamo un ID app, controlla se abbiamo gi una CSP cached\n      if (appId) {\n        const cachedCSP = await StorageService.getAppMetadata(appId, 'customCSP');\n        const cachedDomains = await StorageService.getAppMetadata(appId, 'externalDomains');\n        const lastAnalyzed = await StorageService.getAppMetadata(appId, 'lastAnalyzed');\n        \n        // Usa CSP cached se  recente (meno di 24 ore)\n        if (cachedCSP && cachedDomains && lastAnalyzed) {\n          const hoursSinceAnalysis = (Date.now() - lastAnalyzed) / (1000 * 60 * 60);\n          if (hoursSinceAnalysis < 24) {\n            console.log(` Usando CSP cached per app ${appId} (analizzata ${hoursSinceAnalysis.toFixed(1)} ore fa)`);\n            customCSP = cachedCSP;\n            domains = cachedDomains;\n          }\n        }\n      }\n\n      // Se non abbiamo CSP cached, analizza l'HTML\n      if (!customCSP) {\n        console.log(` Analisi HTML per app ${appId || 'senza ID'}...`);\n        domains = this.analyzeHTMLForExternalResources(htmlContent);\n        customCSP = this.generateCustomCSP(domains);\n        \n        // Cache la CSP per questa app se abbiamo un ID\n        if (appId) {\n          await StorageService.setAppMetadata(appId, { \n            customCSP: customCSP,\n            externalDomains: domains,\n            lastAnalyzed: Date.now()\n          });\n          console.log(` CSP cached per app ${appId}`);\n        }\n      }\n      \n      console.log(' Domini trovati nell\\'HTML:', domains);\n      \n      let modifiedContent;\n      \n      // Sostituisci o aggiungi meta CSP\n      if (htmlContent.includes('<meta http-equiv=\"Content-Security-Policy\"')) {\n        modifiedContent = htmlContent.replace(\n          /<meta http-equiv=\"Content-Security-Policy\"[^>]*>/g,\n          `<meta http-equiv=\"Content-Security-Policy\" content=\"${customCSP}\">`\n        );\n      } else {\n        modifiedContent = htmlContent.replace(\n          /<head>/i,\n          `<head>\\n  <meta http-equiv=\"Content-Security-Policy\" content=\"${customCSP}\">`\n        );\n      }\n      \n      return modifiedContent;\n      \n    } catch (error) {\n      console.warn('Errore nell\\'analisi CSP, uso CSP di fallback:', error);\n      \n      // Fallback a CSP completamente permissiva\n      const fallbackCSP = \"default-src * data: blob: 'unsafe-inline' 'unsafe-eval'; script-src * data: blob: 'unsafe-inline' 'unsafe-eval'; style-src * data: blob: 'unsafe-inline'; img-src * data: blob:; font-src * data: blob:; connect-src * data: blob:; frame-src * data: blob:; object-src * data: blob:; base-uri *; form-action *;\";\n      \n      let modifiedContent;\n      \n      if (htmlContent.includes('<meta http-equiv=\"Content-Security-Policy\"')) {\n        modifiedContent = htmlContent.replace(\n          /<meta http-equiv=\"Content-Security-Policy\"[^>]*>/g,\n          `<meta http-equiv=\"Content-Security-Policy\" content=\"${fallbackCSP}\">`\n        );\n      } else {\n        modifiedContent = htmlContent.replace(\n          /<head>/i,\n          `<head>\\n  <meta http-equiv=\"Content-Security-Policy\" content=\"${fallbackCSP}\">`\n        );\n      }\n      \n      return modifiedContent;\n    }\n  }\n\n  /**\n   * Lancia un'app URL\n   * @param {Object} app - Dati dell'app\n   * @param {Object} options - Opzioni di lancio\n   */\n  async launchUrlApp(app, options = {}) {\n    try {\n      // Validazione URL\n      if (!app.url) {\n        throw new Error('URL dell\\'app non specificato');\n      }\n\n      let targetUrl = app.url;\n\n      // Se forza nuova finestra o  impostato nelle preferenze\n      if (options.launchMode === 'newpage' || options.forceNewWindow) {\n        console.log(' Apertura in nuova finestra (modalit esplicita)');\n        // Apri in nuova finestra/tab\n        const newWindow = window.open(targetUrl, `aideas_app_${app.id}`, \n          'width=1200,height=800,scrollbars=yes,resizable=yes');\n        \n        if (!newWindow) {\n          throw new Error('Popup bloccato dal browser. Consenti i popup per AIdeas.');\n        }\n\n        return {\n          window: newWindow,\n          external: true\n        };\n      } else {\n        // Modalit iframe - controlla compatibilit\n        console.log(' Tentativo apertura in iframe...');\n        const canUseIframe = await this.checkIframeCompatibility(targetUrl);\n\n        if (!canUseIframe) {\n          // Fallback automatico a nuova finestra se iframe non supportato\n          console.log(' Fallback automatico a nuova finestra - iframe non supportato');\n          showToast('Questo sito non supporta iframe, apertura in nuova finestra', 'info');\n          \n          const newWindow = window.open(targetUrl, `aideas_app_${app.id}_fallback`, \n            'width=1200,height=800,scrollbars=yes,resizable=yes');\n          \n          if (!newWindow) {\n            throw new Error('Popup bloccato dal browser. Consenti i popup per AIdeas.');\n          }\n\n          return {\n            window: newWindow,\n            external: true,\n            fallback: true\n          };\n        } else {\n          // Carica in iframe\n          console.log(' Caricamento in iframe...');\n          const iframe = this.createSecureFrame(app, {\n            src: targetUrl,\n            sandbox: 'allow-scripts allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin'\n          });\n\n          // Aggiungi listener per errori di caricamento iframe\n          iframe.addEventListener('error', () => {\n            console.log(' Errore caricamento iframe, fallback a nuova finestra');\n            showToast('Errore caricamento iframe, apertura in nuova finestra', 'info');\n            \n            // Chiudi modal iframe\n            const modal = iframe.closest('.modal');\n            if (modal) {\n              hideModal(modal.id);\n            }\n            \n            // Apri in nuova finestra\n            const newWindow = window.open(targetUrl, `aideas_app_${app.id}_fallback`, \n              'width=1200,height=800,scrollbars=yes,resizable=yes');\n            \n            if (newWindow) {\n              showToast('App aperta in nuova finestra', 'success');\n            }\n          });\n\n          return {\n            iframe,\n            window: iframe.contentWindow\n          };\n        }\n      }\n\n    } catch (error) {\n      console.error('Errore lancio app URL:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Lancia un'app GitHub\n   * @param {Object} app - Dati dell'app\n   * @param {Object} options - Opzioni di lancio\n   */\n  async launchGitHubApp(app, options = {}) {\n    try {\n      if (!app.githubUrl) {\n        throw new Error('URL GitHub non specificato');\n      }\n\n      // Estrai info repository\n      const repoInfo = this.parseGitHubUrl(app.githubUrl);\n      if (!repoInfo) {\n        throw new Error('URL GitHub non valido');\n      }\n\n      // Costruisci URL per GitHub Pages o raw content\n      let targetUrl;\n      \n      if (app.metadata?.usePagesUrl) {\n        // Usa GitHub Pages\n        targetUrl = `https://${repoInfo.owner}.github.io/${repoInfo.repo}/`;\n      } else {\n        // Usa raw content per index.html\n        targetUrl = `https://raw.githubusercontent.com/${repoInfo.owner}/${repoInfo.repo}/${repoInfo.branch || 'main'}/index.html`;\n      }\n\n      // Prova a caricare come URL app\n      const urlApp = { ...app, url: targetUrl, type: 'url' };\n      return await this.launchUrlApp(urlApp, options);\n\n    } catch (error) {\n      console.error('Errore lancio app GitHub:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Lancia una PWA\n   * @param {Object} app - Dati dell'app\n   * @param {Object} options - Opzioni di lancio\n   */\n  async launchPWA(app, options = {}) {\n    try {\n      if (!app.url) {\n        throw new Error('URL della PWA non specificato');\n      }\n\n      // Per le PWA, preferisci sempre nuova finestra per esperienza nativa\n      const newWindow = window.open(app.url, `aideas_pwa_${app.id}`,\n        'width=1200,height=800,scrollbars=yes,resizable=yes,toolbar=no,location=no,status=no,menubar=no');\n      \n      if (!newWindow) {\n        throw new Error('Popup bloccato dal browser. Consenti i popup per AIdeas.');\n      }\n\n      // Prova a richiedere installazione PWA se supportato\n      if ('serviceWorker' in navigator && app.manifest) {\n        setTimeout(() => {\n          this.promptPWAInstall(app, newWindow);\n        }, 2000);\n      }\n\n      return {\n        window: newWindow,\n        external: true,\n        isPWA: true\n      };\n\n    } catch (error) {\n      console.error('Errore lancio PWA:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Crea un iframe sicuro per l'app\n   * @param {Object} app - Dati dell'app\n   * @param {Object} iframeOptions - Opzioni iframe\n   */\n  createSecureFrame(app, iframeOptions = {}) {\n    // Crea modal container per l'app\n    const modalId = `app-modal-${app.id}-${Date.now()}`;\n    \n    const modalContent = `\n      <div class=\"modal-header\">\n        <div class=\"app-modal-title\">\n          <div class=\"app-modal-icon\">\n            ${app.icon ? `<img src=\"${app.icon}\" alt=\"${app.name}\">` : ''}\n          </div>\n          <div>\n            <h2>${escapeHtml(app.name)}</h2>\n            <p class=\"app-modal-subtitle\">${escapeHtml(app.description || '')}</p>\n          </div>\n        </div>\n        <div class=\"app-modal-controls\">\n          <select class=\"app-launch-mode\" id=\"app-launch-mode-${app.id}\" title=\"Modalit di apertura\">\n            <option value=\"default\">Modalit predefinita</option>\n            <option value=\"iframe\">Apri in finestra modale</option>\n            <option value=\"newpage\">Apri in nuova pagina</option>\n          </select>\n          <button class=\"btn btn-secondary btn-sm\" id=\"app-refresh-${app.id}\">\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z\"/>\n            </svg>\n            Ricarica\n          </button>\n          <button class=\"btn btn-secondary btn-sm\" id=\"app-fullscreen-${app.id}\">\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M7,14H5V19H10V17H7V14M12,14H10V17H7V19H12V14M17,14V17H14V19H19V14H17M19,10H17V5H14V7H17V10H19M10,7V5H5V10H7V7H10M12,10V7H10V5H15V10H12Z\"/>\n            </svg>\n            Schermo intero\n          </button>\n          <button class=\"modal-close\">&times;</button>\n        </div>\n      </div>\n      <div class=\"modal-body app-modal-body\">\n        <div class=\"app-frame-container\">\n          <div class=\"app-loading\">\n            <div class=\"spinner\"></div>\n            <p>Caricamento ${escapeHtml(app.name)}...</p>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Mostra modal\n    const modal = showModal(modalId, modalContent, {\n      size: 'modal-xl',\n      disableBackdropClose: false,\n      disableEscapeClose: false\n    });\n\n    // Crea iframe\n    const iframe = document.createElement('iframe');\n    iframe.className = 'app-frame';\n    iframe.src = iframeOptions.src;\n    iframe.sandbox = iframeOptions.sandbox || 'allow-scripts allow-forms allow-modals';\n    iframe.style.cssText = `\n      width: 100%;\n      height: 70vh;\n      border: none;\n      border-radius: 8px;\n      background: white;\n    `;\n\n    // Event listeners per iframe\n    iframe.addEventListener('load', () => {\n      const loadingEl = modal.querySelector('.app-loading');\n      if (loadingEl) {\n        loadingEl.style.display = 'none';\n      }\n      iframe.style.display = 'block';\n      \n      // Inietta API AIdeas nell'iframe\n      this.injectAIdeasAPI(iframe, app);\n    });\n\n    iframe.addEventListener('error', () => {\n      const container = modal.querySelector('.app-frame-container');\n      container.innerHTML = `\n        <div class=\"app-error\">\n          <div class=\"app-error-icon\"></div>\n          <h3>Errore di caricamento</h3>\n          <p>Impossibile caricare l'applicazione.</p>\n          <button class=\"btn btn-primary\" onclick=\"location.reload()\">Riprova</button>\n        </div>\n      `;\n    });\n\n    // Aggiungi iframe al modal\n    const frameContainer = modal.querySelector('.app-frame-container');\n    frameContainer.appendChild(iframe);\n\n    // Setup controlli modal\n    this.setupAppModalControls(modal, iframe, app);\n\n    return iframe;\n  }\n\n  /**\n   * Setup controlli del modal dell'app\n   * @param {Element} modal - Modal element\n   * @param {Element} iframe - Iframe element\n   * @param {Object} app - Dati dell'app\n   */\n  setupAppModalControls(modal, iframe, app) {\n    // Launch mode selector\n    const launchModeSelect = modal.querySelector(`#app-launch-mode-${app.id}`);\n    launchModeSelect?.addEventListener('change', async () => {\n      const newMode = launchModeSelect.value;\n      if (newMode !== 'default') {\n        const confirmed = await showConfirmPopup({\n          title: 'Cambia Modalit',\n          message: `Vuoi riaprire l'app in modalit \"${newMode === 'iframe' ? 'finestra modale' : 'nuova pagina'}\"?`,\n          icon: 'question',\n          confirmText: 'Riapri',\n          cancelText: 'Annulla',\n          type: 'default'\n        });\n        if (confirmed) {\n          // Chiudi modal corrente\n          hideModal(modal.id);\n          // Rilancia con nuova modalit\n          await this.launch(app, { forceMode: newMode });\n        } else {\n          // Reset selezione\n          launchModeSelect.value = 'default';\n        }\n      }\n    });\n\n    // Refresh button\n    const refreshBtn = modal.querySelector(`#app-refresh-${app.id}`);\n    refreshBtn?.addEventListener('click', () => {\n      iframe.src = iframe.src; // Ricarica iframe\n      showToast('App ricaricata', 'info');\n    });\n\n    // Fullscreen button\n    const fullscreenBtn = modal.querySelector(`#app-fullscreen-${app.id}`);\n    fullscreenBtn?.addEventListener('click', () => {\n      if (modal.requestFullscreen) {\n        modal.requestFullscreen();\n      } else if (modal.webkitRequestFullscreen) {\n        modal.webkitRequestFullscreen();\n      } else if (modal.msRequestFullscreen) {\n        modal.msRequestFullscreen();\n      }\n    });\n\n    // Cleanup quando modal si chiude\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (mutation.type === 'childList') {\n          mutation.removedNodes.forEach((node) => {\n            if (node === modal) {\n              this.cleanupApp(app.id);\n              observer.disconnect();\n            }\n          });\n        }\n      });\n    });\n\n    observer.observe(document.body, { childList: true });\n  }\n\n  /**\n   * Inietta l'API AIdeas nell'iframe\n   * @param {Element} iframe - Iframe element\n   * @param {Object} app - Dati dell'app\n   */\n  injectAIdeasAPI(iframe, app) {\n    try {\n      const iframeWindow = iframe.contentWindow;\n      if (!iframeWindow) return;\n\n      // API AIdeas per le app\n      iframeWindow.AIdeas = {\n        // Informazioni app\n        app: {\n          id: app.id,\n          name: app.name,\n          version: app.version\n        },\n\n        // Storage app-specific\n        storage: {\n          get: (key) => localStorage.getItem(`aideas_app_${app.id}_${key}`),\n          set: (key, value) => localStorage.setItem(`aideas_app_${app.id}_${key}`, value),\n          remove: (key) => localStorage.removeItem(`aideas_app_${app.id}_${key}`),\n          clear: () => {\n            const prefix = `aideas_app_${app.id}_`;\n            Object.keys(localStorage).forEach(key => {\n              if (key.startsWith(prefix)) {\n                localStorage.removeItem(key);\n              }\n            });\n          }\n        },\n\n        // Utilities\n        utils: {\n          showNotification: (message, type = 'info') => {\n            showToast(`[${app.name}] ${message}`, type);\n          },\n          \n          getUserPreferences: async () => {\n            return await StorageService.getAllSettings();\n          },\n          \n          openUrl: (url) => {\n            window.open(url, '_blank');\n          },\n\n          closeApp: () => {\n            this.closeApp(app.id);\n          }\n        },\n\n        // Lifecycle hooks\n        lifecycle: {\n          onAppStart: (callback) => {\n            if (typeof callback === 'function') {\n              setTimeout(callback, 100);\n            }\n          },\n          \n          onAppPause: (callback) => {\n            window.addEventListener('blur', callback);\n          },\n          \n          onAppResume: (callback) => {\n            window.addEventListener('focus', callback);\n          }\n        }\n      };\n\n      console.log(` AIdeas API iniettata in ${app.name}`);\n\n    } catch (error) {\n      console.warn('Impossibile iniettare AIdeas API:', error);\n    }\n  }\n\n  /**\n   * Utility methods\n   */\n\n  // Trova entry point nell'app ZIP\n  findEntryPoint(files, specifiedEntry) {\n    if (specifiedEntry) {\n      const specified = files.find(f => f.filename === specifiedEntry);\n      if (specified) return specified;\n    }\n\n    // Fallback: cerca index.html\n    const indexHtml = files.find(f => f.filename === 'index.html');\n    if (indexHtml) return indexHtml;\n\n    // Fallback: primo file HTML\n    const firstHtml = files.find(f => f.filename.endsWith('.html'));\n    if (firstHtml) return firstHtml;\n\n    throw new Error('Entry point HTML non trovato');\n  }\n\n  // Sostituisce TUTTI i percorsi relativi con blob URLs (gestione completa)\n  replaceAllLocalPaths(htmlContent, blobUrls, app) {\n    let modifiedContent = htmlContent;\n\n    // Crea una mappa dei percorsi possibili (con e senza ./)\n    const pathMap = new Map();\n    for (const [filename, blobUrl] of blobUrls) {\n      pathMap.set(filename, blobUrl);\n      pathMap.set('./' + filename, blobUrl);\n      pathMap.set('../' + filename, blobUrl); // Support anche ../\n      \n      // Support per percorsi nelle subdirectory\n      const pathSegments = filename.split('/');\n      if (pathSegments.length > 1) {\n        // es. se filename  \"js/app.js\", aggiungi anche \"app.js\"\n        const justFilename = pathSegments[pathSegments.length - 1];\n        if (!pathMap.has(justFilename)) {\n          pathMap.set(justFilename, blobUrl);\n        }\n      }\n    }\n\n    // 1. Sostituisci attributi src (script, img, iframe, etc.)\n    modifiedContent = modifiedContent.replace(/\\bsrc\\s*=\\s*[\"']([^\"']+)[\"']/gi, (match, path) => {\n      const cleanPath = this.cleanPath(path);\n      if (pathMap.has(cleanPath)) {\n        return match.replace(path, pathMap.get(cleanPath));\n      }\n      return match;\n    });\n\n    // 2. Sostituisci attributi href (link, a)\n    modifiedContent = modifiedContent.replace(/\\bhref\\s*=\\s*[\"']([^\"']+)[\"']/gi, (match, path) => {\n      const cleanPath = this.cleanPath(path);\n      if (pathMap.has(cleanPath) && !path.startsWith('#') && !path.startsWith('mailto:')) {\n        return match.replace(path, pathMap.get(cleanPath));\n      }\n      return match;\n    });\n\n    // 3. Sostituisci import statements JavaScript (ES6 modules)\n    modifiedContent = modifiedContent.replace(/\\bimport\\s+.*?\\s+from\\s+[\"']([^\"']+)[\"']/gi, (match, path) => {\n      const cleanPath = this.cleanPath(path);\n      if (pathMap.has(cleanPath)) {\n        return match.replace(path, pathMap.get(cleanPath));\n      }\n      return match;\n    });\n\n    // 4. Sostituisci require() calls (CommonJS)\n    modifiedContent = modifiedContent.replace(/\\brequire\\s*\\(\\s*[\"']([^\"']+)[\"']\\s*\\)/gi, (match, path) => {\n      const cleanPath = this.cleanPath(path);\n      if (pathMap.has(cleanPath)) {\n        return match.replace(path, pathMap.get(cleanPath));\n      }\n      return match;\n    });\n\n    // 5. Sostituisci CSS url() references\n    modifiedContent = modifiedContent.replace(/\\burl\\s*\\(\\s*[\"']?([^\"')]+)[\"']?\\s*\\)/gi, (match, path) => {\n      const cleanPath = this.cleanPath(path);\n      if (pathMap.has(cleanPath)) {\n        return match.replace(path, pathMap.get(cleanPath));\n      }\n      return match;\n    });\n\n    // 6. Sostituisci fetch() e XMLHttpRequest references\n    modifiedContent = modifiedContent.replace(/\\bfetch\\s*\\(\\s*[\"']([^\"']+)[\"']/gi, (match, path) => {\n      const cleanPath = this.cleanPath(path);\n      if (pathMap.has(cleanPath)) {\n        return match.replace(path, pathMap.get(cleanPath));\n      }\n      return match;\n    });\n\n    // 7. Sostituisci new URL() constructor\n    modifiedContent = modifiedContent.replace(/\\bnew\\s+URL\\s*\\(\\s*[\"']([^\"']+)[\"']/gi, (match, path) => {\n      const cleanPath = this.cleanPath(path);\n      if (pathMap.has(cleanPath)) {\n        return match.replace(path, pathMap.get(cleanPath));\n      }\n      return match;\n    });\n\n    // 8. Sostituisci JSON references e altri possibili pattern\n    modifiedContent = modifiedContent.replace(/[\"']([^\"']*\\.[a-zA-Z0-9]+)[\"']/gi, (match, path) => {\n      // Solo se il path sembra un file locale (ha estensione e non  URL)\n      if (!path.includes('://') && !path.startsWith('data:') && !path.startsWith('#')) {\n        const cleanPath = this.cleanPath(path);\n        if (pathMap.has(cleanPath)) {\n          return match.replace(path, pathMap.get(cleanPath));\n        }\n      }\n      return match;\n    });\n\n    // Aggiungi meta tags per sicurezza e info\n    const metaTags = `\n      <meta charset=\"UTF-8\">\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n      <meta name=\"aideas-app\" content=\"${escapeHtml(app.name)}\">\n      <meta name=\"aideas-version\" content=\"${app.version || '1.0.0'}\">\n      <meta name=\"aideas-type\" content=\"zip\">\n      <base href=\"blob:\">\n    `;\n\n    if (modifiedContent.includes('<head>')) {\n      modifiedContent = modifiedContent.replace('<head>', '<head>' + metaTags);\n    } else if (modifiedContent.includes('<html>')) {\n      modifiedContent = modifiedContent.replace('<html>', '<html><head>' + metaTags + '</head>');\n    } else {\n      modifiedContent = metaTags + modifiedContent;\n    }\n\n    return modifiedContent;\n  }\n\n  // Pulisce il percorso dai parametri query e hash\n  cleanPath(path) {\n    if (!path) return '';\n    \n    // Rimuovi query parameters e hash\n    let cleanPath = path.split('?')[0].split('#')[0];\n    \n    // Normalizza slashes\n    cleanPath = cleanPath.replace(/\\\\/g, '/');\n    \n    // Rimuovi leading/trailing whitespace\n    cleanPath = cleanPath.trim();\n    \n    return cleanPath;\n  }\n\n  // Controlla compatibilit iframe per URL\n  async checkIframeCompatibility(url) {\n    try {\n      console.log(` Controllo compatibilit iframe per: ${url}`);\n      \n      // Per app locali (blob URLs), sempre compatibili\n      if (url.startsWith('blob:')) {\n        console.log(' Blob URL - compatibile con iframe');\n        return true;\n      }\n\n      // Per app HTML locali, sempre compatibili\n      if (url.startsWith('data:')) {\n        console.log(' Data URL - compatibile con iframe');\n        return true;\n      }\n\n      // Per URL esterni, controlla gli header\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 secondi timeout\n\n      try {\n        const response = await fetch(url, { \n          method: 'HEAD',\n          signal: controller.signal,\n          mode: 'cors'\n        });\n        \n        clearTimeout(timeoutId);\n        \n        const xFrameOptions = response.headers.get('X-Frame-Options');\n        const csp = response.headers.get('Content-Security-Policy');\n\n        console.log(` Headers ricevuti:`, {\n          'X-Frame-Options': xFrameOptions,\n          'Content-Security-Policy': csp ? csp.substring(0, 100) + '...' : 'none'\n        });\n\n        // Controlla se il sito blocca iframe\n        if (xFrameOptions) {\n          const xfo = xFrameOptions.toLowerCase();\n          if (xfo === 'deny') {\n            console.log(' X-Frame-Options: DENY - iframe non supportato');\n            return false;\n          }\n          if (xfo === 'sameorigin') {\n            console.log(' X-Frame-Options: SAMEORIGIN - iframe limitato');\n            // Potrebbe funzionare se siamo sulla stessa origine\n            return window.location.origin === new URL(url).origin;\n          }\n        }\n\n        // Controlla CSP frame-ancestors\n        if (csp) {\n          const cspLower = csp.toLowerCase();\n          if (cspLower.includes('frame-ancestors')) {\n            if (cspLower.includes('frame-ancestors \\'none\\'')) {\n              console.log(' CSP frame-ancestors: none - iframe non supportato');\n              return false;\n            }\n            if (cspLower.includes('frame-ancestors \\'self\\'')) {\n              console.log(' CSP frame-ancestors: self - iframe limitato');\n              return window.location.origin === new URL(url).origin;\n            }\n          }\n        }\n\n        console.log(' URL compatibile con iframe');\n        return true;\n\n      } catch (fetchError) {\n        clearTimeout(timeoutId);\n        \n        if (fetchError.name === 'AbortError') {\n          console.log(' Timeout durante controllo compatibilit iframe');\n        } else {\n          console.log(' Errore durante controllo compatibilit iframe:', fetchError.message);\n        }\n        \n        // Se non riusciamo a fare la richiesta, proviamo comunque ma con warning\n        console.log(' Fallback: proveremo iframe comunque');\n        return true;\n      }\n\n    } catch (error) {\n      console.error(' Errore generale controllo compatibilit iframe:', error);\n      // In caso di errore, meglio essere sicuri e usare nuova finestra\n      return false;\n    }\n  }\n\n  // Parsing URL GitHub\n  parseGitHubUrl(url) {\n    const patterns = [\n      /github\\.com\\/([^\\/]+)\\/([^\\/]+)/,\n      /([^\\/]+)\\.github\\.io\\/([^\\/]+)/\n    ];\n\n    for (const pattern of patterns) {\n      const match = url.match(pattern);\n      if (match) {\n        return {\n          owner: match[1],\n          repo: match[2].replace('.git', ''),\n          branch: 'main'\n        };\n      }\n    }\n    return null;\n  }\n\n  // Validazione app prima del lancio\n  async validateApp(app) {\n    const validation = { valid: true, error: null };\n\n    if (!app || !app.id) {\n      validation.valid = false;\n      validation.error = 'App non valida';\n      return validation;\n    }\n\n    switch (app.type) {\n    case 'zip':\n      const files = await StorageService.getAppFiles(app.id);\n      if (!files.length) {\n        validation.valid = false;\n        validation.error = 'File dell\\'app non trovati';\n      }\n      break;\n\n    case 'url':\n    case 'github':\n    case 'pwa':\n      if (!app.url && !app.githubUrl) {\n        validation.valid = false;\n        validation.error = 'URL dell\\'app non specificato';\n      }\n      break;\n\n    case 'html':\n      if (!app.content) {\n        validation.valid = false;\n        validation.error = 'Contenuto HTML mancante';\n      }\n      break;\n\n    default:\n      validation.valid = false;\n      validation.error = `Tipo di app non supportato: ${app.type}`;\n    }\n\n    return validation;\n  }\n\n  // Dialog per limite app concorrenti\n  async showConcurrentAppsDialog() {\n    return new Promise((resolve) => {\n      showModal('concurrent-apps-dialog', `\n        <div class=\"modal-header\">\n          <h2>Limite app raggiunto</h2>\n          <button class=\"modal-close\">&times;</button>\n        </div>\n        <div class=\"modal-body\">\n          <p>Hai raggiunto il limite di ${this.maxConcurrentApps} app aperte contemporaneamente.</p>\n          <p>Vuoi chiudere un'app esistente e procedere?</p>\n          <div class=\"concurrent-apps-list\">\n            ${Array.from(this.activeApps.values()).map(activeApp => `\n              <div class=\"concurrent-app-item\">\n                <span>${activeApp.app.name}</span>\n                <button class=\"btn btn-sm btn-secondary\" onclick=\"this.closeApp('${activeApp.app.id}')\">Chiudi</button>\n              </div>\n            `).join('')}\n          </div>\n        </div>\n        <div class=\"modal-footer\">\n          <button class=\"btn btn-secondary\" onclick=\"resolve(false)\">Annulla</button>\n          <button class=\"btn btn-primary\" onclick=\"resolve(true)\">Continua</button>\n        </div>\n      `, { disableBackdropClose: true });\n      \n      // Questo  semplificato - in realt dovremmo gestire i click sui pulsanti\n      setTimeout(() => resolve(true), 5000); // Auto-resolve dopo 5s per demo\n    });\n  }\n\n  // Chiudi app\n  closeApp(appId) {\n    const activeApp = Array.from(this.activeApps.values()).find(a => a.app.id === appId);\n    if (activeApp) {\n      if (activeApp.window && !activeApp.window.closed) {\n        activeApp.window.close();\n      }\n      if (activeApp.cleanup) {\n        activeApp.cleanup();\n      }\n      this.activeApps.delete(appId);\n    }\n  }\n\n  // Cleanup risorse app\n  cleanupApp(appId) {\n    this.closeApp(appId);\n  }\n\n  // Setup event listeners\n  setupEventListeners() {\n    // Ascolta chiusura finestre esterne\n    window.addEventListener('beforeunload', () => {\n      // Cleanup tutte le app attive\n      for (const [launchId, activeApp] of this.activeApps) {\n        if (activeApp.cleanup) {\n          activeApp.cleanup();\n        }\n      }\n    });\n  }\n\n  // Gestione cronologia\n  async loadLaunchHistory() {\n    const history = await StorageService.getSetting('launchHistory', []);\n    this.launchHistory = history.slice(-50); // Mantieni ultimi 50\n  }\n\n  addToHistory(app, launchId) {\n    this.launchHistory.push({\n      appId: app.id,\n      appName: app.name,\n      launchId,\n      timestamp: new Date().toISOString()\n    });\n\n    // Salva cronologia\n    StorageService.setSetting('launchHistory', this.launchHistory.slice(-50));\n  }\n\n  // Analytics tracking\n  trackLaunch(app, duration) {\n    console.log(` Launch tracked: ${app.name} in ${duration}ms`);\n    // Qui potresti integrare con sistemi di analytics\n  }\n\n  // Prompt installazione PWA\n  promptPWAInstall(app, window) {\n    // Implementazione semplificata per demo\n    console.log(` PWA install prompt for ${app.name}`);\n  }\n\n  // Getter per informazioni stato\n  get activeAppCount() {\n    return this.activeApps.size;\n  }\n\n  get canLaunchMore() {\n    return this.activeApps.size < this.maxConcurrentApps;\n  }\n}","/** Types of elements found in htmlparser2's DOM */\nexport var ElementType;\n(function (ElementType) {\n    /** Type for the root element of a document */\n    ElementType[\"Root\"] = \"root\";\n    /** Type for Text */\n    ElementType[\"Text\"] = \"text\";\n    /** Type for <? ... ?> */\n    ElementType[\"Directive\"] = \"directive\";\n    /** Type for <!-- ... --> */\n    ElementType[\"Comment\"] = \"comment\";\n    /** Type for <script> tags */\n    ElementType[\"Script\"] = \"script\";\n    /** Type for <style> tags */\n    ElementType[\"Style\"] = \"style\";\n    /** Type for Any tag */\n    ElementType[\"Tag\"] = \"tag\";\n    /** Type for <![CDATA[ ... ]]> */\n    ElementType[\"CDATA\"] = \"cdata\";\n    /** Type for <!doctype ...> */\n    ElementType[\"Doctype\"] = \"doctype\";\n})(ElementType || (ElementType = {}));\n/**\n * Tests whether an element is a tag or not.\n *\n * @param elem Element to test\n */\nexport function isTag(elem) {\n    return (elem.type === ElementType.Tag ||\n        elem.type === ElementType.Script ||\n        elem.type === ElementType.Style);\n}\n// Exports for backwards compatibility\n/** Type for the root element of a document */\nexport const Root = ElementType.Root;\n/** Type for Text */\nexport const Text = ElementType.Text;\n/** Type for <? ... ?> */\nexport const Directive = ElementType.Directive;\n/** Type for <!-- ... --> */\nexport const Comment = ElementType.Comment;\n/** Type for <script> tags */\nexport const Script = ElementType.Script;\n/** Type for <style> tags */\nexport const Style = ElementType.Style;\n/** Type for Any tag */\nexport const Tag = ElementType.Tag;\n/** Type for <![CDATA[ ... ]]> */\nexport const CDATA = ElementType.CDATA;\n/** Type for <!doctype ...> */\nexport const Doctype = ElementType.Doctype;\n","import { ElementType, isTag as isTagRaw } from \"domelementtype\";\n/**\n * This object will be used as the prototype for Nodes when creating a\n * DOM-Level-1-compliant structure.\n */\nexport class Node {\n    constructor() {\n        /** Parent of the node */\n        this.parent = null;\n        /** Previous sibling */\n        this.prev = null;\n        /** Next sibling */\n        this.next = null;\n        /** The start index of the node. Requires `withStartIndices` on the handler to be `true. */\n        this.startIndex = null;\n        /** The end index of the node. Requires `withEndIndices` on the handler to be `true. */\n        this.endIndex = null;\n    }\n    // Read-write aliases for properties\n    /**\n     * Same as {@link parent}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get parentNode() {\n        return this.parent;\n    }\n    set parentNode(parent) {\n        this.parent = parent;\n    }\n    /**\n     * Same as {@link prev}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get previousSibling() {\n        return this.prev;\n    }\n    set previousSibling(prev) {\n        this.prev = prev;\n    }\n    /**\n     * Same as {@link next}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get nextSibling() {\n        return this.next;\n    }\n    set nextSibling(next) {\n        this.next = next;\n    }\n    /**\n     * Clone this node, and optionally its children.\n     *\n     * @param recursive Clone child nodes as well.\n     * @returns A clone of the node.\n     */\n    cloneNode(recursive = false) {\n        return cloneNode(this, recursive);\n    }\n}\n/**\n * A node that contains some data.\n */\nexport class DataNode extends Node {\n    /**\n     * @param data The content of the data node\n     */\n    constructor(data) {\n        super();\n        this.data = data;\n    }\n    /**\n     * Same as {@link data}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get nodeValue() {\n        return this.data;\n    }\n    set nodeValue(data) {\n        this.data = data;\n    }\n}\n/**\n * Text within the document.\n */\nexport class Text extends DataNode {\n    constructor() {\n        super(...arguments);\n        this.type = ElementType.Text;\n    }\n    get nodeType() {\n        return 3;\n    }\n}\n/**\n * Comments within the document.\n */\nexport class Comment extends DataNode {\n    constructor() {\n        super(...arguments);\n        this.type = ElementType.Comment;\n    }\n    get nodeType() {\n        return 8;\n    }\n}\n/**\n * Processing instructions, including doc types.\n */\nexport class ProcessingInstruction extends DataNode {\n    constructor(name, data) {\n        super(data);\n        this.name = name;\n        this.type = ElementType.Directive;\n    }\n    get nodeType() {\n        return 1;\n    }\n}\n/**\n * A `Node` that can have children.\n */\nexport class NodeWithChildren extends Node {\n    /**\n     * @param children Children of the node. Only certain node types can have children.\n     */\n    constructor(children) {\n        super();\n        this.children = children;\n    }\n    // Aliases\n    /** First child of the node. */\n    get firstChild() {\n        var _a;\n        return (_a = this.children[0]) !== null && _a !== void 0 ? _a : null;\n    }\n    /** Last child of the node. */\n    get lastChild() {\n        return this.children.length > 0\n            ? this.children[this.children.length - 1]\n            : null;\n    }\n    /**\n     * Same as {@link children}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get childNodes() {\n        return this.children;\n    }\n    set childNodes(children) {\n        this.children = children;\n    }\n}\nexport class CDATA extends NodeWithChildren {\n    constructor() {\n        super(...arguments);\n        this.type = ElementType.CDATA;\n    }\n    get nodeType() {\n        return 4;\n    }\n}\n/**\n * The root node of the document.\n */\nexport class Document extends NodeWithChildren {\n    constructor() {\n        super(...arguments);\n        this.type = ElementType.Root;\n    }\n    get nodeType() {\n        return 9;\n    }\n}\n/**\n * An element within the DOM.\n */\nexport class Element extends NodeWithChildren {\n    /**\n     * @param name Name of the tag, eg. `div`, `span`.\n     * @param attribs Object mapping attribute names to attribute values.\n     * @param children Children of the node.\n     */\n    constructor(name, attribs, children = [], type = name === \"script\"\n        ? ElementType.Script\n        : name === \"style\"\n            ? ElementType.Style\n            : ElementType.Tag) {\n        super(children);\n        this.name = name;\n        this.attribs = attribs;\n        this.type = type;\n    }\n    get nodeType() {\n        return 1;\n    }\n    // DOM Level 1 aliases\n    /**\n     * Same as {@link name}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get tagName() {\n        return this.name;\n    }\n    set tagName(name) {\n        this.name = name;\n    }\n    get attributes() {\n        return Object.keys(this.attribs).map((name) => {\n            var _a, _b;\n            return ({\n                name,\n                value: this.attribs[name],\n                namespace: (_a = this[\"x-attribsNamespace\"]) === null || _a === void 0 ? void 0 : _a[name],\n                prefix: (_b = this[\"x-attribsPrefix\"]) === null || _b === void 0 ? void 0 : _b[name],\n            });\n        });\n    }\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node is a `Element`, `false` otherwise.\n */\nexport function isTag(node) {\n    return isTagRaw(node);\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `CDATA`, `false` otherwise.\n */\nexport function isCDATA(node) {\n    return node.type === ElementType.CDATA;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `Text`, `false` otherwise.\n */\nexport function isText(node) {\n    return node.type === ElementType.Text;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `Comment`, `false` otherwise.\n */\nexport function isComment(node) {\n    return node.type === ElementType.Comment;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `ProcessingInstruction`, `false` otherwise.\n */\nexport function isDirective(node) {\n    return node.type === ElementType.Directive;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `ProcessingInstruction`, `false` otherwise.\n */\nexport function isDocument(node) {\n    return node.type === ElementType.Root;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has children, `false` otherwise.\n */\nexport function hasChildren(node) {\n    return Object.prototype.hasOwnProperty.call(node, \"children\");\n}\n/**\n * Clone a node, and optionally its children.\n *\n * @param recursive Clone child nodes as well.\n * @returns A clone of the node.\n */\nexport function cloneNode(node, recursive = false) {\n    let result;\n    if (isText(node)) {\n        result = new Text(node.data);\n    }\n    else if (isComment(node)) {\n        result = new Comment(node.data);\n    }\n    else if (isTag(node)) {\n        const children = recursive ? cloneChildren(node.children) : [];\n        const clone = new Element(node.name, { ...node.attribs }, children);\n        children.forEach((child) => (child.parent = clone));\n        if (node.namespace != null) {\n            clone.namespace = node.namespace;\n        }\n        if (node[\"x-attribsNamespace\"]) {\n            clone[\"x-attribsNamespace\"] = { ...node[\"x-attribsNamespace\"] };\n        }\n        if (node[\"x-attribsPrefix\"]) {\n            clone[\"x-attribsPrefix\"] = { ...node[\"x-attribsPrefix\"] };\n        }\n        result = clone;\n    }\n    else if (isCDATA(node)) {\n        const children = recursive ? cloneChildren(node.children) : [];\n        const clone = new CDATA(children);\n        children.forEach((child) => (child.parent = clone));\n        result = clone;\n    }\n    else if (isDocument(node)) {\n        const children = recursive ? cloneChildren(node.children) : [];\n        const clone = new Document(children);\n        children.forEach((child) => (child.parent = clone));\n        if (node[\"x-mode\"]) {\n            clone[\"x-mode\"] = node[\"x-mode\"];\n        }\n        result = clone;\n    }\n    else if (isDirective(node)) {\n        const instruction = new ProcessingInstruction(node.name, node.data);\n        if (node[\"x-name\"] != null) {\n            instruction[\"x-name\"] = node[\"x-name\"];\n            instruction[\"x-publicId\"] = node[\"x-publicId\"];\n            instruction[\"x-systemId\"] = node[\"x-systemId\"];\n        }\n        result = instruction;\n    }\n    else {\n        throw new Error(`Not implemented yet: ${node.type}`);\n    }\n    result.startIndex = node.startIndex;\n    result.endIndex = node.endIndex;\n    if (node.sourceCodeLocation != null) {\n        result.sourceCodeLocation = node.sourceCodeLocation;\n    }\n    return result;\n}\nfunction cloneChildren(childs) {\n    const children = childs.map((child) => cloneNode(child, true));\n    for (let i = 1; i < children.length; i++) {\n        children[i].prev = children[i - 1];\n        children[i - 1].next = children[i];\n    }\n    return children;\n}\n","export const xmlReplacer = /[\"&'<>$\\x80-\\uFFFF]/g;\nconst xmlCodeMap = new Map([\n    [34, \"&quot;\"],\n    [38, \"&amp;\"],\n    [39, \"&apos;\"],\n    [60, \"&lt;\"],\n    [62, \"&gt;\"],\n]);\n// For compatibility with node < 4, we wrap `codePointAt`\nexport const getCodePoint = \n// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\nString.prototype.codePointAt != null\n    ? (str, index) => str.codePointAt(index)\n    : // http://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae\n        (c, index) => (c.charCodeAt(index) & 0xfc00) === 0xd800\n            ? (c.charCodeAt(index) - 0xd800) * 0x400 +\n                c.charCodeAt(index + 1) -\n                0xdc00 +\n                0x10000\n            : c.charCodeAt(index);\n/**\n * Encodes all non-ASCII characters, as well as characters not valid in XML\n * documents using XML entities.\n *\n * If a character has no equivalent entity, a\n * numeric hexadecimal reference (eg. `&#xfc;`) will be used.\n */\nexport function encodeXML(str) {\n    let ret = \"\";\n    let lastIdx = 0;\n    let match;\n    while ((match = xmlReplacer.exec(str)) !== null) {\n        const i = match.index;\n        const char = str.charCodeAt(i);\n        const next = xmlCodeMap.get(char);\n        if (next !== undefined) {\n            ret += str.substring(lastIdx, i) + next;\n            lastIdx = i + 1;\n        }\n        else {\n            ret += `${str.substring(lastIdx, i)}&#x${getCodePoint(str, i).toString(16)};`;\n            // Increase by 1 if we have a surrogate pair\n            lastIdx = xmlReplacer.lastIndex += Number((char & 0xfc00) === 0xd800);\n        }\n    }\n    return ret + str.substr(lastIdx);\n}\n/**\n * Encodes all non-ASCII characters, as well as characters not valid in XML\n * documents using numeric hexadecimal reference (eg. `&#xfc;`).\n *\n * Have a look at `escapeUTF8` if you want a more concise output at the expense\n * of reduced transportability.\n *\n * @param data String to escape.\n */\nexport const escape = encodeXML;\n/**\n * Creates a function that escapes all characters matched by the given regular\n * expression using the given map of characters to escape to their entities.\n *\n * @param regex Regular expression to match characters to escape.\n * @param map Map of characters to escape to their entities.\n *\n * @returns Function that escapes all characters matched by the given regular\n * expression using the given map of characters to escape to their entities.\n */\nfunction getEscaper(regex, map) {\n    return function escape(data) {\n        let match;\n        let lastIdx = 0;\n        let result = \"\";\n        while ((match = regex.exec(data))) {\n            if (lastIdx !== match.index) {\n                result += data.substring(lastIdx, match.index);\n            }\n            // We know that this character will be in the map.\n            result += map.get(match[0].charCodeAt(0));\n            // Every match will be of length 1\n            lastIdx = match.index + 1;\n        }\n        return result + data.substring(lastIdx);\n    };\n}\n/**\n * Encodes all characters not valid in XML documents using XML entities.\n *\n * Note that the output will be character-set dependent.\n *\n * @param data String to escape.\n */\nexport const escapeUTF8 = getEscaper(/[&<>'\"]/g, xmlCodeMap);\n/**\n * Encodes all characters that have to be escaped in HTML attributes,\n * following {@link https://html.spec.whatwg.org/multipage/parsing.html#escapingString}.\n *\n * @param data String to escape.\n */\nexport const escapeAttribute = getEscaper(/[\"&\\u00A0]/g, new Map([\n    [34, \"&quot;\"],\n    [38, \"&amp;\"],\n    [160, \"&nbsp;\"],\n]));\n/**\n * Encodes all characters that have to be escaped in HTML text,\n * following {@link https://html.spec.whatwg.org/multipage/parsing.html#escapingString}.\n *\n * @param data String to escape.\n */\nexport const escapeText = getEscaper(/[&<>\\u00A0]/g, new Map([\n    [38, \"&amp;\"],\n    [60, \"&lt;\"],\n    [62, \"&gt;\"],\n    [160, \"&nbsp;\"],\n]));\n//# sourceMappingURL=escape.js.map","export const elementNames = new Map([\n    \"altGlyph\",\n    \"altGlyphDef\",\n    \"altGlyphItem\",\n    \"animateColor\",\n    \"animateMotion\",\n    \"animateTransform\",\n    \"clipPath\",\n    \"feBlend\",\n    \"feColorMatrix\",\n    \"feComponentTransfer\",\n    \"feComposite\",\n    \"feConvolveMatrix\",\n    \"feDiffuseLighting\",\n    \"feDisplacementMap\",\n    \"feDistantLight\",\n    \"feDropShadow\",\n    \"feFlood\",\n    \"feFuncA\",\n    \"feFuncB\",\n    \"feFuncG\",\n    \"feFuncR\",\n    \"feGaussianBlur\",\n    \"feImage\",\n    \"feMerge\",\n    \"feMergeNode\",\n    \"feMorphology\",\n    \"feOffset\",\n    \"fePointLight\",\n    \"feSpecularLighting\",\n    \"feSpotLight\",\n    \"feTile\",\n    \"feTurbulence\",\n    \"foreignObject\",\n    \"glyphRef\",\n    \"linearGradient\",\n    \"radialGradient\",\n    \"textPath\",\n].map((val) => [val.toLowerCase(), val]));\nexport const attributeNames = new Map([\n    \"definitionURL\",\n    \"attributeName\",\n    \"attributeType\",\n    \"baseFrequency\",\n    \"baseProfile\",\n    \"calcMode\",\n    \"clipPathUnits\",\n    \"diffuseConstant\",\n    \"edgeMode\",\n    \"filterUnits\",\n    \"glyphRef\",\n    \"gradientTransform\",\n    \"gradientUnits\",\n    \"kernelMatrix\",\n    \"kernelUnitLength\",\n    \"keyPoints\",\n    \"keySplines\",\n    \"keyTimes\",\n    \"lengthAdjust\",\n    \"limitingConeAngle\",\n    \"markerHeight\",\n    \"markerUnits\",\n    \"markerWidth\",\n    \"maskContentUnits\",\n    \"maskUnits\",\n    \"numOctaves\",\n    \"pathLength\",\n    \"patternContentUnits\",\n    \"patternTransform\",\n    \"patternUnits\",\n    \"pointsAtX\",\n    \"pointsAtY\",\n    \"pointsAtZ\",\n    \"preserveAlpha\",\n    \"preserveAspectRatio\",\n    \"primitiveUnits\",\n    \"refX\",\n    \"refY\",\n    \"repeatCount\",\n    \"repeatDur\",\n    \"requiredExtensions\",\n    \"requiredFeatures\",\n    \"specularConstant\",\n    \"specularExponent\",\n    \"spreadMethod\",\n    \"startOffset\",\n    \"stdDeviation\",\n    \"stitchTiles\",\n    \"surfaceScale\",\n    \"systemLanguage\",\n    \"tableValues\",\n    \"targetX\",\n    \"targetY\",\n    \"textLength\",\n    \"viewBox\",\n    \"viewTarget\",\n    \"xChannelSelector\",\n    \"yChannelSelector\",\n    \"zoomAndPan\",\n].map((val) => [val.toLowerCase(), val]));\n","/*\n * Module dependencies\n */\nimport * as ElementType from \"domelementtype\";\nimport { encodeXML, escapeAttribute, escapeText } from \"entities\";\n/**\n * Mixed-case SVG and MathML tags & attributes\n * recognized by the HTML parser.\n *\n * @see https://html.spec.whatwg.org/multipage/parsing.html#parsing-main-inforeign\n */\nimport { elementNames, attributeNames } from \"./foreignNames.js\";\nconst unencodedElements = new Set([\n    \"style\",\n    \"script\",\n    \"xmp\",\n    \"iframe\",\n    \"noembed\",\n    \"noframes\",\n    \"plaintext\",\n    \"noscript\",\n]);\nfunction replaceQuotes(value) {\n    return value.replace(/\"/g, \"&quot;\");\n}\n/**\n * Format attributes\n */\nfunction formatAttributes(attributes, opts) {\n    var _a;\n    if (!attributes)\n        return;\n    const encode = ((_a = opts.encodeEntities) !== null && _a !== void 0 ? _a : opts.decodeEntities) === false\n        ? replaceQuotes\n        : opts.xmlMode || opts.encodeEntities !== \"utf8\"\n            ? encodeXML\n            : escapeAttribute;\n    return Object.keys(attributes)\n        .map((key) => {\n        var _a, _b;\n        const value = (_a = attributes[key]) !== null && _a !== void 0 ? _a : \"\";\n        if (opts.xmlMode === \"foreign\") {\n            /* Fix up mixed-case attribute names */\n            key = (_b = attributeNames.get(key)) !== null && _b !== void 0 ? _b : key;\n        }\n        if (!opts.emptyAttrs && !opts.xmlMode && value === \"\") {\n            return key;\n        }\n        return `${key}=\"${encode(value)}\"`;\n    })\n        .join(\" \");\n}\n/**\n * Self-enclosing tags\n */\nconst singleTag = new Set([\n    \"area\",\n    \"base\",\n    \"basefont\",\n    \"br\",\n    \"col\",\n    \"command\",\n    \"embed\",\n    \"frame\",\n    \"hr\",\n    \"img\",\n    \"input\",\n    \"isindex\",\n    \"keygen\",\n    \"link\",\n    \"meta\",\n    \"param\",\n    \"source\",\n    \"track\",\n    \"wbr\",\n]);\n/**\n * Renders a DOM node or an array of DOM nodes to a string.\n *\n * Can be thought of as the equivalent of the `outerHTML` of the passed node(s).\n *\n * @param node Node to be rendered.\n * @param options Changes serialization behavior\n */\nexport function render(node, options = {}) {\n    const nodes = \"length\" in node ? node : [node];\n    let output = \"\";\n    for (let i = 0; i < nodes.length; i++) {\n        output += renderNode(nodes[i], options);\n    }\n    return output;\n}\nexport default render;\nfunction renderNode(node, options) {\n    switch (node.type) {\n        case ElementType.Root:\n            return render(node.children, options);\n        // @ts-expect-error We don't use `Doctype` yet\n        case ElementType.Doctype:\n        case ElementType.Directive:\n            return renderDirective(node);\n        case ElementType.Comment:\n            return renderComment(node);\n        case ElementType.CDATA:\n            return renderCdata(node);\n        case ElementType.Script:\n        case ElementType.Style:\n        case ElementType.Tag:\n            return renderTag(node, options);\n        case ElementType.Text:\n            return renderText(node, options);\n    }\n}\nconst foreignModeIntegrationPoints = new Set([\n    \"mi\",\n    \"mo\",\n    \"mn\",\n    \"ms\",\n    \"mtext\",\n    \"annotation-xml\",\n    \"foreignObject\",\n    \"desc\",\n    \"title\",\n]);\nconst foreignElements = new Set([\"svg\", \"math\"]);\nfunction renderTag(elem, opts) {\n    var _a;\n    // Handle SVG / MathML in HTML\n    if (opts.xmlMode === \"foreign\") {\n        /* Fix up mixed-case element names */\n        elem.name = (_a = elementNames.get(elem.name)) !== null && _a !== void 0 ? _a : elem.name;\n        /* Exit foreign mode at integration points */\n        if (elem.parent &&\n            foreignModeIntegrationPoints.has(elem.parent.name)) {\n            opts = { ...opts, xmlMode: false };\n        }\n    }\n    if (!opts.xmlMode && foreignElements.has(elem.name)) {\n        opts = { ...opts, xmlMode: \"foreign\" };\n    }\n    let tag = `<${elem.name}`;\n    const attribs = formatAttributes(elem.attribs, opts);\n    if (attribs) {\n        tag += ` ${attribs}`;\n    }\n    if (elem.children.length === 0 &&\n        (opts.xmlMode\n            ? // In XML mode or foreign mode, and user hasn't explicitly turned off self-closing tags\n                opts.selfClosingTags !== false\n            : // User explicitly asked for self-closing tags, even in HTML mode\n                opts.selfClosingTags && singleTag.has(elem.name))) {\n        if (!opts.xmlMode)\n            tag += \" \";\n        tag += \"/>\";\n    }\n    else {\n        tag += \">\";\n        if (elem.children.length > 0) {\n            tag += render(elem.children, opts);\n        }\n        if (opts.xmlMode || !singleTag.has(elem.name)) {\n            tag += `</${elem.name}>`;\n        }\n    }\n    return tag;\n}\nfunction renderDirective(elem) {\n    return `<${elem.data}>`;\n}\nfunction renderText(elem, opts) {\n    var _a;\n    let data = elem.data || \"\";\n    // If entities weren't decoded, no need to encode them back\n    if (((_a = opts.encodeEntities) !== null && _a !== void 0 ? _a : opts.decodeEntities) !== false &&\n        !(!opts.xmlMode &&\n            elem.parent &&\n            unencodedElements.has(elem.parent.name))) {\n        data =\n            opts.xmlMode || opts.encodeEntities !== \"utf8\"\n                ? encodeXML(data)\n                : escapeText(data);\n    }\n    return data;\n}\nfunction renderCdata(elem) {\n    return `<![CDATA[${elem.children[0].data}]]>`;\n}\nfunction renderComment(elem) {\n    return `<!--${elem.data}-->`;\n}\n","import { isTag, isCDATA, isText, hasChildren, isComment, } from \"domhandler\";\nimport renderHTML from \"dom-serializer\";\nimport { ElementType } from \"domelementtype\";\n/**\n * @category Stringify\n * @deprecated Use the `dom-serializer` module directly.\n * @param node Node to get the outer HTML of.\n * @param options Options for serialization.\n * @returns `node`'s outer HTML.\n */\nexport function getOuterHTML(node, options) {\n    return renderHTML(node, options);\n}\n/**\n * @category Stringify\n * @deprecated Use the `dom-serializer` module directly.\n * @param node Node to get the inner HTML of.\n * @param options Options for serialization.\n * @returns `node`'s inner HTML.\n */\nexport function getInnerHTML(node, options) {\n    return hasChildren(node)\n        ? node.children.map((node) => getOuterHTML(node, options)).join(\"\")\n        : \"\";\n}\n/**\n * Get a node's inner text. Same as `textContent`, but inserts newlines for `<br>` tags. Ignores comments.\n *\n * @category Stringify\n * @deprecated Use `textContent` instead.\n * @param node Node to get the inner text of.\n * @returns `node`'s inner text.\n */\nexport function getText(node) {\n    if (Array.isArray(node))\n        return node.map(getText).join(\"\");\n    if (isTag(node))\n        return node.name === \"br\" ? \"\\n\" : getText(node.children);\n    if (isCDATA(node))\n        return getText(node.children);\n    if (isText(node))\n        return node.data;\n    return \"\";\n}\n/**\n * Get a node's text content. Ignores comments.\n *\n * @category Stringify\n * @param node Node to get the text content of.\n * @returns `node`'s text content.\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent}\n */\nexport function textContent(node) {\n    if (Array.isArray(node))\n        return node.map(textContent).join(\"\");\n    if (hasChildren(node) && !isComment(node)) {\n        return textContent(node.children);\n    }\n    if (isText(node))\n        return node.data;\n    return \"\";\n}\n/**\n * Get a node's inner text, ignoring `<script>` and `<style>` tags. Ignores comments.\n *\n * @category Stringify\n * @param node Node to get the inner text of.\n * @returns `node`'s inner text.\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Node/innerText}\n */\nexport function innerText(node) {\n    if (Array.isArray(node))\n        return node.map(innerText).join(\"\");\n    if (hasChildren(node) && (node.type === ElementType.Tag || isCDATA(node))) {\n        return innerText(node.children);\n    }\n    if (isText(node))\n        return node.data;\n    return \"\";\n}\n//# sourceMappingURL=stringify.js.map","import { isTag, hasChildren, } from \"domhandler\";\n/**\n * Get a node's children.\n *\n * @category Traversal\n * @param elem Node to get the children of.\n * @returns `elem`'s children, or an empty array.\n */\nexport function getChildren(elem) {\n    return hasChildren(elem) ? elem.children : [];\n}\n/**\n * Get a node's parent.\n *\n * @category Traversal\n * @param elem Node to get the parent of.\n * @returns `elem`'s parent node, or `null` if `elem` is a root node.\n */\nexport function getParent(elem) {\n    return elem.parent || null;\n}\n/**\n * Gets an elements siblings, including the element itself.\n *\n * Attempts to get the children through the element's parent first. If we don't\n * have a parent (the element is a root node), we walk the element's `prev` &\n * `next` to get all remaining nodes.\n *\n * @category Traversal\n * @param elem Element to get the siblings of.\n * @returns `elem`'s siblings, including `elem`.\n */\nexport function getSiblings(elem) {\n    const parent = getParent(elem);\n    if (parent != null)\n        return getChildren(parent);\n    const siblings = [elem];\n    let { prev, next } = elem;\n    while (prev != null) {\n        siblings.unshift(prev);\n        ({ prev } = prev);\n    }\n    while (next != null) {\n        siblings.push(next);\n        ({ next } = next);\n    }\n    return siblings;\n}\n/**\n * Gets an attribute from an element.\n *\n * @category Traversal\n * @param elem Element to check.\n * @param name Attribute name to retrieve.\n * @returns The element's attribute value, or `undefined`.\n */\nexport function getAttributeValue(elem, name) {\n    var _a;\n    return (_a = elem.attribs) === null || _a === void 0 ? void 0 : _a[name];\n}\n/**\n * Checks whether an element has an attribute.\n *\n * @category Traversal\n * @param elem Element to check.\n * @param name Attribute name to look for.\n * @returns Returns whether `elem` has the attribute `name`.\n */\nexport function hasAttrib(elem, name) {\n    return (elem.attribs != null &&\n        Object.prototype.hasOwnProperty.call(elem.attribs, name) &&\n        elem.attribs[name] != null);\n}\n/**\n * Get the tag name of an element.\n *\n * @category Traversal\n * @param elem The element to get the name for.\n * @returns The tag name of `elem`.\n */\nexport function getName(elem) {\n    return elem.name;\n}\n/**\n * Returns the next element sibling of a node.\n *\n * @category Traversal\n * @param elem The element to get the next sibling of.\n * @returns `elem`'s next sibling that is a tag, or `null` if there is no next\n * sibling.\n */\nexport function nextElementSibling(elem) {\n    let { next } = elem;\n    while (next !== null && !isTag(next))\n        ({ next } = next);\n    return next;\n}\n/**\n * Returns the previous element sibling of a node.\n *\n * @category Traversal\n * @param elem The element to get the previous sibling of.\n * @returns `elem`'s previous sibling that is a tag, or `null` if there is no\n * previous sibling.\n */\nexport function prevElementSibling(elem) {\n    let { prev } = elem;\n    while (prev !== null && !isTag(prev))\n        ({ prev } = prev);\n    return prev;\n}\n//# sourceMappingURL=traversal.js.map","/**\n * Remove an element from the dom\n *\n * @category Manipulation\n * @param elem The element to be removed\n */\nexport function removeElement(elem) {\n    if (elem.prev)\n        elem.prev.next = elem.next;\n    if (elem.next)\n        elem.next.prev = elem.prev;\n    if (elem.parent) {\n        const childs = elem.parent.children;\n        const childsIndex = childs.lastIndexOf(elem);\n        if (childsIndex >= 0) {\n            childs.splice(childsIndex, 1);\n        }\n    }\n    elem.next = null;\n    elem.prev = null;\n    elem.parent = null;\n}\n/**\n * Replace an element in the dom\n *\n * @category Manipulation\n * @param elem The element to be replaced\n * @param replacement The element to be added\n */\nexport function replaceElement(elem, replacement) {\n    const prev = (replacement.prev = elem.prev);\n    if (prev) {\n        prev.next = replacement;\n    }\n    const next = (replacement.next = elem.next);\n    if (next) {\n        next.prev = replacement;\n    }\n    const parent = (replacement.parent = elem.parent);\n    if (parent) {\n        const childs = parent.children;\n        childs[childs.lastIndexOf(elem)] = replacement;\n        elem.parent = null;\n    }\n}\n/**\n * Append a child to an element.\n *\n * @category Manipulation\n * @param parent The element to append to.\n * @param child The element to be added as a child.\n */\nexport function appendChild(parent, child) {\n    removeElement(child);\n    child.next = null;\n    child.parent = parent;\n    if (parent.children.push(child) > 1) {\n        const sibling = parent.children[parent.children.length - 2];\n        sibling.next = child;\n        child.prev = sibling;\n    }\n    else {\n        child.prev = null;\n    }\n}\n/**\n * Append an element after another.\n *\n * @category Manipulation\n * @param elem The element to append after.\n * @param next The element be added.\n */\nexport function append(elem, next) {\n    removeElement(next);\n    const { parent } = elem;\n    const currNext = elem.next;\n    next.next = currNext;\n    next.prev = elem;\n    elem.next = next;\n    next.parent = parent;\n    if (currNext) {\n        currNext.prev = next;\n        if (parent) {\n            const childs = parent.children;\n            childs.splice(childs.lastIndexOf(currNext), 0, next);\n        }\n    }\n    else if (parent) {\n        parent.children.push(next);\n    }\n}\n/**\n * Prepend a child to an element.\n *\n * @category Manipulation\n * @param parent The element to prepend before.\n * @param child The element to be added as a child.\n */\nexport function prependChild(parent, child) {\n    removeElement(child);\n    child.parent = parent;\n    child.prev = null;\n    if (parent.children.unshift(child) !== 1) {\n        const sibling = parent.children[1];\n        sibling.prev = child;\n        child.next = sibling;\n    }\n    else {\n        child.next = null;\n    }\n}\n/**\n * Prepend an element before another.\n *\n * @category Manipulation\n * @param elem The element to prepend before.\n * @param prev The element be added.\n */\nexport function prepend(elem, prev) {\n    removeElement(prev);\n    const { parent } = elem;\n    if (parent) {\n        const childs = parent.children;\n        childs.splice(childs.indexOf(elem), 0, prev);\n    }\n    if (elem.prev) {\n        elem.prev.next = prev;\n    }\n    prev.parent = parent;\n    prev.prev = elem.prev;\n    prev.next = elem;\n    elem.prev = prev;\n}\n//# sourceMappingURL=manipulation.js.map","import { isTag, hasChildren } from \"domhandler\";\n/**\n * Search a node and its children for nodes passing a test function. If `node` is not an array, it will be wrapped in one.\n *\n * @category Querying\n * @param test Function to test nodes on.\n * @param node Node to search. Will be included in the result set if it matches.\n * @param recurse Also consider child nodes.\n * @param limit Maximum number of nodes to return.\n * @returns All nodes passing `test`.\n */\nexport function filter(test, node, recurse = true, limit = Infinity) {\n    return find(test, Array.isArray(node) ? node : [node], recurse, limit);\n}\n/**\n * Search an array of nodes and their children for nodes passing a test function.\n *\n * @category Querying\n * @param test Function to test nodes on.\n * @param nodes Array of nodes to search.\n * @param recurse Also consider child nodes.\n * @param limit Maximum number of nodes to return.\n * @returns All nodes passing `test`.\n */\nexport function find(test, nodes, recurse, limit) {\n    const result = [];\n    /** Stack of the arrays we are looking at. */\n    const nodeStack = [Array.isArray(nodes) ? nodes : [nodes]];\n    /** Stack of the indices within the arrays. */\n    const indexStack = [0];\n    for (;;) {\n        // First, check if the current array has any more elements to look at.\n        if (indexStack[0] >= nodeStack[0].length) {\n            // If we have no more arrays to look at, we are done.\n            if (indexStack.length === 1) {\n                return result;\n            }\n            // Otherwise, remove the current array from the stack.\n            nodeStack.shift();\n            indexStack.shift();\n            // Loop back to the start to continue with the next array.\n            continue;\n        }\n        const elem = nodeStack[0][indexStack[0]++];\n        if (test(elem)) {\n            result.push(elem);\n            if (--limit <= 0)\n                return result;\n        }\n        if (recurse && hasChildren(elem) && elem.children.length > 0) {\n            /*\n             * Add the children to the stack. We are depth-first, so this is\n             * the next array we look at.\n             */\n            indexStack.unshift(0);\n            nodeStack.unshift(elem.children);\n        }\n    }\n}\n/**\n * Finds the first element inside of an array that matches a test function. This is an alias for `Array.prototype.find`.\n *\n * @category Querying\n * @param test Function to test nodes on.\n * @param nodes Array of nodes to search.\n * @returns The first node in the array that passes `test`.\n * @deprecated Use `Array.prototype.find` directly.\n */\nexport function findOneChild(test, nodes) {\n    return nodes.find(test);\n}\n/**\n * Finds one element in a tree that passes a test.\n *\n * @category Querying\n * @param test Function to test nodes on.\n * @param nodes Node or array of nodes to search.\n * @param recurse Also consider child nodes.\n * @returns The first node that passes `test`.\n */\nexport function findOne(test, nodes, recurse = true) {\n    const searchedNodes = Array.isArray(nodes) ? nodes : [nodes];\n    for (let i = 0; i < searchedNodes.length; i++) {\n        const node = searchedNodes[i];\n        if (isTag(node) && test(node)) {\n            return node;\n        }\n        if (recurse && hasChildren(node) && node.children.length > 0) {\n            const found = findOne(test, node.children, true);\n            if (found)\n                return found;\n        }\n    }\n    return null;\n}\n/**\n * Checks if a tree of nodes contains at least one node passing a test.\n *\n * @category Querying\n * @param test Function to test nodes on.\n * @param nodes Array of nodes to search.\n * @returns Whether a tree of nodes contains at least one node passing the test.\n */\nexport function existsOne(test, nodes) {\n    return (Array.isArray(nodes) ? nodes : [nodes]).some((node) => (isTag(node) && test(node)) ||\n        (hasChildren(node) && existsOne(test, node.children)));\n}\n/**\n * Search an array of nodes and their children for elements passing a test function.\n *\n * Same as `find`, but limited to elements and with less options, leading to reduced complexity.\n *\n * @category Querying\n * @param test Function to test nodes on.\n * @param nodes Array of nodes to search.\n * @returns All nodes passing `test`.\n */\nexport function findAll(test, nodes) {\n    const result = [];\n    const nodeStack = [Array.isArray(nodes) ? nodes : [nodes]];\n    const indexStack = [0];\n    for (;;) {\n        if (indexStack[0] >= nodeStack[0].length) {\n            if (nodeStack.length === 1) {\n                return result;\n            }\n            // Otherwise, remove the current array from the stack.\n            nodeStack.shift();\n            indexStack.shift();\n            // Loop back to the start to continue with the next array.\n            continue;\n        }\n        const elem = nodeStack[0][indexStack[0]++];\n        if (isTag(elem) && test(elem))\n            result.push(elem);\n        if (hasChildren(elem) && elem.children.length > 0) {\n            indexStack.unshift(0);\n            nodeStack.unshift(elem.children);\n        }\n    }\n}\n//# sourceMappingURL=querying.js.map","import { isTag, isText } from \"domhandler\";\nimport { filter, findOne } from \"./querying.js\";\n/**\n * A map of functions to check nodes against.\n */\nconst Checks = {\n    tag_name(name) {\n        if (typeof name === \"function\") {\n            return (elem) => isTag(elem) && name(elem.name);\n        }\n        else if (name === \"*\") {\n            return isTag;\n        }\n        return (elem) => isTag(elem) && elem.name === name;\n    },\n    tag_type(type) {\n        if (typeof type === \"function\") {\n            return (elem) => type(elem.type);\n        }\n        return (elem) => elem.type === type;\n    },\n    tag_contains(data) {\n        if (typeof data === \"function\") {\n            return (elem) => isText(elem) && data(elem.data);\n        }\n        return (elem) => isText(elem) && elem.data === data;\n    },\n};\n/**\n * Returns a function to check whether a node has an attribute with a particular\n * value.\n *\n * @param attrib Attribute to check.\n * @param value Attribute value to look for.\n * @returns A function to check whether the a node has an attribute with a\n *   particular value.\n */\nfunction getAttribCheck(attrib, value) {\n    if (typeof value === \"function\") {\n        return (elem) => isTag(elem) && value(elem.attribs[attrib]);\n    }\n    return (elem) => isTag(elem) && elem.attribs[attrib] === value;\n}\n/**\n * Returns a function that returns `true` if either of the input functions\n * returns `true` for a node.\n *\n * @param a First function to combine.\n * @param b Second function to combine.\n * @returns A function taking a node and returning `true` if either of the input\n *   functions returns `true` for the node.\n */\nfunction combineFuncs(a, b) {\n    return (elem) => a(elem) || b(elem);\n}\n/**\n * Returns a function that executes all checks in `options` and returns `true`\n * if any of them match a node.\n *\n * @param options An object describing nodes to look for.\n * @returns A function that executes all checks in `options` and returns `true`\n *   if any of them match a node.\n */\nfunction compileTest(options) {\n    const funcs = Object.keys(options).map((key) => {\n        const value = options[key];\n        return Object.prototype.hasOwnProperty.call(Checks, key)\n            ? Checks[key](value)\n            : getAttribCheck(key, value);\n    });\n    return funcs.length === 0 ? null : funcs.reduce(combineFuncs);\n}\n/**\n * Checks whether a node matches the description in `options`.\n *\n * @category Legacy Query Functions\n * @param options An object describing nodes to look for.\n * @param node The element to test.\n * @returns Whether the element matches the description in `options`.\n */\nexport function testElement(options, node) {\n    const test = compileTest(options);\n    return test ? test(node) : true;\n}\n/**\n * Returns all nodes that match `options`.\n *\n * @category Legacy Query Functions\n * @param options An object describing nodes to look for.\n * @param nodes Nodes to search through.\n * @param recurse Also consider child nodes.\n * @param limit Maximum number of nodes to return.\n * @returns All nodes that match `options`.\n */\nexport function getElements(options, nodes, recurse, limit = Infinity) {\n    const test = compileTest(options);\n    return test ? filter(test, nodes, recurse, limit) : [];\n}\n/**\n * Returns the node with the supplied ID.\n *\n * @category Legacy Query Functions\n * @param id The unique ID attribute value to look for.\n * @param nodes Nodes to search through.\n * @param recurse Also consider child nodes.\n * @returns The node with the supplied ID.\n */\nexport function getElementById(id, nodes, recurse = true) {\n    if (!Array.isArray(nodes))\n        nodes = [nodes];\n    return findOne(getAttribCheck(\"id\", id), nodes, recurse);\n}\n/**\n * Returns all nodes with the supplied `tagName`.\n *\n * @category Legacy Query Functions\n * @param tagName Tag name to search for.\n * @param nodes Nodes to search through.\n * @param recurse Also consider child nodes.\n * @param limit Maximum number of nodes to return.\n * @returns All nodes with the supplied `tagName`.\n */\nexport function getElementsByTagName(tagName, nodes, recurse = true, limit = Infinity) {\n    return filter(Checks[\"tag_name\"](tagName), nodes, recurse, limit);\n}\n/**\n * Returns all nodes with the supplied `className`.\n *\n * @category Legacy Query Functions\n * @param className Class name to search for.\n * @param nodes Nodes to search through.\n * @param recurse Also consider child nodes.\n * @param limit Maximum number of nodes to return.\n * @returns All nodes with the supplied `className`.\n */\nexport function getElementsByClassName(className, nodes, recurse = true, limit = Infinity) {\n    return filter(getAttribCheck(\"class\", className), nodes, recurse, limit);\n}\n/**\n * Returns all nodes with the supplied `type`.\n *\n * @category Legacy Query Functions\n * @param type Element type to look for.\n * @param nodes Nodes to search through.\n * @param recurse Also consider child nodes.\n * @param limit Maximum number of nodes to return.\n * @returns All nodes with the supplied `type`.\n */\nexport function getElementsByTagType(type, nodes, recurse = true, limit = Infinity) {\n    return filter(Checks[\"tag_type\"](type), nodes, recurse, limit);\n}\n//# sourceMappingURL=legacy.js.map","import { hasChildren } from \"domhandler\";\n/**\n * Given an array of nodes, remove any member that is contained by another\n * member.\n *\n * @category Helpers\n * @param nodes Nodes to filter.\n * @returns Remaining nodes that aren't contained by other nodes.\n */\nexport function removeSubsets(nodes) {\n    let idx = nodes.length;\n    /*\n     * Check if each node (or one of its ancestors) is already contained in the\n     * array.\n     */\n    while (--idx >= 0) {\n        const node = nodes[idx];\n        /*\n         * Remove the node if it is not unique.\n         * We are going through the array from the end, so we only\n         * have to check nodes that preceed the node under consideration in the array.\n         */\n        if (idx > 0 && nodes.lastIndexOf(node, idx - 1) >= 0) {\n            nodes.splice(idx, 1);\n            continue;\n        }\n        for (let ancestor = node.parent; ancestor; ancestor = ancestor.parent) {\n            if (nodes.includes(ancestor)) {\n                nodes.splice(idx, 1);\n                break;\n            }\n        }\n    }\n    return nodes;\n}\n/**\n * @category Helpers\n * @see {@link http://dom.spec.whatwg.org/#dom-node-comparedocumentposition}\n */\nexport var DocumentPosition;\n(function (DocumentPosition) {\n    DocumentPosition[DocumentPosition[\"DISCONNECTED\"] = 1] = \"DISCONNECTED\";\n    DocumentPosition[DocumentPosition[\"PRECEDING\"] = 2] = \"PRECEDING\";\n    DocumentPosition[DocumentPosition[\"FOLLOWING\"] = 4] = \"FOLLOWING\";\n    DocumentPosition[DocumentPosition[\"CONTAINS\"] = 8] = \"CONTAINS\";\n    DocumentPosition[DocumentPosition[\"CONTAINED_BY\"] = 16] = \"CONTAINED_BY\";\n})(DocumentPosition || (DocumentPosition = {}));\n/**\n * Compare the position of one node against another node in any other document,\n * returning a bitmask with the values from {@link DocumentPosition}.\n *\n * Document order:\n * > There is an ordering, document order, defined on all the nodes in the\n * > document corresponding to the order in which the first character of the\n * > XML representation of each node occurs in the XML representation of the\n * > document after expansion of general entities. Thus, the document element\n * > node will be the first node. Element nodes occur before their children.\n * > Thus, document order orders element nodes in order of the occurrence of\n * > their start-tag in the XML (after expansion of entities). The attribute\n * > nodes of an element occur after the element and before its children. The\n * > relative order of attribute nodes is implementation-dependent.\n *\n * Source:\n * http://www.w3.org/TR/DOM-Level-3-Core/glossary.html#dt-document-order\n *\n * @category Helpers\n * @param nodeA The first node to use in the comparison\n * @param nodeB The second node to use in the comparison\n * @returns A bitmask describing the input nodes' relative position.\n *\n * See http://dom.spec.whatwg.org/#dom-node-comparedocumentposition for\n * a description of these values.\n */\nexport function compareDocumentPosition(nodeA, nodeB) {\n    const aParents = [];\n    const bParents = [];\n    if (nodeA === nodeB) {\n        return 0;\n    }\n    let current = hasChildren(nodeA) ? nodeA : nodeA.parent;\n    while (current) {\n        aParents.unshift(current);\n        current = current.parent;\n    }\n    current = hasChildren(nodeB) ? nodeB : nodeB.parent;\n    while (current) {\n        bParents.unshift(current);\n        current = current.parent;\n    }\n    const maxIdx = Math.min(aParents.length, bParents.length);\n    let idx = 0;\n    while (idx < maxIdx && aParents[idx] === bParents[idx]) {\n        idx++;\n    }\n    if (idx === 0) {\n        return DocumentPosition.DISCONNECTED;\n    }\n    const sharedParent = aParents[idx - 1];\n    const siblings = sharedParent.children;\n    const aSibling = aParents[idx];\n    const bSibling = bParents[idx];\n    if (siblings.indexOf(aSibling) > siblings.indexOf(bSibling)) {\n        if (sharedParent === nodeB) {\n            return DocumentPosition.FOLLOWING | DocumentPosition.CONTAINED_BY;\n        }\n        return DocumentPosition.FOLLOWING;\n    }\n    if (sharedParent === nodeA) {\n        return DocumentPosition.PRECEDING | DocumentPosition.CONTAINS;\n    }\n    return DocumentPosition.PRECEDING;\n}\n/**\n * Sort an array of nodes based on their relative position in the document,\n * removing any duplicate nodes. If the array contains nodes that do not belong\n * to the same document, sort order is unspecified.\n *\n * @category Helpers\n * @param nodes Array of DOM nodes.\n * @returns Collection of unique nodes, sorted in document order.\n */\nexport function uniqueSort(nodes) {\n    nodes = nodes.filter((node, i, arr) => !arr.includes(node, i + 1));\n    nodes.sort((a, b) => {\n        const relative = compareDocumentPosition(a, b);\n        if (relative & DocumentPosition.PRECEDING) {\n            return -1;\n        }\n        else if (relative & DocumentPosition.FOLLOWING) {\n            return 1;\n        }\n        return 0;\n    });\n    return nodes;\n}\n//# sourceMappingURL=helpers.js.map","import { textContent } from \"./stringify.js\";\nimport { getElementsByTagName } from \"./legacy.js\";\n/**\n * Get the feed object from the root of a DOM tree.\n *\n * @category Feeds\n * @param doc - The DOM to to extract the feed from.\n * @returns The feed.\n */\nexport function getFeed(doc) {\n    const feedRoot = getOneElement(isValidFeed, doc);\n    return !feedRoot\n        ? null\n        : feedRoot.name === \"feed\"\n            ? getAtomFeed(feedRoot)\n            : getRssFeed(feedRoot);\n}\n/**\n * Parse an Atom feed.\n *\n * @param feedRoot The root of the feed.\n * @returns The parsed feed.\n */\nfunction getAtomFeed(feedRoot) {\n    var _a;\n    const childs = feedRoot.children;\n    const feed = {\n        type: \"atom\",\n        items: getElementsByTagName(\"entry\", childs).map((item) => {\n            var _a;\n            const { children } = item;\n            const entry = { media: getMediaElements(children) };\n            addConditionally(entry, \"id\", \"id\", children);\n            addConditionally(entry, \"title\", \"title\", children);\n            const href = (_a = getOneElement(\"link\", children)) === null || _a === void 0 ? void 0 : _a.attribs[\"href\"];\n            if (href) {\n                entry.link = href;\n            }\n            const description = fetch(\"summary\", children) || fetch(\"content\", children);\n            if (description) {\n                entry.description = description;\n            }\n            const pubDate = fetch(\"updated\", children);\n            if (pubDate) {\n                entry.pubDate = new Date(pubDate);\n            }\n            return entry;\n        }),\n    };\n    addConditionally(feed, \"id\", \"id\", childs);\n    addConditionally(feed, \"title\", \"title\", childs);\n    const href = (_a = getOneElement(\"link\", childs)) === null || _a === void 0 ? void 0 : _a.attribs[\"href\"];\n    if (href) {\n        feed.link = href;\n    }\n    addConditionally(feed, \"description\", \"subtitle\", childs);\n    const updated = fetch(\"updated\", childs);\n    if (updated) {\n        feed.updated = new Date(updated);\n    }\n    addConditionally(feed, \"author\", \"email\", childs, true);\n    return feed;\n}\n/**\n * Parse a RSS feed.\n *\n * @param feedRoot The root of the feed.\n * @returns The parsed feed.\n */\nfunction getRssFeed(feedRoot) {\n    var _a, _b;\n    const childs = (_b = (_a = getOneElement(\"channel\", feedRoot.children)) === null || _a === void 0 ? void 0 : _a.children) !== null && _b !== void 0 ? _b : [];\n    const feed = {\n        type: feedRoot.name.substr(0, 3),\n        id: \"\",\n        items: getElementsByTagName(\"item\", feedRoot.children).map((item) => {\n            const { children } = item;\n            const entry = { media: getMediaElements(children) };\n            addConditionally(entry, \"id\", \"guid\", children);\n            addConditionally(entry, \"title\", \"title\", children);\n            addConditionally(entry, \"link\", \"link\", children);\n            addConditionally(entry, \"description\", \"description\", children);\n            const pubDate = fetch(\"pubDate\", children) || fetch(\"dc:date\", children);\n            if (pubDate)\n                entry.pubDate = new Date(pubDate);\n            return entry;\n        }),\n    };\n    addConditionally(feed, \"title\", \"title\", childs);\n    addConditionally(feed, \"link\", \"link\", childs);\n    addConditionally(feed, \"description\", \"description\", childs);\n    const updated = fetch(\"lastBuildDate\", childs);\n    if (updated) {\n        feed.updated = new Date(updated);\n    }\n    addConditionally(feed, \"author\", \"managingEditor\", childs, true);\n    return feed;\n}\nconst MEDIA_KEYS_STRING = [\"url\", \"type\", \"lang\"];\nconst MEDIA_KEYS_INT = [\n    \"fileSize\",\n    \"bitrate\",\n    \"framerate\",\n    \"samplingrate\",\n    \"channels\",\n    \"duration\",\n    \"height\",\n    \"width\",\n];\n/**\n * Get all media elements of a feed item.\n *\n * @param where Nodes to search in.\n * @returns Media elements.\n */\nfunction getMediaElements(where) {\n    return getElementsByTagName(\"media:content\", where).map((elem) => {\n        const { attribs } = elem;\n        const media = {\n            medium: attribs[\"medium\"],\n            isDefault: !!attribs[\"isDefault\"],\n        };\n        for (const attrib of MEDIA_KEYS_STRING) {\n            if (attribs[attrib]) {\n                media[attrib] = attribs[attrib];\n            }\n        }\n        for (const attrib of MEDIA_KEYS_INT) {\n            if (attribs[attrib]) {\n                media[attrib] = parseInt(attribs[attrib], 10);\n            }\n        }\n        if (attribs[\"expression\"]) {\n            media.expression = attribs[\"expression\"];\n        }\n        return media;\n    });\n}\n/**\n * Get one element by tag name.\n *\n * @param tagName Tag name to look for\n * @param node Node to search in\n * @returns The element or null\n */\nfunction getOneElement(tagName, node) {\n    return getElementsByTagName(tagName, node, true, 1)[0];\n}\n/**\n * Get the text content of an element with a certain tag name.\n *\n * @param tagName Tag name to look for.\n * @param where Node to search in.\n * @param recurse Whether to recurse into child nodes.\n * @returns The text content of the element.\n */\nfunction fetch(tagName, where, recurse = false) {\n    return textContent(getElementsByTagName(tagName, where, recurse, 1)).trim();\n}\n/**\n * Adds a property to an object if it has a value.\n *\n * @param obj Object to be extended\n * @param prop Property name\n * @param tagName Tag name that contains the conditionally added property\n * @param where Element to search for the property\n * @param recurse Whether to recurse into child nodes.\n */\nfunction addConditionally(obj, prop, tagName, where, recurse = false) {\n    const val = fetch(tagName, where, recurse);\n    if (val)\n        obj[prop] = val;\n}\n/**\n * Checks if an element is a feed root node.\n *\n * @param value The name of the element to check.\n * @returns Whether an element is a feed root node.\n */\nfunction isValidFeed(value) {\n    return value === \"rss\" || value === \"feed\" || value === \"rdf:RDF\";\n}\n//# sourceMappingURL=feeds.js.map","import { textContent } from 'domutils';\nimport { flattenOptions as flattenOptions, } from './options.js';\n/**\n * Helper function to render a DOM.\n *\n * @param that - Cheerio instance to render.\n * @param dom - The DOM to render. Defaults to `that`'s root.\n * @param options - Options for rendering.\n * @returns The rendered document.\n */\nfunction render(that, dom, options) {\n    if (!that)\n        return '';\n    return that(dom !== null && dom !== void 0 ? dom : that._root.children, null, undefined, options).toString();\n}\n/**\n * Checks if a passed object is an options object.\n *\n * @param dom - Object to check if it is an options object.\n * @param options - Options object.\n * @returns Whether the object is an options object.\n */\nfunction isOptions(dom, options) {\n    return (!options &&\n        typeof dom === 'object' &&\n        dom != null &&\n        !('length' in dom) &&\n        !('type' in dom));\n}\nexport function html(dom, options) {\n    /*\n     * Be flexible about parameters, sometimes we call html(),\n     * with options as only parameter\n     * check dom argument for dom element specific properties\n     * assume there is no 'length' or 'type' properties in the options object\n     */\n    const toRender = isOptions(dom) ? ((options = dom), undefined) : dom;\n    /*\n     * Sometimes `$.html()` is used without preloading html,\n     * so fallback non-existing options to the default ones.\n     */\n    const opts = {\n        ...this === null || this === void 0 ? void 0 : this._options,\n        ...flattenOptions(options),\n    };\n    return render(this, toRender, opts);\n}\n/**\n * Render the document as XML.\n *\n * @category Static\n * @param dom - Element to render.\n * @returns THe rendered document.\n */\nexport function xml(dom) {\n    const options = { ...this._options, xmlMode: true };\n    return render(this, dom, options);\n}\n/**\n * Render the document as text.\n *\n * This returns the `textContent` of the passed elements. The result will\n * include the contents of `<script>` and `<style>` elements. To avoid this, use\n * `.prop('innerText')` instead.\n *\n * @category Static\n * @param elements - Elements to render.\n * @returns The rendered document.\n */\nexport function text(elements) {\n    const elems = elements !== null && elements !== void 0 ? elements : (this ? this.root() : []);\n    let ret = '';\n    for (let i = 0; i < elems.length; i++) {\n        ret += textContent(elems[i]);\n    }\n    return ret;\n}\nexport function parseHTML(data, context, keepScripts = typeof context === 'boolean' ? context : false) {\n    if (!data || typeof data !== 'string') {\n        return null;\n    }\n    if (typeof context === 'boolean') {\n        keepScripts = context;\n    }\n    const parsed = this.load(data, this._options, false);\n    if (!keepScripts) {\n        parsed('script').remove();\n    }\n    /*\n     * The `children` array is used by Cheerio internally to group elements that\n     * share the same parents. When nodes created through `parseHTML` are\n     * inserted into previously-existing DOM structures, they will be removed\n     * from the `children` array. The results of `parseHTML` should remain\n     * constant across these operations, so a shallow copy should be returned.\n     */\n    return [...parsed.root()[0].children];\n}\n/**\n * Sometimes you need to work with the top-level root element. To query it, you\n * can use `$.root()`.\n *\n * @category Static\n * @example\n *\n * ```js\n * $.root().append('<ul id=\"vegetables\"></ul>').html();\n * //=> <ul id=\"fruits\">...</ul><ul id=\"vegetables\"></ul>\n * ```\n *\n * @returns Cheerio instance wrapping the root node.\n * @alias Cheerio.root\n */\nexport function root() {\n    return this(this._root);\n}\n/**\n * Checks to see if the `contained` DOM element is a descendant of the\n * `container` DOM element.\n *\n * @category Static\n * @param container - Potential parent node.\n * @param contained - Potential child node.\n * @returns Indicates if the nodes contain one another.\n * @alias Cheerio.contains\n * @see {@link https://api.jquery.com/jQuery.contains/}\n */\nexport function contains(container, contained) {\n    // According to the jQuery API, an element does not \"contain\" itself\n    if (contained === container) {\n        return false;\n    }\n    /*\n     * Step up the descendants, stopping when the root element is reached\n     * (signaled by `.parent` returning a reference to the same object)\n     */\n    let next = contained;\n    while (next && next !== next.parent) {\n        next = next.parent;\n        if (next === container) {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Extract multiple values from a document, and store them in an object.\n *\n * @category Static\n * @param map - An object containing key-value pairs. The keys are the names of\n *   the properties to be created on the object, and the values are the\n *   selectors to be used to extract the values.\n * @returns An object containing the extracted values.\n */\nexport function extract(map) {\n    return this.root().extract(map);\n}\n/**\n * $.merge().\n *\n * @category Static\n * @param arr1 - First array.\n * @param arr2 - Second array.\n * @returns `arr1`, with elements of `arr2` inserted.\n * @alias Cheerio.merge\n * @see {@link https://api.jquery.com/jQuery.merge/}\n */\nexport function merge(arr1, arr2) {\n    if (!isArrayLike(arr1) || !isArrayLike(arr2)) {\n        return;\n    }\n    let newLength = arr1.length;\n    const len = +arr2.length;\n    for (let i = 0; i < len; i++) {\n        arr1[newLength++] = arr2[i];\n    }\n    arr1.length = newLength;\n    return arr1;\n}\n/**\n * Checks if an object is array-like.\n *\n * @category Static\n * @param item - Item to check.\n * @returns Indicates if the item is array-like.\n */\nfunction isArrayLike(item) {\n    if (Array.isArray(item)) {\n        return true;\n    }\n    if (typeof item !== 'object' ||\n        item === null ||\n        !('length' in item) ||\n        typeof item.length !== 'number' ||\n        item.length < 0) {\n        return false;\n    }\n    for (let i = 0; i < item.length; i++) {\n        if (!(i in item)) {\n            return false;\n        }\n    }\n    return true;\n}\n//# sourceMappingURL=static.js.map","/**\n * Checks if an object is a Cheerio instance.\n *\n * @category Utils\n * @param maybeCheerio - The object to check.\n * @returns Whether the object is a Cheerio instance.\n */\nexport function isCheerio(maybeCheerio) {\n    return maybeCheerio.cheerio != null;\n}\n/**\n * Convert a string to camel case notation.\n *\n * @private\n * @category Utils\n * @param str - The string to be converted.\n * @returns String in camel case notation.\n */\nexport function camelCase(str) {\n    return str.replace(/[._-](\\w|$)/g, (_, x) => x.toUpperCase());\n}\n/**\n * Convert a string from camel case to \"CSS case\", where word boundaries are\n * described by hyphens (\"-\") and all characters are lower-case.\n *\n * @private\n * @category Utils\n * @param str - The string to be converted.\n * @returns String in \"CSS case\".\n */\nexport function cssCase(str) {\n    return str.replace(/[A-Z]/g, '-$&').toLowerCase();\n}\n/**\n * Iterate over each DOM element without creating intermediary Cheerio\n * instances.\n *\n * This is indented for use internally to avoid otherwise unnecessary memory\n * pressure introduced by _make.\n *\n * @category Utils\n * @param array - The array to iterate over.\n * @param fn - Function to call.\n * @returns The original instance.\n */\nexport function domEach(array, fn) {\n    const len = array.length;\n    for (let i = 0; i < len; i++)\n        fn(array[i], i);\n    return array;\n}\nvar CharacterCode;\n(function (CharacterCode) {\n    CharacterCode[CharacterCode[\"LowerA\"] = 97] = \"LowerA\";\n    CharacterCode[CharacterCode[\"LowerZ\"] = 122] = \"LowerZ\";\n    CharacterCode[CharacterCode[\"UpperA\"] = 65] = \"UpperA\";\n    CharacterCode[CharacterCode[\"UpperZ\"] = 90] = \"UpperZ\";\n    CharacterCode[CharacterCode[\"Exclamation\"] = 33] = \"Exclamation\";\n})(CharacterCode || (CharacterCode = {}));\n/**\n * Check if string is HTML.\n *\n * Tests for a `<` within a string, immediate followed by a letter and\n * eventually followed by a `>`.\n *\n * @private\n * @category Utils\n * @param str - The string to check.\n * @returns Indicates if `str` is HTML.\n */\nexport function isHtml(str) {\n    const tagStart = str.indexOf('<');\n    if (tagStart === -1 || tagStart > str.length - 3)\n        return false;\n    const tagChar = str.charCodeAt(tagStart + 1);\n    return (((tagChar >= CharacterCode.LowerA && tagChar <= CharacterCode.LowerZ) ||\n        (tagChar >= CharacterCode.UpperA && tagChar <= CharacterCode.UpperZ) ||\n        tagChar === CharacterCode.Exclamation) &&\n        str.includes('>', tagStart + 2));\n}\n//# sourceMappingURL=utils.js.map","/**\n * Methods for getting and modifying attributes.\n *\n * @module cheerio/attributes\n */\nvar _a;\nimport { text } from '../static.js';\nimport { domEach, camelCase, cssCase } from '../utils.js';\nimport { isTag } from 'domhandler';\nimport { innerText, textContent } from 'domutils';\nimport { ElementType } from 'htmlparser2';\nconst hasOwn = \n// @ts-expect-error `hasOwn` is a standard object method\n(_a = Object.hasOwn) !== null && _a !== void 0 ? _a : ((object, prop) => Object.prototype.hasOwnProperty.call(object, prop));\nconst rspace = /\\s+/;\nconst dataAttrPrefix = 'data-';\n// Attributes that are booleans\nconst rboolean = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i;\n// Matches strings that look like JSON objects or arrays\nconst rbrace = /^{[^]*}$|^\\[[^]*]$/;\nfunction getAttr(elem, name, xmlMode) {\n    var _a;\n    if (!elem || !isTag(elem))\n        return undefined;\n    (_a = elem.attribs) !== null && _a !== void 0 ? _a : (elem.attribs = {});\n    // Return the entire attribs object if no attribute specified\n    if (!name) {\n        return elem.attribs;\n    }\n    if (hasOwn(elem.attribs, name)) {\n        // Get the (decoded) attribute\n        return !xmlMode && rboolean.test(name) ? name : elem.attribs[name];\n    }\n    // Mimic the DOM and return text content as value for `option's`\n    if (elem.name === 'option' && name === 'value') {\n        return text(elem.children);\n    }\n    // Mimic DOM with default value for radios/checkboxes\n    if (elem.name === 'input' &&\n        (elem.attribs['type'] === 'radio' || elem.attribs['type'] === 'checkbox') &&\n        name === 'value') {\n        return 'on';\n    }\n    return undefined;\n}\n/**\n * Sets the value of an attribute. The attribute will be deleted if the value is\n * `null`.\n *\n * @private\n * @param el - The element to set the attribute on.\n * @param name - The attribute's name.\n * @param value - The attribute's value.\n */\nfunction setAttr(el, name, value) {\n    if (value === null) {\n        removeAttribute(el, name);\n    }\n    else {\n        el.attribs[name] = `${value}`;\n    }\n}\nexport function attr(name, value) {\n    // Set the value (with attr map support)\n    if (typeof name === 'object' || value !== undefined) {\n        if (typeof value === 'function') {\n            if (typeof name !== 'string') {\n                {\n                    throw new Error('Bad combination of arguments.');\n                }\n            }\n            return domEach(this, (el, i) => {\n                if (isTag(el))\n                    setAttr(el, name, value.call(el, i, el.attribs[name]));\n            });\n        }\n        return domEach(this, (el) => {\n            if (!isTag(el))\n                return;\n            if (typeof name === 'object') {\n                for (const objName of Object.keys(name)) {\n                    const objValue = name[objName];\n                    setAttr(el, objName, objValue);\n                }\n            }\n            else {\n                setAttr(el, name, value);\n            }\n        });\n    }\n    return arguments.length > 1\n        ? this\n        : getAttr(this[0], name, this.options.xmlMode);\n}\n/**\n * Gets a node's prop.\n *\n * @private\n * @category Attributes\n * @param el - Element to get the prop of.\n * @param name - Name of the prop.\n * @param xmlMode - Disable handling of special HTML attributes.\n * @returns The prop's value.\n */\nfunction getProp(el, name, xmlMode) {\n    return name in el\n        ? // @ts-expect-error TS doesn't like us accessing the value directly here.\n            el[name]\n        : !xmlMode && rboolean.test(name)\n            ? getAttr(el, name, false) !== undefined\n            : getAttr(el, name, xmlMode);\n}\n/**\n * Sets the value of a prop.\n *\n * @private\n * @param el - The element to set the prop on.\n * @param name - The prop's name.\n * @param value - The prop's value.\n * @param xmlMode - Disable handling of special HTML attributes.\n */\nfunction setProp(el, name, value, xmlMode) {\n    if (name in el) {\n        // @ts-expect-error Overriding value\n        el[name] = value;\n    }\n    else {\n        setAttr(el, name, !xmlMode && rboolean.test(name)\n            ? value\n                ? ''\n                : null\n            : `${value}`);\n    }\n}\nexport function prop(name, value) {\n    var _a;\n    if (typeof name === 'string' && value === undefined) {\n        const el = this[0];\n        if (!el)\n            return undefined;\n        switch (name) {\n            case 'style': {\n                const property = this.css();\n                const keys = Object.keys(property);\n                for (let i = 0; i < keys.length; i++) {\n                    property[i] = keys[i];\n                }\n                property.length = keys.length;\n                return property;\n            }\n            case 'tagName':\n            case 'nodeName': {\n                if (!isTag(el))\n                    return undefined;\n                return el.name.toUpperCase();\n            }\n            case 'href':\n            case 'src': {\n                if (!isTag(el))\n                    return undefined;\n                const prop = (_a = el.attribs) === null || _a === void 0 ? void 0 : _a[name];\n                if (typeof URL !== 'undefined' &&\n                    ((name === 'href' && (el.tagName === 'a' || el.tagName === 'link')) ||\n                        (name === 'src' &&\n                            (el.tagName === 'img' ||\n                                el.tagName === 'iframe' ||\n                                el.tagName === 'audio' ||\n                                el.tagName === 'video' ||\n                                el.tagName === 'source'))) &&\n                    prop !== undefined &&\n                    this.options.baseURI) {\n                    return new URL(prop, this.options.baseURI).href;\n                }\n                return prop;\n            }\n            case 'innerText': {\n                return innerText(el);\n            }\n            case 'textContent': {\n                return textContent(el);\n            }\n            case 'outerHTML': {\n                if (el.type === ElementType.Root)\n                    return this.html();\n                return this.clone().wrap('<container />').parent().html();\n            }\n            case 'innerHTML': {\n                return this.html();\n            }\n            default: {\n                if (!isTag(el))\n                    return undefined;\n                return getProp(el, name, this.options.xmlMode);\n            }\n        }\n    }\n    if (typeof name === 'object' || value !== undefined) {\n        if (typeof value === 'function') {\n            if (typeof name === 'object') {\n                throw new TypeError('Bad combination of arguments.');\n            }\n            return domEach(this, (el, i) => {\n                if (isTag(el)) {\n                    setProp(el, name, value.call(el, i, getProp(el, name, this.options.xmlMode)), this.options.xmlMode);\n                }\n            });\n        }\n        return domEach(this, (el) => {\n            if (!isTag(el))\n                return;\n            if (typeof name === 'object') {\n                for (const key of Object.keys(name)) {\n                    const val = name[key];\n                    setProp(el, key, val, this.options.xmlMode);\n                }\n            }\n            else {\n                setProp(el, name, value, this.options.xmlMode);\n            }\n        });\n    }\n    return undefined;\n}\n/**\n * Sets the value of a data attribute.\n *\n * @private\n * @param elem - The element to set the data attribute on.\n * @param name - The data attribute's name.\n * @param value - The data attribute's value.\n */\nfunction setData(elem, name, value) {\n    var _a;\n    (_a = elem.data) !== null && _a !== void 0 ? _a : (elem.data = {});\n    if (typeof name === 'object')\n        Object.assign(elem.data, name);\n    else if (typeof name === 'string' && value !== undefined) {\n        elem.data[name] = value;\n    }\n}\n/**\n * Read _all_ HTML5 `data-*` attributes from the equivalent HTML5 `data-*`\n * attribute, and cache the value in the node's internal data store.\n *\n * @private\n * @category Attributes\n * @param el - Element to get the data attribute of.\n * @returns A map with all of the data attributes.\n */\nfunction readAllData(el) {\n    for (const domName of Object.keys(el.attribs)) {\n        if (!domName.startsWith(dataAttrPrefix)) {\n            continue;\n        }\n        const jsName = camelCase(domName.slice(dataAttrPrefix.length));\n        if (!hasOwn(el.data, jsName)) {\n            el.data[jsName] = parseDataValue(el.attribs[domName]);\n        }\n    }\n    return el.data;\n}\n/**\n * Read the specified attribute from the equivalent HTML5 `data-*` attribute,\n * and (if present) cache the value in the node's internal data store.\n *\n * @private\n * @category Attributes\n * @param el - Element to get the data attribute of.\n * @param name - Name of the data attribute.\n * @returns The data attribute's value.\n */\nfunction readData(el, name) {\n    const domName = dataAttrPrefix + cssCase(name);\n    const data = el.data;\n    if (hasOwn(data, name)) {\n        return data[name];\n    }\n    if (hasOwn(el.attribs, domName)) {\n        return (data[name] = parseDataValue(el.attribs[domName]));\n    }\n    return undefined;\n}\n/**\n * Coerce string data-* attributes to their corresponding JavaScript primitives.\n *\n * @private\n * @category Attributes\n * @param value - The value to parse.\n * @returns The parsed value.\n */\nfunction parseDataValue(value) {\n    if (value === 'null')\n        return null;\n    if (value === 'true')\n        return true;\n    if (value === 'false')\n        return false;\n    const num = Number(value);\n    if (value === String(num))\n        return num;\n    if (rbrace.test(value)) {\n        try {\n            return JSON.parse(value);\n        }\n        catch {\n            /* Ignore */\n        }\n    }\n    return value;\n}\nexport function data(name, value) {\n    var _a;\n    const elem = this[0];\n    if (!elem || !isTag(elem))\n        return;\n    const dataEl = elem;\n    (_a = dataEl.data) !== null && _a !== void 0 ? _a : (dataEl.data = {});\n    // Return the entire data object if no data specified\n    if (name == null) {\n        return readAllData(dataEl);\n    }\n    // Set the value (with attr map support)\n    if (typeof name === 'object' || value !== undefined) {\n        domEach(this, (el) => {\n            if (isTag(el)) {\n                if (typeof name === 'object')\n                    setData(el, name);\n                else\n                    setData(el, name, value);\n            }\n        });\n        return this;\n    }\n    return readData(dataEl, name);\n}\nexport function val(value) {\n    const querying = arguments.length === 0;\n    const element = this[0];\n    if (!element || !isTag(element))\n        return querying ? undefined : this;\n    switch (element.name) {\n        case 'textarea': {\n            return this.text(value);\n        }\n        case 'select': {\n            const option = this.find('option:selected');\n            if (!querying) {\n                if (this.attr('multiple') == null && typeof value === 'object') {\n                    return this;\n                }\n                this.find('option').removeAttr('selected');\n                const values = typeof value === 'object' ? value : [value];\n                for (const val of values) {\n                    this.find(`option[value=\"${val}\"]`).attr('selected', '');\n                }\n                return this;\n            }\n            return this.attr('multiple')\n                ? option.toArray().map((el) => text(el.children))\n                : option.attr('value');\n        }\n        case 'input':\n        case 'option': {\n            return querying\n                ? this.attr('value')\n                : this.attr('value', value);\n        }\n    }\n    return undefined;\n}\n/**\n * Remove an attribute.\n *\n * @private\n * @param elem - Node to remove attribute from.\n * @param name - Name of the attribute to remove.\n */\nfunction removeAttribute(elem, name) {\n    if (!elem.attribs || !hasOwn(elem.attribs, name))\n        return;\n    delete elem.attribs[name];\n}\n/**\n * Splits a space-separated list of names to individual names.\n *\n * @category Attributes\n * @param names - Names to split.\n * @returns - Split names.\n */\nfunction splitNames(names) {\n    return names ? names.trim().split(rspace) : [];\n}\n/**\n * Method for removing attributes by `name`.\n *\n * @category Attributes\n * @example\n *\n * ```js\n * $('.pear').removeAttr('class').prop('outerHTML');\n * //=> <li>Pear</li>\n *\n * $('.apple').attr('id', 'favorite');\n * $('.apple').removeAttr('id class').prop('outerHTML');\n * //=> <li>Apple</li>\n * ```\n *\n * @param name - Name of the attribute.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/removeAttr/}\n */\nexport function removeAttr(name) {\n    const attrNames = splitNames(name);\n    for (const attrName of attrNames) {\n        domEach(this, (elem) => {\n            if (isTag(elem))\n                removeAttribute(elem, attrName);\n        });\n    }\n    return this;\n}\n/**\n * Check to see if _any_ of the matched elements have the given `className`.\n *\n * @category Attributes\n * @example\n *\n * ```js\n * $('.pear').hasClass('pear');\n * //=> true\n *\n * $('apple').hasClass('fruit');\n * //=> false\n *\n * $('li').hasClass('pear');\n * //=> true\n * ```\n *\n * @param className - Name of the class.\n * @returns Indicates if an element has the given `className`.\n * @see {@link https://api.jquery.com/hasClass/}\n */\nexport function hasClass(className) {\n    return this.toArray().some((elem) => {\n        const clazz = isTag(elem) && elem.attribs['class'];\n        let idx = -1;\n        if (clazz && className.length > 0) {\n            while ((idx = clazz.indexOf(className, idx + 1)) > -1) {\n                const end = idx + className.length;\n                if ((idx === 0 || rspace.test(clazz[idx - 1])) &&\n                    (end === clazz.length || rspace.test(clazz[end]))) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    });\n}\n/**\n * Adds class(es) to all of the matched elements. Also accepts a `function`.\n *\n * @category Attributes\n * @example\n *\n * ```js\n * $('.pear').addClass('fruit').prop('outerHTML');\n * //=> <li class=\"pear fruit\">Pear</li>\n *\n * $('.apple').addClass('fruit red').prop('outerHTML');\n * //=> <li class=\"apple fruit red\">Apple</li>\n * ```\n *\n * @param value - Name of new class.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/addClass/}\n */\nexport function addClass(value) {\n    // Support functions\n    if (typeof value === 'function') {\n        return domEach(this, (el, i) => {\n            if (isTag(el)) {\n                const className = el.attribs['class'] || '';\n                addClass.call([el], value.call(el, i, className));\n            }\n        });\n    }\n    // Return if no value or not a string or function\n    if (!value || typeof value !== 'string')\n        return this;\n    const classNames = value.split(rspace);\n    const numElements = this.length;\n    for (let i = 0; i < numElements; i++) {\n        const el = this[i];\n        // If selected element isn't a tag, move on\n        if (!isTag(el))\n            continue;\n        // If we don't already have classes  always set xmlMode to false here, as it doesn't matter for classes\n        const className = getAttr(el, 'class', false);\n        if (className) {\n            let setClass = ` ${className} `;\n            // Check if class already exists\n            for (const cn of classNames) {\n                const appendClass = `${cn} `;\n                if (!setClass.includes(` ${appendClass}`))\n                    setClass += appendClass;\n            }\n            setAttr(el, 'class', setClass.trim());\n        }\n        else {\n            setAttr(el, 'class', classNames.join(' ').trim());\n        }\n    }\n    return this;\n}\n/**\n * Removes one or more space-separated classes from the selected elements. If no\n * `className` is defined, all classes will be removed. Also accepts a\n * `function`.\n *\n * @category Attributes\n * @example\n *\n * ```js\n * $('.pear').removeClass('pear').prop('outerHTML');\n * //=> <li class=\"\">Pear</li>\n *\n * $('.apple').addClass('red').removeClass().prop('outerHTML');\n * //=> <li class=\"\">Apple</li>\n * ```\n *\n * @param name - Name of the class. If not specified, removes all elements.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/removeClass/}\n */\nexport function removeClass(name) {\n    // Handle if value is a function\n    if (typeof name === 'function') {\n        return domEach(this, (el, i) => {\n            if (isTag(el)) {\n                removeClass.call([el], name.call(el, i, el.attribs['class'] || ''));\n            }\n        });\n    }\n    const classes = splitNames(name);\n    const numClasses = classes.length;\n    const removeAll = arguments.length === 0;\n    return domEach(this, (el) => {\n        if (!isTag(el))\n            return;\n        if (removeAll) {\n            // Short circuit the remove all case as this is the nice one\n            el.attribs['class'] = '';\n        }\n        else {\n            const elClasses = splitNames(el.attribs['class']);\n            let changed = false;\n            for (let j = 0; j < numClasses; j++) {\n                const index = elClasses.indexOf(classes[j]);\n                if (index !== -1) {\n                    elClasses.splice(index, 1);\n                    changed = true;\n                    /*\n                     * We have to do another pass to ensure that there are not duplicate\n                     * classes listed\n                     */\n                    j--;\n                }\n            }\n            if (changed) {\n                el.attribs['class'] = elClasses.join(' ');\n            }\n        }\n    });\n}\n/**\n * Add or remove class(es) from the matched elements, depending on either the\n * class's presence or the value of the switch argument. Also accepts a\n * `function`.\n *\n * @category Attributes\n * @example\n *\n * ```js\n * $('.apple.green').toggleClass('fruit green red').prop('outerHTML');\n * //=> <li class=\"apple fruit red\">Apple</li>\n *\n * $('.apple.green').toggleClass('fruit green red', true).prop('outerHTML');\n * //=> <li class=\"apple green fruit red\">Apple</li>\n * ```\n *\n * @param value - Name of the class. Can also be a function.\n * @param stateVal - If specified the state of the class.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/toggleClass/}\n */\nexport function toggleClass(value, stateVal) {\n    // Support functions\n    if (typeof value === 'function') {\n        return domEach(this, (el, i) => {\n            if (isTag(el)) {\n                toggleClass.call([el], value.call(el, i, el.attribs['class'] || '', stateVal), stateVal);\n            }\n        });\n    }\n    // Return if no value or not a string or function\n    if (!value || typeof value !== 'string')\n        return this;\n    const classNames = value.split(rspace);\n    const numClasses = classNames.length;\n    const state = typeof stateVal === 'boolean' ? (stateVal ? 1 : -1) : 0;\n    const numElements = this.length;\n    for (let i = 0; i < numElements; i++) {\n        const el = this[i];\n        // If selected element isn't a tag, move on\n        if (!isTag(el))\n            continue;\n        const elementClasses = splitNames(el.attribs['class']);\n        // Check if class already exists\n        for (let j = 0; j < numClasses; j++) {\n            // Check if the class name is currently defined\n            const index = elementClasses.indexOf(classNames[j]);\n            // Add if stateValue === true or we are toggling and there is no value\n            if (state >= 0 && index === -1) {\n                elementClasses.push(classNames[j]);\n            }\n            else if (state <= 0 && index !== -1) {\n                // Otherwise remove but only if the item exists\n                elementClasses.splice(index, 1);\n            }\n        }\n        el.attribs['class'] = elementClasses.join(' ');\n    }\n    return this;\n}\n//# sourceMappingURL=attributes.js.map","export var SelectorType;\n(function (SelectorType) {\n    SelectorType[\"Attribute\"] = \"attribute\";\n    SelectorType[\"Pseudo\"] = \"pseudo\";\n    SelectorType[\"PseudoElement\"] = \"pseudo-element\";\n    SelectorType[\"Tag\"] = \"tag\";\n    SelectorType[\"Universal\"] = \"universal\";\n    // Traversals\n    SelectorType[\"Adjacent\"] = \"adjacent\";\n    SelectorType[\"Child\"] = \"child\";\n    SelectorType[\"Descendant\"] = \"descendant\";\n    SelectorType[\"Parent\"] = \"parent\";\n    SelectorType[\"Sibling\"] = \"sibling\";\n    SelectorType[\"ColumnCombinator\"] = \"column-combinator\";\n})(SelectorType || (SelectorType = {}));\n/**\n * Modes for ignore case.\n *\n * This could be updated to an enum, and the object is\n * the current stand-in that will allow code to be updated\n * without big changes.\n */\nexport const IgnoreCaseMode = {\n    Unknown: null,\n    QuirksMode: \"quirks\",\n    IgnoreCase: true,\n    CaseSensitive: false,\n};\nexport var AttributeAction;\n(function (AttributeAction) {\n    AttributeAction[\"Any\"] = \"any\";\n    AttributeAction[\"Element\"] = \"element\";\n    AttributeAction[\"End\"] = \"end\";\n    AttributeAction[\"Equals\"] = \"equals\";\n    AttributeAction[\"Exists\"] = \"exists\";\n    AttributeAction[\"Hyphen\"] = \"hyphen\";\n    AttributeAction[\"Not\"] = \"not\";\n    AttributeAction[\"Start\"] = \"start\";\n})(AttributeAction || (AttributeAction = {}));\n","import { SelectorType, AttributeAction, } from \"./types\";\nconst reName = /^[^\\\\#]?(?:\\\\(?:[\\da-f]{1,6}\\s?|.)|[\\w\\-\\u00b0-\\uFFFF])+/;\nconst reEscape = /\\\\([\\da-f]{1,6}\\s?|(\\s)|.)/gi;\nconst actionTypes = new Map([\n    [126 /* Tilde */, AttributeAction.Element],\n    [94 /* Circumflex */, AttributeAction.Start],\n    [36 /* Dollar */, AttributeAction.End],\n    [42 /* Asterisk */, AttributeAction.Any],\n    [33 /* ExclamationMark */, AttributeAction.Not],\n    [124 /* Pipe */, AttributeAction.Hyphen],\n]);\n// Pseudos, whose data property is parsed as well.\nconst unpackPseudos = new Set([\n    \"has\",\n    \"not\",\n    \"matches\",\n    \"is\",\n    \"where\",\n    \"host\",\n    \"host-context\",\n]);\n/**\n * Checks whether a specific selector is a traversal.\n * This is useful eg. in swapping the order of elements that\n * are not traversals.\n *\n * @param selector Selector to check.\n */\nexport function isTraversal(selector) {\n    switch (selector.type) {\n        case SelectorType.Adjacent:\n        case SelectorType.Child:\n        case SelectorType.Descendant:\n        case SelectorType.Parent:\n        case SelectorType.Sibling:\n        case SelectorType.ColumnCombinator:\n            return true;\n        default:\n            return false;\n    }\n}\nconst stripQuotesFromPseudos = new Set([\"contains\", \"icontains\"]);\n// Unescape function taken from https://github.com/jquery/sizzle/blob/master/src/sizzle.js#L152\nfunction funescape(_, escaped, escapedWhitespace) {\n    const high = parseInt(escaped, 16) - 0x10000;\n    // NaN means non-codepoint\n    return high !== high || escapedWhitespace\n        ? escaped\n        : high < 0\n            ? // BMP codepoint\n                String.fromCharCode(high + 0x10000)\n            : // Supplemental Plane codepoint (surrogate pair)\n                String.fromCharCode((high >> 10) | 0xd800, (high & 0x3ff) | 0xdc00);\n}\nfunction unescapeCSS(str) {\n    return str.replace(reEscape, funescape);\n}\nfunction isQuote(c) {\n    return c === 39 /* SingleQuote */ || c === 34 /* DoubleQuote */;\n}\nfunction isWhitespace(c) {\n    return (c === 32 /* Space */ ||\n        c === 9 /* Tab */ ||\n        c === 10 /* NewLine */ ||\n        c === 12 /* FormFeed */ ||\n        c === 13 /* CarriageReturn */);\n}\n/**\n * Parses `selector`, optionally with the passed `options`.\n *\n * @param selector Selector to parse.\n * @param options Options for parsing.\n * @returns Returns a two-dimensional array.\n * The first dimension represents selectors separated by commas (eg. `sub1, sub2`),\n * the second contains the relevant tokens for that selector.\n */\nexport function parse(selector) {\n    const subselects = [];\n    const endIndex = parseSelector(subselects, `${selector}`, 0);\n    if (endIndex < selector.length) {\n        throw new Error(`Unmatched selector: ${selector.slice(endIndex)}`);\n    }\n    return subselects;\n}\nfunction parseSelector(subselects, selector, selectorIndex) {\n    let tokens = [];\n    function getName(offset) {\n        const match = selector.slice(selectorIndex + offset).match(reName);\n        if (!match) {\n            throw new Error(`Expected name, found ${selector.slice(selectorIndex)}`);\n        }\n        const [name] = match;\n        selectorIndex += offset + name.length;\n        return unescapeCSS(name);\n    }\n    function stripWhitespace(offset) {\n        selectorIndex += offset;\n        while (selectorIndex < selector.length &&\n            isWhitespace(selector.charCodeAt(selectorIndex))) {\n            selectorIndex++;\n        }\n    }\n    function readValueWithParenthesis() {\n        selectorIndex += 1;\n        const start = selectorIndex;\n        let counter = 1;\n        for (; counter > 0 && selectorIndex < selector.length; selectorIndex++) {\n            if (selector.charCodeAt(selectorIndex) ===\n                40 /* LeftParenthesis */ &&\n                !isEscaped(selectorIndex)) {\n                counter++;\n            }\n            else if (selector.charCodeAt(selectorIndex) ===\n                41 /* RightParenthesis */ &&\n                !isEscaped(selectorIndex)) {\n                counter--;\n            }\n        }\n        if (counter) {\n            throw new Error(\"Parenthesis not matched\");\n        }\n        return unescapeCSS(selector.slice(start, selectorIndex - 1));\n    }\n    function isEscaped(pos) {\n        let slashCount = 0;\n        while (selector.charCodeAt(--pos) === 92 /* BackSlash */)\n            slashCount++;\n        return (slashCount & 1) === 1;\n    }\n    function ensureNotTraversal() {\n        if (tokens.length > 0 && isTraversal(tokens[tokens.length - 1])) {\n            throw new Error(\"Did not expect successive traversals.\");\n        }\n    }\n    function addTraversal(type) {\n        if (tokens.length > 0 &&\n            tokens[tokens.length - 1].type === SelectorType.Descendant) {\n            tokens[tokens.length - 1].type = type;\n            return;\n        }\n        ensureNotTraversal();\n        tokens.push({ type });\n    }\n    function addSpecialAttribute(name, action) {\n        tokens.push({\n            type: SelectorType.Attribute,\n            name,\n            action,\n            value: getName(1),\n            namespace: null,\n            ignoreCase: \"quirks\",\n        });\n    }\n    /**\n     * We have finished parsing the current part of the selector.\n     *\n     * Remove descendant tokens at the end if they exist,\n     * and return the last index, so that parsing can be\n     * picked up from here.\n     */\n    function finalizeSubselector() {\n        if (tokens.length &&\n            tokens[tokens.length - 1].type === SelectorType.Descendant) {\n            tokens.pop();\n        }\n        if (tokens.length === 0) {\n            throw new Error(\"Empty sub-selector\");\n        }\n        subselects.push(tokens);\n    }\n    stripWhitespace(0);\n    if (selector.length === selectorIndex) {\n        return selectorIndex;\n    }\n    loop: while (selectorIndex < selector.length) {\n        const firstChar = selector.charCodeAt(selectorIndex);\n        switch (firstChar) {\n            // Whitespace\n            case 32 /* Space */:\n            case 9 /* Tab */:\n            case 10 /* NewLine */:\n            case 12 /* FormFeed */:\n            case 13 /* CarriageReturn */: {\n                if (tokens.length === 0 ||\n                    tokens[0].type !== SelectorType.Descendant) {\n                    ensureNotTraversal();\n                    tokens.push({ type: SelectorType.Descendant });\n                }\n                stripWhitespace(1);\n                break;\n            }\n            // Traversals\n            case 62 /* GreaterThan */: {\n                addTraversal(SelectorType.Child);\n                stripWhitespace(1);\n                break;\n            }\n            case 60 /* LessThan */: {\n                addTraversal(SelectorType.Parent);\n                stripWhitespace(1);\n                break;\n            }\n            case 126 /* Tilde */: {\n                addTraversal(SelectorType.Sibling);\n                stripWhitespace(1);\n                break;\n            }\n            case 43 /* Plus */: {\n                addTraversal(SelectorType.Adjacent);\n                stripWhitespace(1);\n                break;\n            }\n            // Special attribute selectors: .class, #id\n            case 46 /* Period */: {\n                addSpecialAttribute(\"class\", AttributeAction.Element);\n                break;\n            }\n            case 35 /* Hash */: {\n                addSpecialAttribute(\"id\", AttributeAction.Equals);\n                break;\n            }\n            case 91 /* LeftSquareBracket */: {\n                stripWhitespace(1);\n                // Determine attribute name and namespace\n                let name;\n                let namespace = null;\n                if (selector.charCodeAt(selectorIndex) === 124 /* Pipe */) {\n                    // Equivalent to no namespace\n                    name = getName(1);\n                }\n                else if (selector.startsWith(\"*|\", selectorIndex)) {\n                    namespace = \"*\";\n                    name = getName(2);\n                }\n                else {\n                    name = getName(0);\n                    if (selector.charCodeAt(selectorIndex) === 124 /* Pipe */ &&\n                        selector.charCodeAt(selectorIndex + 1) !==\n                            61 /* Equal */) {\n                        namespace = name;\n                        name = getName(1);\n                    }\n                }\n                stripWhitespace(0);\n                // Determine comparison operation\n                let action = AttributeAction.Exists;\n                const possibleAction = actionTypes.get(selector.charCodeAt(selectorIndex));\n                if (possibleAction) {\n                    action = possibleAction;\n                    if (selector.charCodeAt(selectorIndex + 1) !==\n                        61 /* Equal */) {\n                        throw new Error(\"Expected `=`\");\n                    }\n                    stripWhitespace(2);\n                }\n                else if (selector.charCodeAt(selectorIndex) === 61 /* Equal */) {\n                    action = AttributeAction.Equals;\n                    stripWhitespace(1);\n                }\n                // Determine value\n                let value = \"\";\n                let ignoreCase = null;\n                if (action !== \"exists\") {\n                    if (isQuote(selector.charCodeAt(selectorIndex))) {\n                        const quote = selector.charCodeAt(selectorIndex);\n                        let sectionEnd = selectorIndex + 1;\n                        while (sectionEnd < selector.length &&\n                            (selector.charCodeAt(sectionEnd) !== quote ||\n                                isEscaped(sectionEnd))) {\n                            sectionEnd += 1;\n                        }\n                        if (selector.charCodeAt(sectionEnd) !== quote) {\n                            throw new Error(\"Attribute value didn't end\");\n                        }\n                        value = unescapeCSS(selector.slice(selectorIndex + 1, sectionEnd));\n                        selectorIndex = sectionEnd + 1;\n                    }\n                    else {\n                        const valueStart = selectorIndex;\n                        while (selectorIndex < selector.length &&\n                            ((!isWhitespace(selector.charCodeAt(selectorIndex)) &&\n                                selector.charCodeAt(selectorIndex) !==\n                                    93 /* RightSquareBracket */) ||\n                                isEscaped(selectorIndex))) {\n                            selectorIndex += 1;\n                        }\n                        value = unescapeCSS(selector.slice(valueStart, selectorIndex));\n                    }\n                    stripWhitespace(0);\n                    // See if we have a force ignore flag\n                    const forceIgnore = selector.charCodeAt(selectorIndex) | 0x20;\n                    // If the forceIgnore flag is set (either `i` or `s`), use that value\n                    if (forceIgnore === 115 /* LowerS */) {\n                        ignoreCase = false;\n                        stripWhitespace(1);\n                    }\n                    else if (forceIgnore === 105 /* LowerI */) {\n                        ignoreCase = true;\n                        stripWhitespace(1);\n                    }\n                }\n                if (selector.charCodeAt(selectorIndex) !==\n                    93 /* RightSquareBracket */) {\n                    throw new Error(\"Attribute selector didn't terminate\");\n                }\n                selectorIndex += 1;\n                const attributeSelector = {\n                    type: SelectorType.Attribute,\n                    name,\n                    action,\n                    value,\n                    namespace,\n                    ignoreCase,\n                };\n                tokens.push(attributeSelector);\n                break;\n            }\n            case 58 /* Colon */: {\n                if (selector.charCodeAt(selectorIndex + 1) === 58 /* Colon */) {\n                    tokens.push({\n                        type: SelectorType.PseudoElement,\n                        name: getName(2).toLowerCase(),\n                        data: selector.charCodeAt(selectorIndex) ===\n                            40 /* LeftParenthesis */\n                            ? readValueWithParenthesis()\n                            : null,\n                    });\n                    continue;\n                }\n                const name = getName(1).toLowerCase();\n                let data = null;\n                if (selector.charCodeAt(selectorIndex) ===\n                    40 /* LeftParenthesis */) {\n                    if (unpackPseudos.has(name)) {\n                        if (isQuote(selector.charCodeAt(selectorIndex + 1))) {\n                            throw new Error(`Pseudo-selector ${name} cannot be quoted`);\n                        }\n                        data = [];\n                        selectorIndex = parseSelector(data, selector, selectorIndex + 1);\n                        if (selector.charCodeAt(selectorIndex) !==\n                            41 /* RightParenthesis */) {\n                            throw new Error(`Missing closing parenthesis in :${name} (${selector})`);\n                        }\n                        selectorIndex += 1;\n                    }\n                    else {\n                        data = readValueWithParenthesis();\n                        if (stripQuotesFromPseudos.has(name)) {\n                            const quot = data.charCodeAt(0);\n                            if (quot === data.charCodeAt(data.length - 1) &&\n                                isQuote(quot)) {\n                                data = data.slice(1, -1);\n                            }\n                        }\n                        data = unescapeCSS(data);\n                    }\n                }\n                tokens.push({ type: SelectorType.Pseudo, name, data });\n                break;\n            }\n            case 44 /* Comma */: {\n                finalizeSubselector();\n                tokens = [];\n                stripWhitespace(1);\n                break;\n            }\n            default: {\n                if (selector.startsWith(\"/*\", selectorIndex)) {\n                    const endIndex = selector.indexOf(\"*/\", selectorIndex + 2);\n                    if (endIndex < 0) {\n                        throw new Error(\"Comment was not terminated\");\n                    }\n                    selectorIndex = endIndex + 2;\n                    // Remove leading whitespace\n                    if (tokens.length === 0) {\n                        stripWhitespace(0);\n                    }\n                    break;\n                }\n                let namespace = null;\n                let name;\n                if (firstChar === 42 /* Asterisk */) {\n                    selectorIndex += 1;\n                    name = \"*\";\n                }\n                else if (firstChar === 124 /* Pipe */) {\n                    name = \"\";\n                    if (selector.charCodeAt(selectorIndex + 1) === 124 /* Pipe */) {\n                        addTraversal(SelectorType.ColumnCombinator);\n                        stripWhitespace(2);\n                        break;\n                    }\n                }\n                else if (reName.test(selector.slice(selectorIndex))) {\n                    name = getName(0);\n                }\n                else {\n                    break loop;\n                }\n                if (selector.charCodeAt(selectorIndex) === 124 /* Pipe */ &&\n                    selector.charCodeAt(selectorIndex + 1) !== 124 /* Pipe */) {\n                    namespace = name;\n                    if (selector.charCodeAt(selectorIndex + 1) ===\n                        42 /* Asterisk */) {\n                        name = \"*\";\n                        selectorIndex += 2;\n                    }\n                    else {\n                        name = getName(1);\n                    }\n                }\n                tokens.push(name === \"*\"\n                    ? { type: SelectorType.Universal, namespace }\n                    : { type: SelectorType.Tag, name, namespace });\n            }\n        }\n    }\n    finalizeSubselector();\n    return selectorIndex;\n}\n","module.exports = {\n\ttrueFunc: function trueFunc(){\n\t\treturn true;\n\t},\n\tfalseFunc: function falseFunc(){\n\t\treturn false;\n\t}\n};","import { AttributeAction, SelectorType } from \"css-what\";\nconst procedure = new Map([\n    [SelectorType.Universal, 50],\n    [SelectorType.Tag, 30],\n    [SelectorType.Attribute, 1],\n    [SelectorType.Pseudo, 0],\n]);\nexport function isTraversal(token) {\n    return !procedure.has(token.type);\n}\nconst attributes = new Map([\n    [AttributeAction.Exists, 10],\n    [AttributeAction.Equals, 8],\n    [AttributeAction.Not, 7],\n    [AttributeAction.Start, 6],\n    [AttributeAction.End, 6],\n    [AttributeAction.Any, 5],\n]);\n/**\n * Sort the parts of the passed selector,\n * as there is potential for optimization\n * (some types of selectors are faster than others)\n *\n * @param arr Selector to sort\n */\nexport default function sortByProcedure(arr) {\n    const procs = arr.map(getProcedure);\n    for (let i = 1; i < arr.length; i++) {\n        const procNew = procs[i];\n        if (procNew < 0)\n            continue;\n        for (let j = i - 1; j >= 0 && procNew < procs[j]; j--) {\n            const token = arr[j + 1];\n            arr[j + 1] = arr[j];\n            arr[j] = token;\n            procs[j + 1] = procs[j];\n            procs[j] = procNew;\n        }\n    }\n}\nfunction getProcedure(token) {\n    var _a, _b;\n    let proc = (_a = procedure.get(token.type)) !== null && _a !== void 0 ? _a : -1;\n    if (token.type === SelectorType.Attribute) {\n        proc = (_b = attributes.get(token.action)) !== null && _b !== void 0 ? _b : 4;\n        if (token.action === AttributeAction.Equals && token.name === \"id\") {\n            // Prefer ID selectors (eg. #ID)\n            proc = 9;\n        }\n        if (token.ignoreCase) {\n            /*\n             * IgnoreCase adds some overhead, prefer \"normal\" token\n             * this is a binary operation, to ensure it's still an int\n             */\n            proc >>= 1;\n        }\n    }\n    else if (token.type === SelectorType.Pseudo) {\n        if (!token.data) {\n            proc = 3;\n        }\n        else if (token.name === \"has\" || token.name === \"contains\") {\n            proc = 0; // Expensive in any case\n        }\n        else if (Array.isArray(token.data)) {\n            // Eg. :matches, :not\n            proc = Math.min(...token.data.map((d) => Math.min(...d.map(getProcedure))));\n            // If we have traversals, try to avoid executing this selector\n            if (proc < 0) {\n                proc = 0;\n            }\n        }\n        else {\n            proc = 2;\n        }\n    }\n    return proc;\n}\n//# sourceMappingURL=sort.js.map","import boolbase from \"boolbase\";\n/**\n * All reserved characters in a regex, used for escaping.\n *\n * Taken from XRegExp, (c) 2007-2020 Steven Levithan under the MIT license\n * https://github.com/slevithan/xregexp/blob/95eeebeb8fac8754d54eafe2b4743661ac1cf028/src/xregexp.js#L794\n */\nconst reChars = /[-[\\]{}()*+?.,\\\\^$|#\\s]/g;\nfunction escapeRegex(value) {\n    return value.replace(reChars, \"\\\\$&\");\n}\n/**\n * Attributes that are case-insensitive in HTML.\n *\n * @private\n * @see https://html.spec.whatwg.org/multipage/semantics-other.html#case-sensitivity-of-selectors\n */\nconst caseInsensitiveAttributes = new Set([\n    \"accept\",\n    \"accept-charset\",\n    \"align\",\n    \"alink\",\n    \"axis\",\n    \"bgcolor\",\n    \"charset\",\n    \"checked\",\n    \"clear\",\n    \"codetype\",\n    \"color\",\n    \"compact\",\n    \"declare\",\n    \"defer\",\n    \"dir\",\n    \"direction\",\n    \"disabled\",\n    \"enctype\",\n    \"face\",\n    \"frame\",\n    \"hreflang\",\n    \"http-equiv\",\n    \"lang\",\n    \"language\",\n    \"link\",\n    \"media\",\n    \"method\",\n    \"multiple\",\n    \"nohref\",\n    \"noresize\",\n    \"noshade\",\n    \"nowrap\",\n    \"readonly\",\n    \"rel\",\n    \"rev\",\n    \"rules\",\n    \"scope\",\n    \"scrolling\",\n    \"selected\",\n    \"shape\",\n    \"target\",\n    \"text\",\n    \"type\",\n    \"valign\",\n    \"valuetype\",\n    \"vlink\",\n]);\nfunction shouldIgnoreCase(selector, options) {\n    return typeof selector.ignoreCase === \"boolean\"\n        ? selector.ignoreCase\n        : selector.ignoreCase === \"quirks\"\n            ? !!options.quirksMode\n            : !options.xmlMode && caseInsensitiveAttributes.has(selector.name);\n}\n/**\n * Attribute selectors\n */\nexport const attributeRules = {\n    equals(next, data, options) {\n        const { adapter } = options;\n        const { name } = data;\n        let { value } = data;\n        if (shouldIgnoreCase(data, options)) {\n            value = value.toLowerCase();\n            return (elem) => {\n                const attr = adapter.getAttributeValue(elem, name);\n                return (attr != null &&\n                    attr.length === value.length &&\n                    attr.toLowerCase() === value &&\n                    next(elem));\n            };\n        }\n        return (elem) => adapter.getAttributeValue(elem, name) === value && next(elem);\n    },\n    hyphen(next, data, options) {\n        const { adapter } = options;\n        const { name } = data;\n        let { value } = data;\n        const len = value.length;\n        if (shouldIgnoreCase(data, options)) {\n            value = value.toLowerCase();\n            return function hyphenIC(elem) {\n                const attr = adapter.getAttributeValue(elem, name);\n                return (attr != null &&\n                    (attr.length === len || attr.charAt(len) === \"-\") &&\n                    attr.substr(0, len).toLowerCase() === value &&\n                    next(elem));\n            };\n        }\n        return function hyphen(elem) {\n            const attr = adapter.getAttributeValue(elem, name);\n            return (attr != null &&\n                (attr.length === len || attr.charAt(len) === \"-\") &&\n                attr.substr(0, len) === value &&\n                next(elem));\n        };\n    },\n    element(next, data, options) {\n        const { adapter } = options;\n        const { name, value } = data;\n        if (/\\s/.test(value)) {\n            return boolbase.falseFunc;\n        }\n        const regex = new RegExp(`(?:^|\\\\s)${escapeRegex(value)}(?:$|\\\\s)`, shouldIgnoreCase(data, options) ? \"i\" : \"\");\n        return function element(elem) {\n            const attr = adapter.getAttributeValue(elem, name);\n            return (attr != null &&\n                attr.length >= value.length &&\n                regex.test(attr) &&\n                next(elem));\n        };\n    },\n    exists(next, { name }, { adapter }) {\n        return (elem) => adapter.hasAttrib(elem, name) && next(elem);\n    },\n    start(next, data, options) {\n        const { adapter } = options;\n        const { name } = data;\n        let { value } = data;\n        const len = value.length;\n        if (len === 0) {\n            return boolbase.falseFunc;\n        }\n        if (shouldIgnoreCase(data, options)) {\n            value = value.toLowerCase();\n            return (elem) => {\n                const attr = adapter.getAttributeValue(elem, name);\n                return (attr != null &&\n                    attr.length >= len &&\n                    attr.substr(0, len).toLowerCase() === value &&\n                    next(elem));\n            };\n        }\n        return (elem) => {\n            var _a;\n            return !!((_a = adapter.getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.startsWith(value)) &&\n                next(elem);\n        };\n    },\n    end(next, data, options) {\n        const { adapter } = options;\n        const { name } = data;\n        let { value } = data;\n        const len = -value.length;\n        if (len === 0) {\n            return boolbase.falseFunc;\n        }\n        if (shouldIgnoreCase(data, options)) {\n            value = value.toLowerCase();\n            return (elem) => {\n                var _a;\n                return ((_a = adapter\n                    .getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.substr(len).toLowerCase()) === value && next(elem);\n            };\n        }\n        return (elem) => {\n            var _a;\n            return !!((_a = adapter.getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.endsWith(value)) &&\n                next(elem);\n        };\n    },\n    any(next, data, options) {\n        const { adapter } = options;\n        const { name, value } = data;\n        if (value === \"\") {\n            return boolbase.falseFunc;\n        }\n        if (shouldIgnoreCase(data, options)) {\n            const regex = new RegExp(escapeRegex(value), \"i\");\n            return function anyIC(elem) {\n                const attr = adapter.getAttributeValue(elem, name);\n                return (attr != null &&\n                    attr.length >= value.length &&\n                    regex.test(attr) &&\n                    next(elem));\n            };\n        }\n        return (elem) => {\n            var _a;\n            return !!((_a = adapter.getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.includes(value)) &&\n                next(elem);\n        };\n    },\n    not(next, data, options) {\n        const { adapter } = options;\n        const { name } = data;\n        let { value } = data;\n        if (value === \"\") {\n            return (elem) => !!adapter.getAttributeValue(elem, name) && next(elem);\n        }\n        else if (shouldIgnoreCase(data, options)) {\n            value = value.toLowerCase();\n            return (elem) => {\n                const attr = adapter.getAttributeValue(elem, name);\n                return ((attr == null ||\n                    attr.length !== value.length ||\n                    attr.toLowerCase() !== value) &&\n                    next(elem));\n            };\n        }\n        return (elem) => adapter.getAttributeValue(elem, name) !== value && next(elem);\n    },\n};\n//# sourceMappingURL=attributes.js.map","// Following http://www.w3.org/TR/css3-selectors/#nth-child-pseudo\n// Whitespace as per https://www.w3.org/TR/selectors-3/#lex is \" \\t\\r\\n\\f\"\nconst whitespace = new Set([9, 10, 12, 13, 32]);\nconst ZERO = \"0\".charCodeAt(0);\nconst NINE = \"9\".charCodeAt(0);\n/**\n * Parses an expression.\n *\n * @throws An `Error` if parsing fails.\n * @returns An array containing the integer step size and the integer offset of the nth rule.\n * @example nthCheck.parse(\"2n+3\"); // returns [2, 3]\n */\nexport function parse(formula) {\n    formula = formula.trim().toLowerCase();\n    if (formula === \"even\") {\n        return [2, 0];\n    }\n    else if (formula === \"odd\") {\n        return [2, 1];\n    }\n    // Parse [ ['-'|'+']? INTEGER? {N} [ S* ['-'|'+'] S* INTEGER ]?\n    let idx = 0;\n    let a = 0;\n    let sign = readSign();\n    let number = readNumber();\n    if (idx < formula.length && formula.charAt(idx) === \"n\") {\n        idx++;\n        a = sign * (number !== null && number !== void 0 ? number : 1);\n        skipWhitespace();\n        if (idx < formula.length) {\n            sign = readSign();\n            skipWhitespace();\n            number = readNumber();\n        }\n        else {\n            sign = number = 0;\n        }\n    }\n    // Throw if there is anything else\n    if (number === null || idx < formula.length) {\n        throw new Error(`n-th rule couldn't be parsed ('${formula}')`);\n    }\n    return [a, sign * number];\n    function readSign() {\n        if (formula.charAt(idx) === \"-\") {\n            idx++;\n            return -1;\n        }\n        if (formula.charAt(idx) === \"+\") {\n            idx++;\n        }\n        return 1;\n    }\n    function readNumber() {\n        const start = idx;\n        let value = 0;\n        while (idx < formula.length &&\n            formula.charCodeAt(idx) >= ZERO &&\n            formula.charCodeAt(idx) <= NINE) {\n            value = value * 10 + (formula.charCodeAt(idx) - ZERO);\n            idx++;\n        }\n        // Return `null` if we didn't read anything.\n        return idx === start ? null : value;\n    }\n    function skipWhitespace() {\n        while (idx < formula.length &&\n            whitespace.has(formula.charCodeAt(idx))) {\n            idx++;\n        }\n    }\n}\n//# sourceMappingURL=parse.js.map","import boolbase from \"boolbase\";\n/**\n * Returns a function that checks if an elements index matches the given rule\n * highly optimized to return the fastest solution.\n *\n * @param parsed A tuple [a, b], as returned by `parse`.\n * @returns A highly optimized function that returns whether an index matches the nth-check.\n * @example\n *\n * ```js\n * const check = nthCheck.compile([2, 3]);\n *\n * check(0); // `false`\n * check(1); // `false`\n * check(2); // `true`\n * check(3); // `false`\n * check(4); // `true`\n * check(5); // `false`\n * check(6); // `true`\n * ```\n */\nexport function compile(parsed) {\n    const a = parsed[0];\n    // Subtract 1 from `b`, to convert from one- to zero-indexed.\n    const b = parsed[1] - 1;\n    /*\n     * When `b <= 0`, `a * n` won't be lead to any matches for `a < 0`.\n     * Besides, the specification states that no elements are\n     * matched when `a` and `b` are 0.\n     *\n     * `b < 0` here as we subtracted 1 from `b` above.\n     */\n    if (b < 0 && a <= 0)\n        return boolbase.falseFunc;\n    // When `a` is in the range -1..1, it matches any element (so only `b` is checked).\n    if (a === -1)\n        return (index) => index <= b;\n    if (a === 0)\n        return (index) => index === b;\n    // When `b <= 0` and `a === 1`, they match any element.\n    if (a === 1)\n        return b < 0 ? boolbase.trueFunc : (index) => index >= b;\n    /*\n     * Otherwise, modulo can be used to check if there is a match.\n     *\n     * Modulo doesn't care about the sign, so let's use `a`s absolute value.\n     */\n    const absA = Math.abs(a);\n    // Get `b mod a`, + a if this is negative.\n    const bMod = ((b % absA) + absA) % absA;\n    return a > 1\n        ? (index) => index >= b && index % absA === bMod\n        : (index) => index <= b && index % absA === bMod;\n}\n/**\n * Returns a function that produces a monotonously increasing sequence of indices.\n *\n * If the sequence has an end, the returned function will return `null` after\n * the last index in the sequence.\n *\n * @param parsed A tuple [a, b], as returned by `parse`.\n * @returns A function that produces a sequence of indices.\n * @example <caption>Always increasing (2n+3)</caption>\n *\n * ```js\n * const gen = nthCheck.generate([2, 3])\n *\n * gen() // `1`\n * gen() // `3`\n * gen() // `5`\n * gen() // `8`\n * gen() // `11`\n * ```\n *\n * @example <caption>With end value (-2n+10)</caption>\n *\n * ```js\n *\n * const gen = nthCheck.generate([-2, 5]);\n *\n * gen() // 0\n * gen() // 2\n * gen() // 4\n * gen() // null\n * ```\n */\nexport function generate(parsed) {\n    const a = parsed[0];\n    // Subtract 1 from `b`, to convert from one- to zero-indexed.\n    let b = parsed[1] - 1;\n    let n = 0;\n    // Make sure to always return an increasing sequence\n    if (a < 0) {\n        const aPos = -a;\n        // Get `b mod a`\n        const minValue = ((b % aPos) + aPos) % aPos;\n        return () => {\n            const val = minValue + aPos * n++;\n            return val > b ? null : val;\n        };\n    }\n    if (a === 0)\n        return b < 0\n            ? // There are no result  always return `null`\n                () => null\n            : // Return `b` exactly once\n                () => (n++ === 0 ? b : null);\n    if (b < 0) {\n        b += a * Math.ceil(-b / a);\n    }\n    return () => a * n++ + b;\n}\n//# sourceMappingURL=compile.js.map","import { parse } from \"./parse.js\";\nimport { compile, generate } from \"./compile.js\";\nexport { parse, compile, generate };\n/**\n * Parses and compiles a formula to a highly optimized function.\n * Combination of {@link parse} and {@link compile}.\n *\n * If the formula doesn't match any elements,\n * it returns [`boolbase`](https://github.com/fb55/boolbase)'s `falseFunc`.\n * Otherwise, a function accepting an _index_ is returned, which returns\n * whether or not the passed _index_ matches the formula.\n *\n * Note: The nth-rule starts counting at `1`, the returned function at `0`.\n *\n * @param formula The formula to compile.\n * @example\n * const check = nthCheck(\"2n+3\");\n *\n * check(0); // `false`\n * check(1); // `false`\n * check(2); // `true`\n * check(3); // `false`\n * check(4); // `true`\n * check(5); // `false`\n * check(6); // `true`\n */\nexport default function nthCheck(formula) {\n    return compile(parse(formula));\n}\n/**\n * Parses and compiles a formula to a generator that produces a sequence of indices.\n * Combination of {@link parse} and {@link generate}.\n *\n * @param formula The formula to compile.\n * @returns A function that produces a sequence of indices.\n * @example <caption>Always increasing</caption>\n *\n * ```js\n * const gen = nthCheck.sequence('2n+3')\n *\n * gen() // `1`\n * gen() // `3`\n * gen() // `5`\n * gen() // `8`\n * gen() // `11`\n * ```\n *\n * @example <caption>With end value</caption>\n *\n * ```js\n *\n * const gen = nthCheck.sequence('-2n+5');\n *\n * gen() // 0\n * gen() // 2\n * gen() // 4\n * gen() // null\n * ```\n */\nexport function sequence(formula) {\n    return generate(parse(formula));\n}\n//# sourceMappingURL=index.js.map","import getNCheck from \"nth-check\";\nimport boolbase from \"boolbase\";\nfunction getChildFunc(next, adapter) {\n    return (elem) => {\n        const parent = adapter.getParent(elem);\n        return parent != null && adapter.isTag(parent) && next(elem);\n    };\n}\nexport const filters = {\n    contains(next, text, { adapter }) {\n        return function contains(elem) {\n            return next(elem) && adapter.getText(elem).includes(text);\n        };\n    },\n    icontains(next, text, { adapter }) {\n        const itext = text.toLowerCase();\n        return function icontains(elem) {\n            return (next(elem) &&\n                adapter.getText(elem).toLowerCase().includes(itext));\n        };\n    },\n    // Location specific methods\n    \"nth-child\"(next, rule, { adapter, equals }) {\n        const func = getNCheck(rule);\n        if (func === boolbase.falseFunc)\n            return boolbase.falseFunc;\n        if (func === boolbase.trueFunc)\n            return getChildFunc(next, adapter);\n        return function nthChild(elem) {\n            const siblings = adapter.getSiblings(elem);\n            let pos = 0;\n            for (let i = 0; i < siblings.length; i++) {\n                if (equals(elem, siblings[i]))\n                    break;\n                if (adapter.isTag(siblings[i])) {\n                    pos++;\n                }\n            }\n            return func(pos) && next(elem);\n        };\n    },\n    \"nth-last-child\"(next, rule, { adapter, equals }) {\n        const func = getNCheck(rule);\n        if (func === boolbase.falseFunc)\n            return boolbase.falseFunc;\n        if (func === boolbase.trueFunc)\n            return getChildFunc(next, adapter);\n        return function nthLastChild(elem) {\n            const siblings = adapter.getSiblings(elem);\n            let pos = 0;\n            for (let i = siblings.length - 1; i >= 0; i--) {\n                if (equals(elem, siblings[i]))\n                    break;\n                if (adapter.isTag(siblings[i])) {\n                    pos++;\n                }\n            }\n            return func(pos) && next(elem);\n        };\n    },\n    \"nth-of-type\"(next, rule, { adapter, equals }) {\n        const func = getNCheck(rule);\n        if (func === boolbase.falseFunc)\n            return boolbase.falseFunc;\n        if (func === boolbase.trueFunc)\n            return getChildFunc(next, adapter);\n        return function nthOfType(elem) {\n            const siblings = adapter.getSiblings(elem);\n            let pos = 0;\n            for (let i = 0; i < siblings.length; i++) {\n                const currentSibling = siblings[i];\n                if (equals(elem, currentSibling))\n                    break;\n                if (adapter.isTag(currentSibling) &&\n                    adapter.getName(currentSibling) === adapter.getName(elem)) {\n                    pos++;\n                }\n            }\n            return func(pos) && next(elem);\n        };\n    },\n    \"nth-last-of-type\"(next, rule, { adapter, equals }) {\n        const func = getNCheck(rule);\n        if (func === boolbase.falseFunc)\n            return boolbase.falseFunc;\n        if (func === boolbase.trueFunc)\n            return getChildFunc(next, adapter);\n        return function nthLastOfType(elem) {\n            const siblings = adapter.getSiblings(elem);\n            let pos = 0;\n            for (let i = siblings.length - 1; i >= 0; i--) {\n                const currentSibling = siblings[i];\n                if (equals(elem, currentSibling))\n                    break;\n                if (adapter.isTag(currentSibling) &&\n                    adapter.getName(currentSibling) === adapter.getName(elem)) {\n                    pos++;\n                }\n            }\n            return func(pos) && next(elem);\n        };\n    },\n    // TODO determine the actual root element\n    root(next, _rule, { adapter }) {\n        return (elem) => {\n            const parent = adapter.getParent(elem);\n            return (parent == null || !adapter.isTag(parent)) && next(elem);\n        };\n    },\n    scope(next, rule, options, context) {\n        const { equals } = options;\n        if (!context || context.length === 0) {\n            // Equivalent to :root\n            return filters[\"root\"](next, rule, options);\n        }\n        if (context.length === 1) {\n            // NOTE: can't be unpacked, as :has uses this for side-effects\n            return (elem) => equals(context[0], elem) && next(elem);\n        }\n        return (elem) => context.includes(elem) && next(elem);\n    },\n    hover: dynamicStatePseudo(\"isHovered\"),\n    visited: dynamicStatePseudo(\"isVisited\"),\n    active: dynamicStatePseudo(\"isActive\"),\n};\n/**\n * Dynamic state pseudos. These depend on optional Adapter methods.\n *\n * @param name The name of the adapter method to call.\n * @returns Pseudo for the `filters` object.\n */\nfunction dynamicStatePseudo(name) {\n    return function dynamicPseudo(next, _rule, { adapter }) {\n        const func = adapter[name];\n        if (typeof func !== \"function\") {\n            return boolbase.falseFunc;\n        }\n        return function active(elem) {\n            return func(elem) && next(elem);\n        };\n    };\n}\n//# sourceMappingURL=filters.js.map","// While filters are precompiled, pseudos get called when they are needed\nexport const pseudos = {\n    empty(elem, { adapter }) {\n        return !adapter.getChildren(elem).some((elem) => \n        // FIXME: `getText` call is potentially expensive.\n        adapter.isTag(elem) || adapter.getText(elem) !== \"\");\n    },\n    \"first-child\"(elem, { adapter, equals }) {\n        if (adapter.prevElementSibling) {\n            return adapter.prevElementSibling(elem) == null;\n        }\n        const firstChild = adapter\n            .getSiblings(elem)\n            .find((elem) => adapter.isTag(elem));\n        return firstChild != null && equals(elem, firstChild);\n    },\n    \"last-child\"(elem, { adapter, equals }) {\n        const siblings = adapter.getSiblings(elem);\n        for (let i = siblings.length - 1; i >= 0; i--) {\n            if (equals(elem, siblings[i]))\n                return true;\n            if (adapter.isTag(siblings[i]))\n                break;\n        }\n        return false;\n    },\n    \"first-of-type\"(elem, { adapter, equals }) {\n        const siblings = adapter.getSiblings(elem);\n        const elemName = adapter.getName(elem);\n        for (let i = 0; i < siblings.length; i++) {\n            const currentSibling = siblings[i];\n            if (equals(elem, currentSibling))\n                return true;\n            if (adapter.isTag(currentSibling) &&\n                adapter.getName(currentSibling) === elemName) {\n                break;\n            }\n        }\n        return false;\n    },\n    \"last-of-type\"(elem, { adapter, equals }) {\n        const siblings = adapter.getSiblings(elem);\n        const elemName = adapter.getName(elem);\n        for (let i = siblings.length - 1; i >= 0; i--) {\n            const currentSibling = siblings[i];\n            if (equals(elem, currentSibling))\n                return true;\n            if (adapter.isTag(currentSibling) &&\n                adapter.getName(currentSibling) === elemName) {\n                break;\n            }\n        }\n        return false;\n    },\n    \"only-of-type\"(elem, { adapter, equals }) {\n        const elemName = adapter.getName(elem);\n        return adapter\n            .getSiblings(elem)\n            .every((sibling) => equals(elem, sibling) ||\n            !adapter.isTag(sibling) ||\n            adapter.getName(sibling) !== elemName);\n    },\n    \"only-child\"(elem, { adapter, equals }) {\n        return adapter\n            .getSiblings(elem)\n            .every((sibling) => equals(elem, sibling) || !adapter.isTag(sibling));\n    },\n};\nexport function verifyPseudoArgs(func, name, subselect, argIndex) {\n    if (subselect === null) {\n        if (func.length > argIndex) {\n            throw new Error(`Pseudo-class :${name} requires an argument`);\n        }\n    }\n    else if (func.length === argIndex) {\n        throw new Error(`Pseudo-class :${name} doesn't have any arguments`);\n    }\n}\n//# sourceMappingURL=pseudos.js.map","/**\n * Aliases are pseudos that are expressed as selectors.\n */\nexport const aliases = {\n    // Links\n    \"any-link\": \":is(a, area, link)[href]\",\n    link: \":any-link:not(:visited)\",\n    // Forms\n    // https://html.spec.whatwg.org/multipage/scripting.html#disabled-elements\n    disabled: `:is(\n        :is(button, input, select, textarea, optgroup, option)[disabled],\n        optgroup[disabled] > option,\n        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)\n    )`,\n    enabled: \":not(:disabled)\",\n    checked: \":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)\",\n    required: \":is(input, select, textarea)[required]\",\n    optional: \":is(input, select, textarea):not([required])\",\n    // JQuery extensions\n    // https://html.spec.whatwg.org/multipage/form-elements.html#concept-option-selectedness\n    selected: \"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)\",\n    checkbox: \"[type=checkbox]\",\n    file: \"[type=file]\",\n    password: \"[type=password]\",\n    radio: \"[type=radio]\",\n    reset: \"[type=reset]\",\n    image: \"[type=image]\",\n    submit: \"[type=submit]\",\n    parent: \":not(:empty)\",\n    header: \":is(h1, h2, h3, h4, h5, h6)\",\n    button: \":is(button, input[type=button])\",\n    input: \":is(input, textarea, select, button)\",\n    text: \"input:is(:not([type!='']), [type=text])\",\n};\n//# sourceMappingURL=aliases.js.map","import boolbase from \"boolbase\";\nimport { isTraversal } from \"../sort.js\";\n/** Used as a placeholder for :has. Will be replaced with the actual element. */\nexport const PLACEHOLDER_ELEMENT = {};\nexport function ensureIsTag(next, adapter) {\n    if (next === boolbase.falseFunc)\n        return boolbase.falseFunc;\n    return (elem) => adapter.isTag(elem) && next(elem);\n}\nexport function getNextSiblings(elem, adapter) {\n    const siblings = adapter.getSiblings(elem);\n    if (siblings.length <= 1)\n        return [];\n    const elemIndex = siblings.indexOf(elem);\n    if (elemIndex < 0 || elemIndex === siblings.length - 1)\n        return [];\n    return siblings.slice(elemIndex + 1).filter(adapter.isTag);\n}\nfunction copyOptions(options) {\n    // Not copied: context, rootFunc\n    return {\n        xmlMode: !!options.xmlMode,\n        lowerCaseAttributeNames: !!options.lowerCaseAttributeNames,\n        lowerCaseTags: !!options.lowerCaseTags,\n        quirksMode: !!options.quirksMode,\n        cacheResults: !!options.cacheResults,\n        pseudos: options.pseudos,\n        adapter: options.adapter,\n        equals: options.equals,\n    };\n}\nconst is = (next, token, options, context, compileToken) => {\n    const func = compileToken(token, copyOptions(options), context);\n    return func === boolbase.trueFunc\n        ? next\n        : func === boolbase.falseFunc\n            ? boolbase.falseFunc\n            : (elem) => func(elem) && next(elem);\n};\n/*\n * :not, :has, :is, :matches and :where have to compile selectors\n * doing this in src/pseudos.ts would lead to circular dependencies,\n * so we add them here\n */\nexport const subselects = {\n    is,\n    /**\n     * `:matches` and `:where` are aliases for `:is`.\n     */\n    matches: is,\n    where: is,\n    not(next, token, options, context, compileToken) {\n        const func = compileToken(token, copyOptions(options), context);\n        return func === boolbase.falseFunc\n            ? next\n            : func === boolbase.trueFunc\n                ? boolbase.falseFunc\n                : (elem) => !func(elem) && next(elem);\n    },\n    has(next, subselect, options, _context, compileToken) {\n        const { adapter } = options;\n        const opts = copyOptions(options);\n        opts.relativeSelector = true;\n        const context = subselect.some((s) => s.some(isTraversal))\n            ? // Used as a placeholder. Will be replaced with the actual element.\n                [PLACEHOLDER_ELEMENT]\n            : undefined;\n        const compiled = compileToken(subselect, opts, context);\n        if (compiled === boolbase.falseFunc)\n            return boolbase.falseFunc;\n        const hasElement = ensureIsTag(compiled, adapter);\n        // If `compiled` is `trueFunc`, we can skip this.\n        if (context && compiled !== boolbase.trueFunc) {\n            /*\n             * `shouldTestNextSiblings` will only be true if the query starts with\n             * a traversal (sibling or adjacent). That means we will always have a context.\n             */\n            const { shouldTestNextSiblings = false } = compiled;\n            return (elem) => {\n                if (!next(elem))\n                    return false;\n                context[0] = elem;\n                const childs = adapter.getChildren(elem);\n                const nextElements = shouldTestNextSiblings\n                    ? [...childs, ...getNextSiblings(elem, adapter)]\n                    : childs;\n                return adapter.existsOne(hasElement, nextElements);\n            };\n        }\n        return (elem) => next(elem) &&\n            adapter.existsOne(hasElement, adapter.getChildren(elem));\n    },\n};\n//# sourceMappingURL=subselects.js.map","import { parse } from \"css-what\";\nimport { filters } from \"./filters.js\";\nimport { pseudos, verifyPseudoArgs } from \"./pseudos.js\";\nimport { aliases } from \"./aliases.js\";\nimport { subselects } from \"./subselects.js\";\nexport { filters, pseudos, aliases };\nexport function compilePseudoSelector(next, selector, options, context, compileToken) {\n    var _a;\n    const { name, data } = selector;\n    if (Array.isArray(data)) {\n        if (!(name in subselects)) {\n            throw new Error(`Unknown pseudo-class :${name}(${data})`);\n        }\n        return subselects[name](next, data, options, context, compileToken);\n    }\n    const userPseudo = (_a = options.pseudos) === null || _a === void 0 ? void 0 : _a[name];\n    const stringPseudo = typeof userPseudo === \"string\" ? userPseudo : aliases[name];\n    if (typeof stringPseudo === \"string\") {\n        if (data != null) {\n            throw new Error(`Pseudo ${name} doesn't have any arguments`);\n        }\n        // The alias has to be parsed here, to make sure options are respected.\n        const alias = parse(stringPseudo);\n        return subselects[\"is\"](next, alias, options, context, compileToken);\n    }\n    if (typeof userPseudo === \"function\") {\n        verifyPseudoArgs(userPseudo, name, data, 1);\n        return (elem) => userPseudo(elem, data) && next(elem);\n    }\n    if (name in filters) {\n        return filters[name](next, data, options, context);\n    }\n    if (name in pseudos) {\n        const pseudo = pseudos[name];\n        verifyPseudoArgs(pseudo, name, data, 2);\n        return (elem) => pseudo(elem, options, data) && next(elem);\n    }\n    throw new Error(`Unknown pseudo-class :${name}`);\n}\n//# sourceMappingURL=index.js.map","import { attributeRules } from \"./attributes.js\";\nimport { compilePseudoSelector } from \"./pseudo-selectors/index.js\";\nimport { SelectorType } from \"css-what\";\nfunction getElementParent(node, adapter) {\n    const parent = adapter.getParent(node);\n    if (parent && adapter.isTag(parent)) {\n        return parent;\n    }\n    return null;\n}\n/*\n * All available rules\n */\nexport function compileGeneralSelector(next, selector, options, context, compileToken) {\n    const { adapter, equals } = options;\n    switch (selector.type) {\n        case SelectorType.PseudoElement: {\n            throw new Error(\"Pseudo-elements are not supported by css-select\");\n        }\n        case SelectorType.ColumnCombinator: {\n            throw new Error(\"Column combinators are not yet supported by css-select\");\n        }\n        case SelectorType.Attribute: {\n            if (selector.namespace != null) {\n                throw new Error(\"Namespaced attributes are not yet supported by css-select\");\n            }\n            if (!options.xmlMode || options.lowerCaseAttributeNames) {\n                selector.name = selector.name.toLowerCase();\n            }\n            return attributeRules[selector.action](next, selector, options);\n        }\n        case SelectorType.Pseudo: {\n            return compilePseudoSelector(next, selector, options, context, compileToken);\n        }\n        // Tags\n        case SelectorType.Tag: {\n            if (selector.namespace != null) {\n                throw new Error(\"Namespaced tag names are not yet supported by css-select\");\n            }\n            let { name } = selector;\n            if (!options.xmlMode || options.lowerCaseTags) {\n                name = name.toLowerCase();\n            }\n            return function tag(elem) {\n                return adapter.getName(elem) === name && next(elem);\n            };\n        }\n        // Traversal\n        case SelectorType.Descendant: {\n            if (options.cacheResults === false ||\n                typeof WeakSet === \"undefined\") {\n                return function descendant(elem) {\n                    let current = elem;\n                    while ((current = getElementParent(current, adapter))) {\n                        if (next(current)) {\n                            return true;\n                        }\n                    }\n                    return false;\n                };\n            }\n            // @ts-expect-error `ElementNode` is not extending object\n            const isFalseCache = new WeakSet();\n            return function cachedDescendant(elem) {\n                let current = elem;\n                while ((current = getElementParent(current, adapter))) {\n                    if (!isFalseCache.has(current)) {\n                        if (adapter.isTag(current) && next(current)) {\n                            return true;\n                        }\n                        isFalseCache.add(current);\n                    }\n                }\n                return false;\n            };\n        }\n        case \"_flexibleDescendant\": {\n            // Include element itself, only used while querying an array\n            return function flexibleDescendant(elem) {\n                let current = elem;\n                do {\n                    if (next(current))\n                        return true;\n                } while ((current = getElementParent(current, adapter)));\n                return false;\n            };\n        }\n        case SelectorType.Parent: {\n            return function parent(elem) {\n                return adapter\n                    .getChildren(elem)\n                    .some((elem) => adapter.isTag(elem) && next(elem));\n            };\n        }\n        case SelectorType.Child: {\n            return function child(elem) {\n                const parent = adapter.getParent(elem);\n                return parent != null && adapter.isTag(parent) && next(parent);\n            };\n        }\n        case SelectorType.Sibling: {\n            return function sibling(elem) {\n                const siblings = adapter.getSiblings(elem);\n                for (let i = 0; i < siblings.length; i++) {\n                    const currentSibling = siblings[i];\n                    if (equals(elem, currentSibling))\n                        break;\n                    if (adapter.isTag(currentSibling) && next(currentSibling)) {\n                        return true;\n                    }\n                }\n                return false;\n            };\n        }\n        case SelectorType.Adjacent: {\n            if (adapter.prevElementSibling) {\n                return function adjacent(elem) {\n                    const previous = adapter.prevElementSibling(elem);\n                    return previous != null && next(previous);\n                };\n            }\n            return function adjacent(elem) {\n                const siblings = adapter.getSiblings(elem);\n                let lastElement;\n                for (let i = 0; i < siblings.length; i++) {\n                    const currentSibling = siblings[i];\n                    if (equals(elem, currentSibling))\n                        break;\n                    if (adapter.isTag(currentSibling)) {\n                        lastElement = currentSibling;\n                    }\n                }\n                return !!lastElement && next(lastElement);\n            };\n        }\n        case SelectorType.Universal: {\n            if (selector.namespace != null && selector.namespace !== \"*\") {\n                throw new Error(\"Namespaced universal selectors are not yet supported by css-select\");\n            }\n            return next;\n        }\n    }\n}\n//# sourceMappingURL=general.js.map","import { parse, SelectorType } from \"css-what\";\nimport boolbase from \"boolbase\";\nimport sortRules, { isTraversal } from \"./sort.js\";\nimport { compileGeneralSelector } from \"./general.js\";\nimport { ensureIsTag, PLACEHOLDER_ELEMENT, } from \"./pseudo-selectors/subselects.js\";\n/**\n * Compiles a selector to an executable function.\n *\n * @param selector Selector to compile.\n * @param options Compilation options.\n * @param context Optional context for the selector.\n */\nexport function compile(selector, options, context) {\n    const next = compileUnsafe(selector, options, context);\n    return ensureIsTag(next, options.adapter);\n}\nexport function compileUnsafe(selector, options, context) {\n    const token = typeof selector === \"string\" ? parse(selector) : selector;\n    return compileToken(token, options, context);\n}\nfunction includesScopePseudo(t) {\n    return (t.type === SelectorType.Pseudo &&\n        (t.name === \"scope\" ||\n            (Array.isArray(t.data) &&\n                t.data.some((data) => data.some(includesScopePseudo)))));\n}\nconst DESCENDANT_TOKEN = { type: SelectorType.Descendant };\nconst FLEXIBLE_DESCENDANT_TOKEN = {\n    type: \"_flexibleDescendant\",\n};\nconst SCOPE_TOKEN = {\n    type: SelectorType.Pseudo,\n    name: \"scope\",\n    data: null,\n};\n/*\n * CSS 4 Spec (Draft): 3.4.1. Absolutizing a Relative Selector\n * http://www.w3.org/TR/selectors4/#absolutizing\n */\nfunction absolutize(token, { adapter }, context) {\n    // TODO Use better check if the context is a document\n    const hasContext = !!(context === null || context === void 0 ? void 0 : context.every((e) => {\n        const parent = adapter.isTag(e) && adapter.getParent(e);\n        return e === PLACEHOLDER_ELEMENT || (parent && adapter.isTag(parent));\n    }));\n    for (const t of token) {\n        if (t.length > 0 &&\n            isTraversal(t[0]) &&\n            t[0].type !== SelectorType.Descendant) {\n            // Don't continue in else branch\n        }\n        else if (hasContext && !t.some(includesScopePseudo)) {\n            t.unshift(DESCENDANT_TOKEN);\n        }\n        else {\n            continue;\n        }\n        t.unshift(SCOPE_TOKEN);\n    }\n}\nexport function compileToken(token, options, context) {\n    var _a;\n    token.forEach(sortRules);\n    context = (_a = options.context) !== null && _a !== void 0 ? _a : context;\n    const isArrayContext = Array.isArray(context);\n    const finalContext = context && (Array.isArray(context) ? context : [context]);\n    // Check if the selector is relative\n    if (options.relativeSelector !== false) {\n        absolutize(token, options, finalContext);\n    }\n    else if (token.some((t) => t.length > 0 && isTraversal(t[0]))) {\n        throw new Error(\"Relative selectors are not allowed when the `relativeSelector` option is disabled\");\n    }\n    let shouldTestNextSiblings = false;\n    const query = token\n        .map((rules) => {\n        if (rules.length >= 2) {\n            const [first, second] = rules;\n            if (first.type !== SelectorType.Pseudo ||\n                first.name !== \"scope\") {\n                // Ignore\n            }\n            else if (isArrayContext &&\n                second.type === SelectorType.Descendant) {\n                rules[1] = FLEXIBLE_DESCENDANT_TOKEN;\n            }\n            else if (second.type === SelectorType.Adjacent ||\n                second.type === SelectorType.Sibling) {\n                shouldTestNextSiblings = true;\n            }\n        }\n        return compileRules(rules, options, finalContext);\n    })\n        .reduce(reduceRules, boolbase.falseFunc);\n    query.shouldTestNextSiblings = shouldTestNextSiblings;\n    return query;\n}\nfunction compileRules(rules, options, context) {\n    var _a;\n    return rules.reduce((previous, rule) => previous === boolbase.falseFunc\n        ? boolbase.falseFunc\n        : compileGeneralSelector(previous, rule, options, context, compileToken), (_a = options.rootFunc) !== null && _a !== void 0 ? _a : boolbase.trueFunc);\n}\nfunction reduceRules(a, b) {\n    if (b === boolbase.falseFunc || a === boolbase.trueFunc) {\n        return a;\n    }\n    if (a === boolbase.falseFunc || b === boolbase.trueFunc) {\n        return b;\n    }\n    return function combine(elem) {\n        return a(elem) || b(elem);\n    };\n}\n//# sourceMappingURL=compile.js.map","import * as DomUtils from \"domutils\";\nimport boolbase from \"boolbase\";\nimport { compile as compileRaw, compileUnsafe, compileToken, } from \"./compile.js\";\nimport { getNextSiblings } from \"./pseudo-selectors/subselects.js\";\nconst defaultEquals = (a, b) => a === b;\nconst defaultOptions = {\n    adapter: DomUtils,\n    equals: defaultEquals,\n};\nfunction convertOptionFormats(options) {\n    var _a, _b, _c, _d;\n    /*\n     * We force one format of options to the other one.\n     */\n    // @ts-expect-error Default options may have incompatible `Node` / `ElementNode`.\n    const opts = options !== null && options !== void 0 ? options : defaultOptions;\n    // @ts-expect-error Same as above.\n    (_a = opts.adapter) !== null && _a !== void 0 ? _a : (opts.adapter = DomUtils);\n    // @ts-expect-error `equals` does not exist on `Options`\n    (_b = opts.equals) !== null && _b !== void 0 ? _b : (opts.equals = (_d = (_c = opts.adapter) === null || _c === void 0 ? void 0 : _c.equals) !== null && _d !== void 0 ? _d : defaultEquals);\n    return opts;\n}\nfunction wrapCompile(func) {\n    return function addAdapter(selector, options, context) {\n        const opts = convertOptionFormats(options);\n        return func(selector, opts, context);\n    };\n}\n/**\n * Compiles the query, returns a function.\n */\nexport const compile = wrapCompile(compileRaw);\nexport const _compileUnsafe = wrapCompile(compileUnsafe);\nexport const _compileToken = wrapCompile(compileToken);\nfunction getSelectorFunc(searchFunc) {\n    return function select(query, elements, options) {\n        const opts = convertOptionFormats(options);\n        if (typeof query !== \"function\") {\n            query = compileUnsafe(query, opts, elements);\n        }\n        const filteredElements = prepareContext(elements, opts.adapter, query.shouldTestNextSiblings);\n        return searchFunc(query, filteredElements, opts);\n    };\n}\nexport function prepareContext(elems, adapter, shouldTestNextSiblings = false) {\n    /*\n     * Add siblings if the query requires them.\n     * See https://github.com/fb55/css-select/pull/43#issuecomment-225414692\n     */\n    if (shouldTestNextSiblings) {\n        elems = appendNextSiblings(elems, adapter);\n    }\n    return Array.isArray(elems)\n        ? adapter.removeSubsets(elems)\n        : adapter.getChildren(elems);\n}\nfunction appendNextSiblings(elem, adapter) {\n    // Order matters because jQuery seems to check the children before the siblings\n    const elems = Array.isArray(elem) ? elem.slice(0) : [elem];\n    const elemsLength = elems.length;\n    for (let i = 0; i < elemsLength; i++) {\n        const nextSiblings = getNextSiblings(elems[i], adapter);\n        elems.push(...nextSiblings);\n    }\n    return elems;\n}\n/**\n * @template Node The generic Node type for the DOM adapter being used.\n * @template ElementNode The Node type for elements for the DOM adapter being used.\n * @param elems Elements to query. If it is an element, its children will be queried..\n * @param query can be either a CSS selector string or a compiled query function.\n * @param [options] options for querying the document.\n * @see compile for supported selector queries.\n * @returns All matching elements.\n *\n */\nexport const selectAll = getSelectorFunc((query, elems, options) => query === boolbase.falseFunc || !elems || elems.length === 0\n    ? []\n    : options.adapter.findAll(query, elems));\n/**\n * @template Node The generic Node type for the DOM adapter being used.\n * @template ElementNode The Node type for elements for the DOM adapter being used.\n * @param elems Elements to query. If it is an element, its children will be queried..\n * @param query can be either a CSS selector string or a compiled query function.\n * @param [options] options for querying the document.\n * @see compile for supported selector queries.\n * @returns the first match, or null if there was no match.\n */\nexport const selectOne = getSelectorFunc((query, elems, options) => query === boolbase.falseFunc || !elems || elems.length === 0\n    ? null\n    : options.adapter.findOne(query, elems));\n/**\n * Tests whether or not an element is matched by query.\n *\n * @template Node The generic Node type for the DOM adapter being used.\n * @template ElementNode The Node type for elements for the DOM adapter being used.\n * @param elem The element to test if it matches the query.\n * @param query can be either a CSS selector string or a compiled query function.\n * @param [options] options for querying the document.\n * @see compile for supported selector queries.\n * @returns\n */\nexport function is(elem, query, options) {\n    const opts = convertOptionFormats(options);\n    return (typeof query === \"function\" ? query : compileRaw(query, opts))(elem);\n}\n/**\n * Alias for selectAll(query, elems, options).\n * @see [compile] for supported selector queries.\n */\nexport default selectAll;\n// Export filters, pseudos and aliases to allow users to supply their own.\n/** @deprecated Use the `pseudos` option instead. */\nexport { filters, pseudos, aliases } from \"./pseudo-selectors/index.js\";\n//# sourceMappingURL=index.js.map","export const filterNames = new Set([\n    \"first\",\n    \"last\",\n    \"eq\",\n    \"gt\",\n    \"nth\",\n    \"lt\",\n    \"even\",\n    \"odd\",\n]);\nexport function isFilter(s) {\n    if (s.type !== \"pseudo\")\n        return false;\n    if (filterNames.has(s.name))\n        return true;\n    if (s.name === \"not\" && Array.isArray(s.data)) {\n        // Only consider `:not` with embedded filters\n        return s.data.some((s) => s.some(isFilter));\n    }\n    return false;\n}\nexport function getLimit(filter, data, partLimit) {\n    const num = data != null ? parseInt(data, 10) : NaN;\n    switch (filter) {\n        case \"first\":\n            return 1;\n        case \"nth\":\n        case \"eq\":\n            return isFinite(num) ? (num >= 0 ? num + 1 : Infinity) : 0;\n        case \"lt\":\n            return isFinite(num)\n                ? num >= 0\n                    ? Math.min(num, partLimit)\n                    : Infinity\n                : 0;\n        case \"gt\":\n            return isFinite(num) ? Infinity : 0;\n        case \"odd\":\n            return 2 * partLimit;\n        case \"even\":\n            return 2 * partLimit - 1;\n        case \"last\":\n        case \"not\":\n            return Infinity;\n    }\n}\n//# sourceMappingURL=positionals.js.map","import { isFilter } from \"./positionals.js\";\nexport function getDocumentRoot(node) {\n    while (node.parent)\n        node = node.parent;\n    return node;\n}\nexport function groupSelectors(selectors) {\n    const filteredSelectors = [];\n    const plainSelectors = [];\n    for (const selector of selectors) {\n        if (selector.some(isFilter)) {\n            filteredSelectors.push(selector);\n        }\n        else {\n            plainSelectors.push(selector);\n        }\n    }\n    return [plainSelectors, filteredSelectors];\n}\n//# sourceMappingURL=helpers.js.map","import { parse, SelectorType, isTraversal } from \"css-what\";\nimport { _compileToken as compileToken, prepareContext, } from \"css-select\";\nimport * as DomUtils from \"domutils\";\nimport * as boolbase from \"boolbase\";\nimport { getDocumentRoot, groupSelectors } from \"./helpers.js\";\nimport { isFilter, getLimit, } from \"./positionals.js\";\n// Re-export pseudo extension points\nexport { filters, pseudos, aliases } from \"css-select\";\nconst UNIVERSAL_SELECTOR = {\n    type: SelectorType.Universal,\n    namespace: null,\n};\nconst SCOPE_PSEUDO = {\n    type: SelectorType.Pseudo,\n    name: \"scope\",\n    data: null,\n};\nexport function is(element, selector, options = {}) {\n    return some([element], selector, options);\n}\nexport function some(elements, selector, options = {}) {\n    if (typeof selector === \"function\")\n        return elements.some(selector);\n    const [plain, filtered] = groupSelectors(parse(selector));\n    return ((plain.length > 0 && elements.some(compileToken(plain, options))) ||\n        filtered.some((sel) => filterBySelector(sel, elements, options).length > 0));\n}\nfunction filterByPosition(filter, elems, data, options) {\n    const num = typeof data === \"string\" ? parseInt(data, 10) : NaN;\n    switch (filter) {\n        case \"first\":\n        case \"lt\":\n            // Already done in `getLimit`\n            return elems;\n        case \"last\":\n            return elems.length > 0 ? [elems[elems.length - 1]] : elems;\n        case \"nth\":\n        case \"eq\":\n            return isFinite(num) && Math.abs(num) < elems.length\n                ? [num < 0 ? elems[elems.length + num] : elems[num]]\n                : [];\n        case \"gt\":\n            return isFinite(num) ? elems.slice(num + 1) : [];\n        case \"even\":\n            return elems.filter((_, i) => i % 2 === 0);\n        case \"odd\":\n            return elems.filter((_, i) => i % 2 === 1);\n        case \"not\": {\n            const filtered = new Set(filterParsed(data, elems, options));\n            return elems.filter((e) => !filtered.has(e));\n        }\n    }\n}\nexport function filter(selector, elements, options = {}) {\n    return filterParsed(parse(selector), elements, options);\n}\n/**\n * Filter a set of elements by a selector.\n *\n * Will return elements in the original order.\n *\n * @param selector Selector to filter by.\n * @param elements Elements to filter.\n * @param options Options for selector.\n */\nfunction filterParsed(selector, elements, options) {\n    if (elements.length === 0)\n        return [];\n    const [plainSelectors, filteredSelectors] = groupSelectors(selector);\n    let found;\n    if (plainSelectors.length) {\n        const filtered = filterElements(elements, plainSelectors, options);\n        // If there are no filters, just return\n        if (filteredSelectors.length === 0) {\n            return filtered;\n        }\n        // Otherwise, we have to do some filtering\n        if (filtered.length) {\n            found = new Set(filtered);\n        }\n    }\n    for (let i = 0; i < filteredSelectors.length && (found === null || found === void 0 ? void 0 : found.size) !== elements.length; i++) {\n        const filteredSelector = filteredSelectors[i];\n        const missing = found\n            ? elements.filter((e) => DomUtils.isTag(e) && !found.has(e))\n            : elements;\n        if (missing.length === 0)\n            break;\n        const filtered = filterBySelector(filteredSelector, elements, options);\n        if (filtered.length) {\n            if (!found) {\n                /*\n                 * If we haven't found anything before the last selector,\n                 * just return what we found now.\n                 */\n                if (i === filteredSelectors.length - 1) {\n                    return filtered;\n                }\n                found = new Set(filtered);\n            }\n            else {\n                filtered.forEach((el) => found.add(el));\n            }\n        }\n    }\n    return typeof found !== \"undefined\"\n        ? (found.size === elements.length\n            ? elements\n            : // Filter elements to preserve order\n                elements.filter((el) => found.has(el)))\n        : [];\n}\nfunction filterBySelector(selector, elements, options) {\n    var _a;\n    if (selector.some(isTraversal)) {\n        /*\n         * Get root node, run selector with the scope\n         * set to all of our nodes.\n         */\n        const root = (_a = options.root) !== null && _a !== void 0 ? _a : getDocumentRoot(elements[0]);\n        const opts = { ...options, context: elements, relativeSelector: false };\n        selector.push(SCOPE_PSEUDO);\n        return findFilterElements(root, selector, opts, true, elements.length);\n    }\n    // Performance optimization: If we don't have to traverse, just filter set.\n    return findFilterElements(elements, selector, options, false, elements.length);\n}\nexport function select(selector, root, options = {}, limit = Infinity) {\n    if (typeof selector === \"function\") {\n        return find(root, selector);\n    }\n    const [plain, filtered] = groupSelectors(parse(selector));\n    const results = filtered.map((sel) => findFilterElements(root, sel, options, true, limit));\n    // Plain selectors can be queried in a single go\n    if (plain.length) {\n        results.push(findElements(root, plain, options, limit));\n    }\n    if (results.length === 0) {\n        return [];\n    }\n    // If there was only a single selector, just return the result\n    if (results.length === 1) {\n        return results[0];\n    }\n    // Sort results, filtering for duplicates\n    return DomUtils.uniqueSort(results.reduce((a, b) => [...a, ...b]));\n}\n/**\n *\n * @param root Element(s) to search from.\n * @param selector Selector to look for.\n * @param options Options for querying.\n * @param queryForSelector Query multiple levels deep for the initial selector, even if it doesn't contain a traversal.\n */\nfunction findFilterElements(root, selector, options, queryForSelector, totalLimit) {\n    const filterIndex = selector.findIndex(isFilter);\n    const sub = selector.slice(0, filterIndex);\n    const filter = selector[filterIndex];\n    // If we are at the end of the selector, we can limit the number of elements to retrieve.\n    const partLimit = selector.length - 1 === filterIndex ? totalLimit : Infinity;\n    /*\n     * Set the number of elements to retrieve.\n     * Eg. for :first, we only have to get a single element.\n     */\n    const limit = getLimit(filter.name, filter.data, partLimit);\n    if (limit === 0)\n        return [];\n    /*\n     * Skip `findElements` call if our selector starts with a positional\n     * pseudo.\n     */\n    const elemsNoLimit = sub.length === 0 && !Array.isArray(root)\n        ? DomUtils.getChildren(root).filter(DomUtils.isTag)\n        : sub.length === 0\n            ? (Array.isArray(root) ? root : [root]).filter(DomUtils.isTag)\n            : queryForSelector || sub.some(isTraversal)\n                ? findElements(root, [sub], options, limit)\n                : filterElements(root, [sub], options);\n    const elems = elemsNoLimit.slice(0, limit);\n    let result = filterByPosition(filter.name, elems, filter.data, options);\n    if (result.length === 0 || selector.length === filterIndex + 1) {\n        return result;\n    }\n    const remainingSelector = selector.slice(filterIndex + 1);\n    const remainingHasTraversal = remainingSelector.some(isTraversal);\n    if (remainingHasTraversal) {\n        if (isTraversal(remainingSelector[0])) {\n            const { type } = remainingSelector[0];\n            if (type === SelectorType.Sibling ||\n                type === SelectorType.Adjacent) {\n                // If we have a sibling traversal, we need to also look at the siblings.\n                result = prepareContext(result, DomUtils, true);\n            }\n            // Avoid a traversal-first selector error.\n            remainingSelector.unshift(UNIVERSAL_SELECTOR);\n        }\n        options = {\n            ...options,\n            // Avoid absolutizing the selector\n            relativeSelector: false,\n            /*\n             * Add a custom root func, to make sure traversals don't match elements\n             * that aren't a part of the considered tree.\n             */\n            rootFunc: (el) => result.includes(el),\n        };\n    }\n    else if (options.rootFunc && options.rootFunc !== boolbase.trueFunc) {\n        options = { ...options, rootFunc: boolbase.trueFunc };\n    }\n    /*\n     * If we have another filter, recursively call `findFilterElements`,\n     * with the `recursive` flag disabled. We only have to look for more\n     * elements when we see a traversal.\n     *\n     * Otherwise,\n     */\n    return remainingSelector.some(isFilter)\n        ? findFilterElements(result, remainingSelector, options, false, totalLimit)\n        : remainingHasTraversal\n            ? // Query existing elements to resolve traversal.\n                findElements(result, [remainingSelector], options, totalLimit)\n            : // If we don't have any more traversals, simply filter elements.\n                filterElements(result, [remainingSelector], options);\n}\nfunction findElements(root, sel, options, limit) {\n    const query = compileToken(sel, options, root);\n    return find(root, query, limit);\n}\nfunction find(root, query, limit = Infinity) {\n    const elems = prepareContext(root, DomUtils, query.shouldTestNextSiblings);\n    return DomUtils.find((node) => DomUtils.isTag(node) && query(node), elems, true, limit);\n}\nfunction filterElements(elements, sel, options) {\n    const els = (Array.isArray(elements) ? elements : [elements]).filter(DomUtils.isTag);\n    if (els.length === 0)\n        return els;\n    const query = compileToken(sel, options);\n    return query === boolbase.trueFunc ? els : els.filter(query);\n}\n//# sourceMappingURL=index.js.map","/**\n * Methods for traversing the DOM structure.\n *\n * @module cheerio/traversing\n */\nimport { isTag, hasChildren, isDocument, } from 'domhandler';\nimport * as select from 'cheerio-select';\nimport { domEach, isCheerio } from '../utils.js';\nimport { contains } from '../static.js';\nimport { getChildren, getSiblings, nextElementSibling, prevElementSibling, uniqueSort, } from 'domutils';\nconst reSiblingSelector = /^\\s*[+~]/;\n/**\n * Get the descendants of each element in the current set of matched elements,\n * filtered by a selector, jQuery object, or element.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('#fruits').find('li').length;\n * //=> 3\n * $('#fruits').find($('.apple')).length;\n * //=> 1\n * ```\n *\n * @param selectorOrHaystack - Element to look for.\n * @returns The found elements.\n * @see {@link https://api.jquery.com/find/}\n */\nexport function find(selectorOrHaystack) {\n    if (!selectorOrHaystack) {\n        return this._make([]);\n    }\n    if (typeof selectorOrHaystack !== 'string') {\n        const haystack = isCheerio(selectorOrHaystack)\n            ? selectorOrHaystack.toArray()\n            : [selectorOrHaystack];\n        const context = this.toArray();\n        return this._make(haystack.filter((elem) => context.some((node) => contains(node, elem))));\n    }\n    return this._findBySelector(selectorOrHaystack, Number.POSITIVE_INFINITY);\n}\n/**\n * Find elements by a specific selector.\n *\n * @private\n * @category Traversing\n * @param selector - Selector to filter by.\n * @param limit - Maximum number of elements to match.\n * @returns The found elements.\n */\nexport function _findBySelector(selector, limit) {\n    var _a;\n    const context = this.toArray();\n    const elems = reSiblingSelector.test(selector)\n        ? context\n        : this.children().toArray();\n    const options = {\n        context,\n        root: (_a = this._root) === null || _a === void 0 ? void 0 : _a[0],\n        // Pass options that are recognized by `cheerio-select`\n        xmlMode: this.options.xmlMode,\n        lowerCaseTags: this.options.lowerCaseTags,\n        lowerCaseAttributeNames: this.options.lowerCaseAttributeNames,\n        pseudos: this.options.pseudos,\n        quirksMode: this.options.quirksMode,\n    };\n    return this._make(select.select(selector, elems, options, limit));\n}\n/**\n * Creates a matcher, using a particular mapping function. Matchers provide a\n * function that finds elements using a generating function, supporting\n * filtering.\n *\n * @private\n * @param matchMap - Mapping function.\n * @returns - Function for wrapping generating functions.\n */\nfunction _getMatcher(matchMap) {\n    return function (fn, ...postFns) {\n        return function (selector) {\n            var _a;\n            let matched = matchMap(fn, this);\n            if (selector) {\n                matched = filterArray(matched, selector, this.options.xmlMode, (_a = this._root) === null || _a === void 0 ? void 0 : _a[0]);\n            }\n            return this._make(\n            // Post processing is only necessary if there is more than one element.\n            this.length > 1 && matched.length > 1\n                ? postFns.reduce((elems, fn) => fn(elems), matched)\n                : matched);\n        };\n    };\n}\n/** Matcher that adds multiple elements for each entry in the input. */\nconst _matcher = _getMatcher((fn, elems) => {\n    let ret = [];\n    for (let i = 0; i < elems.length; i++) {\n        const value = fn(elems[i]);\n        if (value.length > 0)\n            ret = ret.concat(value);\n    }\n    return ret;\n});\n/** Matcher that adds at most one element for each entry in the input. */\nconst _singleMatcher = _getMatcher((fn, elems) => {\n    const ret = [];\n    for (let i = 0; i < elems.length; i++) {\n        const value = fn(elems[i]);\n        if (value !== null) {\n            ret.push(value);\n        }\n    }\n    return ret;\n});\n/**\n * Matcher that supports traversing until a condition is met.\n *\n * @param nextElem - Function that returns the next element.\n * @param postFns - Post processing functions.\n * @returns A function usable for `*Until` methods.\n */\nfunction _matchUntil(nextElem, ...postFns) {\n    // We use a variable here that is used from within the matcher.\n    let matches = null;\n    const innerMatcher = _getMatcher((nextElem, elems) => {\n        const matched = [];\n        domEach(elems, (elem) => {\n            for (let next; (next = nextElem(elem)); elem = next) {\n                // FIXME: `matched` might contain duplicates here and the index is too large.\n                if (matches === null || matches === void 0 ? void 0 : matches(next, matched.length))\n                    break;\n                matched.push(next);\n            }\n        });\n        return matched;\n    })(nextElem, ...postFns);\n    return function (selector, filterSelector) {\n        // Override `matches` variable with the new target.\n        matches =\n            typeof selector === 'string'\n                ? (elem) => select.is(elem, selector, this.options)\n                : selector\n                    ? getFilterFn(selector)\n                    : null;\n        const ret = innerMatcher.call(this, filterSelector);\n        // Set `matches` to `null`, so we don't waste memory.\n        matches = null;\n        return ret;\n    };\n}\nfunction _removeDuplicates(elems) {\n    return elems.length > 1 ? Array.from(new Set(elems)) : elems;\n}\n/**\n * Get the parent of each element in the current set of matched elements,\n * optionally filtered by a selector.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.pear').parent().attr('id');\n * //=> fruits\n * ```\n *\n * @param selector - If specified filter for parent.\n * @returns The parents.\n * @see {@link https://api.jquery.com/parent/}\n */\nexport const parent = _singleMatcher(({ parent }) => (parent && !isDocument(parent) ? parent : null), _removeDuplicates);\n/**\n * Get a set of parents filtered by `selector` of each element in the current\n * set of match elements.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.orange').parents().length;\n * //=> 2\n * $('.orange').parents('#fruits').length;\n * //=> 1\n * ```\n *\n * @param selector - If specified filter for parents.\n * @returns The parents.\n * @see {@link https://api.jquery.com/parents/}\n */\nexport const parents = _matcher((elem) => {\n    const matched = [];\n    while (elem.parent && !isDocument(elem.parent)) {\n        matched.push(elem.parent);\n        elem = elem.parent;\n    }\n    return matched;\n}, uniqueSort, (elems) => elems.reverse());\n/**\n * Get the ancestors of each element in the current set of matched elements, up\n * to but not including the element matched by the selector, DOM node, or\n * cheerio object.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.orange').parentsUntil('#food').length;\n * //=> 1\n * ```\n *\n * @param selector - Selector for element to stop at.\n * @param filterSelector - Optional filter for parents.\n * @returns The parents.\n * @see {@link https://api.jquery.com/parentsUntil/}\n */\nexport const parentsUntil = _matchUntil(({ parent }) => (parent && !isDocument(parent) ? parent : null), uniqueSort, (elems) => elems.reverse());\n/**\n * For each element in the set, get the first element that matches the selector\n * by testing the element itself and traversing up through its ancestors in the\n * DOM tree.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.orange').closest();\n * //=> []\n *\n * $('.orange').closest('.apple');\n * // => []\n *\n * $('.orange').closest('li');\n * //=> [<li class=\"orange\">Orange</li>]\n *\n * $('.orange').closest('#fruits');\n * //=> [<ul id=\"fruits\"> ... </ul>]\n * ```\n *\n * @param selector - Selector for the element to find.\n * @returns The closest nodes.\n * @see {@link https://api.jquery.com/closest/}\n */\nexport function closest(selector) {\n    var _a;\n    const set = [];\n    if (!selector) {\n        return this._make(set);\n    }\n    const selectOpts = {\n        xmlMode: this.options.xmlMode,\n        root: (_a = this._root) === null || _a === void 0 ? void 0 : _a[0],\n    };\n    const selectFn = typeof selector === 'string'\n        ? (elem) => select.is(elem, selector, selectOpts)\n        : getFilterFn(selector);\n    domEach(this, (elem) => {\n        if (elem && !isDocument(elem) && !isTag(elem)) {\n            elem = elem.parent;\n        }\n        while (elem && isTag(elem)) {\n            if (selectFn(elem, 0)) {\n                // Do not add duplicate elements to the set\n                if (!set.includes(elem)) {\n                    set.push(elem);\n                }\n                break;\n            }\n            elem = elem.parent;\n        }\n    });\n    return this._make(set);\n}\n/**\n * Gets the next sibling of each selected element, optionally filtered by a\n * selector.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.apple').next().hasClass('orange');\n * //=> true\n * ```\n *\n * @param selector - If specified filter for sibling.\n * @returns The next nodes.\n * @see {@link https://api.jquery.com/next/}\n */\nexport const next = _singleMatcher((elem) => nextElementSibling(elem));\n/**\n * Gets all the following siblings of the each selected element, optionally\n * filtered by a selector.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.apple').nextAll();\n * //=> [<li class=\"orange\">Orange</li>, <li class=\"pear\">Pear</li>]\n * $('.apple').nextAll('.orange');\n * //=> [<li class=\"orange\">Orange</li>]\n * ```\n *\n * @param selector - If specified filter for siblings.\n * @returns The next nodes.\n * @see {@link https://api.jquery.com/nextAll/}\n */\nexport const nextAll = _matcher((elem) => {\n    const matched = [];\n    while (elem.next) {\n        elem = elem.next;\n        if (isTag(elem))\n            matched.push(elem);\n    }\n    return matched;\n}, _removeDuplicates);\n/**\n * Gets all the following siblings up to but not including the element matched\n * by the selector, optionally filtered by another selector.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.apple').nextUntil('.pear');\n * //=> [<li class=\"orange\">Orange</li>]\n * ```\n *\n * @param selector - Selector for element to stop at.\n * @param filterSelector - If specified filter for siblings.\n * @returns The next nodes.\n * @see {@link https://api.jquery.com/nextUntil/}\n */\nexport const nextUntil = _matchUntil((el) => nextElementSibling(el), _removeDuplicates);\n/**\n * Gets the previous sibling of each selected element optionally filtered by a\n * selector.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.orange').prev().hasClass('apple');\n * //=> true\n * ```\n *\n * @param selector - If specified filter for siblings.\n * @returns The previous nodes.\n * @see {@link https://api.jquery.com/prev/}\n */\nexport const prev = _singleMatcher((elem) => prevElementSibling(elem));\n/**\n * Gets all the preceding siblings of each selected element, optionally filtered\n * by a selector.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.pear').prevAll();\n * //=> [<li class=\"orange\">Orange</li>, <li class=\"apple\">Apple</li>]\n *\n * $('.pear').prevAll('.orange');\n * //=> [<li class=\"orange\">Orange</li>]\n * ```\n *\n * @param selector - If specified filter for siblings.\n * @returns The previous nodes.\n * @see {@link https://api.jquery.com/prevAll/}\n */\nexport const prevAll = _matcher((elem) => {\n    const matched = [];\n    while (elem.prev) {\n        elem = elem.prev;\n        if (isTag(elem))\n            matched.push(elem);\n    }\n    return matched;\n}, _removeDuplicates);\n/**\n * Gets all the preceding siblings up to but not including the element matched\n * by the selector, optionally filtered by another selector.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.pear').prevUntil('.apple');\n * //=> [<li class=\"orange\">Orange</li>]\n * ```\n *\n * @param selector - Selector for element to stop at.\n * @param filterSelector - If specified filter for siblings.\n * @returns The previous nodes.\n * @see {@link https://api.jquery.com/prevUntil/}\n */\nexport const prevUntil = _matchUntil((el) => prevElementSibling(el), _removeDuplicates);\n/**\n * Get the siblings of each element (excluding the element) in the set of\n * matched elements, optionally filtered by a selector.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.pear').siblings().length;\n * //=> 2\n *\n * $('.pear').siblings('.orange').length;\n * //=> 1\n * ```\n *\n * @param selector - If specified filter for siblings.\n * @returns The siblings.\n * @see {@link https://api.jquery.com/siblings/}\n */\nexport const siblings = _matcher((elem) => getSiblings(elem).filter((el) => isTag(el) && el !== elem), uniqueSort);\n/**\n * Gets the element children of each element in the set of matched elements.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('#fruits').children().length;\n * //=> 3\n *\n * $('#fruits').children('.pear').text();\n * //=> Pear\n * ```\n *\n * @param selector - If specified filter for children.\n * @returns The children.\n * @see {@link https://api.jquery.com/children/}\n */\nexport const children = _matcher((elem) => getChildren(elem).filter(isTag), _removeDuplicates);\n/**\n * Gets the children of each element in the set of matched elements, including\n * text and comment nodes.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('#fruits').contents().length;\n * //=> 3\n * ```\n *\n * @returns The children.\n * @see {@link https://api.jquery.com/contents/}\n */\nexport function contents() {\n    const elems = this.toArray().reduce((newElems, elem) => hasChildren(elem) ? newElems.concat(elem.children) : newElems, []);\n    return this._make(elems);\n}\n/**\n * Iterates over a cheerio object, executing a function for each matched\n * element. When the callback is fired, the function is fired in the context of\n * the DOM element, so `this` refers to the current element, which is equivalent\n * to the function parameter `element`. To break out of the `each` loop early,\n * return with `false`.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * const fruits = [];\n *\n * $('li').each(function (i, elem) {\n *   fruits[i] = $(this).text();\n * });\n *\n * fruits.join(', ');\n * //=> Apple, Orange, Pear\n * ```\n *\n * @param fn - Function to execute.\n * @returns The instance itself, useful for chaining.\n * @see {@link https://api.jquery.com/each/}\n */\nexport function each(fn) {\n    let i = 0;\n    const len = this.length;\n    while (i < len && fn.call(this[i], i, this[i]) !== false)\n        ++i;\n    return this;\n}\n/**\n * Pass each element in the current matched set through a function, producing a\n * new Cheerio object containing the return values. The function can return an\n * individual data item or an array of data items to be inserted into the\n * resulting set. If an array is returned, the elements inside the array are\n * inserted into the set. If the function returns null or undefined, no element\n * will be inserted.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('li')\n *   .map(function (i, el) {\n *     // this === el\n *     return $(this).text();\n *   })\n *   .toArray()\n *   .join(' ');\n * //=> \"apple orange pear\"\n * ```\n *\n * @param fn - Function to execute.\n * @returns The mapped elements, wrapped in a Cheerio collection.\n * @see {@link https://api.jquery.com/map/}\n */\nexport function map(fn) {\n    let elems = [];\n    for (let i = 0; i < this.length; i++) {\n        const el = this[i];\n        const val = fn.call(el, i, el);\n        if (val != null) {\n            elems = elems.concat(val);\n        }\n    }\n    return this._make(elems);\n}\n/**\n * Creates a function to test if a filter is matched.\n *\n * @param match - A filter.\n * @returns A function that determines if a filter has been matched.\n */\nfunction getFilterFn(match) {\n    if (typeof match === 'function') {\n        return (el, i) => match.call(el, i, el);\n    }\n    if (isCheerio(match)) {\n        return (el) => Array.prototype.includes.call(match, el);\n    }\n    return function (el) {\n        return match === el;\n    };\n}\nexport function filter(match) {\n    var _a;\n    return this._make(filterArray(this.toArray(), match, this.options.xmlMode, (_a = this._root) === null || _a === void 0 ? void 0 : _a[0]));\n}\nexport function filterArray(nodes, match, xmlMode, root) {\n    return typeof match === 'string'\n        ? select.filter(match, nodes, { xmlMode, root })\n        : nodes.filter(getFilterFn(match));\n}\n/**\n * Checks the current list of elements and returns `true` if _any_ of the\n * elements match the selector. If using an element or Cheerio selection,\n * returns `true` if _any_ of the elements match. If using a predicate function,\n * the function is executed in the context of the selected element, so `this`\n * refers to the current element.\n *\n * @category Traversing\n * @param selector - Selector for the selection.\n * @returns Whether or not the selector matches an element of the instance.\n * @see {@link https://api.jquery.com/is/}\n */\nexport function is(selector) {\n    const nodes = this.toArray();\n    return typeof selector === 'string'\n        ? select.some(nodes.filter(isTag), selector, this.options)\n        : selector\n            ? nodes.some(getFilterFn(selector))\n            : false;\n}\n/**\n * Remove elements from the set of matched elements. Given a Cheerio object that\n * represents a set of DOM elements, the `.not()` method constructs a new\n * Cheerio object from a subset of the matching elements. The supplied selector\n * is tested against each element; the elements that don't match the selector\n * will be included in the result.\n *\n * The `.not()` method can take a function as its argument in the same way that\n * `.filter()` does. Elements for which the function returns `true` are excluded\n * from the filtered set; all other elements are included.\n *\n * @category Traversing\n * @example <caption>Selector</caption>\n *\n * ```js\n * $('li').not('.apple').length;\n * //=> 2\n * ```\n *\n * @example <caption>Function</caption>\n *\n * ```js\n * $('li').not(function (i, el) {\n *   // this === el\n *   return $(this).attr('class') === 'orange';\n * }).length; //=> 2\n * ```\n *\n * @param match - Value to look for, following the rules above.\n * @returns The filtered collection.\n * @see {@link https://api.jquery.com/not/}\n */\nexport function not(match) {\n    let nodes = this.toArray();\n    if (typeof match === 'string') {\n        const matches = new Set(select.filter(match, nodes, this.options));\n        nodes = nodes.filter((el) => !matches.has(el));\n    }\n    else {\n        const filterFn = getFilterFn(match);\n        nodes = nodes.filter((el, i) => !filterFn(el, i));\n    }\n    return this._make(nodes);\n}\n/**\n * Filters the set of matched elements to only those which have the given DOM\n * element as a descendant or which have a descendant that matches the given\n * selector. Equivalent to `.filter(':has(selector)')`.\n *\n * @category Traversing\n * @example <caption>Selector</caption>\n *\n * ```js\n * $('ul').has('.pear').attr('id');\n * //=> fruits\n * ```\n *\n * @example <caption>Element</caption>\n *\n * ```js\n * $('ul').has($('.pear')[0]).attr('id');\n * //=> fruits\n * ```\n *\n * @param selectorOrHaystack - Element to look for.\n * @returns The filtered collection.\n * @see {@link https://api.jquery.com/has/}\n */\nexport function has(selectorOrHaystack) {\n    return this.filter(typeof selectorOrHaystack === 'string'\n        ? // Using the `:has` selector here short-circuits searches.\n            `:has(${selectorOrHaystack})`\n        : (_, el) => this._make(el).find(selectorOrHaystack).length > 0);\n}\n/**\n * Will select the first element of a cheerio object.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('#fruits').children().first().text();\n * //=> Apple\n * ```\n *\n * @returns The first element.\n * @see {@link https://api.jquery.com/first/}\n */\nexport function first() {\n    return this.length > 1 ? this._make(this[0]) : this;\n}\n/**\n * Will select the last element of a cheerio object.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('#fruits').children().last().text();\n * //=> Pear\n * ```\n *\n * @returns The last element.\n * @see {@link https://api.jquery.com/last/}\n */\nexport function last() {\n    return this.length > 0 ? this._make(this[this.length - 1]) : this;\n}\n/**\n * Reduce the set of matched elements to the one at the specified index. Use\n * `.eq(-i)` to count backwards from the last selected element.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('li').eq(0).text();\n * //=> Apple\n *\n * $('li').eq(-1).text();\n * //=> Pear\n * ```\n *\n * @param i - Index of the element to select.\n * @returns The element at the `i`th position.\n * @see {@link https://api.jquery.com/eq/}\n */\nexport function eq(i) {\n    var _a;\n    i = +i;\n    // Use the first identity optimization if possible\n    if (i === 0 && this.length <= 1)\n        return this;\n    if (i < 0)\n        i = this.length + i;\n    return this._make((_a = this[i]) !== null && _a !== void 0 ? _a : []);\n}\nexport function get(i) {\n    if (i == null) {\n        return this.toArray();\n    }\n    return this[i < 0 ? this.length + i : i];\n}\n/**\n * Retrieve all the DOM elements contained in the jQuery set as an array.\n *\n * @example\n *\n * ```js\n * $('li').toArray();\n * //=> [ {...}, {...}, {...} ]\n * ```\n *\n * @returns The contained items.\n */\nexport function toArray() {\n    return Array.prototype.slice.call(this);\n}\n/**\n * Search for a given element from among the matched elements.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.pear').index();\n * //=> 2 $('.orange').index('li');\n * //=> 1\n * $('.apple').index($('#fruit, li'));\n * //=> 1\n * ```\n *\n * @param selectorOrNeedle - Element to look for.\n * @returns The index of the element.\n * @see {@link https://api.jquery.com/index/}\n */\nexport function index(selectorOrNeedle) {\n    let $haystack;\n    let needle;\n    if (selectorOrNeedle == null) {\n        $haystack = this.parent().children();\n        needle = this[0];\n    }\n    else if (typeof selectorOrNeedle === 'string') {\n        $haystack = this._make(selectorOrNeedle);\n        needle = this[0];\n    }\n    else {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias, unicorn/no-this-assignment\n        $haystack = this;\n        needle = isCheerio(selectorOrNeedle)\n            ? selectorOrNeedle[0]\n            : selectorOrNeedle;\n    }\n    return Array.prototype.indexOf.call($haystack, needle);\n}\n/**\n * Gets the elements matching the specified range (0-based position).\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('li').slice(1).eq(0).text();\n * //=> 'Orange'\n *\n * $('li').slice(1, 2).length;\n * //=> 1\n * ```\n *\n * @param start - A position at which the elements begin to be selected. If\n *   negative, it indicates an offset from the end of the set.\n * @param end - A position at which the elements stop being selected. If\n *   negative, it indicates an offset from the end of the set. If omitted, the\n *   range continues until the end of the set.\n * @returns The elements matching the specified range.\n * @see {@link https://api.jquery.com/slice/}\n */\nexport function slice(start, end) {\n    return this._make(Array.prototype.slice.call(this, start, end));\n}\n/**\n * End the most recent filtering operation in the current chain and return the\n * set of matched elements to its previous state.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('li').eq(0).end().length;\n * //=> 3\n * ```\n *\n * @returns The previous state of the set of matched elements.\n * @see {@link https://api.jquery.com/end/}\n */\nexport function end() {\n    var _a;\n    return (_a = this.prevObject) !== null && _a !== void 0 ? _a : this._make([]);\n}\n/**\n * Add elements to the set of matched elements.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('.apple').add('.orange').length;\n * //=> 2\n * ```\n *\n * @param other - Elements to add.\n * @param context - Optionally the context of the new selection.\n * @returns The combined set.\n * @see {@link https://api.jquery.com/add/}\n */\nexport function add(other, context) {\n    const selection = this._make(other, context);\n    const contents = uniqueSort([...this.get(), ...selection.get()]);\n    return this._make(contents);\n}\n/**\n * Add the previous set of elements on the stack to the current set, optionally\n * filtered by a selector.\n *\n * @category Traversing\n * @example\n *\n * ```js\n * $('li').eq(0).addBack('.orange').length;\n * //=> 2\n * ```\n *\n * @param selector - Selector for the elements to add.\n * @returns The combined set.\n * @see {@link https://api.jquery.com/addBack/}\n */\nexport function addBack(selector) {\n    return this.prevObject\n        ? this.add(selector ? this.prevObject.filter(selector) : this.prevObject)\n        : this;\n}\n//# sourceMappingURL=traversing.js.map","import { removeElement } from 'domutils';\nimport { Document, isDocument as checkIsDocument, } from 'domhandler';\n/**\n * Get the parse function with options.\n *\n * @param parser - The parser function.\n * @returns The parse function with options.\n */\nexport function getParse(parser) {\n    /**\n     * Parse a HTML string or a node.\n     *\n     * @param content - The HTML string or node.\n     * @param options - The parser options.\n     * @param isDocument - If `content` is a document.\n     * @param context - The context node in the DOM tree.\n     * @returns The parsed document node.\n     */\n    return function parse(content, options, isDocument, context) {\n        if (typeof Buffer !== 'undefined' && Buffer.isBuffer(content)) {\n            content = content.toString();\n        }\n        if (typeof content === 'string') {\n            return parser(content, options, isDocument, context);\n        }\n        const doc = content;\n        if (!Array.isArray(doc) && checkIsDocument(doc)) {\n            // If `doc` is already a root, just return it\n            return doc;\n        }\n        // Add conent to new root element\n        const root = new Document([]);\n        // Update the DOM using the root\n        update(doc, root);\n        return root;\n    };\n}\n/**\n * Update the dom structure, for one changed layer.\n *\n * @param newChilds - The new children.\n * @param parent - The new parent.\n * @returns The parent node.\n */\nexport function update(newChilds, parent) {\n    // Normalize\n    const arr = Array.isArray(newChilds) ? newChilds : [newChilds];\n    // Update parent\n    if (parent) {\n        parent.children = arr;\n    }\n    else {\n        parent = null;\n    }\n    // Update neighbors\n    for (let i = 0; i < arr.length; i++) {\n        const node = arr[i];\n        // Cleanly remove existing nodes from their previous structures.\n        if (node.parent && node.parent.children !== arr) {\n            removeElement(node);\n        }\n        if (parent) {\n            node.prev = arr[i - 1] || null;\n            node.next = arr[i + 1] || null;\n        }\n        else {\n            node.prev = node.next = null;\n        }\n        node.parent = parent;\n    }\n    return parent;\n}\n//# sourceMappingURL=parse.js.map","/**\n * Methods for modifying the DOM structure.\n *\n * @module cheerio/manipulation\n */\nimport { isTag, Text, hasChildren, cloneNode, Document, } from 'domhandler';\nimport { update as updateDOM } from '../parse.js';\nimport { text as staticText } from '../static.js';\nimport { domEach, isHtml, isCheerio } from '../utils.js';\nimport { removeElement } from 'domutils';\nimport { ElementType } from 'htmlparser2';\n/**\n * Create an array of nodes, recursing into arrays and parsing strings if\n * necessary.\n *\n * @private\n * @category Manipulation\n * @param elem - Elements to make an array of.\n * @param clone - Optionally clone nodes.\n * @returns The array of nodes.\n */\nexport function _makeDomArray(elem, clone) {\n    if (elem == null) {\n        return [];\n    }\n    if (typeof elem === 'string') {\n        return this._parse(elem, this.options, false, null).children.slice(0);\n    }\n    if ('length' in elem) {\n        if (elem.length === 1) {\n            return this._makeDomArray(elem[0], clone);\n        }\n        const result = [];\n        for (let i = 0; i < elem.length; i++) {\n            const el = elem[i];\n            if (typeof el === 'object') {\n                if (el == null) {\n                    continue;\n                }\n                if (!('length' in el)) {\n                    result.push(clone ? cloneNode(el, true) : el);\n                    continue;\n                }\n            }\n            result.push(...this._makeDomArray(el, clone));\n        }\n        return result;\n    }\n    return [clone ? cloneNode(elem, true) : elem];\n}\nfunction _insert(concatenator) {\n    return function (...elems) {\n        const lastIdx = this.length - 1;\n        return domEach(this, (el, i) => {\n            if (!hasChildren(el))\n                return;\n            const domSrc = typeof elems[0] === 'function'\n                ? elems[0].call(el, i, this._render(el.children))\n                : elems;\n            const dom = this._makeDomArray(domSrc, i < lastIdx);\n            concatenator(dom, el.children, el);\n        });\n    };\n}\n/**\n * Modify an array in-place, removing some number of elements and adding new\n * elements directly following them.\n *\n * @private\n * @category Manipulation\n * @param array - Target array to splice.\n * @param spliceIdx - Index at which to begin changing the array.\n * @param spliceCount - Number of elements to remove from the array.\n * @param newElems - Elements to insert into the array.\n * @param parent - The parent of the node.\n * @returns The spliced array.\n */\nfunction uniqueSplice(array, spliceIdx, spliceCount, newElems, parent) {\n    var _a, _b;\n    const spliceArgs = [\n        spliceIdx,\n        spliceCount,\n        ...newElems,\n    ];\n    const prev = spliceIdx === 0 ? null : array[spliceIdx - 1];\n    const next = spliceIdx + spliceCount >= array.length\n        ? null\n        : array[spliceIdx + spliceCount];\n    /*\n     * Before splicing in new elements, ensure they do not already appear in the\n     * current array.\n     */\n    for (let idx = 0; idx < newElems.length; ++idx) {\n        const node = newElems[idx];\n        const oldParent = node.parent;\n        if (oldParent) {\n            const oldSiblings = oldParent.children;\n            const prevIdx = oldSiblings.indexOf(node);\n            if (prevIdx !== -1) {\n                oldParent.children.splice(prevIdx, 1);\n                if (parent === oldParent && spliceIdx > prevIdx) {\n                    spliceArgs[0]--;\n                }\n            }\n        }\n        node.parent = parent;\n        if (node.prev) {\n            node.prev.next = (_a = node.next) !== null && _a !== void 0 ? _a : null;\n        }\n        if (node.next) {\n            node.next.prev = (_b = node.prev) !== null && _b !== void 0 ? _b : null;\n        }\n        node.prev = idx === 0 ? prev : newElems[idx - 1];\n        node.next = idx === newElems.length - 1 ? next : newElems[idx + 1];\n    }\n    if (prev) {\n        prev.next = newElems[0];\n    }\n    if (next) {\n        next.prev = newElems[newElems.length - 1];\n    }\n    return array.splice(...spliceArgs);\n}\n/**\n * Insert every element in the set of matched elements to the end of the target.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('<li class=\"plum\">Plum</li>').appendTo('#fruits');\n * $.html();\n * //=>  <ul id=\"fruits\">\n * //      <li class=\"apple\">Apple</li>\n * //      <li class=\"orange\">Orange</li>\n * //      <li class=\"pear\">Pear</li>\n * //      <li class=\"plum\">Plum</li>\n * //    </ul>\n * ```\n *\n * @param target - Element to append elements to.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/appendTo/}\n */\nexport function appendTo(target) {\n    const appendTarget = isCheerio(target) ? target : this._make(target);\n    appendTarget.append(this);\n    return this;\n}\n/**\n * Insert every element in the set of matched elements to the beginning of the\n * target.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('<li class=\"plum\">Plum</li>').prependTo('#fruits');\n * $.html();\n * //=>  <ul id=\"fruits\">\n * //      <li class=\"plum\">Plum</li>\n * //      <li class=\"apple\">Apple</li>\n * //      <li class=\"orange\">Orange</li>\n * //      <li class=\"pear\">Pear</li>\n * //    </ul>\n * ```\n *\n * @param target - Element to prepend elements to.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/prependTo/}\n */\nexport function prependTo(target) {\n    const prependTarget = isCheerio(target) ? target : this._make(target);\n    prependTarget.prepend(this);\n    return this;\n}\n/**\n * Inserts content as the _last_ child of each of the selected elements.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('ul').append('<li class=\"plum\">Plum</li>');\n * $.html();\n * //=>  <ul id=\"fruits\">\n * //      <li class=\"apple\">Apple</li>\n * //      <li class=\"orange\">Orange</li>\n * //      <li class=\"pear\">Pear</li>\n * //      <li class=\"plum\">Plum</li>\n * //    </ul>\n * ```\n *\n * @see {@link https://api.jquery.com/append/}\n */\nexport const append = _insert((dom, children, parent) => {\n    uniqueSplice(children, children.length, 0, dom, parent);\n});\n/**\n * Inserts content as the _first_ child of each of the selected elements.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('ul').prepend('<li class=\"plum\">Plum</li>');\n * $.html();\n * //=>  <ul id=\"fruits\">\n * //      <li class=\"plum\">Plum</li>\n * //      <li class=\"apple\">Apple</li>\n * //      <li class=\"orange\">Orange</li>\n * //      <li class=\"pear\">Pear</li>\n * //    </ul>\n * ```\n *\n * @see {@link https://api.jquery.com/prepend/}\n */\nexport const prepend = _insert((dom, children, parent) => {\n    uniqueSplice(children, 0, 0, dom, parent);\n});\nfunction _wrap(insert) {\n    return function (wrapper) {\n        const lastIdx = this.length - 1;\n        const lastParent = this.parents().last();\n        for (let i = 0; i < this.length; i++) {\n            const el = this[i];\n            const wrap = typeof wrapper === 'function'\n                ? wrapper.call(el, i, el)\n                : typeof wrapper === 'string' && !isHtml(wrapper)\n                    ? lastParent.find(wrapper).clone()\n                    : wrapper;\n            const [wrapperDom] = this._makeDomArray(wrap, i < lastIdx);\n            if (!wrapperDom || !hasChildren(wrapperDom))\n                continue;\n            let elInsertLocation = wrapperDom;\n            /*\n             * Find the deepest child. Only consider the first tag child of each node\n             * (ignore text); stop if no children are found.\n             */\n            let j = 0;\n            while (j < elInsertLocation.children.length) {\n                const child = elInsertLocation.children[j];\n                if (isTag(child)) {\n                    elInsertLocation = child;\n                    j = 0;\n                }\n                else {\n                    j++;\n                }\n            }\n            insert(el, elInsertLocation, [wrapperDom]);\n        }\n        return this;\n    };\n}\n/**\n * The .wrap() function can take any string or object that could be passed to\n * the $() factory function to specify a DOM structure. This structure may be\n * nested several levels deep, but should contain only one inmost element. A\n * copy of this structure will be wrapped around each of the elements in the set\n * of matched elements. This method returns the original set of elements for\n * chaining purposes.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * const redFruit = $('<div class=\"red-fruit\"></div>');\n * $('.apple').wrap(redFruit);\n *\n * //=> <ul id=\"fruits\">\n * //     <div class=\"red-fruit\">\n * //      <li class=\"apple\">Apple</li>\n * //     </div>\n * //     <li class=\"orange\">Orange</li>\n * //     <li class=\"plum\">Plum</li>\n * //   </ul>\n *\n * const healthy = $('<div class=\"healthy\"></div>');\n * $('li').wrap(healthy);\n *\n * //=> <ul id=\"fruits\">\n * //     <div class=\"healthy\">\n * //       <li class=\"apple\">Apple</li>\n * //     </div>\n * //     <div class=\"healthy\">\n * //       <li class=\"orange\">Orange</li>\n * //     </div>\n * //     <div class=\"healthy\">\n * //        <li class=\"plum\">Plum</li>\n * //     </div>\n * //   </ul>\n * ```\n *\n * @param wrapper - The DOM structure to wrap around each element in the\n *   selection.\n * @see {@link https://api.jquery.com/wrap/}\n */\nexport const wrap = _wrap((el, elInsertLocation, wrapperDom) => {\n    const { parent } = el;\n    if (!parent)\n        return;\n    const siblings = parent.children;\n    const index = siblings.indexOf(el);\n    updateDOM([el], elInsertLocation);\n    /*\n     * The previous operation removed the current element from the `siblings`\n     * array, so the `dom` array can be inserted without removing any\n     * additional elements.\n     */\n    uniqueSplice(siblings, index, 0, wrapperDom, parent);\n});\n/**\n * The .wrapInner() function can take any string or object that could be passed\n * to the $() factory function to specify a DOM structure. This structure may be\n * nested several levels deep, but should contain only one inmost element. The\n * structure will be wrapped around the content of each of the elements in the\n * set of matched elements.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * const redFruit = $('<div class=\"red-fruit\"></div>');\n * $('.apple').wrapInner(redFruit);\n *\n * //=> <ul id=\"fruits\">\n * //     <li class=\"apple\">\n * //       <div class=\"red-fruit\">Apple</div>\n * //     </li>\n * //     <li class=\"orange\">Orange</li>\n * //     <li class=\"pear\">Pear</li>\n * //   </ul>\n *\n * const healthy = $('<div class=\"healthy\"></div>');\n * $('li').wrapInner(healthy);\n *\n * //=> <ul id=\"fruits\">\n * //     <li class=\"apple\">\n * //       <div class=\"healthy\">Apple</div>\n * //     </li>\n * //     <li class=\"orange\">\n * //       <div class=\"healthy\">Orange</div>\n * //     </li>\n * //     <li class=\"pear\">\n * //       <div class=\"healthy\">Pear</div>\n * //     </li>\n * //   </ul>\n * ```\n *\n * @param wrapper - The DOM structure to wrap around the content of each element\n *   in the selection.\n * @returns The instance itself, for chaining.\n * @see {@link https://api.jquery.com/wrapInner/}\n */\nexport const wrapInner = _wrap((el, elInsertLocation, wrapperDom) => {\n    if (!hasChildren(el))\n        return;\n    updateDOM(el.children, elInsertLocation);\n    updateDOM(wrapperDom, el);\n});\n/**\n * The .unwrap() function, removes the parents of the set of matched elements\n * from the DOM, leaving the matched elements in their place.\n *\n * @category Manipulation\n * @example <caption>without selector</caption>\n *\n * ```js\n * const $ = cheerio.load(\n *   '<div id=test>\\n  <div><p>Hello</p></div>\\n  <div><p>World</p></div>\\n</div>',\n * );\n * $('#test p').unwrap();\n *\n * //=> <div id=test>\n * //     <p>Hello</p>\n * //     <p>World</p>\n * //   </div>\n * ```\n *\n * @example <caption>with selector</caption>\n *\n * ```js\n * const $ = cheerio.load(\n *   '<div id=test>\\n  <p>Hello</p>\\n  <b><p>World</p></b>\\n</div>',\n * );\n * $('#test p').unwrap('b');\n *\n * //=> <div id=test>\n * //     <p>Hello</p>\n * //     <p>World</p>\n * //   </div>\n * ```\n *\n * @param selector - A selector to check the parent element against. If an\n *   element's parent does not match the selector, the element won't be\n *   unwrapped.\n * @returns The instance itself, for chaining.\n * @see {@link https://api.jquery.com/unwrap/}\n */\nexport function unwrap(selector) {\n    this.parent(selector)\n        .not('body')\n        .each((_, el) => {\n        this._make(el).replaceWith(el.children);\n    });\n    return this;\n}\n/**\n * The .wrapAll() function can take any string or object that could be passed to\n * the $() function to specify a DOM structure. This structure may be nested\n * several levels deep, but should contain only one inmost element. The\n * structure will be wrapped around all of the elements in the set of matched\n * elements, as a single group.\n *\n * @category Manipulation\n * @example <caption>With markup passed to `wrapAll`</caption>\n *\n * ```js\n * const $ = cheerio.load(\n *   '<div class=\"container\"><div class=\"inner\">First</div><div class=\"inner\">Second</div></div>',\n * );\n * $('.inner').wrapAll(\"<div class='new'></div>\");\n *\n * //=> <div class=\"container\">\n * //     <div class='new'>\n * //       <div class=\"inner\">First</div>\n * //       <div class=\"inner\">Second</div>\n * //     </div>\n * //   </div>\n * ```\n *\n * @example <caption>With an existing cheerio instance</caption>\n *\n * ```js\n * const $ = cheerio.load(\n *   '<span>Span 1</span><strong>Strong</strong><span>Span 2</span>',\n * );\n * const wrap = $('<div><p><em><b></b></em></p></div>');\n * $('span').wrapAll(wrap);\n *\n * //=> <div>\n * //     <p>\n * //       <em>\n * //         <b>\n * //           <span>Span 1</span>\n * //           <span>Span 2</span>\n * //         </b>\n * //       </em>\n * //     </p>\n * //   </div>\n * //   <strong>Strong</strong>\n * ```\n *\n * @param wrapper - The DOM structure to wrap around all matched elements in the\n *   selection.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/wrapAll/}\n */\nexport function wrapAll(wrapper) {\n    const el = this[0];\n    if (el) {\n        const wrap = this._make(typeof wrapper === 'function' ? wrapper.call(el, 0, el) : wrapper).insertBefore(el);\n        // If html is given as wrapper, wrap may contain text elements\n        let elInsertLocation;\n        for (let i = 0; i < wrap.length; i++) {\n            if (wrap[i].type === ElementType.Tag) {\n                elInsertLocation = wrap[i];\n            }\n        }\n        let j = 0;\n        /*\n         * Find the deepest child. Only consider the first tag child of each node\n         * (ignore text); stop if no children are found.\n         */\n        while (elInsertLocation && j < elInsertLocation.children.length) {\n            const child = elInsertLocation.children[j];\n            if (child.type === ElementType.Tag) {\n                elInsertLocation = child;\n                j = 0;\n            }\n            else {\n                j++;\n            }\n        }\n        if (elInsertLocation)\n            this._make(elInsertLocation).append(this);\n    }\n    return this;\n}\n/**\n * Insert content next to each element in the set of matched elements.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('.apple').after('<li class=\"plum\">Plum</li>');\n * $.html();\n * //=>  <ul id=\"fruits\">\n * //      <li class=\"apple\">Apple</li>\n * //      <li class=\"plum\">Plum</li>\n * //      <li class=\"orange\">Orange</li>\n * //      <li class=\"pear\">Pear</li>\n * //    </ul>\n * ```\n *\n * @param elems - HTML string, DOM element, array of DOM elements or Cheerio to\n *   insert after each element in the set of matched elements.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/after/}\n */\nexport function after(...elems) {\n    const lastIdx = this.length - 1;\n    return domEach(this, (el, i) => {\n        if (!hasChildren(el) || !el.parent) {\n            return;\n        }\n        const siblings = el.parent.children;\n        const index = siblings.indexOf(el);\n        // If not found, move on\n        /* istanbul ignore next */\n        if (index === -1)\n            return;\n        const domSrc = typeof elems[0] === 'function'\n            ? elems[0].call(el, i, this._render(el.children))\n            : elems;\n        const dom = this._makeDomArray(domSrc, i < lastIdx);\n        // Add element after `this` element\n        uniqueSplice(siblings, index + 1, 0, dom, el.parent);\n    });\n}\n/**\n * Insert every element in the set of matched elements after the target.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('<li class=\"plum\">Plum</li>').insertAfter('.apple');\n * $.html();\n * //=>  <ul id=\"fruits\">\n * //      <li class=\"apple\">Apple</li>\n * //      <li class=\"plum\">Plum</li>\n * //      <li class=\"orange\">Orange</li>\n * //      <li class=\"pear\">Pear</li>\n * //    </ul>\n * ```\n *\n * @param target - Element to insert elements after.\n * @returns The set of newly inserted elements.\n * @see {@link https://api.jquery.com/insertAfter/}\n */\nexport function insertAfter(target) {\n    if (typeof target === 'string') {\n        target = this._make(target);\n    }\n    this.remove();\n    const clones = [];\n    for (const el of this._makeDomArray(target)) {\n        const clonedSelf = this.clone().toArray();\n        const { parent } = el;\n        if (!parent) {\n            continue;\n        }\n        const siblings = parent.children;\n        const index = siblings.indexOf(el);\n        // If not found, move on\n        /* istanbul ignore next */\n        if (index === -1)\n            continue;\n        // Add cloned `this` element(s) after target element\n        uniqueSplice(siblings, index + 1, 0, clonedSelf, parent);\n        clones.push(...clonedSelf);\n    }\n    return this._make(clones);\n}\n/**\n * Insert content previous to each element in the set of matched elements.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('.apple').before('<li class=\"plum\">Plum</li>');\n * $.html();\n * //=>  <ul id=\"fruits\">\n * //      <li class=\"plum\">Plum</li>\n * //      <li class=\"apple\">Apple</li>\n * //      <li class=\"orange\">Orange</li>\n * //      <li class=\"pear\">Pear</li>\n * //    </ul>\n * ```\n *\n * @param elems - HTML string, DOM element, array of DOM elements or Cheerio to\n *   insert before each element in the set of matched elements.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/before/}\n */\nexport function before(...elems) {\n    const lastIdx = this.length - 1;\n    return domEach(this, (el, i) => {\n        if (!hasChildren(el) || !el.parent) {\n            return;\n        }\n        const siblings = el.parent.children;\n        const index = siblings.indexOf(el);\n        // If not found, move on\n        /* istanbul ignore next */\n        if (index === -1)\n            return;\n        const domSrc = typeof elems[0] === 'function'\n            ? elems[0].call(el, i, this._render(el.children))\n            : elems;\n        const dom = this._makeDomArray(domSrc, i < lastIdx);\n        // Add element before `el` element\n        uniqueSplice(siblings, index, 0, dom, el.parent);\n    });\n}\n/**\n * Insert every element in the set of matched elements before the target.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('<li class=\"plum\">Plum</li>').insertBefore('.apple');\n * $.html();\n * //=>  <ul id=\"fruits\">\n * //      <li class=\"plum\">Plum</li>\n * //      <li class=\"apple\">Apple</li>\n * //      <li class=\"orange\">Orange</li>\n * //      <li class=\"pear\">Pear</li>\n * //    </ul>\n * ```\n *\n * @param target - Element to insert elements before.\n * @returns The set of newly inserted elements.\n * @see {@link https://api.jquery.com/insertBefore/}\n */\nexport function insertBefore(target) {\n    const targetArr = this._make(target);\n    this.remove();\n    const clones = [];\n    domEach(targetArr, (el) => {\n        const clonedSelf = this.clone().toArray();\n        const { parent } = el;\n        if (!parent) {\n            return;\n        }\n        const siblings = parent.children;\n        const index = siblings.indexOf(el);\n        // If not found, move on\n        /* istanbul ignore next */\n        if (index === -1)\n            return;\n        // Add cloned `this` element(s) after target element\n        uniqueSplice(siblings, index, 0, clonedSelf, parent);\n        clones.push(...clonedSelf);\n    });\n    return this._make(clones);\n}\n/**\n * Removes the set of matched elements from the DOM and all their children.\n * `selector` filters the set of matched elements to be removed.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('.pear').remove();\n * $.html();\n * //=>  <ul id=\"fruits\">\n * //      <li class=\"apple\">Apple</li>\n * //      <li class=\"orange\">Orange</li>\n * //    </ul>\n * ```\n *\n * @param selector - Optional selector for elements to remove.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/remove/}\n */\nexport function remove(selector) {\n    // Filter if we have selector\n    const elems = selector ? this.filter(selector) : this;\n    domEach(elems, (el) => {\n        removeElement(el);\n        el.prev = el.next = el.parent = null;\n    });\n    return this;\n}\n/**\n * Replaces matched elements with `content`.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * const plum = $('<li class=\"plum\">Plum</li>');\n * $('.pear').replaceWith(plum);\n * $.html();\n * //=> <ul id=\"fruits\">\n * //     <li class=\"apple\">Apple</li>\n * //     <li class=\"orange\">Orange</li>\n * //     <li class=\"plum\">Plum</li>\n * //   </ul>\n * ```\n *\n * @param content - Replacement for matched elements.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/replaceWith/}\n */\nexport function replaceWith(content) {\n    return domEach(this, (el, i) => {\n        const { parent } = el;\n        if (!parent) {\n            return;\n        }\n        const siblings = parent.children;\n        const cont = typeof content === 'function' ? content.call(el, i, el) : content;\n        const dom = this._makeDomArray(cont);\n        /*\n         * In the case that `dom` contains nodes that already exist in other\n         * structures, ensure those nodes are properly removed.\n         */\n        updateDOM(dom, null);\n        const index = siblings.indexOf(el);\n        // Completely remove old element\n        uniqueSplice(siblings, index, 1, dom, parent);\n        if (!dom.includes(el)) {\n            el.parent = el.prev = el.next = null;\n        }\n    });\n}\n/**\n * Removes all children from each item in the selection. Text nodes and comment\n * nodes are left as is.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * $('ul').empty();\n * $.html();\n * //=>  <ul id=\"fruits\"></ul>\n * ```\n *\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/empty/}\n */\nexport function empty() {\n    return domEach(this, (el) => {\n        if (!hasChildren(el))\n            return;\n        for (const child of el.children) {\n            child.next = child.prev = child.parent = null;\n        }\n        el.children.length = 0;\n    });\n}\nexport function html(str) {\n    if (str === undefined) {\n        const el = this[0];\n        if (!el || !hasChildren(el))\n            return null;\n        return this._render(el.children);\n    }\n    return domEach(this, (el) => {\n        if (!hasChildren(el))\n            return;\n        for (const child of el.children) {\n            child.next = child.prev = child.parent = null;\n        }\n        const content = isCheerio(str)\n            ? str.toArray()\n            : this._parse(`${str}`, this.options, false, el).children;\n        updateDOM(content, el);\n    });\n}\n/**\n * Turns the collection to a string. Alias for `.html()`.\n *\n * @category Manipulation\n * @returns The rendered document.\n */\nexport function toString() {\n    return this._render(this);\n}\nexport function text(str) {\n    // If `str` is undefined, act as a \"getter\"\n    if (str === undefined) {\n        return staticText(this);\n    }\n    if (typeof str === 'function') {\n        // Function support\n        return domEach(this, (el, i) => this._make(el).text(str.call(el, i, staticText([el]))));\n    }\n    // Append text node to each selected elements\n    return domEach(this, (el) => {\n        if (!hasChildren(el))\n            return;\n        for (const child of el.children) {\n            child.next = child.prev = child.parent = null;\n        }\n        const textNode = new Text(`${str}`);\n        updateDOM(textNode, el);\n    });\n}\n/**\n * Clone the cheerio object.\n *\n * @category Manipulation\n * @example\n *\n * ```js\n * const moreFruit = $('#fruits').clone();\n * ```\n *\n * @returns The cloned object.\n * @see {@link https://api.jquery.com/clone/}\n */\nexport function clone() {\n    const clone = Array.prototype.map.call(this.get(), (el) => cloneNode(el, true));\n    // Add a root node around the cloned nodes\n    const root = new Document(clone);\n    for (const node of clone) {\n        node.parent = root;\n    }\n    return this._make(clone);\n}\n//# sourceMappingURL=manipulation.js.map","import { domEach } from '../utils.js';\nimport { isTag } from 'domhandler';\n/**\n * Set multiple CSS properties for every matched element.\n *\n * @category CSS\n * @param prop - The names of the properties.\n * @param val - The new values.\n * @returns The instance itself.\n * @see {@link https://api.jquery.com/css/}\n */\nexport function css(prop, val) {\n    if ((prop != null && val != null) ||\n        // When `prop` is a \"plain\" object\n        (typeof prop === 'object' && !Array.isArray(prop))) {\n        return domEach(this, (el, i) => {\n            if (isTag(el)) {\n                // `prop` can't be an array here anymore.\n                setCss(el, prop, val, i);\n            }\n        });\n    }\n    if (this.length === 0) {\n        return undefined;\n    }\n    return getCss(this[0], prop);\n}\n/**\n * Set styles of all elements.\n *\n * @private\n * @param el - Element to set style of.\n * @param prop - Name of property.\n * @param value - Value to set property to.\n * @param idx - Optional index within the selection.\n */\nfunction setCss(el, prop, value, idx) {\n    if (typeof prop === 'string') {\n        const styles = getCss(el);\n        const val = typeof value === 'function' ? value.call(el, idx, styles[prop]) : value;\n        if (val === '') {\n            delete styles[prop];\n        }\n        else if (val != null) {\n            styles[prop] = val;\n        }\n        el.attribs['style'] = stringify(styles);\n    }\n    else if (typeof prop === 'object') {\n        const keys = Object.keys(prop);\n        for (let i = 0; i < keys.length; i++) {\n            const k = keys[i];\n            setCss(el, k, prop[k], i);\n        }\n    }\n}\nfunction getCss(el, prop) {\n    if (!el || !isTag(el))\n        return;\n    const styles = parse(el.attribs['style']);\n    if (typeof prop === 'string') {\n        return styles[prop];\n    }\n    if (Array.isArray(prop)) {\n        const newStyles = {};\n        for (const item of prop) {\n            if (styles[item] != null) {\n                newStyles[item] = styles[item];\n            }\n        }\n        return newStyles;\n    }\n    return styles;\n}\n/**\n * Stringify `obj` to styles.\n *\n * @private\n * @category CSS\n * @param obj - Object to stringify.\n * @returns The serialized styles.\n */\nfunction stringify(obj) {\n    return Object.keys(obj).reduce((str, prop) => `${str}${str ? ' ' : ''}${prop}: ${obj[prop]};`, '');\n}\n/**\n * Parse `styles`.\n *\n * @private\n * @category CSS\n * @param styles - Styles to be parsed.\n * @returns The parsed styles.\n */\nfunction parse(styles) {\n    styles = (styles || '').trim();\n    if (!styles)\n        return {};\n    const obj = {};\n    let key;\n    for (const str of styles.split(';')) {\n        const n = str.indexOf(':');\n        // If there is no :, or if it is the first/last character, add to the previous item's value\n        if (n < 1 || n === str.length - 1) {\n            const trimmed = str.trimEnd();\n            if (trimmed.length > 0 && key !== undefined) {\n                obj[key] += `;${trimmed}`;\n            }\n        }\n        else {\n            key = str.slice(0, n).trim();\n            obj[key] = str.slice(n + 1).trim();\n        }\n    }\n    return obj;\n}\n//# sourceMappingURL=css.js.map","import { isTag } from 'domhandler';\n/*\n * https://github.com/jquery/jquery/blob/2.1.3/src/manipulation/var/rcheckableType.js\n * https://github.com/jquery/jquery/blob/2.1.3/src/serialize.js\n */\nconst submittableSelector = 'input,select,textarea,keygen';\nconst r20 = /%20/g;\nconst rCRLF = /\\r?\\n/g;\n/**\n * Encode a set of form elements as a string for submission.\n *\n * @category Forms\n * @example\n *\n * ```js\n * $('<form><input name=\"foo\" value=\"bar\" /></form>').serialize();\n * //=> 'foo=bar'\n * ```\n *\n * @returns The serialized form.\n * @see {@link https://api.jquery.com/serialize/}\n */\nexport function serialize() {\n    // Convert form elements into name/value objects\n    const arr = this.serializeArray();\n    // Serialize each element into a key/value string\n    const retArr = arr.map((data) => `${encodeURIComponent(data.name)}=${encodeURIComponent(data.value)}`);\n    // Return the resulting serialization\n    return retArr.join('&').replace(r20, '+');\n}\n/**\n * Encode a set of form elements as an array of names and values.\n *\n * @category Forms\n * @example\n *\n * ```js\n * $('<form><input name=\"foo\" value=\"bar\" /></form>').serializeArray();\n * //=> [ { name: 'foo', value: 'bar' } ]\n * ```\n *\n * @returns The serialized form.\n * @see {@link https://api.jquery.com/serializeArray/}\n */\nexport function serializeArray() {\n    // Resolve all form elements from either forms or collections of form elements\n    return this.map((_, elem) => {\n        const $elem = this._make(elem);\n        if (isTag(elem) && elem.name === 'form') {\n            return $elem.find(submittableSelector).toArray();\n        }\n        return $elem.filter(submittableSelector).toArray();\n    })\n        .filter(\n    // Verify elements have a name (`attr.name`) and are not disabled (`:enabled`)\n    '[name!=\"\"]:enabled' +\n        // And cannot be clicked (`[type=submit]`) or are used in `x-www-form-urlencoded` (`[type=file]`)\n        ':not(:submit, :button, :image, :reset, :file)' +\n        // And are either checked/don't have a checkable state\n        ':matches([checked], :not(:checkbox, :radio))')\n        .map((_, elem) => {\n        var _a;\n        const $elem = this._make(elem);\n        const name = $elem.attr('name'); // We have filtered for elements with a name before.\n        // If there is no value set (e.g. `undefined`, `null`), then default value to empty\n        const value = (_a = $elem.val()) !== null && _a !== void 0 ? _a : '';\n        // If we have an array of values (e.g. `<select multiple>`), return an array of key/value pairs\n        if (Array.isArray(value)) {\n            return value.map((val) => \n            /*\n             * We trim replace any line endings (e.g. `\\r` or `\\r\\n` with `\\r\\n`) to guarantee consistency across platforms\n             * These can occur inside of `<textarea>'s`\n             */\n            ({ name, value: val.replace(rCRLF, '\\r\\n') }));\n        }\n        // Otherwise (e.g. `<input type=\"text\">`, return only one key/value pair\n        return { name, value: value.replace(rCRLF, '\\r\\n') };\n    })\n        .toArray();\n}\n//# sourceMappingURL=forms.js.map","function getExtractDescr(descr) {\n    var _a;\n    if (typeof descr === 'string') {\n        return { selector: descr, value: 'textContent' };\n    }\n    return {\n        selector: descr.selector,\n        value: (_a = descr.value) !== null && _a !== void 0 ? _a : 'textContent',\n    };\n}\n/**\n * Extract multiple values from a document, and store them in an object.\n *\n * @param map - An object containing key-value pairs. The keys are the names of\n *   the properties to be created on the object, and the values are the\n *   selectors to be used to extract the values.\n * @returns An object containing the extracted values.\n */\nexport function extract(map) {\n    const ret = {};\n    for (const key in map) {\n        const descr = map[key];\n        const isArray = Array.isArray(descr);\n        const { selector, value } = getExtractDescr(isArray ? descr[0] : descr);\n        const fn = typeof value === 'function'\n            ? value\n            : typeof value === 'string'\n                ? (el) => this._make(el).prop(value)\n                : (el) => this._make(el).extract(value);\n        if (isArray) {\n            ret[key] = this._findBySelector(selector, Number.POSITIVE_INFINITY)\n                .map((_, el) => fn(el, key, ret))\n                .get();\n        }\n        else {\n            const $ = this._findBySelector(selector, 1);\n            ret[key] = $.length > 0 ? fn($[0], key, ret) : undefined;\n        }\n    }\n    return ret;\n}\n//# sourceMappingURL=extract.js.map","import * as Attributes from './api/attributes.js';\nimport * as Traversing from './api/traversing.js';\nimport * as Manipulation from './api/manipulation.js';\nimport * as Css from './api/css.js';\nimport * as Forms from './api/forms.js';\nimport * as Extract from './api/extract.js';\n/**\n * The cheerio class is the central class of the library. It wraps a set of\n * elements and provides an API for traversing, modifying, and interacting with\n * the set.\n *\n * Loading a document will return the Cheerio class bound to the root element of\n * the document. The class will be instantiated when querying the document (when\n * calling `$('selector')`).\n *\n * @example This is the HTML markup we will be using in all of the API examples:\n *\n * ```html\n * <ul id=\"fruits\">\n *   <li class=\"apple\">Apple</li>\n *   <li class=\"orange\">Orange</li>\n *   <li class=\"pear\">Pear</li>\n * </ul>\n * ```\n */\nexport class Cheerio {\n    /**\n     * Instance of cheerio. Methods are specified in the modules. Usage of this\n     * constructor is not recommended. Please use `$.load` instead.\n     *\n     * @private\n     * @param elements - The new selection.\n     * @param root - Sets the root node.\n     * @param options - Options for the instance.\n     */\n    constructor(elements, root, options) {\n        this.length = 0;\n        this.options = options;\n        this._root = root;\n        if (elements) {\n            for (let idx = 0; idx < elements.length; idx++) {\n                this[idx] = elements[idx];\n            }\n            this.length = elements.length;\n        }\n    }\n}\n/** Set a signature of the object. */\nCheerio.prototype.cheerio = '[cheerio object]';\n/*\n * Make cheerio an array-like object\n */\nCheerio.prototype.splice = Array.prototype.splice;\n// Support for (const element of $(...)) iteration:\nCheerio.prototype[Symbol.iterator] = Array.prototype[Symbol.iterator];\n// Plug in the API\nObject.assign(Cheerio.prototype, Attributes, Traversing, Manipulation, Css, Forms, Extract);\n//# sourceMappingURL=cheerio.js.map","const UNDEFINED_CODE_POINTS = new Set([\n    65534, 65535, 131070, 131071, 196606, 196607, 262142, 262143, 327678, 327679, 393214,\n    393215, 458750, 458751, 524286, 524287, 589822, 589823, 655358, 655359, 720894,\n    720895, 786430, 786431, 851966, 851967, 917502, 917503, 983038, 983039, 1048574,\n    1048575, 1114110, 1114111,\n]);\nexport const REPLACEMENT_CHARACTER = '\\uFFFD';\nexport var CODE_POINTS;\n(function (CODE_POINTS) {\n    CODE_POINTS[CODE_POINTS[\"EOF\"] = -1] = \"EOF\";\n    CODE_POINTS[CODE_POINTS[\"NULL\"] = 0] = \"NULL\";\n    CODE_POINTS[CODE_POINTS[\"TABULATION\"] = 9] = \"TABULATION\";\n    CODE_POINTS[CODE_POINTS[\"CARRIAGE_RETURN\"] = 13] = \"CARRIAGE_RETURN\";\n    CODE_POINTS[CODE_POINTS[\"LINE_FEED\"] = 10] = \"LINE_FEED\";\n    CODE_POINTS[CODE_POINTS[\"FORM_FEED\"] = 12] = \"FORM_FEED\";\n    CODE_POINTS[CODE_POINTS[\"SPACE\"] = 32] = \"SPACE\";\n    CODE_POINTS[CODE_POINTS[\"EXCLAMATION_MARK\"] = 33] = \"EXCLAMATION_MARK\";\n    CODE_POINTS[CODE_POINTS[\"QUOTATION_MARK\"] = 34] = \"QUOTATION_MARK\";\n    CODE_POINTS[CODE_POINTS[\"AMPERSAND\"] = 38] = \"AMPERSAND\";\n    CODE_POINTS[CODE_POINTS[\"APOSTROPHE\"] = 39] = \"APOSTROPHE\";\n    CODE_POINTS[CODE_POINTS[\"HYPHEN_MINUS\"] = 45] = \"HYPHEN_MINUS\";\n    CODE_POINTS[CODE_POINTS[\"SOLIDUS\"] = 47] = \"SOLIDUS\";\n    CODE_POINTS[CODE_POINTS[\"DIGIT_0\"] = 48] = \"DIGIT_0\";\n    CODE_POINTS[CODE_POINTS[\"DIGIT_9\"] = 57] = \"DIGIT_9\";\n    CODE_POINTS[CODE_POINTS[\"SEMICOLON\"] = 59] = \"SEMICOLON\";\n    CODE_POINTS[CODE_POINTS[\"LESS_THAN_SIGN\"] = 60] = \"LESS_THAN_SIGN\";\n    CODE_POINTS[CODE_POINTS[\"EQUALS_SIGN\"] = 61] = \"EQUALS_SIGN\";\n    CODE_POINTS[CODE_POINTS[\"GREATER_THAN_SIGN\"] = 62] = \"GREATER_THAN_SIGN\";\n    CODE_POINTS[CODE_POINTS[\"QUESTION_MARK\"] = 63] = \"QUESTION_MARK\";\n    CODE_POINTS[CODE_POINTS[\"LATIN_CAPITAL_A\"] = 65] = \"LATIN_CAPITAL_A\";\n    CODE_POINTS[CODE_POINTS[\"LATIN_CAPITAL_Z\"] = 90] = \"LATIN_CAPITAL_Z\";\n    CODE_POINTS[CODE_POINTS[\"RIGHT_SQUARE_BRACKET\"] = 93] = \"RIGHT_SQUARE_BRACKET\";\n    CODE_POINTS[CODE_POINTS[\"GRAVE_ACCENT\"] = 96] = \"GRAVE_ACCENT\";\n    CODE_POINTS[CODE_POINTS[\"LATIN_SMALL_A\"] = 97] = \"LATIN_SMALL_A\";\n    CODE_POINTS[CODE_POINTS[\"LATIN_SMALL_Z\"] = 122] = \"LATIN_SMALL_Z\";\n})(CODE_POINTS || (CODE_POINTS = {}));\nexport const SEQUENCES = {\n    DASH_DASH: '--',\n    CDATA_START: '[CDATA[',\n    DOCTYPE: 'doctype',\n    SCRIPT: 'script',\n    PUBLIC: 'public',\n    SYSTEM: 'system',\n};\n//Surrogates\nexport function isSurrogate(cp) {\n    return cp >= 55296 && cp <= 57343;\n}\nexport function isSurrogatePair(cp) {\n    return cp >= 56320 && cp <= 57343;\n}\nexport function getSurrogatePairCodePoint(cp1, cp2) {\n    return (cp1 - 55296) * 1024 + 9216 + cp2;\n}\n//NOTE: excluding NULL and ASCII whitespace\nexport function isControlCodePoint(cp) {\n    return ((cp !== 0x20 && cp !== 0x0a && cp !== 0x0d && cp !== 0x09 && cp !== 0x0c && cp >= 0x01 && cp <= 0x1f) ||\n        (cp >= 0x7f && cp <= 0x9f));\n}\nexport function isUndefinedCodePoint(cp) {\n    return (cp >= 64976 && cp <= 65007) || UNDEFINED_CODE_POINTS.has(cp);\n}\n","export var ERR;\n(function (ERR) {\n    ERR[\"controlCharacterInInputStream\"] = \"control-character-in-input-stream\";\n    ERR[\"noncharacterInInputStream\"] = \"noncharacter-in-input-stream\";\n    ERR[\"surrogateInInputStream\"] = \"surrogate-in-input-stream\";\n    ERR[\"nonVoidHtmlElementStartTagWithTrailingSolidus\"] = \"non-void-html-element-start-tag-with-trailing-solidus\";\n    ERR[\"endTagWithAttributes\"] = \"end-tag-with-attributes\";\n    ERR[\"endTagWithTrailingSolidus\"] = \"end-tag-with-trailing-solidus\";\n    ERR[\"unexpectedSolidusInTag\"] = \"unexpected-solidus-in-tag\";\n    ERR[\"unexpectedNullCharacter\"] = \"unexpected-null-character\";\n    ERR[\"unexpectedQuestionMarkInsteadOfTagName\"] = \"unexpected-question-mark-instead-of-tag-name\";\n    ERR[\"invalidFirstCharacterOfTagName\"] = \"invalid-first-character-of-tag-name\";\n    ERR[\"unexpectedEqualsSignBeforeAttributeName\"] = \"unexpected-equals-sign-before-attribute-name\";\n    ERR[\"missingEndTagName\"] = \"missing-end-tag-name\";\n    ERR[\"unexpectedCharacterInAttributeName\"] = \"unexpected-character-in-attribute-name\";\n    ERR[\"unknownNamedCharacterReference\"] = \"unknown-named-character-reference\";\n    ERR[\"missingSemicolonAfterCharacterReference\"] = \"missing-semicolon-after-character-reference\";\n    ERR[\"unexpectedCharacterAfterDoctypeSystemIdentifier\"] = \"unexpected-character-after-doctype-system-identifier\";\n    ERR[\"unexpectedCharacterInUnquotedAttributeValue\"] = \"unexpected-character-in-unquoted-attribute-value\";\n    ERR[\"eofBeforeTagName\"] = \"eof-before-tag-name\";\n    ERR[\"eofInTag\"] = \"eof-in-tag\";\n    ERR[\"missingAttributeValue\"] = \"missing-attribute-value\";\n    ERR[\"missingWhitespaceBetweenAttributes\"] = \"missing-whitespace-between-attributes\";\n    ERR[\"missingWhitespaceAfterDoctypePublicKeyword\"] = \"missing-whitespace-after-doctype-public-keyword\";\n    ERR[\"missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers\"] = \"missing-whitespace-between-doctype-public-and-system-identifiers\";\n    ERR[\"missingWhitespaceAfterDoctypeSystemKeyword\"] = \"missing-whitespace-after-doctype-system-keyword\";\n    ERR[\"missingQuoteBeforeDoctypePublicIdentifier\"] = \"missing-quote-before-doctype-public-identifier\";\n    ERR[\"missingQuoteBeforeDoctypeSystemIdentifier\"] = \"missing-quote-before-doctype-system-identifier\";\n    ERR[\"missingDoctypePublicIdentifier\"] = \"missing-doctype-public-identifier\";\n    ERR[\"missingDoctypeSystemIdentifier\"] = \"missing-doctype-system-identifier\";\n    ERR[\"abruptDoctypePublicIdentifier\"] = \"abrupt-doctype-public-identifier\";\n    ERR[\"abruptDoctypeSystemIdentifier\"] = \"abrupt-doctype-system-identifier\";\n    ERR[\"cdataInHtmlContent\"] = \"cdata-in-html-content\";\n    ERR[\"incorrectlyOpenedComment\"] = \"incorrectly-opened-comment\";\n    ERR[\"eofInScriptHtmlCommentLikeText\"] = \"eof-in-script-html-comment-like-text\";\n    ERR[\"eofInDoctype\"] = \"eof-in-doctype\";\n    ERR[\"nestedComment\"] = \"nested-comment\";\n    ERR[\"abruptClosingOfEmptyComment\"] = \"abrupt-closing-of-empty-comment\";\n    ERR[\"eofInComment\"] = \"eof-in-comment\";\n    ERR[\"incorrectlyClosedComment\"] = \"incorrectly-closed-comment\";\n    ERR[\"eofInCdata\"] = \"eof-in-cdata\";\n    ERR[\"absenceOfDigitsInNumericCharacterReference\"] = \"absence-of-digits-in-numeric-character-reference\";\n    ERR[\"nullCharacterReference\"] = \"null-character-reference\";\n    ERR[\"surrogateCharacterReference\"] = \"surrogate-character-reference\";\n    ERR[\"characterReferenceOutsideUnicodeRange\"] = \"character-reference-outside-unicode-range\";\n    ERR[\"controlCharacterReference\"] = \"control-character-reference\";\n    ERR[\"noncharacterCharacterReference\"] = \"noncharacter-character-reference\";\n    ERR[\"missingWhitespaceBeforeDoctypeName\"] = \"missing-whitespace-before-doctype-name\";\n    ERR[\"missingDoctypeName\"] = \"missing-doctype-name\";\n    ERR[\"invalidCharacterSequenceAfterDoctypeName\"] = \"invalid-character-sequence-after-doctype-name\";\n    ERR[\"duplicateAttribute\"] = \"duplicate-attribute\";\n    ERR[\"nonConformingDoctype\"] = \"non-conforming-doctype\";\n    ERR[\"missingDoctype\"] = \"missing-doctype\";\n    ERR[\"misplacedDoctype\"] = \"misplaced-doctype\";\n    ERR[\"endTagWithoutMatchingOpenElement\"] = \"end-tag-without-matching-open-element\";\n    ERR[\"closingOfElementWithOpenChildElements\"] = \"closing-of-element-with-open-child-elements\";\n    ERR[\"disallowedContentInNoscriptInHead\"] = \"disallowed-content-in-noscript-in-head\";\n    ERR[\"openElementsLeftAfterEof\"] = \"open-elements-left-after-eof\";\n    ERR[\"abandonedHeadElementChild\"] = \"abandoned-head-element-child\";\n    ERR[\"misplacedStartTagForHeadElement\"] = \"misplaced-start-tag-for-head-element\";\n    ERR[\"nestedNoscriptInHead\"] = \"nested-noscript-in-head\";\n    ERR[\"eofInElementThatCanContainOnlyText\"] = \"eof-in-element-that-can-contain-only-text\";\n})(ERR || (ERR = {}));\n","export var TokenType;\n(function (TokenType) {\n    TokenType[TokenType[\"CHARACTER\"] = 0] = \"CHARACTER\";\n    TokenType[TokenType[\"NULL_CHARACTER\"] = 1] = \"NULL_CHARACTER\";\n    TokenType[TokenType[\"WHITESPACE_CHARACTER\"] = 2] = \"WHITESPACE_CHARACTER\";\n    TokenType[TokenType[\"START_TAG\"] = 3] = \"START_TAG\";\n    TokenType[TokenType[\"END_TAG\"] = 4] = \"END_TAG\";\n    TokenType[TokenType[\"COMMENT\"] = 5] = \"COMMENT\";\n    TokenType[TokenType[\"DOCTYPE\"] = 6] = \"DOCTYPE\";\n    TokenType[TokenType[\"EOF\"] = 7] = \"EOF\";\n    TokenType[TokenType[\"HIBERNATION\"] = 8] = \"HIBERNATION\";\n})(TokenType || (TokenType = {}));\nexport function getTokenAttr(token, attrName) {\n    for (let i = token.attrs.length - 1; i >= 0; i--) {\n        if (token.attrs[i].name === attrName) {\n            return token.attrs[i].value;\n        }\n    }\n    return null;\n}\n","/** All valid namespaces in HTML. */\nexport var NS;\n(function (NS) {\n    NS[\"HTML\"] = \"http://www.w3.org/1999/xhtml\";\n    NS[\"MATHML\"] = \"http://www.w3.org/1998/Math/MathML\";\n    NS[\"SVG\"] = \"http://www.w3.org/2000/svg\";\n    NS[\"XLINK\"] = \"http://www.w3.org/1999/xlink\";\n    NS[\"XML\"] = \"http://www.w3.org/XML/1998/namespace\";\n    NS[\"XMLNS\"] = \"http://www.w3.org/2000/xmlns/\";\n})(NS || (NS = {}));\nexport var ATTRS;\n(function (ATTRS) {\n    ATTRS[\"TYPE\"] = \"type\";\n    ATTRS[\"ACTION\"] = \"action\";\n    ATTRS[\"ENCODING\"] = \"encoding\";\n    ATTRS[\"PROMPT\"] = \"prompt\";\n    ATTRS[\"NAME\"] = \"name\";\n    ATTRS[\"COLOR\"] = \"color\";\n    ATTRS[\"FACE\"] = \"face\";\n    ATTRS[\"SIZE\"] = \"size\";\n})(ATTRS || (ATTRS = {}));\n/**\n * The mode of the document.\n *\n * @see {@link https://dom.spec.whatwg.org/#concept-document-limited-quirks}\n */\nexport var DOCUMENT_MODE;\n(function (DOCUMENT_MODE) {\n    DOCUMENT_MODE[\"NO_QUIRKS\"] = \"no-quirks\";\n    DOCUMENT_MODE[\"QUIRKS\"] = \"quirks\";\n    DOCUMENT_MODE[\"LIMITED_QUIRKS\"] = \"limited-quirks\";\n})(DOCUMENT_MODE || (DOCUMENT_MODE = {}));\nexport var TAG_NAMES;\n(function (TAG_NAMES) {\n    TAG_NAMES[\"A\"] = \"a\";\n    TAG_NAMES[\"ADDRESS\"] = \"address\";\n    TAG_NAMES[\"ANNOTATION_XML\"] = \"annotation-xml\";\n    TAG_NAMES[\"APPLET\"] = \"applet\";\n    TAG_NAMES[\"AREA\"] = \"area\";\n    TAG_NAMES[\"ARTICLE\"] = \"article\";\n    TAG_NAMES[\"ASIDE\"] = \"aside\";\n    TAG_NAMES[\"B\"] = \"b\";\n    TAG_NAMES[\"BASE\"] = \"base\";\n    TAG_NAMES[\"BASEFONT\"] = \"basefont\";\n    TAG_NAMES[\"BGSOUND\"] = \"bgsound\";\n    TAG_NAMES[\"BIG\"] = \"big\";\n    TAG_NAMES[\"BLOCKQUOTE\"] = \"blockquote\";\n    TAG_NAMES[\"BODY\"] = \"body\";\n    TAG_NAMES[\"BR\"] = \"br\";\n    TAG_NAMES[\"BUTTON\"] = \"button\";\n    TAG_NAMES[\"CAPTION\"] = \"caption\";\n    TAG_NAMES[\"CENTER\"] = \"center\";\n    TAG_NAMES[\"CODE\"] = \"code\";\n    TAG_NAMES[\"COL\"] = \"col\";\n    TAG_NAMES[\"COLGROUP\"] = \"colgroup\";\n    TAG_NAMES[\"DD\"] = \"dd\";\n    TAG_NAMES[\"DESC\"] = \"desc\";\n    TAG_NAMES[\"DETAILS\"] = \"details\";\n    TAG_NAMES[\"DIALOG\"] = \"dialog\";\n    TAG_NAMES[\"DIR\"] = \"dir\";\n    TAG_NAMES[\"DIV\"] = \"div\";\n    TAG_NAMES[\"DL\"] = \"dl\";\n    TAG_NAMES[\"DT\"] = \"dt\";\n    TAG_NAMES[\"EM\"] = \"em\";\n    TAG_NAMES[\"EMBED\"] = \"embed\";\n    TAG_NAMES[\"FIELDSET\"] = \"fieldset\";\n    TAG_NAMES[\"FIGCAPTION\"] = \"figcaption\";\n    TAG_NAMES[\"FIGURE\"] = \"figure\";\n    TAG_NAMES[\"FONT\"] = \"font\";\n    TAG_NAMES[\"FOOTER\"] = \"footer\";\n    TAG_NAMES[\"FOREIGN_OBJECT\"] = \"foreignObject\";\n    TAG_NAMES[\"FORM\"] = \"form\";\n    TAG_NAMES[\"FRAME\"] = \"frame\";\n    TAG_NAMES[\"FRAMESET\"] = \"frameset\";\n    TAG_NAMES[\"H1\"] = \"h1\";\n    TAG_NAMES[\"H2\"] = \"h2\";\n    TAG_NAMES[\"H3\"] = \"h3\";\n    TAG_NAMES[\"H4\"] = \"h4\";\n    TAG_NAMES[\"H5\"] = \"h5\";\n    TAG_NAMES[\"H6\"] = \"h6\";\n    TAG_NAMES[\"HEAD\"] = \"head\";\n    TAG_NAMES[\"HEADER\"] = \"header\";\n    TAG_NAMES[\"HGROUP\"] = \"hgroup\";\n    TAG_NAMES[\"HR\"] = \"hr\";\n    TAG_NAMES[\"HTML\"] = \"html\";\n    TAG_NAMES[\"I\"] = \"i\";\n    TAG_NAMES[\"IMG\"] = \"img\";\n    TAG_NAMES[\"IMAGE\"] = \"image\";\n    TAG_NAMES[\"INPUT\"] = \"input\";\n    TAG_NAMES[\"IFRAME\"] = \"iframe\";\n    TAG_NAMES[\"KEYGEN\"] = \"keygen\";\n    TAG_NAMES[\"LABEL\"] = \"label\";\n    TAG_NAMES[\"LI\"] = \"li\";\n    TAG_NAMES[\"LINK\"] = \"link\";\n    TAG_NAMES[\"LISTING\"] = \"listing\";\n    TAG_NAMES[\"MAIN\"] = \"main\";\n    TAG_NAMES[\"MALIGNMARK\"] = \"malignmark\";\n    TAG_NAMES[\"MARQUEE\"] = \"marquee\";\n    TAG_NAMES[\"MATH\"] = \"math\";\n    TAG_NAMES[\"MENU\"] = \"menu\";\n    TAG_NAMES[\"META\"] = \"meta\";\n    TAG_NAMES[\"MGLYPH\"] = \"mglyph\";\n    TAG_NAMES[\"MI\"] = \"mi\";\n    TAG_NAMES[\"MO\"] = \"mo\";\n    TAG_NAMES[\"MN\"] = \"mn\";\n    TAG_NAMES[\"MS\"] = \"ms\";\n    TAG_NAMES[\"MTEXT\"] = \"mtext\";\n    TAG_NAMES[\"NAV\"] = \"nav\";\n    TAG_NAMES[\"NOBR\"] = \"nobr\";\n    TAG_NAMES[\"NOFRAMES\"] = \"noframes\";\n    TAG_NAMES[\"NOEMBED\"] = \"noembed\";\n    TAG_NAMES[\"NOSCRIPT\"] = \"noscript\";\n    TAG_NAMES[\"OBJECT\"] = \"object\";\n    TAG_NAMES[\"OL\"] = \"ol\";\n    TAG_NAMES[\"OPTGROUP\"] = \"optgroup\";\n    TAG_NAMES[\"OPTION\"] = \"option\";\n    TAG_NAMES[\"P\"] = \"p\";\n    TAG_NAMES[\"PARAM\"] = \"param\";\n    TAG_NAMES[\"PLAINTEXT\"] = \"plaintext\";\n    TAG_NAMES[\"PRE\"] = \"pre\";\n    TAG_NAMES[\"RB\"] = \"rb\";\n    TAG_NAMES[\"RP\"] = \"rp\";\n    TAG_NAMES[\"RT\"] = \"rt\";\n    TAG_NAMES[\"RTC\"] = \"rtc\";\n    TAG_NAMES[\"RUBY\"] = \"ruby\";\n    TAG_NAMES[\"S\"] = \"s\";\n    TAG_NAMES[\"SCRIPT\"] = \"script\";\n    TAG_NAMES[\"SEARCH\"] = \"search\";\n    TAG_NAMES[\"SECTION\"] = \"section\";\n    TAG_NAMES[\"SELECT\"] = \"select\";\n    TAG_NAMES[\"SOURCE\"] = \"source\";\n    TAG_NAMES[\"SMALL\"] = \"small\";\n    TAG_NAMES[\"SPAN\"] = \"span\";\n    TAG_NAMES[\"STRIKE\"] = \"strike\";\n    TAG_NAMES[\"STRONG\"] = \"strong\";\n    TAG_NAMES[\"STYLE\"] = \"style\";\n    TAG_NAMES[\"SUB\"] = \"sub\";\n    TAG_NAMES[\"SUMMARY\"] = \"summary\";\n    TAG_NAMES[\"SUP\"] = \"sup\";\n    TAG_NAMES[\"TABLE\"] = \"table\";\n    TAG_NAMES[\"TBODY\"] = \"tbody\";\n    TAG_NAMES[\"TEMPLATE\"] = \"template\";\n    TAG_NAMES[\"TEXTAREA\"] = \"textarea\";\n    TAG_NAMES[\"TFOOT\"] = \"tfoot\";\n    TAG_NAMES[\"TD\"] = \"td\";\n    TAG_NAMES[\"TH\"] = \"th\";\n    TAG_NAMES[\"THEAD\"] = \"thead\";\n    TAG_NAMES[\"TITLE\"] = \"title\";\n    TAG_NAMES[\"TR\"] = \"tr\";\n    TAG_NAMES[\"TRACK\"] = \"track\";\n    TAG_NAMES[\"TT\"] = \"tt\";\n    TAG_NAMES[\"U\"] = \"u\";\n    TAG_NAMES[\"UL\"] = \"ul\";\n    TAG_NAMES[\"SVG\"] = \"svg\";\n    TAG_NAMES[\"VAR\"] = \"var\";\n    TAG_NAMES[\"WBR\"] = \"wbr\";\n    TAG_NAMES[\"XMP\"] = \"xmp\";\n})(TAG_NAMES || (TAG_NAMES = {}));\n/**\n * Tag IDs are numeric IDs for known tag names.\n *\n * We use tag IDs to improve the performance of tag name comparisons.\n */\nexport var TAG_ID;\n(function (TAG_ID) {\n    TAG_ID[TAG_ID[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\n    TAG_ID[TAG_ID[\"A\"] = 1] = \"A\";\n    TAG_ID[TAG_ID[\"ADDRESS\"] = 2] = \"ADDRESS\";\n    TAG_ID[TAG_ID[\"ANNOTATION_XML\"] = 3] = \"ANNOTATION_XML\";\n    TAG_ID[TAG_ID[\"APPLET\"] = 4] = \"APPLET\";\n    TAG_ID[TAG_ID[\"AREA\"] = 5] = \"AREA\";\n    TAG_ID[TAG_ID[\"ARTICLE\"] = 6] = \"ARTICLE\";\n    TAG_ID[TAG_ID[\"ASIDE\"] = 7] = \"ASIDE\";\n    TAG_ID[TAG_ID[\"B\"] = 8] = \"B\";\n    TAG_ID[TAG_ID[\"BASE\"] = 9] = \"BASE\";\n    TAG_ID[TAG_ID[\"BASEFONT\"] = 10] = \"BASEFONT\";\n    TAG_ID[TAG_ID[\"BGSOUND\"] = 11] = \"BGSOUND\";\n    TAG_ID[TAG_ID[\"BIG\"] = 12] = \"BIG\";\n    TAG_ID[TAG_ID[\"BLOCKQUOTE\"] = 13] = \"BLOCKQUOTE\";\n    TAG_ID[TAG_ID[\"BODY\"] = 14] = \"BODY\";\n    TAG_ID[TAG_ID[\"BR\"] = 15] = \"BR\";\n    TAG_ID[TAG_ID[\"BUTTON\"] = 16] = \"BUTTON\";\n    TAG_ID[TAG_ID[\"CAPTION\"] = 17] = \"CAPTION\";\n    TAG_ID[TAG_ID[\"CENTER\"] = 18] = \"CENTER\";\n    TAG_ID[TAG_ID[\"CODE\"] = 19] = \"CODE\";\n    TAG_ID[TAG_ID[\"COL\"] = 20] = \"COL\";\n    TAG_ID[TAG_ID[\"COLGROUP\"] = 21] = \"COLGROUP\";\n    TAG_ID[TAG_ID[\"DD\"] = 22] = \"DD\";\n    TAG_ID[TAG_ID[\"DESC\"] = 23] = \"DESC\";\n    TAG_ID[TAG_ID[\"DETAILS\"] = 24] = \"DETAILS\";\n    TAG_ID[TAG_ID[\"DIALOG\"] = 25] = \"DIALOG\";\n    TAG_ID[TAG_ID[\"DIR\"] = 26] = \"DIR\";\n    TAG_ID[TAG_ID[\"DIV\"] = 27] = \"DIV\";\n    TAG_ID[TAG_ID[\"DL\"] = 28] = \"DL\";\n    TAG_ID[TAG_ID[\"DT\"] = 29] = \"DT\";\n    TAG_ID[TAG_ID[\"EM\"] = 30] = \"EM\";\n    TAG_ID[TAG_ID[\"EMBED\"] = 31] = \"EMBED\";\n    TAG_ID[TAG_ID[\"FIELDSET\"] = 32] = \"FIELDSET\";\n    TAG_ID[TAG_ID[\"FIGCAPTION\"] = 33] = \"FIGCAPTION\";\n    TAG_ID[TAG_ID[\"FIGURE\"] = 34] = \"FIGURE\";\n    TAG_ID[TAG_ID[\"FONT\"] = 35] = \"FONT\";\n    TAG_ID[TAG_ID[\"FOOTER\"] = 36] = \"FOOTER\";\n    TAG_ID[TAG_ID[\"FOREIGN_OBJECT\"] = 37] = \"FOREIGN_OBJECT\";\n    TAG_ID[TAG_ID[\"FORM\"] = 38] = \"FORM\";\n    TAG_ID[TAG_ID[\"FRAME\"] = 39] = \"FRAME\";\n    TAG_ID[TAG_ID[\"FRAMESET\"] = 40] = \"FRAMESET\";\n    TAG_ID[TAG_ID[\"H1\"] = 41] = \"H1\";\n    TAG_ID[TAG_ID[\"H2\"] = 42] = \"H2\";\n    TAG_ID[TAG_ID[\"H3\"] = 43] = \"H3\";\n    TAG_ID[TAG_ID[\"H4\"] = 44] = \"H4\";\n    TAG_ID[TAG_ID[\"H5\"] = 45] = \"H5\";\n    TAG_ID[TAG_ID[\"H6\"] = 46] = \"H6\";\n    TAG_ID[TAG_ID[\"HEAD\"] = 47] = \"HEAD\";\n    TAG_ID[TAG_ID[\"HEADER\"] = 48] = \"HEADER\";\n    TAG_ID[TAG_ID[\"HGROUP\"] = 49] = \"HGROUP\";\n    TAG_ID[TAG_ID[\"HR\"] = 50] = \"HR\";\n    TAG_ID[TAG_ID[\"HTML\"] = 51] = \"HTML\";\n    TAG_ID[TAG_ID[\"I\"] = 52] = \"I\";\n    TAG_ID[TAG_ID[\"IMG\"] = 53] = \"IMG\";\n    TAG_ID[TAG_ID[\"IMAGE\"] = 54] = \"IMAGE\";\n    TAG_ID[TAG_ID[\"INPUT\"] = 55] = \"INPUT\";\n    TAG_ID[TAG_ID[\"IFRAME\"] = 56] = \"IFRAME\";\n    TAG_ID[TAG_ID[\"KEYGEN\"] = 57] = \"KEYGEN\";\n    TAG_ID[TAG_ID[\"LABEL\"] = 58] = \"LABEL\";\n    TAG_ID[TAG_ID[\"LI\"] = 59] = \"LI\";\n    TAG_ID[TAG_ID[\"LINK\"] = 60] = \"LINK\";\n    TAG_ID[TAG_ID[\"LISTING\"] = 61] = \"LISTING\";\n    TAG_ID[TAG_ID[\"MAIN\"] = 62] = \"MAIN\";\n    TAG_ID[TAG_ID[\"MALIGNMARK\"] = 63] = \"MALIGNMARK\";\n    TAG_ID[TAG_ID[\"MARQUEE\"] = 64] = \"MARQUEE\";\n    TAG_ID[TAG_ID[\"MATH\"] = 65] = \"MATH\";\n    TAG_ID[TAG_ID[\"MENU\"] = 66] = \"MENU\";\n    TAG_ID[TAG_ID[\"META\"] = 67] = \"META\";\n    TAG_ID[TAG_ID[\"MGLYPH\"] = 68] = \"MGLYPH\";\n    TAG_ID[TAG_ID[\"MI\"] = 69] = \"MI\";\n    TAG_ID[TAG_ID[\"MO\"] = 70] = \"MO\";\n    TAG_ID[TAG_ID[\"MN\"] = 71] = \"MN\";\n    TAG_ID[TAG_ID[\"MS\"] = 72] = \"MS\";\n    TAG_ID[TAG_ID[\"MTEXT\"] = 73] = \"MTEXT\";\n    TAG_ID[TAG_ID[\"NAV\"] = 74] = \"NAV\";\n    TAG_ID[TAG_ID[\"NOBR\"] = 75] = \"NOBR\";\n    TAG_ID[TAG_ID[\"NOFRAMES\"] = 76] = \"NOFRAMES\";\n    TAG_ID[TAG_ID[\"NOEMBED\"] = 77] = \"NOEMBED\";\n    TAG_ID[TAG_ID[\"NOSCRIPT\"] = 78] = \"NOSCRIPT\";\n    TAG_ID[TAG_ID[\"OBJECT\"] = 79] = \"OBJECT\";\n    TAG_ID[TAG_ID[\"OL\"] = 80] = \"OL\";\n    TAG_ID[TAG_ID[\"OPTGROUP\"] = 81] = \"OPTGROUP\";\n    TAG_ID[TAG_ID[\"OPTION\"] = 82] = \"OPTION\";\n    TAG_ID[TAG_ID[\"P\"] = 83] = \"P\";\n    TAG_ID[TAG_ID[\"PARAM\"] = 84] = \"PARAM\";\n    TAG_ID[TAG_ID[\"PLAINTEXT\"] = 85] = \"PLAINTEXT\";\n    TAG_ID[TAG_ID[\"PRE\"] = 86] = \"PRE\";\n    TAG_ID[TAG_ID[\"RB\"] = 87] = \"RB\";\n    TAG_ID[TAG_ID[\"RP\"] = 88] = \"RP\";\n    TAG_ID[TAG_ID[\"RT\"] = 89] = \"RT\";\n    TAG_ID[TAG_ID[\"RTC\"] = 90] = \"RTC\";\n    TAG_ID[TAG_ID[\"RUBY\"] = 91] = \"RUBY\";\n    TAG_ID[TAG_ID[\"S\"] = 92] = \"S\";\n    TAG_ID[TAG_ID[\"SCRIPT\"] = 93] = \"SCRIPT\";\n    TAG_ID[TAG_ID[\"SEARCH\"] = 94] = \"SEARCH\";\n    TAG_ID[TAG_ID[\"SECTION\"] = 95] = \"SECTION\";\n    TAG_ID[TAG_ID[\"SELECT\"] = 96] = \"SELECT\";\n    TAG_ID[TAG_ID[\"SOURCE\"] = 97] = \"SOURCE\";\n    TAG_ID[TAG_ID[\"SMALL\"] = 98] = \"SMALL\";\n    TAG_ID[TAG_ID[\"SPAN\"] = 99] = \"SPAN\";\n    TAG_ID[TAG_ID[\"STRIKE\"] = 100] = \"STRIKE\";\n    TAG_ID[TAG_ID[\"STRONG\"] = 101] = \"STRONG\";\n    TAG_ID[TAG_ID[\"STYLE\"] = 102] = \"STYLE\";\n    TAG_ID[TAG_ID[\"SUB\"] = 103] = \"SUB\";\n    TAG_ID[TAG_ID[\"SUMMARY\"] = 104] = \"SUMMARY\";\n    TAG_ID[TAG_ID[\"SUP\"] = 105] = \"SUP\";\n    TAG_ID[TAG_ID[\"TABLE\"] = 106] = \"TABLE\";\n    TAG_ID[TAG_ID[\"TBODY\"] = 107] = \"TBODY\";\n    TAG_ID[TAG_ID[\"TEMPLATE\"] = 108] = \"TEMPLATE\";\n    TAG_ID[TAG_ID[\"TEXTAREA\"] = 109] = \"TEXTAREA\";\n    TAG_ID[TAG_ID[\"TFOOT\"] = 110] = \"TFOOT\";\n    TAG_ID[TAG_ID[\"TD\"] = 111] = \"TD\";\n    TAG_ID[TAG_ID[\"TH\"] = 112] = \"TH\";\n    TAG_ID[TAG_ID[\"THEAD\"] = 113] = \"THEAD\";\n    TAG_ID[TAG_ID[\"TITLE\"] = 114] = \"TITLE\";\n    TAG_ID[TAG_ID[\"TR\"] = 115] = \"TR\";\n    TAG_ID[TAG_ID[\"TRACK\"] = 116] = \"TRACK\";\n    TAG_ID[TAG_ID[\"TT\"] = 117] = \"TT\";\n    TAG_ID[TAG_ID[\"U\"] = 118] = \"U\";\n    TAG_ID[TAG_ID[\"UL\"] = 119] = \"UL\";\n    TAG_ID[TAG_ID[\"SVG\"] = 120] = \"SVG\";\n    TAG_ID[TAG_ID[\"VAR\"] = 121] = \"VAR\";\n    TAG_ID[TAG_ID[\"WBR\"] = 122] = \"WBR\";\n    TAG_ID[TAG_ID[\"XMP\"] = 123] = \"XMP\";\n})(TAG_ID || (TAG_ID = {}));\nconst TAG_NAME_TO_ID = new Map([\n    [TAG_NAMES.A, TAG_ID.A],\n    [TAG_NAMES.ADDRESS, TAG_ID.ADDRESS],\n    [TAG_NAMES.ANNOTATION_XML, TAG_ID.ANNOTATION_XML],\n    [TAG_NAMES.APPLET, TAG_ID.APPLET],\n    [TAG_NAMES.AREA, TAG_ID.AREA],\n    [TAG_NAMES.ARTICLE, TAG_ID.ARTICLE],\n    [TAG_NAMES.ASIDE, TAG_ID.ASIDE],\n    [TAG_NAMES.B, TAG_ID.B],\n    [TAG_NAMES.BASE, TAG_ID.BASE],\n    [TAG_NAMES.BASEFONT, TAG_ID.BASEFONT],\n    [TAG_NAMES.BGSOUND, TAG_ID.BGSOUND],\n    [TAG_NAMES.BIG, TAG_ID.BIG],\n    [TAG_NAMES.BLOCKQUOTE, TAG_ID.BLOCKQUOTE],\n    [TAG_NAMES.BODY, TAG_ID.BODY],\n    [TAG_NAMES.BR, TAG_ID.BR],\n    [TAG_NAMES.BUTTON, TAG_ID.BUTTON],\n    [TAG_NAMES.CAPTION, TAG_ID.CAPTION],\n    [TAG_NAMES.CENTER, TAG_ID.CENTER],\n    [TAG_NAMES.CODE, TAG_ID.CODE],\n    [TAG_NAMES.COL, TAG_ID.COL],\n    [TAG_NAMES.COLGROUP, TAG_ID.COLGROUP],\n    [TAG_NAMES.DD, TAG_ID.DD],\n    [TAG_NAMES.DESC, TAG_ID.DESC],\n    [TAG_NAMES.DETAILS, TAG_ID.DETAILS],\n    [TAG_NAMES.DIALOG, TAG_ID.DIALOG],\n    [TAG_NAMES.DIR, TAG_ID.DIR],\n    [TAG_NAMES.DIV, TAG_ID.DIV],\n    [TAG_NAMES.DL, TAG_ID.DL],\n    [TAG_NAMES.DT, TAG_ID.DT],\n    [TAG_NAMES.EM, TAG_ID.EM],\n    [TAG_NAMES.EMBED, TAG_ID.EMBED],\n    [TAG_NAMES.FIELDSET, TAG_ID.FIELDSET],\n    [TAG_NAMES.FIGCAPTION, TAG_ID.FIGCAPTION],\n    [TAG_NAMES.FIGURE, TAG_ID.FIGURE],\n    [TAG_NAMES.FONT, TAG_ID.FONT],\n    [TAG_NAMES.FOOTER, TAG_ID.FOOTER],\n    [TAG_NAMES.FOREIGN_OBJECT, TAG_ID.FOREIGN_OBJECT],\n    [TAG_NAMES.FORM, TAG_ID.FORM],\n    [TAG_NAMES.FRAME, TAG_ID.FRAME],\n    [TAG_NAMES.FRAMESET, TAG_ID.FRAMESET],\n    [TAG_NAMES.H1, TAG_ID.H1],\n    [TAG_NAMES.H2, TAG_ID.H2],\n    [TAG_NAMES.H3, TAG_ID.H3],\n    [TAG_NAMES.H4, TAG_ID.H4],\n    [TAG_NAMES.H5, TAG_ID.H5],\n    [TAG_NAMES.H6, TAG_ID.H6],\n    [TAG_NAMES.HEAD, TAG_ID.HEAD],\n    [TAG_NAMES.HEADER, TAG_ID.HEADER],\n    [TAG_NAMES.HGROUP, TAG_ID.HGROUP],\n    [TAG_NAMES.HR, TAG_ID.HR],\n    [TAG_NAMES.HTML, TAG_ID.HTML],\n    [TAG_NAMES.I, TAG_ID.I],\n    [TAG_NAMES.IMG, TAG_ID.IMG],\n    [TAG_NAMES.IMAGE, TAG_ID.IMAGE],\n    [TAG_NAMES.INPUT, TAG_ID.INPUT],\n    [TAG_NAMES.IFRAME, TAG_ID.IFRAME],\n    [TAG_NAMES.KEYGEN, TAG_ID.KEYGEN],\n    [TAG_NAMES.LABEL, TAG_ID.LABEL],\n    [TAG_NAMES.LI, TAG_ID.LI],\n    [TAG_NAMES.LINK, TAG_ID.LINK],\n    [TAG_NAMES.LISTING, TAG_ID.LISTING],\n    [TAG_NAMES.MAIN, TAG_ID.MAIN],\n    [TAG_NAMES.MALIGNMARK, TAG_ID.MALIGNMARK],\n    [TAG_NAMES.MARQUEE, TAG_ID.MARQUEE],\n    [TAG_NAMES.MATH, TAG_ID.MATH],\n    [TAG_NAMES.MENU, TAG_ID.MENU],\n    [TAG_NAMES.META, TAG_ID.META],\n    [TAG_NAMES.MGLYPH, TAG_ID.MGLYPH],\n    [TAG_NAMES.MI, TAG_ID.MI],\n    [TAG_NAMES.MO, TAG_ID.MO],\n    [TAG_NAMES.MN, TAG_ID.MN],\n    [TAG_NAMES.MS, TAG_ID.MS],\n    [TAG_NAMES.MTEXT, TAG_ID.MTEXT],\n    [TAG_NAMES.NAV, TAG_ID.NAV],\n    [TAG_NAMES.NOBR, TAG_ID.NOBR],\n    [TAG_NAMES.NOFRAMES, TAG_ID.NOFRAMES],\n    [TAG_NAMES.NOEMBED, TAG_ID.NOEMBED],\n    [TAG_NAMES.NOSCRIPT, TAG_ID.NOSCRIPT],\n    [TAG_NAMES.OBJECT, TAG_ID.OBJECT],\n    [TAG_NAMES.OL, TAG_ID.OL],\n    [TAG_NAMES.OPTGROUP, TAG_ID.OPTGROUP],\n    [TAG_NAMES.OPTION, TAG_ID.OPTION],\n    [TAG_NAMES.P, TAG_ID.P],\n    [TAG_NAMES.PARAM, TAG_ID.PARAM],\n    [TAG_NAMES.PLAINTEXT, TAG_ID.PLAINTEXT],\n    [TAG_NAMES.PRE, TAG_ID.PRE],\n    [TAG_NAMES.RB, TAG_ID.RB],\n    [TAG_NAMES.RP, TAG_ID.RP],\n    [TAG_NAMES.RT, TAG_ID.RT],\n    [TAG_NAMES.RTC, TAG_ID.RTC],\n    [TAG_NAMES.RUBY, TAG_ID.RUBY],\n    [TAG_NAMES.S, TAG_ID.S],\n    [TAG_NAMES.SCRIPT, TAG_ID.SCRIPT],\n    [TAG_NAMES.SEARCH, TAG_ID.SEARCH],\n    [TAG_NAMES.SECTION, TAG_ID.SECTION],\n    [TAG_NAMES.SELECT, TAG_ID.SELECT],\n    [TAG_NAMES.SOURCE, TAG_ID.SOURCE],\n    [TAG_NAMES.SMALL, TAG_ID.SMALL],\n    [TAG_NAMES.SPAN, TAG_ID.SPAN],\n    [TAG_NAMES.STRIKE, TAG_ID.STRIKE],\n    [TAG_NAMES.STRONG, TAG_ID.STRONG],\n    [TAG_NAMES.STYLE, TAG_ID.STYLE],\n    [TAG_NAMES.SUB, TAG_ID.SUB],\n    [TAG_NAMES.SUMMARY, TAG_ID.SUMMARY],\n    [TAG_NAMES.SUP, TAG_ID.SUP],\n    [TAG_NAMES.TABLE, TAG_ID.TABLE],\n    [TAG_NAMES.TBODY, TAG_ID.TBODY],\n    [TAG_NAMES.TEMPLATE, TAG_ID.TEMPLATE],\n    [TAG_NAMES.TEXTAREA, TAG_ID.TEXTAREA],\n    [TAG_NAMES.TFOOT, TAG_ID.TFOOT],\n    [TAG_NAMES.TD, TAG_ID.TD],\n    [TAG_NAMES.TH, TAG_ID.TH],\n    [TAG_NAMES.THEAD, TAG_ID.THEAD],\n    [TAG_NAMES.TITLE, TAG_ID.TITLE],\n    [TAG_NAMES.TR, TAG_ID.TR],\n    [TAG_NAMES.TRACK, TAG_ID.TRACK],\n    [TAG_NAMES.TT, TAG_ID.TT],\n    [TAG_NAMES.U, TAG_ID.U],\n    [TAG_NAMES.UL, TAG_ID.UL],\n    [TAG_NAMES.SVG, TAG_ID.SVG],\n    [TAG_NAMES.VAR, TAG_ID.VAR],\n    [TAG_NAMES.WBR, TAG_ID.WBR],\n    [TAG_NAMES.XMP, TAG_ID.XMP],\n]);\nexport function getTagID(tagName) {\n    var _a;\n    return (_a = TAG_NAME_TO_ID.get(tagName)) !== null && _a !== void 0 ? _a : TAG_ID.UNKNOWN;\n}\nconst $ = TAG_ID;\nexport const SPECIAL_ELEMENTS = {\n    [NS.HTML]: new Set([\n        $.ADDRESS,\n        $.APPLET,\n        $.AREA,\n        $.ARTICLE,\n        $.ASIDE,\n        $.BASE,\n        $.BASEFONT,\n        $.BGSOUND,\n        $.BLOCKQUOTE,\n        $.BODY,\n        $.BR,\n        $.BUTTON,\n        $.CAPTION,\n        $.CENTER,\n        $.COL,\n        $.COLGROUP,\n        $.DD,\n        $.DETAILS,\n        $.DIR,\n        $.DIV,\n        $.DL,\n        $.DT,\n        $.EMBED,\n        $.FIELDSET,\n        $.FIGCAPTION,\n        $.FIGURE,\n        $.FOOTER,\n        $.FORM,\n        $.FRAME,\n        $.FRAMESET,\n        $.H1,\n        $.H2,\n        $.H3,\n        $.H4,\n        $.H5,\n        $.H6,\n        $.HEAD,\n        $.HEADER,\n        $.HGROUP,\n        $.HR,\n        $.HTML,\n        $.IFRAME,\n        $.IMG,\n        $.INPUT,\n        $.LI,\n        $.LINK,\n        $.LISTING,\n        $.MAIN,\n        $.MARQUEE,\n        $.MENU,\n        $.META,\n        $.NAV,\n        $.NOEMBED,\n        $.NOFRAMES,\n        $.NOSCRIPT,\n        $.OBJECT,\n        $.OL,\n        $.P,\n        $.PARAM,\n        $.PLAINTEXT,\n        $.PRE,\n        $.SCRIPT,\n        $.SECTION,\n        $.SELECT,\n        $.SOURCE,\n        $.STYLE,\n        $.SUMMARY,\n        $.TABLE,\n        $.TBODY,\n        $.TD,\n        $.TEMPLATE,\n        $.TEXTAREA,\n        $.TFOOT,\n        $.TH,\n        $.THEAD,\n        $.TITLE,\n        $.TR,\n        $.TRACK,\n        $.UL,\n        $.WBR,\n        $.XMP,\n    ]),\n    [NS.MATHML]: new Set([$.MI, $.MO, $.MN, $.MS, $.MTEXT, $.ANNOTATION_XML]),\n    [NS.SVG]: new Set([$.TITLE, $.FOREIGN_OBJECT, $.DESC]),\n    [NS.XLINK]: new Set(),\n    [NS.XML]: new Set(),\n    [NS.XMLNS]: new Set(),\n};\nexport const NUMBERED_HEADERS = new Set([$.H1, $.H2, $.H3, $.H4, $.H5, $.H6]);\nconst UNESCAPED_TEXT = new Set([\n    TAG_NAMES.STYLE,\n    TAG_NAMES.SCRIPT,\n    TAG_NAMES.XMP,\n    TAG_NAMES.IFRAME,\n    TAG_NAMES.NOEMBED,\n    TAG_NAMES.NOFRAMES,\n    TAG_NAMES.PLAINTEXT,\n]);\nexport function hasUnescapedText(tn, scriptingEnabled) {\n    return UNESCAPED_TEXT.has(tn) || (scriptingEnabled && tn === TAG_NAMES.NOSCRIPT);\n}\n","import { Preprocessor } from './preprocessor.js';\nimport { CODE_POINTS as $, SEQUENCES as $$, REPLACEMENT_CHARACTER, isSurrogate, isUndefinedCodePoint, isControlCodePoint, } from '../common/unicode.js';\nimport { TokenType, getTokenAttr, } from '../common/token.js';\nimport { htmlDecodeTree, EntityDecoder, DecodingMode } from 'entities/decode';\nimport { ERR } from '../common/error-codes.js';\nimport { TAG_ID, getTagID } from '../common/html.js';\n//States\nvar State;\n(function (State) {\n    State[State[\"DATA\"] = 0] = \"DATA\";\n    State[State[\"RCDATA\"] = 1] = \"RCDATA\";\n    State[State[\"RAWTEXT\"] = 2] = \"RAWTEXT\";\n    State[State[\"SCRIPT_DATA\"] = 3] = \"SCRIPT_DATA\";\n    State[State[\"PLAINTEXT\"] = 4] = \"PLAINTEXT\";\n    State[State[\"TAG_OPEN\"] = 5] = \"TAG_OPEN\";\n    State[State[\"END_TAG_OPEN\"] = 6] = \"END_TAG_OPEN\";\n    State[State[\"TAG_NAME\"] = 7] = \"TAG_NAME\";\n    State[State[\"RCDATA_LESS_THAN_SIGN\"] = 8] = \"RCDATA_LESS_THAN_SIGN\";\n    State[State[\"RCDATA_END_TAG_OPEN\"] = 9] = \"RCDATA_END_TAG_OPEN\";\n    State[State[\"RCDATA_END_TAG_NAME\"] = 10] = \"RCDATA_END_TAG_NAME\";\n    State[State[\"RAWTEXT_LESS_THAN_SIGN\"] = 11] = \"RAWTEXT_LESS_THAN_SIGN\";\n    State[State[\"RAWTEXT_END_TAG_OPEN\"] = 12] = \"RAWTEXT_END_TAG_OPEN\";\n    State[State[\"RAWTEXT_END_TAG_NAME\"] = 13] = \"RAWTEXT_END_TAG_NAME\";\n    State[State[\"SCRIPT_DATA_LESS_THAN_SIGN\"] = 14] = \"SCRIPT_DATA_LESS_THAN_SIGN\";\n    State[State[\"SCRIPT_DATA_END_TAG_OPEN\"] = 15] = \"SCRIPT_DATA_END_TAG_OPEN\";\n    State[State[\"SCRIPT_DATA_END_TAG_NAME\"] = 16] = \"SCRIPT_DATA_END_TAG_NAME\";\n    State[State[\"SCRIPT_DATA_ESCAPE_START\"] = 17] = \"SCRIPT_DATA_ESCAPE_START\";\n    State[State[\"SCRIPT_DATA_ESCAPE_START_DASH\"] = 18] = \"SCRIPT_DATA_ESCAPE_START_DASH\";\n    State[State[\"SCRIPT_DATA_ESCAPED\"] = 19] = \"SCRIPT_DATA_ESCAPED\";\n    State[State[\"SCRIPT_DATA_ESCAPED_DASH\"] = 20] = \"SCRIPT_DATA_ESCAPED_DASH\";\n    State[State[\"SCRIPT_DATA_ESCAPED_DASH_DASH\"] = 21] = \"SCRIPT_DATA_ESCAPED_DASH_DASH\";\n    State[State[\"SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN\"] = 22] = \"SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN\";\n    State[State[\"SCRIPT_DATA_ESCAPED_END_TAG_OPEN\"] = 23] = \"SCRIPT_DATA_ESCAPED_END_TAG_OPEN\";\n    State[State[\"SCRIPT_DATA_ESCAPED_END_TAG_NAME\"] = 24] = \"SCRIPT_DATA_ESCAPED_END_TAG_NAME\";\n    State[State[\"SCRIPT_DATA_DOUBLE_ESCAPE_START\"] = 25] = \"SCRIPT_DATA_DOUBLE_ESCAPE_START\";\n    State[State[\"SCRIPT_DATA_DOUBLE_ESCAPED\"] = 26] = \"SCRIPT_DATA_DOUBLE_ESCAPED\";\n    State[State[\"SCRIPT_DATA_DOUBLE_ESCAPED_DASH\"] = 27] = \"SCRIPT_DATA_DOUBLE_ESCAPED_DASH\";\n    State[State[\"SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH\"] = 28] = \"SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH\";\n    State[State[\"SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN\"] = 29] = \"SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN\";\n    State[State[\"SCRIPT_DATA_DOUBLE_ESCAPE_END\"] = 30] = \"SCRIPT_DATA_DOUBLE_ESCAPE_END\";\n    State[State[\"BEFORE_ATTRIBUTE_NAME\"] = 31] = \"BEFORE_ATTRIBUTE_NAME\";\n    State[State[\"ATTRIBUTE_NAME\"] = 32] = \"ATTRIBUTE_NAME\";\n    State[State[\"AFTER_ATTRIBUTE_NAME\"] = 33] = \"AFTER_ATTRIBUTE_NAME\";\n    State[State[\"BEFORE_ATTRIBUTE_VALUE\"] = 34] = \"BEFORE_ATTRIBUTE_VALUE\";\n    State[State[\"ATTRIBUTE_VALUE_DOUBLE_QUOTED\"] = 35] = \"ATTRIBUTE_VALUE_DOUBLE_QUOTED\";\n    State[State[\"ATTRIBUTE_VALUE_SINGLE_QUOTED\"] = 36] = \"ATTRIBUTE_VALUE_SINGLE_QUOTED\";\n    State[State[\"ATTRIBUTE_VALUE_UNQUOTED\"] = 37] = \"ATTRIBUTE_VALUE_UNQUOTED\";\n    State[State[\"AFTER_ATTRIBUTE_VALUE_QUOTED\"] = 38] = \"AFTER_ATTRIBUTE_VALUE_QUOTED\";\n    State[State[\"SELF_CLOSING_START_TAG\"] = 39] = \"SELF_CLOSING_START_TAG\";\n    State[State[\"BOGUS_COMMENT\"] = 40] = \"BOGUS_COMMENT\";\n    State[State[\"MARKUP_DECLARATION_OPEN\"] = 41] = \"MARKUP_DECLARATION_OPEN\";\n    State[State[\"COMMENT_START\"] = 42] = \"COMMENT_START\";\n    State[State[\"COMMENT_START_DASH\"] = 43] = \"COMMENT_START_DASH\";\n    State[State[\"COMMENT\"] = 44] = \"COMMENT\";\n    State[State[\"COMMENT_LESS_THAN_SIGN\"] = 45] = \"COMMENT_LESS_THAN_SIGN\";\n    State[State[\"COMMENT_LESS_THAN_SIGN_BANG\"] = 46] = \"COMMENT_LESS_THAN_SIGN_BANG\";\n    State[State[\"COMMENT_LESS_THAN_SIGN_BANG_DASH\"] = 47] = \"COMMENT_LESS_THAN_SIGN_BANG_DASH\";\n    State[State[\"COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH\"] = 48] = \"COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH\";\n    State[State[\"COMMENT_END_DASH\"] = 49] = \"COMMENT_END_DASH\";\n    State[State[\"COMMENT_END\"] = 50] = \"COMMENT_END\";\n    State[State[\"COMMENT_END_BANG\"] = 51] = \"COMMENT_END_BANG\";\n    State[State[\"DOCTYPE\"] = 52] = \"DOCTYPE\";\n    State[State[\"BEFORE_DOCTYPE_NAME\"] = 53] = \"BEFORE_DOCTYPE_NAME\";\n    State[State[\"DOCTYPE_NAME\"] = 54] = \"DOCTYPE_NAME\";\n    State[State[\"AFTER_DOCTYPE_NAME\"] = 55] = \"AFTER_DOCTYPE_NAME\";\n    State[State[\"AFTER_DOCTYPE_PUBLIC_KEYWORD\"] = 56] = \"AFTER_DOCTYPE_PUBLIC_KEYWORD\";\n    State[State[\"BEFORE_DOCTYPE_PUBLIC_IDENTIFIER\"] = 57] = \"BEFORE_DOCTYPE_PUBLIC_IDENTIFIER\";\n    State[State[\"DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED\"] = 58] = \"DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED\";\n    State[State[\"DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED\"] = 59] = \"DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED\";\n    State[State[\"AFTER_DOCTYPE_PUBLIC_IDENTIFIER\"] = 60] = \"AFTER_DOCTYPE_PUBLIC_IDENTIFIER\";\n    State[State[\"BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS\"] = 61] = \"BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS\";\n    State[State[\"AFTER_DOCTYPE_SYSTEM_KEYWORD\"] = 62] = \"AFTER_DOCTYPE_SYSTEM_KEYWORD\";\n    State[State[\"BEFORE_DOCTYPE_SYSTEM_IDENTIFIER\"] = 63] = \"BEFORE_DOCTYPE_SYSTEM_IDENTIFIER\";\n    State[State[\"DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED\"] = 64] = \"DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED\";\n    State[State[\"DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED\"] = 65] = \"DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED\";\n    State[State[\"AFTER_DOCTYPE_SYSTEM_IDENTIFIER\"] = 66] = \"AFTER_DOCTYPE_SYSTEM_IDENTIFIER\";\n    State[State[\"BOGUS_DOCTYPE\"] = 67] = \"BOGUS_DOCTYPE\";\n    State[State[\"CDATA_SECTION\"] = 68] = \"CDATA_SECTION\";\n    State[State[\"CDATA_SECTION_BRACKET\"] = 69] = \"CDATA_SECTION_BRACKET\";\n    State[State[\"CDATA_SECTION_END\"] = 70] = \"CDATA_SECTION_END\";\n    State[State[\"CHARACTER_REFERENCE\"] = 71] = \"CHARACTER_REFERENCE\";\n    State[State[\"AMBIGUOUS_AMPERSAND\"] = 72] = \"AMBIGUOUS_AMPERSAND\";\n})(State || (State = {}));\n//Tokenizer initial states for different modes\nexport const TokenizerMode = {\n    DATA: State.DATA,\n    RCDATA: State.RCDATA,\n    RAWTEXT: State.RAWTEXT,\n    SCRIPT_DATA: State.SCRIPT_DATA,\n    PLAINTEXT: State.PLAINTEXT,\n    CDATA_SECTION: State.CDATA_SECTION,\n};\n//Utils\n//OPTIMIZATION: these utility functions should not be moved out of this module. V8 Crankshaft will not inline\n//this functions if they will be situated in another module due to context switch.\n//Always perform inlining check before modifying this functions ('node --trace-inlining').\nfunction isAsciiDigit(cp) {\n    return cp >= $.DIGIT_0 && cp <= $.DIGIT_9;\n}\nfunction isAsciiUpper(cp) {\n    return cp >= $.LATIN_CAPITAL_A && cp <= $.LATIN_CAPITAL_Z;\n}\nfunction isAsciiLower(cp) {\n    return cp >= $.LATIN_SMALL_A && cp <= $.LATIN_SMALL_Z;\n}\nfunction isAsciiLetter(cp) {\n    return isAsciiLower(cp) || isAsciiUpper(cp);\n}\nfunction isAsciiAlphaNumeric(cp) {\n    return isAsciiLetter(cp) || isAsciiDigit(cp);\n}\nfunction toAsciiLower(cp) {\n    return cp + 32;\n}\nfunction isWhitespace(cp) {\n    return cp === $.SPACE || cp === $.LINE_FEED || cp === $.TABULATION || cp === $.FORM_FEED;\n}\nfunction isScriptDataDoubleEscapeSequenceEnd(cp) {\n    return isWhitespace(cp) || cp === $.SOLIDUS || cp === $.GREATER_THAN_SIGN;\n}\nfunction getErrorForNumericCharacterReference(code) {\n    if (code === $.NULL) {\n        return ERR.nullCharacterReference;\n    }\n    else if (code > 1114111) {\n        return ERR.characterReferenceOutsideUnicodeRange;\n    }\n    else if (isSurrogate(code)) {\n        return ERR.surrogateCharacterReference;\n    }\n    else if (isUndefinedCodePoint(code)) {\n        return ERR.noncharacterCharacterReference;\n    }\n    else if (isControlCodePoint(code) || code === $.CARRIAGE_RETURN) {\n        return ERR.controlCharacterReference;\n    }\n    return null;\n}\n//Tokenizer\nexport class Tokenizer {\n    constructor(options, handler) {\n        this.options = options;\n        this.handler = handler;\n        this.paused = false;\n        /** Ensures that the parsing loop isn't run multiple times at once. */\n        this.inLoop = false;\n        /**\n         * Indicates that the current adjusted node exists, is not an element in the HTML namespace,\n         * and that it is not an integration point for either MathML or HTML.\n         *\n         * @see {@link https://html.spec.whatwg.org/multipage/parsing.html#tree-construction}\n         */\n        this.inForeignNode = false;\n        this.lastStartTagName = '';\n        this.active = false;\n        this.state = State.DATA;\n        this.returnState = State.DATA;\n        this.entityStartPos = 0;\n        this.consumedAfterSnapshot = -1;\n        this.currentCharacterToken = null;\n        this.currentToken = null;\n        this.currentAttr = { name: '', value: '' };\n        this.preprocessor = new Preprocessor(handler);\n        this.currentLocation = this.getCurrentLocation(-1);\n        this.entityDecoder = new EntityDecoder(htmlDecodeTree, (cp, consumed) => {\n            // Note: Set `pos` _before_ flushing, as flushing might drop\n            // the current chunk and invalidate `entityStartPos`.\n            this.preprocessor.pos = this.entityStartPos + consumed - 1;\n            this._flushCodePointConsumedAsCharacterReference(cp);\n        }, handler.onParseError\n            ? {\n                missingSemicolonAfterCharacterReference: () => {\n                    this._err(ERR.missingSemicolonAfterCharacterReference, 1);\n                },\n                absenceOfDigitsInNumericCharacterReference: (consumed) => {\n                    this._err(ERR.absenceOfDigitsInNumericCharacterReference, this.entityStartPos - this.preprocessor.pos + consumed);\n                },\n                validateNumericCharacterReference: (code) => {\n                    const error = getErrorForNumericCharacterReference(code);\n                    if (error)\n                        this._err(error, 1);\n                },\n            }\n            : undefined);\n    }\n    //Errors\n    _err(code, cpOffset = 0) {\n        var _a, _b;\n        (_b = (_a = this.handler).onParseError) === null || _b === void 0 ? void 0 : _b.call(_a, this.preprocessor.getError(code, cpOffset));\n    }\n    // NOTE: `offset` may never run across line boundaries.\n    getCurrentLocation(offset) {\n        if (!this.options.sourceCodeLocationInfo) {\n            return null;\n        }\n        return {\n            startLine: this.preprocessor.line,\n            startCol: this.preprocessor.col - offset,\n            startOffset: this.preprocessor.offset - offset,\n            endLine: -1,\n            endCol: -1,\n            endOffset: -1,\n        };\n    }\n    _runParsingLoop() {\n        if (this.inLoop)\n            return;\n        this.inLoop = true;\n        while (this.active && !this.paused) {\n            this.consumedAfterSnapshot = 0;\n            const cp = this._consume();\n            if (!this._ensureHibernation()) {\n                this._callState(cp);\n            }\n        }\n        this.inLoop = false;\n    }\n    //API\n    pause() {\n        this.paused = true;\n    }\n    resume(writeCallback) {\n        if (!this.paused) {\n            throw new Error('Parser was already resumed');\n        }\n        this.paused = false;\n        // Necessary for synchronous resume.\n        if (this.inLoop)\n            return;\n        this._runParsingLoop();\n        if (!this.paused) {\n            writeCallback === null || writeCallback === void 0 ? void 0 : writeCallback();\n        }\n    }\n    write(chunk, isLastChunk, writeCallback) {\n        this.active = true;\n        this.preprocessor.write(chunk, isLastChunk);\n        this._runParsingLoop();\n        if (!this.paused) {\n            writeCallback === null || writeCallback === void 0 ? void 0 : writeCallback();\n        }\n    }\n    insertHtmlAtCurrentPos(chunk) {\n        this.active = true;\n        this.preprocessor.insertHtmlAtCurrentPos(chunk);\n        this._runParsingLoop();\n    }\n    //Hibernation\n    _ensureHibernation() {\n        if (this.preprocessor.endOfChunkHit) {\n            this.preprocessor.retreat(this.consumedAfterSnapshot);\n            this.consumedAfterSnapshot = 0;\n            this.active = false;\n            return true;\n        }\n        return false;\n    }\n    //Consumption\n    _consume() {\n        this.consumedAfterSnapshot++;\n        return this.preprocessor.advance();\n    }\n    _advanceBy(count) {\n        this.consumedAfterSnapshot += count;\n        for (let i = 0; i < count; i++) {\n            this.preprocessor.advance();\n        }\n    }\n    _consumeSequenceIfMatch(pattern, caseSensitive) {\n        if (this.preprocessor.startsWith(pattern, caseSensitive)) {\n            // We will already have consumed one character before calling this method.\n            this._advanceBy(pattern.length - 1);\n            return true;\n        }\n        return false;\n    }\n    //Token creation\n    _createStartTagToken() {\n        this.currentToken = {\n            type: TokenType.START_TAG,\n            tagName: '',\n            tagID: TAG_ID.UNKNOWN,\n            selfClosing: false,\n            ackSelfClosing: false,\n            attrs: [],\n            location: this.getCurrentLocation(1),\n        };\n    }\n    _createEndTagToken() {\n        this.currentToken = {\n            type: TokenType.END_TAG,\n            tagName: '',\n            tagID: TAG_ID.UNKNOWN,\n            selfClosing: false,\n            ackSelfClosing: false,\n            attrs: [],\n            location: this.getCurrentLocation(2),\n        };\n    }\n    _createCommentToken(offset) {\n        this.currentToken = {\n            type: TokenType.COMMENT,\n            data: '',\n            location: this.getCurrentLocation(offset),\n        };\n    }\n    _createDoctypeToken(initialName) {\n        this.currentToken = {\n            type: TokenType.DOCTYPE,\n            name: initialName,\n            forceQuirks: false,\n            publicId: null,\n            systemId: null,\n            location: this.currentLocation,\n        };\n    }\n    _createCharacterToken(type, chars) {\n        this.currentCharacterToken = {\n            type,\n            chars,\n            location: this.currentLocation,\n        };\n    }\n    //Tag attributes\n    _createAttr(attrNameFirstCh) {\n        this.currentAttr = {\n            name: attrNameFirstCh,\n            value: '',\n        };\n        this.currentLocation = this.getCurrentLocation(0);\n    }\n    _leaveAttrName() {\n        var _a;\n        var _b;\n        const token = this.currentToken;\n        if (getTokenAttr(token, this.currentAttr.name) === null) {\n            token.attrs.push(this.currentAttr);\n            if (token.location && this.currentLocation) {\n                const attrLocations = ((_a = (_b = token.location).attrs) !== null && _a !== void 0 ? _a : (_b.attrs = Object.create(null)));\n                attrLocations[this.currentAttr.name] = this.currentLocation;\n                // Set end location\n                this._leaveAttrValue();\n            }\n        }\n        else {\n            this._err(ERR.duplicateAttribute);\n        }\n    }\n    _leaveAttrValue() {\n        if (this.currentLocation) {\n            this.currentLocation.endLine = this.preprocessor.line;\n            this.currentLocation.endCol = this.preprocessor.col;\n            this.currentLocation.endOffset = this.preprocessor.offset;\n        }\n    }\n    //Token emission\n    prepareToken(ct) {\n        this._emitCurrentCharacterToken(ct.location);\n        this.currentToken = null;\n        if (ct.location) {\n            ct.location.endLine = this.preprocessor.line;\n            ct.location.endCol = this.preprocessor.col + 1;\n            ct.location.endOffset = this.preprocessor.offset + 1;\n        }\n        this.currentLocation = this.getCurrentLocation(-1);\n    }\n    emitCurrentTagToken() {\n        const ct = this.currentToken;\n        this.prepareToken(ct);\n        ct.tagID = getTagID(ct.tagName);\n        if (ct.type === TokenType.START_TAG) {\n            this.lastStartTagName = ct.tagName;\n            this.handler.onStartTag(ct);\n        }\n        else {\n            if (ct.attrs.length > 0) {\n                this._err(ERR.endTagWithAttributes);\n            }\n            if (ct.selfClosing) {\n                this._err(ERR.endTagWithTrailingSolidus);\n            }\n            this.handler.onEndTag(ct);\n        }\n        this.preprocessor.dropParsedChunk();\n    }\n    emitCurrentComment(ct) {\n        this.prepareToken(ct);\n        this.handler.onComment(ct);\n        this.preprocessor.dropParsedChunk();\n    }\n    emitCurrentDoctype(ct) {\n        this.prepareToken(ct);\n        this.handler.onDoctype(ct);\n        this.preprocessor.dropParsedChunk();\n    }\n    _emitCurrentCharacterToken(nextLocation) {\n        if (this.currentCharacterToken) {\n            //NOTE: if we have a pending character token, make it's end location equal to the\n            //current token's start location.\n            if (nextLocation && this.currentCharacterToken.location) {\n                this.currentCharacterToken.location.endLine = nextLocation.startLine;\n                this.currentCharacterToken.location.endCol = nextLocation.startCol;\n                this.currentCharacterToken.location.endOffset = nextLocation.startOffset;\n            }\n            switch (this.currentCharacterToken.type) {\n                case TokenType.CHARACTER: {\n                    this.handler.onCharacter(this.currentCharacterToken);\n                    break;\n                }\n                case TokenType.NULL_CHARACTER: {\n                    this.handler.onNullCharacter(this.currentCharacterToken);\n                    break;\n                }\n                case TokenType.WHITESPACE_CHARACTER: {\n                    this.handler.onWhitespaceCharacter(this.currentCharacterToken);\n                    break;\n                }\n            }\n            this.currentCharacterToken = null;\n        }\n    }\n    _emitEOFToken() {\n        const location = this.getCurrentLocation(0);\n        if (location) {\n            location.endLine = location.startLine;\n            location.endCol = location.startCol;\n            location.endOffset = location.startOffset;\n        }\n        this._emitCurrentCharacterToken(location);\n        this.handler.onEof({ type: TokenType.EOF, location });\n        this.active = false;\n    }\n    //Characters emission\n    //OPTIMIZATION: The specification uses only one type of character token (one token per character).\n    //This causes a huge memory overhead and a lot of unnecessary parser loops. parse5 uses 3 groups of characters.\n    //If we have a sequence of characters that belong to the same group, the parser can process it\n    //as a single solid character token.\n    //So, there are 3 types of character tokens in parse5:\n    //1)TokenType.NULL_CHARACTER - \\u0000-character sequences (e.g. '\\u0000\\u0000\\u0000')\n    //2)TokenType.WHITESPACE_CHARACTER - any whitespace/new-line character sequences (e.g. '\\n  \\r\\t   \\f')\n    //3)TokenType.CHARACTER - any character sequence which don't belong to groups 1 and 2 (e.g. 'abcdef1234@@#$%^')\n    _appendCharToCurrentCharacterToken(type, ch) {\n        if (this.currentCharacterToken) {\n            if (this.currentCharacterToken.type === type) {\n                this.currentCharacterToken.chars += ch;\n                return;\n            }\n            else {\n                this.currentLocation = this.getCurrentLocation(0);\n                this._emitCurrentCharacterToken(this.currentLocation);\n                this.preprocessor.dropParsedChunk();\n            }\n        }\n        this._createCharacterToken(type, ch);\n    }\n    _emitCodePoint(cp) {\n        const type = isWhitespace(cp)\n            ? TokenType.WHITESPACE_CHARACTER\n            : cp === $.NULL\n                ? TokenType.NULL_CHARACTER\n                : TokenType.CHARACTER;\n        this._appendCharToCurrentCharacterToken(type, String.fromCodePoint(cp));\n    }\n    //NOTE: used when we emit characters explicitly.\n    //This is always for non-whitespace and non-null characters, which allows us to avoid additional checks.\n    _emitChars(ch) {\n        this._appendCharToCurrentCharacterToken(TokenType.CHARACTER, ch);\n    }\n    // Character reference helpers\n    _startCharacterReference() {\n        this.returnState = this.state;\n        this.state = State.CHARACTER_REFERENCE;\n        this.entityStartPos = this.preprocessor.pos;\n        this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute() ? DecodingMode.Attribute : DecodingMode.Legacy);\n    }\n    _isCharacterReferenceInAttribute() {\n        return (this.returnState === State.ATTRIBUTE_VALUE_DOUBLE_QUOTED ||\n            this.returnState === State.ATTRIBUTE_VALUE_SINGLE_QUOTED ||\n            this.returnState === State.ATTRIBUTE_VALUE_UNQUOTED);\n    }\n    _flushCodePointConsumedAsCharacterReference(cp) {\n        if (this._isCharacterReferenceInAttribute()) {\n            this.currentAttr.value += String.fromCodePoint(cp);\n        }\n        else {\n            this._emitCodePoint(cp);\n        }\n    }\n    // Calling states this way turns out to be much faster than any other approach.\n    _callState(cp) {\n        switch (this.state) {\n            case State.DATA: {\n                this._stateData(cp);\n                break;\n            }\n            case State.RCDATA: {\n                this._stateRcdata(cp);\n                break;\n            }\n            case State.RAWTEXT: {\n                this._stateRawtext(cp);\n                break;\n            }\n            case State.SCRIPT_DATA: {\n                this._stateScriptData(cp);\n                break;\n            }\n            case State.PLAINTEXT: {\n                this._statePlaintext(cp);\n                break;\n            }\n            case State.TAG_OPEN: {\n                this._stateTagOpen(cp);\n                break;\n            }\n            case State.END_TAG_OPEN: {\n                this._stateEndTagOpen(cp);\n                break;\n            }\n            case State.TAG_NAME: {\n                this._stateTagName(cp);\n                break;\n            }\n            case State.RCDATA_LESS_THAN_SIGN: {\n                this._stateRcdataLessThanSign(cp);\n                break;\n            }\n            case State.RCDATA_END_TAG_OPEN: {\n                this._stateRcdataEndTagOpen(cp);\n                break;\n            }\n            case State.RCDATA_END_TAG_NAME: {\n                this._stateRcdataEndTagName(cp);\n                break;\n            }\n            case State.RAWTEXT_LESS_THAN_SIGN: {\n                this._stateRawtextLessThanSign(cp);\n                break;\n            }\n            case State.RAWTEXT_END_TAG_OPEN: {\n                this._stateRawtextEndTagOpen(cp);\n                break;\n            }\n            case State.RAWTEXT_END_TAG_NAME: {\n                this._stateRawtextEndTagName(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_LESS_THAN_SIGN: {\n                this._stateScriptDataLessThanSign(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_END_TAG_OPEN: {\n                this._stateScriptDataEndTagOpen(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_END_TAG_NAME: {\n                this._stateScriptDataEndTagName(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_ESCAPE_START: {\n                this._stateScriptDataEscapeStart(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_ESCAPE_START_DASH: {\n                this._stateScriptDataEscapeStartDash(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_ESCAPED: {\n                this._stateScriptDataEscaped(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_ESCAPED_DASH: {\n                this._stateScriptDataEscapedDash(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_ESCAPED_DASH_DASH: {\n                this._stateScriptDataEscapedDashDash(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN: {\n                this._stateScriptDataEscapedLessThanSign(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_ESCAPED_END_TAG_OPEN: {\n                this._stateScriptDataEscapedEndTagOpen(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_ESCAPED_END_TAG_NAME: {\n                this._stateScriptDataEscapedEndTagName(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_DOUBLE_ESCAPE_START: {\n                this._stateScriptDataDoubleEscapeStart(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_DOUBLE_ESCAPED: {\n                this._stateScriptDataDoubleEscaped(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_DOUBLE_ESCAPED_DASH: {\n                this._stateScriptDataDoubleEscapedDash(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH: {\n                this._stateScriptDataDoubleEscapedDashDash(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN: {\n                this._stateScriptDataDoubleEscapedLessThanSign(cp);\n                break;\n            }\n            case State.SCRIPT_DATA_DOUBLE_ESCAPE_END: {\n                this._stateScriptDataDoubleEscapeEnd(cp);\n                break;\n            }\n            case State.BEFORE_ATTRIBUTE_NAME: {\n                this._stateBeforeAttributeName(cp);\n                break;\n            }\n            case State.ATTRIBUTE_NAME: {\n                this._stateAttributeName(cp);\n                break;\n            }\n            case State.AFTER_ATTRIBUTE_NAME: {\n                this._stateAfterAttributeName(cp);\n                break;\n            }\n            case State.BEFORE_ATTRIBUTE_VALUE: {\n                this._stateBeforeAttributeValue(cp);\n                break;\n            }\n            case State.ATTRIBUTE_VALUE_DOUBLE_QUOTED: {\n                this._stateAttributeValueDoubleQuoted(cp);\n                break;\n            }\n            case State.ATTRIBUTE_VALUE_SINGLE_QUOTED: {\n                this._stateAttributeValueSingleQuoted(cp);\n                break;\n            }\n            case State.ATTRIBUTE_VALUE_UNQUOTED: {\n                this._stateAttributeValueUnquoted(cp);\n                break;\n            }\n            case State.AFTER_ATTRIBUTE_VALUE_QUOTED: {\n                this._stateAfterAttributeValueQuoted(cp);\n                break;\n            }\n            case State.SELF_CLOSING_START_TAG: {\n                this._stateSelfClosingStartTag(cp);\n                break;\n            }\n            case State.BOGUS_COMMENT: {\n                this._stateBogusComment(cp);\n                break;\n            }\n            case State.MARKUP_DECLARATION_OPEN: {\n                this._stateMarkupDeclarationOpen(cp);\n                break;\n            }\n            case State.COMMENT_START: {\n                this._stateCommentStart(cp);\n                break;\n            }\n            case State.COMMENT_START_DASH: {\n                this._stateCommentStartDash(cp);\n                break;\n            }\n            case State.COMMENT: {\n                this._stateComment(cp);\n                break;\n            }\n            case State.COMMENT_LESS_THAN_SIGN: {\n                this._stateCommentLessThanSign(cp);\n                break;\n            }\n            case State.COMMENT_LESS_THAN_SIGN_BANG: {\n                this._stateCommentLessThanSignBang(cp);\n                break;\n            }\n            case State.COMMENT_LESS_THAN_SIGN_BANG_DASH: {\n                this._stateCommentLessThanSignBangDash(cp);\n                break;\n            }\n            case State.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH: {\n                this._stateCommentLessThanSignBangDashDash(cp);\n                break;\n            }\n            case State.COMMENT_END_DASH: {\n                this._stateCommentEndDash(cp);\n                break;\n            }\n            case State.COMMENT_END: {\n                this._stateCommentEnd(cp);\n                break;\n            }\n            case State.COMMENT_END_BANG: {\n                this._stateCommentEndBang(cp);\n                break;\n            }\n            case State.DOCTYPE: {\n                this._stateDoctype(cp);\n                break;\n            }\n            case State.BEFORE_DOCTYPE_NAME: {\n                this._stateBeforeDoctypeName(cp);\n                break;\n            }\n            case State.DOCTYPE_NAME: {\n                this._stateDoctypeName(cp);\n                break;\n            }\n            case State.AFTER_DOCTYPE_NAME: {\n                this._stateAfterDoctypeName(cp);\n                break;\n            }\n            case State.AFTER_DOCTYPE_PUBLIC_KEYWORD: {\n                this._stateAfterDoctypePublicKeyword(cp);\n                break;\n            }\n            case State.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER: {\n                this._stateBeforeDoctypePublicIdentifier(cp);\n                break;\n            }\n            case State.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED: {\n                this._stateDoctypePublicIdentifierDoubleQuoted(cp);\n                break;\n            }\n            case State.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED: {\n                this._stateDoctypePublicIdentifierSingleQuoted(cp);\n                break;\n            }\n            case State.AFTER_DOCTYPE_PUBLIC_IDENTIFIER: {\n                this._stateAfterDoctypePublicIdentifier(cp);\n                break;\n            }\n            case State.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS: {\n                this._stateBetweenDoctypePublicAndSystemIdentifiers(cp);\n                break;\n            }\n            case State.AFTER_DOCTYPE_SYSTEM_KEYWORD: {\n                this._stateAfterDoctypeSystemKeyword(cp);\n                break;\n            }\n            case State.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER: {\n                this._stateBeforeDoctypeSystemIdentifier(cp);\n                break;\n            }\n            case State.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED: {\n                this._stateDoctypeSystemIdentifierDoubleQuoted(cp);\n                break;\n            }\n            case State.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED: {\n                this._stateDoctypeSystemIdentifierSingleQuoted(cp);\n                break;\n            }\n            case State.AFTER_DOCTYPE_SYSTEM_IDENTIFIER: {\n                this._stateAfterDoctypeSystemIdentifier(cp);\n                break;\n            }\n            case State.BOGUS_DOCTYPE: {\n                this._stateBogusDoctype(cp);\n                break;\n            }\n            case State.CDATA_SECTION: {\n                this._stateCdataSection(cp);\n                break;\n            }\n            case State.CDATA_SECTION_BRACKET: {\n                this._stateCdataSectionBracket(cp);\n                break;\n            }\n            case State.CDATA_SECTION_END: {\n                this._stateCdataSectionEnd(cp);\n                break;\n            }\n            case State.CHARACTER_REFERENCE: {\n                this._stateCharacterReference();\n                break;\n            }\n            case State.AMBIGUOUS_AMPERSAND: {\n                this._stateAmbiguousAmpersand(cp);\n                break;\n            }\n            default: {\n                throw new Error('Unknown state');\n            }\n        }\n    }\n    // State machine\n    // Data state\n    //------------------------------------------------------------------\n    _stateData(cp) {\n        switch (cp) {\n            case $.LESS_THAN_SIGN: {\n                this.state = State.TAG_OPEN;\n                break;\n            }\n            case $.AMPERSAND: {\n                this._startCharacterReference();\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this._emitCodePoint(cp);\n                break;\n            }\n            case $.EOF: {\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    //  RCDATA state\n    //------------------------------------------------------------------\n    _stateRcdata(cp) {\n        switch (cp) {\n            case $.AMPERSAND: {\n                this._startCharacterReference();\n                break;\n            }\n            case $.LESS_THAN_SIGN: {\n                this.state = State.RCDATA_LESS_THAN_SIGN;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // RAWTEXT state\n    //------------------------------------------------------------------\n    _stateRawtext(cp) {\n        switch (cp) {\n            case $.LESS_THAN_SIGN: {\n                this.state = State.RAWTEXT_LESS_THAN_SIGN;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // Script data state\n    //------------------------------------------------------------------\n    _stateScriptData(cp) {\n        switch (cp) {\n            case $.LESS_THAN_SIGN: {\n                this.state = State.SCRIPT_DATA_LESS_THAN_SIGN;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // PLAINTEXT state\n    //------------------------------------------------------------------\n    _statePlaintext(cp) {\n        switch (cp) {\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // Tag open state\n    //------------------------------------------------------------------\n    _stateTagOpen(cp) {\n        if (isAsciiLetter(cp)) {\n            this._createStartTagToken();\n            this.state = State.TAG_NAME;\n            this._stateTagName(cp);\n        }\n        else\n            switch (cp) {\n                case $.EXCLAMATION_MARK: {\n                    this.state = State.MARKUP_DECLARATION_OPEN;\n                    break;\n                }\n                case $.SOLIDUS: {\n                    this.state = State.END_TAG_OPEN;\n                    break;\n                }\n                case $.QUESTION_MARK: {\n                    this._err(ERR.unexpectedQuestionMarkInsteadOfTagName);\n                    this._createCommentToken(1);\n                    this.state = State.BOGUS_COMMENT;\n                    this._stateBogusComment(cp);\n                    break;\n                }\n                case $.EOF: {\n                    this._err(ERR.eofBeforeTagName);\n                    this._emitChars('<');\n                    this._emitEOFToken();\n                    break;\n                }\n                default: {\n                    this._err(ERR.invalidFirstCharacterOfTagName);\n                    this._emitChars('<');\n                    this.state = State.DATA;\n                    this._stateData(cp);\n                }\n            }\n    }\n    // End tag open state\n    //------------------------------------------------------------------\n    _stateEndTagOpen(cp) {\n        if (isAsciiLetter(cp)) {\n            this._createEndTagToken();\n            this.state = State.TAG_NAME;\n            this._stateTagName(cp);\n        }\n        else\n            switch (cp) {\n                case $.GREATER_THAN_SIGN: {\n                    this._err(ERR.missingEndTagName);\n                    this.state = State.DATA;\n                    break;\n                }\n                case $.EOF: {\n                    this._err(ERR.eofBeforeTagName);\n                    this._emitChars('</');\n                    this._emitEOFToken();\n                    break;\n                }\n                default: {\n                    this._err(ERR.invalidFirstCharacterOfTagName);\n                    this._createCommentToken(2);\n                    this.state = State.BOGUS_COMMENT;\n                    this._stateBogusComment(cp);\n                }\n            }\n    }\n    // Tag name state\n    //------------------------------------------------------------------\n    _stateTagName(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                this.state = State.BEFORE_ATTRIBUTE_NAME;\n                break;\n            }\n            case $.SOLIDUS: {\n                this.state = State.SELF_CLOSING_START_TAG;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.DATA;\n                this.emitCurrentTagToken();\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                token.tagName += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInTag);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.tagName += String.fromCodePoint(isAsciiUpper(cp) ? toAsciiLower(cp) : cp);\n            }\n        }\n    }\n    // RCDATA less-than sign state\n    //------------------------------------------------------------------\n    _stateRcdataLessThanSign(cp) {\n        if (cp === $.SOLIDUS) {\n            this.state = State.RCDATA_END_TAG_OPEN;\n        }\n        else {\n            this._emitChars('<');\n            this.state = State.RCDATA;\n            this._stateRcdata(cp);\n        }\n    }\n    // RCDATA end tag open state\n    //------------------------------------------------------------------\n    _stateRcdataEndTagOpen(cp) {\n        if (isAsciiLetter(cp)) {\n            this.state = State.RCDATA_END_TAG_NAME;\n            this._stateRcdataEndTagName(cp);\n        }\n        else {\n            this._emitChars('</');\n            this.state = State.RCDATA;\n            this._stateRcdata(cp);\n        }\n    }\n    handleSpecialEndTag(_cp) {\n        if (!this.preprocessor.startsWith(this.lastStartTagName, false)) {\n            return !this._ensureHibernation();\n        }\n        this._createEndTagToken();\n        const token = this.currentToken;\n        token.tagName = this.lastStartTagName;\n        const cp = this.preprocessor.peek(this.lastStartTagName.length);\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                this._advanceBy(this.lastStartTagName.length);\n                this.state = State.BEFORE_ATTRIBUTE_NAME;\n                return false;\n            }\n            case $.SOLIDUS: {\n                this._advanceBy(this.lastStartTagName.length);\n                this.state = State.SELF_CLOSING_START_TAG;\n                return false;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._advanceBy(this.lastStartTagName.length);\n                this.emitCurrentTagToken();\n                this.state = State.DATA;\n                return false;\n            }\n            default: {\n                return !this._ensureHibernation();\n            }\n        }\n    }\n    // RCDATA end tag name state\n    //------------------------------------------------------------------\n    _stateRcdataEndTagName(cp) {\n        if (this.handleSpecialEndTag(cp)) {\n            this._emitChars('</');\n            this.state = State.RCDATA;\n            this._stateRcdata(cp);\n        }\n    }\n    // RAWTEXT less-than sign state\n    //------------------------------------------------------------------\n    _stateRawtextLessThanSign(cp) {\n        if (cp === $.SOLIDUS) {\n            this.state = State.RAWTEXT_END_TAG_OPEN;\n        }\n        else {\n            this._emitChars('<');\n            this.state = State.RAWTEXT;\n            this._stateRawtext(cp);\n        }\n    }\n    // RAWTEXT end tag open state\n    //------------------------------------------------------------------\n    _stateRawtextEndTagOpen(cp) {\n        if (isAsciiLetter(cp)) {\n            this.state = State.RAWTEXT_END_TAG_NAME;\n            this._stateRawtextEndTagName(cp);\n        }\n        else {\n            this._emitChars('</');\n            this.state = State.RAWTEXT;\n            this._stateRawtext(cp);\n        }\n    }\n    // RAWTEXT end tag name state\n    //------------------------------------------------------------------\n    _stateRawtextEndTagName(cp) {\n        if (this.handleSpecialEndTag(cp)) {\n            this._emitChars('</');\n            this.state = State.RAWTEXT;\n            this._stateRawtext(cp);\n        }\n    }\n    // Script data less-than sign state\n    //------------------------------------------------------------------\n    _stateScriptDataLessThanSign(cp) {\n        switch (cp) {\n            case $.SOLIDUS: {\n                this.state = State.SCRIPT_DATA_END_TAG_OPEN;\n                break;\n            }\n            case $.EXCLAMATION_MARK: {\n                this.state = State.SCRIPT_DATA_ESCAPE_START;\n                this._emitChars('<!');\n                break;\n            }\n            default: {\n                this._emitChars('<');\n                this.state = State.SCRIPT_DATA;\n                this._stateScriptData(cp);\n            }\n        }\n    }\n    // Script data end tag open state\n    //------------------------------------------------------------------\n    _stateScriptDataEndTagOpen(cp) {\n        if (isAsciiLetter(cp)) {\n            this.state = State.SCRIPT_DATA_END_TAG_NAME;\n            this._stateScriptDataEndTagName(cp);\n        }\n        else {\n            this._emitChars('</');\n            this.state = State.SCRIPT_DATA;\n            this._stateScriptData(cp);\n        }\n    }\n    // Script data end tag name state\n    //------------------------------------------------------------------\n    _stateScriptDataEndTagName(cp) {\n        if (this.handleSpecialEndTag(cp)) {\n            this._emitChars('</');\n            this.state = State.SCRIPT_DATA;\n            this._stateScriptData(cp);\n        }\n    }\n    // Script data escape start state\n    //------------------------------------------------------------------\n    _stateScriptDataEscapeStart(cp) {\n        if (cp === $.HYPHEN_MINUS) {\n            this.state = State.SCRIPT_DATA_ESCAPE_START_DASH;\n            this._emitChars('-');\n        }\n        else {\n            this.state = State.SCRIPT_DATA;\n            this._stateScriptData(cp);\n        }\n    }\n    // Script data escape start dash state\n    //------------------------------------------------------------------\n    _stateScriptDataEscapeStartDash(cp) {\n        if (cp === $.HYPHEN_MINUS) {\n            this.state = State.SCRIPT_DATA_ESCAPED_DASH_DASH;\n            this._emitChars('-');\n        }\n        else {\n            this.state = State.SCRIPT_DATA;\n            this._stateScriptData(cp);\n        }\n    }\n    // Script data escaped state\n    //------------------------------------------------------------------\n    _stateScriptDataEscaped(cp) {\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this.state = State.SCRIPT_DATA_ESCAPED_DASH;\n                this._emitChars('-');\n                break;\n            }\n            case $.LESS_THAN_SIGN: {\n                this.state = State.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInScriptHtmlCommentLikeText);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // Script data escaped dash state\n    //------------------------------------------------------------------\n    _stateScriptDataEscapedDash(cp) {\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this.state = State.SCRIPT_DATA_ESCAPED_DASH_DASH;\n                this._emitChars('-');\n                break;\n            }\n            case $.LESS_THAN_SIGN: {\n                this.state = State.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this.state = State.SCRIPT_DATA_ESCAPED;\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInScriptHtmlCommentLikeText);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this.state = State.SCRIPT_DATA_ESCAPED;\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // Script data escaped dash dash state\n    //------------------------------------------------------------------\n    _stateScriptDataEscapedDashDash(cp) {\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this._emitChars('-');\n                break;\n            }\n            case $.LESS_THAN_SIGN: {\n                this.state = State.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.SCRIPT_DATA;\n                this._emitChars('>');\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this.state = State.SCRIPT_DATA_ESCAPED;\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInScriptHtmlCommentLikeText);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this.state = State.SCRIPT_DATA_ESCAPED;\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // Script data escaped less-than sign state\n    //------------------------------------------------------------------\n    _stateScriptDataEscapedLessThanSign(cp) {\n        if (cp === $.SOLIDUS) {\n            this.state = State.SCRIPT_DATA_ESCAPED_END_TAG_OPEN;\n        }\n        else if (isAsciiLetter(cp)) {\n            this._emitChars('<');\n            this.state = State.SCRIPT_DATA_DOUBLE_ESCAPE_START;\n            this._stateScriptDataDoubleEscapeStart(cp);\n        }\n        else {\n            this._emitChars('<');\n            this.state = State.SCRIPT_DATA_ESCAPED;\n            this._stateScriptDataEscaped(cp);\n        }\n    }\n    // Script data escaped end tag open state\n    //------------------------------------------------------------------\n    _stateScriptDataEscapedEndTagOpen(cp) {\n        if (isAsciiLetter(cp)) {\n            this.state = State.SCRIPT_DATA_ESCAPED_END_TAG_NAME;\n            this._stateScriptDataEscapedEndTagName(cp);\n        }\n        else {\n            this._emitChars('</');\n            this.state = State.SCRIPT_DATA_ESCAPED;\n            this._stateScriptDataEscaped(cp);\n        }\n    }\n    // Script data escaped end tag name state\n    //------------------------------------------------------------------\n    _stateScriptDataEscapedEndTagName(cp) {\n        if (this.handleSpecialEndTag(cp)) {\n            this._emitChars('</');\n            this.state = State.SCRIPT_DATA_ESCAPED;\n            this._stateScriptDataEscaped(cp);\n        }\n    }\n    // Script data double escape start state\n    //------------------------------------------------------------------\n    _stateScriptDataDoubleEscapeStart(cp) {\n        if (this.preprocessor.startsWith($$.SCRIPT, false) &&\n            isScriptDataDoubleEscapeSequenceEnd(this.preprocessor.peek($$.SCRIPT.length))) {\n            this._emitCodePoint(cp);\n            for (let i = 0; i < $$.SCRIPT.length; i++) {\n                this._emitCodePoint(this._consume());\n            }\n            this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED;\n        }\n        else if (!this._ensureHibernation()) {\n            this.state = State.SCRIPT_DATA_ESCAPED;\n            this._stateScriptDataEscaped(cp);\n        }\n    }\n    // Script data double escaped state\n    //------------------------------------------------------------------\n    _stateScriptDataDoubleEscaped(cp) {\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED_DASH;\n                this._emitChars('-');\n                break;\n            }\n            case $.LESS_THAN_SIGN: {\n                this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN;\n                this._emitChars('<');\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInScriptHtmlCommentLikeText);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // Script data double escaped dash state\n    //------------------------------------------------------------------\n    _stateScriptDataDoubleEscapedDash(cp) {\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH;\n                this._emitChars('-');\n                break;\n            }\n            case $.LESS_THAN_SIGN: {\n                this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN;\n                this._emitChars('<');\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED;\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInScriptHtmlCommentLikeText);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED;\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // Script data double escaped dash dash state\n    //------------------------------------------------------------------\n    _stateScriptDataDoubleEscapedDashDash(cp) {\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this._emitChars('-');\n                break;\n            }\n            case $.LESS_THAN_SIGN: {\n                this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN;\n                this._emitChars('<');\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.SCRIPT_DATA;\n                this._emitChars('>');\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED;\n                this._emitChars(REPLACEMENT_CHARACTER);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInScriptHtmlCommentLikeText);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED;\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // Script data double escaped less-than sign state\n    //------------------------------------------------------------------\n    _stateScriptDataDoubleEscapedLessThanSign(cp) {\n        if (cp === $.SOLIDUS) {\n            this.state = State.SCRIPT_DATA_DOUBLE_ESCAPE_END;\n            this._emitChars('/');\n        }\n        else {\n            this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED;\n            this._stateScriptDataDoubleEscaped(cp);\n        }\n    }\n    // Script data double escape end state\n    //------------------------------------------------------------------\n    _stateScriptDataDoubleEscapeEnd(cp) {\n        if (this.preprocessor.startsWith($$.SCRIPT, false) &&\n            isScriptDataDoubleEscapeSequenceEnd(this.preprocessor.peek($$.SCRIPT.length))) {\n            this._emitCodePoint(cp);\n            for (let i = 0; i < $$.SCRIPT.length; i++) {\n                this._emitCodePoint(this._consume());\n            }\n            this.state = State.SCRIPT_DATA_ESCAPED;\n        }\n        else if (!this._ensureHibernation()) {\n            this.state = State.SCRIPT_DATA_DOUBLE_ESCAPED;\n            this._stateScriptDataDoubleEscaped(cp);\n        }\n    }\n    // Before attribute name state\n    //------------------------------------------------------------------\n    _stateBeforeAttributeName(cp) {\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                // Ignore whitespace\n                break;\n            }\n            case $.SOLIDUS:\n            case $.GREATER_THAN_SIGN:\n            case $.EOF: {\n                this.state = State.AFTER_ATTRIBUTE_NAME;\n                this._stateAfterAttributeName(cp);\n                break;\n            }\n            case $.EQUALS_SIGN: {\n                this._err(ERR.unexpectedEqualsSignBeforeAttributeName);\n                this._createAttr('=');\n                this.state = State.ATTRIBUTE_NAME;\n                break;\n            }\n            default: {\n                this._createAttr('');\n                this.state = State.ATTRIBUTE_NAME;\n                this._stateAttributeName(cp);\n            }\n        }\n    }\n    // Attribute name state\n    //------------------------------------------------------------------\n    _stateAttributeName(cp) {\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED:\n            case $.SOLIDUS:\n            case $.GREATER_THAN_SIGN:\n            case $.EOF: {\n                this._leaveAttrName();\n                this.state = State.AFTER_ATTRIBUTE_NAME;\n                this._stateAfterAttributeName(cp);\n                break;\n            }\n            case $.EQUALS_SIGN: {\n                this._leaveAttrName();\n                this.state = State.BEFORE_ATTRIBUTE_VALUE;\n                break;\n            }\n            case $.QUOTATION_MARK:\n            case $.APOSTROPHE:\n            case $.LESS_THAN_SIGN: {\n                this._err(ERR.unexpectedCharacterInAttributeName);\n                this.currentAttr.name += String.fromCodePoint(cp);\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this.currentAttr.name += REPLACEMENT_CHARACTER;\n                break;\n            }\n            default: {\n                this.currentAttr.name += String.fromCodePoint(isAsciiUpper(cp) ? toAsciiLower(cp) : cp);\n            }\n        }\n    }\n    // After attribute name state\n    //------------------------------------------------------------------\n    _stateAfterAttributeName(cp) {\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                // Ignore whitespace\n                break;\n            }\n            case $.SOLIDUS: {\n                this.state = State.SELF_CLOSING_START_TAG;\n                break;\n            }\n            case $.EQUALS_SIGN: {\n                this.state = State.BEFORE_ATTRIBUTE_VALUE;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.DATA;\n                this.emitCurrentTagToken();\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInTag);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._createAttr('');\n                this.state = State.ATTRIBUTE_NAME;\n                this._stateAttributeName(cp);\n            }\n        }\n    }\n    // Before attribute value state\n    //------------------------------------------------------------------\n    _stateBeforeAttributeValue(cp) {\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                // Ignore whitespace\n                break;\n            }\n            case $.QUOTATION_MARK: {\n                this.state = State.ATTRIBUTE_VALUE_DOUBLE_QUOTED;\n                break;\n            }\n            case $.APOSTROPHE: {\n                this.state = State.ATTRIBUTE_VALUE_SINGLE_QUOTED;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.missingAttributeValue);\n                this.state = State.DATA;\n                this.emitCurrentTagToken();\n                break;\n            }\n            default: {\n                this.state = State.ATTRIBUTE_VALUE_UNQUOTED;\n                this._stateAttributeValueUnquoted(cp);\n            }\n        }\n    }\n    // Attribute value (double-quoted) state\n    //------------------------------------------------------------------\n    _stateAttributeValueDoubleQuoted(cp) {\n        switch (cp) {\n            case $.QUOTATION_MARK: {\n                this.state = State.AFTER_ATTRIBUTE_VALUE_QUOTED;\n                break;\n            }\n            case $.AMPERSAND: {\n                this._startCharacterReference();\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this.currentAttr.value += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInTag);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this.currentAttr.value += String.fromCodePoint(cp);\n            }\n        }\n    }\n    // Attribute value (single-quoted) state\n    //------------------------------------------------------------------\n    _stateAttributeValueSingleQuoted(cp) {\n        switch (cp) {\n            case $.APOSTROPHE: {\n                this.state = State.AFTER_ATTRIBUTE_VALUE_QUOTED;\n                break;\n            }\n            case $.AMPERSAND: {\n                this._startCharacterReference();\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this.currentAttr.value += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInTag);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this.currentAttr.value += String.fromCodePoint(cp);\n            }\n        }\n    }\n    // Attribute value (unquoted) state\n    //------------------------------------------------------------------\n    _stateAttributeValueUnquoted(cp) {\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                this._leaveAttrValue();\n                this.state = State.BEFORE_ATTRIBUTE_NAME;\n                break;\n            }\n            case $.AMPERSAND: {\n                this._startCharacterReference();\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._leaveAttrValue();\n                this.state = State.DATA;\n                this.emitCurrentTagToken();\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                this.currentAttr.value += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.QUOTATION_MARK:\n            case $.APOSTROPHE:\n            case $.LESS_THAN_SIGN:\n            case $.EQUALS_SIGN:\n            case $.GRAVE_ACCENT: {\n                this._err(ERR.unexpectedCharacterInUnquotedAttributeValue);\n                this.currentAttr.value += String.fromCodePoint(cp);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInTag);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this.currentAttr.value += String.fromCodePoint(cp);\n            }\n        }\n    }\n    // After attribute value (quoted) state\n    //------------------------------------------------------------------\n    _stateAfterAttributeValueQuoted(cp) {\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                this._leaveAttrValue();\n                this.state = State.BEFORE_ATTRIBUTE_NAME;\n                break;\n            }\n            case $.SOLIDUS: {\n                this._leaveAttrValue();\n                this.state = State.SELF_CLOSING_START_TAG;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._leaveAttrValue();\n                this.state = State.DATA;\n                this.emitCurrentTagToken();\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInTag);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.missingWhitespaceBetweenAttributes);\n                this.state = State.BEFORE_ATTRIBUTE_NAME;\n                this._stateBeforeAttributeName(cp);\n            }\n        }\n    }\n    // Self-closing start tag state\n    //------------------------------------------------------------------\n    _stateSelfClosingStartTag(cp) {\n        switch (cp) {\n            case $.GREATER_THAN_SIGN: {\n                const token = this.currentToken;\n                token.selfClosing = true;\n                this.state = State.DATA;\n                this.emitCurrentTagToken();\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInTag);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.unexpectedSolidusInTag);\n                this.state = State.BEFORE_ATTRIBUTE_NAME;\n                this._stateBeforeAttributeName(cp);\n            }\n        }\n    }\n    // Bogus comment state\n    //------------------------------------------------------------------\n    _stateBogusComment(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.DATA;\n                this.emitCurrentComment(token);\n                break;\n            }\n            case $.EOF: {\n                this.emitCurrentComment(token);\n                this._emitEOFToken();\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                token.data += REPLACEMENT_CHARACTER;\n                break;\n            }\n            default: {\n                token.data += String.fromCodePoint(cp);\n            }\n        }\n    }\n    // Markup declaration open state\n    //------------------------------------------------------------------\n    _stateMarkupDeclarationOpen(cp) {\n        if (this._consumeSequenceIfMatch($$.DASH_DASH, true)) {\n            this._createCommentToken($$.DASH_DASH.length + 1);\n            this.state = State.COMMENT_START;\n        }\n        else if (this._consumeSequenceIfMatch($$.DOCTYPE, false)) {\n            // NOTE: Doctypes tokens are created without fixed offsets. We keep track of the moment a doctype *might* start here.\n            this.currentLocation = this.getCurrentLocation($$.DOCTYPE.length + 1);\n            this.state = State.DOCTYPE;\n        }\n        else if (this._consumeSequenceIfMatch($$.CDATA_START, true)) {\n            if (this.inForeignNode) {\n                this.state = State.CDATA_SECTION;\n            }\n            else {\n                this._err(ERR.cdataInHtmlContent);\n                this._createCommentToken($$.CDATA_START.length + 1);\n                this.currentToken.data = '[CDATA[';\n                this.state = State.BOGUS_COMMENT;\n            }\n        }\n        //NOTE: Sequence lookups can be abrupted by hibernation. In that case, lookup\n        //results are no longer valid and we will need to start over.\n        else if (!this._ensureHibernation()) {\n            this._err(ERR.incorrectlyOpenedComment);\n            this._createCommentToken(2);\n            this.state = State.BOGUS_COMMENT;\n            this._stateBogusComment(cp);\n        }\n    }\n    // Comment start state\n    //------------------------------------------------------------------\n    _stateCommentStart(cp) {\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this.state = State.COMMENT_START_DASH;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.abruptClosingOfEmptyComment);\n                this.state = State.DATA;\n                const token = this.currentToken;\n                this.emitCurrentComment(token);\n                break;\n            }\n            default: {\n                this.state = State.COMMENT;\n                this._stateComment(cp);\n            }\n        }\n    }\n    // Comment start dash state\n    //------------------------------------------------------------------\n    _stateCommentStartDash(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this.state = State.COMMENT_END;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.abruptClosingOfEmptyComment);\n                this.state = State.DATA;\n                this.emitCurrentComment(token);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInComment);\n                this.emitCurrentComment(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.data += '-';\n                this.state = State.COMMENT;\n                this._stateComment(cp);\n            }\n        }\n    }\n    // Comment state\n    //------------------------------------------------------------------\n    _stateComment(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this.state = State.COMMENT_END_DASH;\n                break;\n            }\n            case $.LESS_THAN_SIGN: {\n                token.data += '<';\n                this.state = State.COMMENT_LESS_THAN_SIGN;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                token.data += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInComment);\n                this.emitCurrentComment(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.data += String.fromCodePoint(cp);\n            }\n        }\n    }\n    // Comment less-than sign state\n    //------------------------------------------------------------------\n    _stateCommentLessThanSign(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.EXCLAMATION_MARK: {\n                token.data += '!';\n                this.state = State.COMMENT_LESS_THAN_SIGN_BANG;\n                break;\n            }\n            case $.LESS_THAN_SIGN: {\n                token.data += '<';\n                break;\n            }\n            default: {\n                this.state = State.COMMENT;\n                this._stateComment(cp);\n            }\n        }\n    }\n    // Comment less-than sign bang state\n    //------------------------------------------------------------------\n    _stateCommentLessThanSignBang(cp) {\n        if (cp === $.HYPHEN_MINUS) {\n            this.state = State.COMMENT_LESS_THAN_SIGN_BANG_DASH;\n        }\n        else {\n            this.state = State.COMMENT;\n            this._stateComment(cp);\n        }\n    }\n    // Comment less-than sign bang dash state\n    //------------------------------------------------------------------\n    _stateCommentLessThanSignBangDash(cp) {\n        if (cp === $.HYPHEN_MINUS) {\n            this.state = State.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH;\n        }\n        else {\n            this.state = State.COMMENT_END_DASH;\n            this._stateCommentEndDash(cp);\n        }\n    }\n    // Comment less-than sign bang dash dash state\n    //------------------------------------------------------------------\n    _stateCommentLessThanSignBangDashDash(cp) {\n        if (cp !== $.GREATER_THAN_SIGN && cp !== $.EOF) {\n            this._err(ERR.nestedComment);\n        }\n        this.state = State.COMMENT_END;\n        this._stateCommentEnd(cp);\n    }\n    // Comment end dash state\n    //------------------------------------------------------------------\n    _stateCommentEndDash(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                this.state = State.COMMENT_END;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInComment);\n                this.emitCurrentComment(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.data += '-';\n                this.state = State.COMMENT;\n                this._stateComment(cp);\n            }\n        }\n    }\n    // Comment end state\n    //------------------------------------------------------------------\n    _stateCommentEnd(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.DATA;\n                this.emitCurrentComment(token);\n                break;\n            }\n            case $.EXCLAMATION_MARK: {\n                this.state = State.COMMENT_END_BANG;\n                break;\n            }\n            case $.HYPHEN_MINUS: {\n                token.data += '-';\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInComment);\n                this.emitCurrentComment(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.data += '--';\n                this.state = State.COMMENT;\n                this._stateComment(cp);\n            }\n        }\n    }\n    // Comment end bang state\n    //------------------------------------------------------------------\n    _stateCommentEndBang(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.HYPHEN_MINUS: {\n                token.data += '--!';\n                this.state = State.COMMENT_END_DASH;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.incorrectlyClosedComment);\n                this.state = State.DATA;\n                this.emitCurrentComment(token);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInComment);\n                this.emitCurrentComment(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.data += '--!';\n                this.state = State.COMMENT;\n                this._stateComment(cp);\n            }\n        }\n    }\n    // DOCTYPE state\n    //------------------------------------------------------------------\n    _stateDoctype(cp) {\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                this.state = State.BEFORE_DOCTYPE_NAME;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.BEFORE_DOCTYPE_NAME;\n                this._stateBeforeDoctypeName(cp);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                this._createDoctypeToken(null);\n                const token = this.currentToken;\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.missingWhitespaceBeforeDoctypeName);\n                this.state = State.BEFORE_DOCTYPE_NAME;\n                this._stateBeforeDoctypeName(cp);\n            }\n        }\n    }\n    // Before DOCTYPE name state\n    //------------------------------------------------------------------\n    _stateBeforeDoctypeName(cp) {\n        if (isAsciiUpper(cp)) {\n            this._createDoctypeToken(String.fromCharCode(toAsciiLower(cp)));\n            this.state = State.DOCTYPE_NAME;\n        }\n        else\n            switch (cp) {\n                case $.SPACE:\n                case $.LINE_FEED:\n                case $.TABULATION:\n                case $.FORM_FEED: {\n                    // Ignore whitespace\n                    break;\n                }\n                case $.NULL: {\n                    this._err(ERR.unexpectedNullCharacter);\n                    this._createDoctypeToken(REPLACEMENT_CHARACTER);\n                    this.state = State.DOCTYPE_NAME;\n                    break;\n                }\n                case $.GREATER_THAN_SIGN: {\n                    this._err(ERR.missingDoctypeName);\n                    this._createDoctypeToken(null);\n                    const token = this.currentToken;\n                    token.forceQuirks = true;\n                    this.emitCurrentDoctype(token);\n                    this.state = State.DATA;\n                    break;\n                }\n                case $.EOF: {\n                    this._err(ERR.eofInDoctype);\n                    this._createDoctypeToken(null);\n                    const token = this.currentToken;\n                    token.forceQuirks = true;\n                    this.emitCurrentDoctype(token);\n                    this._emitEOFToken();\n                    break;\n                }\n                default: {\n                    this._createDoctypeToken(String.fromCodePoint(cp));\n                    this.state = State.DOCTYPE_NAME;\n                }\n            }\n    }\n    // DOCTYPE name state\n    //------------------------------------------------------------------\n    _stateDoctypeName(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                this.state = State.AFTER_DOCTYPE_NAME;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.DATA;\n                this.emitCurrentDoctype(token);\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                token.name += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.name += String.fromCodePoint(isAsciiUpper(cp) ? toAsciiLower(cp) : cp);\n            }\n        }\n    }\n    // After DOCTYPE name state\n    //------------------------------------------------------------------\n    _stateAfterDoctypeName(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                // Ignore whitespace\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.DATA;\n                this.emitCurrentDoctype(token);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                if (this._consumeSequenceIfMatch($$.PUBLIC, false)) {\n                    this.state = State.AFTER_DOCTYPE_PUBLIC_KEYWORD;\n                }\n                else if (this._consumeSequenceIfMatch($$.SYSTEM, false)) {\n                    this.state = State.AFTER_DOCTYPE_SYSTEM_KEYWORD;\n                }\n                //NOTE: sequence lookup can be abrupted by hibernation. In that case lookup\n                //results are no longer valid and we will need to start over.\n                else if (!this._ensureHibernation()) {\n                    this._err(ERR.invalidCharacterSequenceAfterDoctypeName);\n                    token.forceQuirks = true;\n                    this.state = State.BOGUS_DOCTYPE;\n                    this._stateBogusDoctype(cp);\n                }\n            }\n        }\n    }\n    // After DOCTYPE public keyword state\n    //------------------------------------------------------------------\n    _stateAfterDoctypePublicKeyword(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                this.state = State.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;\n                break;\n            }\n            case $.QUOTATION_MARK: {\n                this._err(ERR.missingWhitespaceAfterDoctypePublicKeyword);\n                token.publicId = '';\n                this.state = State.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;\n                break;\n            }\n            case $.APOSTROPHE: {\n                this._err(ERR.missingWhitespaceAfterDoctypePublicKeyword);\n                token.publicId = '';\n                this.state = State.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.missingDoctypePublicIdentifier);\n                token.forceQuirks = true;\n                this.state = State.DATA;\n                this.emitCurrentDoctype(token);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.missingQuoteBeforeDoctypePublicIdentifier);\n                token.forceQuirks = true;\n                this.state = State.BOGUS_DOCTYPE;\n                this._stateBogusDoctype(cp);\n            }\n        }\n    }\n    // Before DOCTYPE public identifier state\n    //------------------------------------------------------------------\n    _stateBeforeDoctypePublicIdentifier(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                // Ignore whitespace\n                break;\n            }\n            case $.QUOTATION_MARK: {\n                token.publicId = '';\n                this.state = State.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;\n                break;\n            }\n            case $.APOSTROPHE: {\n                token.publicId = '';\n                this.state = State.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.missingDoctypePublicIdentifier);\n                token.forceQuirks = true;\n                this.state = State.DATA;\n                this.emitCurrentDoctype(token);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.missingQuoteBeforeDoctypePublicIdentifier);\n                token.forceQuirks = true;\n                this.state = State.BOGUS_DOCTYPE;\n                this._stateBogusDoctype(cp);\n            }\n        }\n    }\n    // DOCTYPE public identifier (double-quoted) state\n    //------------------------------------------------------------------\n    _stateDoctypePublicIdentifierDoubleQuoted(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.QUOTATION_MARK: {\n                this.state = State.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                token.publicId += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.abruptDoctypePublicIdentifier);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this.state = State.DATA;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.publicId += String.fromCodePoint(cp);\n            }\n        }\n    }\n    // DOCTYPE public identifier (single-quoted) state\n    //------------------------------------------------------------------\n    _stateDoctypePublicIdentifierSingleQuoted(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.APOSTROPHE: {\n                this.state = State.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                token.publicId += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.abruptDoctypePublicIdentifier);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this.state = State.DATA;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.publicId += String.fromCodePoint(cp);\n            }\n        }\n    }\n    // After DOCTYPE public identifier state\n    //------------------------------------------------------------------\n    _stateAfterDoctypePublicIdentifier(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                this.state = State.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.DATA;\n                this.emitCurrentDoctype(token);\n                break;\n            }\n            case $.QUOTATION_MARK: {\n                this._err(ERR.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers);\n                token.systemId = '';\n                this.state = State.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;\n                break;\n            }\n            case $.APOSTROPHE: {\n                this._err(ERR.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers);\n                token.systemId = '';\n                this.state = State.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.missingQuoteBeforeDoctypeSystemIdentifier);\n                token.forceQuirks = true;\n                this.state = State.BOGUS_DOCTYPE;\n                this._stateBogusDoctype(cp);\n            }\n        }\n    }\n    // Between DOCTYPE public and system identifiers state\n    //------------------------------------------------------------------\n    _stateBetweenDoctypePublicAndSystemIdentifiers(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                // Ignore whitespace\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.emitCurrentDoctype(token);\n                this.state = State.DATA;\n                break;\n            }\n            case $.QUOTATION_MARK: {\n                token.systemId = '';\n                this.state = State.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;\n                break;\n            }\n            case $.APOSTROPHE: {\n                token.systemId = '';\n                this.state = State.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.missingQuoteBeforeDoctypeSystemIdentifier);\n                token.forceQuirks = true;\n                this.state = State.BOGUS_DOCTYPE;\n                this._stateBogusDoctype(cp);\n            }\n        }\n    }\n    // After DOCTYPE system keyword state\n    //------------------------------------------------------------------\n    _stateAfterDoctypeSystemKeyword(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                this.state = State.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;\n                break;\n            }\n            case $.QUOTATION_MARK: {\n                this._err(ERR.missingWhitespaceAfterDoctypeSystemKeyword);\n                token.systemId = '';\n                this.state = State.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;\n                break;\n            }\n            case $.APOSTROPHE: {\n                this._err(ERR.missingWhitespaceAfterDoctypeSystemKeyword);\n                token.systemId = '';\n                this.state = State.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.missingDoctypeSystemIdentifier);\n                token.forceQuirks = true;\n                this.state = State.DATA;\n                this.emitCurrentDoctype(token);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.missingQuoteBeforeDoctypeSystemIdentifier);\n                token.forceQuirks = true;\n                this.state = State.BOGUS_DOCTYPE;\n                this._stateBogusDoctype(cp);\n            }\n        }\n    }\n    // Before DOCTYPE system identifier state\n    //------------------------------------------------------------------\n    _stateBeforeDoctypeSystemIdentifier(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                // Ignore whitespace\n                break;\n            }\n            case $.QUOTATION_MARK: {\n                token.systemId = '';\n                this.state = State.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;\n                break;\n            }\n            case $.APOSTROPHE: {\n                token.systemId = '';\n                this.state = State.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.missingDoctypeSystemIdentifier);\n                token.forceQuirks = true;\n                this.state = State.DATA;\n                this.emitCurrentDoctype(token);\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.missingQuoteBeforeDoctypeSystemIdentifier);\n                token.forceQuirks = true;\n                this.state = State.BOGUS_DOCTYPE;\n                this._stateBogusDoctype(cp);\n            }\n        }\n    }\n    // DOCTYPE system identifier (double-quoted) state\n    //------------------------------------------------------------------\n    _stateDoctypeSystemIdentifierDoubleQuoted(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.QUOTATION_MARK: {\n                this.state = State.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                token.systemId += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.abruptDoctypeSystemIdentifier);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this.state = State.DATA;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.systemId += String.fromCodePoint(cp);\n            }\n        }\n    }\n    // DOCTYPE system identifier (single-quoted) state\n    //------------------------------------------------------------------\n    _stateDoctypeSystemIdentifierSingleQuoted(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.APOSTROPHE: {\n                this.state = State.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                token.systemId += REPLACEMENT_CHARACTER;\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this._err(ERR.abruptDoctypeSystemIdentifier);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this.state = State.DATA;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                token.systemId += String.fromCodePoint(cp);\n            }\n        }\n    }\n    // After DOCTYPE system identifier state\n    //------------------------------------------------------------------\n    _stateAfterDoctypeSystemIdentifier(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.SPACE:\n            case $.LINE_FEED:\n            case $.TABULATION:\n            case $.FORM_FEED: {\n                // Ignore whitespace\n                break;\n            }\n            case $.GREATER_THAN_SIGN: {\n                this.emitCurrentDoctype(token);\n                this.state = State.DATA;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInDoctype);\n                token.forceQuirks = true;\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._err(ERR.unexpectedCharacterAfterDoctypeSystemIdentifier);\n                this.state = State.BOGUS_DOCTYPE;\n                this._stateBogusDoctype(cp);\n            }\n        }\n    }\n    // Bogus DOCTYPE state\n    //------------------------------------------------------------------\n    _stateBogusDoctype(cp) {\n        const token = this.currentToken;\n        switch (cp) {\n            case $.GREATER_THAN_SIGN: {\n                this.emitCurrentDoctype(token);\n                this.state = State.DATA;\n                break;\n            }\n            case $.NULL: {\n                this._err(ERR.unexpectedNullCharacter);\n                break;\n            }\n            case $.EOF: {\n                this.emitCurrentDoctype(token);\n                this._emitEOFToken();\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    // CDATA section state\n    //------------------------------------------------------------------\n    _stateCdataSection(cp) {\n        switch (cp) {\n            case $.RIGHT_SQUARE_BRACKET: {\n                this.state = State.CDATA_SECTION_BRACKET;\n                break;\n            }\n            case $.EOF: {\n                this._err(ERR.eofInCdata);\n                this._emitEOFToken();\n                break;\n            }\n            default: {\n                this._emitCodePoint(cp);\n            }\n        }\n    }\n    // CDATA section bracket state\n    //------------------------------------------------------------------\n    _stateCdataSectionBracket(cp) {\n        if (cp === $.RIGHT_SQUARE_BRACKET) {\n            this.state = State.CDATA_SECTION_END;\n        }\n        else {\n            this._emitChars(']');\n            this.state = State.CDATA_SECTION;\n            this._stateCdataSection(cp);\n        }\n    }\n    // CDATA section end state\n    //------------------------------------------------------------------\n    _stateCdataSectionEnd(cp) {\n        switch (cp) {\n            case $.GREATER_THAN_SIGN: {\n                this.state = State.DATA;\n                break;\n            }\n            case $.RIGHT_SQUARE_BRACKET: {\n                this._emitChars(']');\n                break;\n            }\n            default: {\n                this._emitChars(']]');\n                this.state = State.CDATA_SECTION;\n                this._stateCdataSection(cp);\n            }\n        }\n    }\n    // Character reference state\n    //------------------------------------------------------------------\n    _stateCharacterReference() {\n        let length = this.entityDecoder.write(this.preprocessor.html, this.preprocessor.pos);\n        if (length < 0) {\n            if (this.preprocessor.lastChunkWritten) {\n                length = this.entityDecoder.end();\n            }\n            else {\n                // Wait for the rest of the entity.\n                this.active = false;\n                // Mark the entire buffer as read.\n                this.preprocessor.pos = this.preprocessor.html.length - 1;\n                this.consumedAfterSnapshot = 0;\n                this.preprocessor.endOfChunkHit = true;\n                return;\n            }\n        }\n        if (length === 0) {\n            // This was not a valid entity. Go back to the beginning, and\n            // figure out what to do.\n            this.preprocessor.pos = this.entityStartPos;\n            this._flushCodePointConsumedAsCharacterReference($.AMPERSAND);\n            this.state =\n                !this._isCharacterReferenceInAttribute() && isAsciiAlphaNumeric(this.preprocessor.peek(1))\n                    ? State.AMBIGUOUS_AMPERSAND\n                    : this.returnState;\n        }\n        else {\n            // We successfully parsed an entity. Switch to the return state.\n            this.state = this.returnState;\n        }\n    }\n    // Ambiguos ampersand state\n    //------------------------------------------------------------------\n    _stateAmbiguousAmpersand(cp) {\n        if (isAsciiAlphaNumeric(cp)) {\n            this._flushCodePointConsumedAsCharacterReference(cp);\n        }\n        else {\n            if (cp === $.SEMICOLON) {\n                this._err(ERR.unknownNamedCharacterReference);\n            }\n            this.state = this.returnState;\n            this._callState(cp);\n        }\n    }\n}\n","import { TAG_ID as $, NS, NUMBERED_HEADERS } from '../common/html.js';\n//Element utils\nconst IMPLICIT_END_TAG_REQUIRED = new Set([$.DD, $.DT, $.LI, $.OPTGROUP, $.OPTION, $.P, $.RB, $.RP, $.RT, $.RTC]);\nconst IMPLICIT_END_TAG_REQUIRED_THOROUGHLY = new Set([\n    ...IMPLICIT_END_TAG_REQUIRED,\n    $.CAPTION,\n    $.COLGROUP,\n    $.TBODY,\n    $.TD,\n    $.TFOOT,\n    $.TH,\n    $.THEAD,\n    $.TR,\n]);\nconst SCOPING_ELEMENTS_HTML = new Set([\n    $.APPLET,\n    $.CAPTION,\n    $.HTML,\n    $.MARQUEE,\n    $.OBJECT,\n    $.TABLE,\n    $.TD,\n    $.TEMPLATE,\n    $.TH,\n]);\nconst SCOPING_ELEMENTS_HTML_LIST = new Set([...SCOPING_ELEMENTS_HTML, $.OL, $.UL]);\nconst SCOPING_ELEMENTS_HTML_BUTTON = new Set([...SCOPING_ELEMENTS_HTML, $.BUTTON]);\nconst SCOPING_ELEMENTS_MATHML = new Set([$.ANNOTATION_XML, $.MI, $.MN, $.MO, $.MS, $.MTEXT]);\nconst SCOPING_ELEMENTS_SVG = new Set([$.DESC, $.FOREIGN_OBJECT, $.TITLE]);\nconst TABLE_ROW_CONTEXT = new Set([$.TR, $.TEMPLATE, $.HTML]);\nconst TABLE_BODY_CONTEXT = new Set([$.TBODY, $.TFOOT, $.THEAD, $.TEMPLATE, $.HTML]);\nconst TABLE_CONTEXT = new Set([$.TABLE, $.TEMPLATE, $.HTML]);\nconst TABLE_CELLS = new Set([$.TD, $.TH]);\n//Stack of open elements\nexport class OpenElementStack {\n    get currentTmplContentOrNode() {\n        return this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : this.current;\n    }\n    constructor(document, treeAdapter, handler) {\n        this.treeAdapter = treeAdapter;\n        this.handler = handler;\n        this.items = [];\n        this.tagIDs = [];\n        this.stackTop = -1;\n        this.tmplCount = 0;\n        this.currentTagId = $.UNKNOWN;\n        this.current = document;\n    }\n    //Index of element\n    _indexOf(element) {\n        return this.items.lastIndexOf(element, this.stackTop);\n    }\n    //Update current element\n    _isInTemplate() {\n        return this.currentTagId === $.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\n    }\n    _updateCurrentElement() {\n        this.current = this.items[this.stackTop];\n        this.currentTagId = this.tagIDs[this.stackTop];\n    }\n    //Mutations\n    push(element, tagID) {\n        this.stackTop++;\n        this.items[this.stackTop] = element;\n        this.current = element;\n        this.tagIDs[this.stackTop] = tagID;\n        this.currentTagId = tagID;\n        if (this._isInTemplate()) {\n            this.tmplCount++;\n        }\n        this.handler.onItemPush(element, tagID, true);\n    }\n    pop() {\n        const popped = this.current;\n        if (this.tmplCount > 0 && this._isInTemplate()) {\n            this.tmplCount--;\n        }\n        this.stackTop--;\n        this._updateCurrentElement();\n        this.handler.onItemPop(popped, true);\n    }\n    replace(oldElement, newElement) {\n        const idx = this._indexOf(oldElement);\n        this.items[idx] = newElement;\n        if (idx === this.stackTop) {\n            this.current = newElement;\n        }\n    }\n    insertAfter(referenceElement, newElement, newElementID) {\n        const insertionIdx = this._indexOf(referenceElement) + 1;\n        this.items.splice(insertionIdx, 0, newElement);\n        this.tagIDs.splice(insertionIdx, 0, newElementID);\n        this.stackTop++;\n        if (insertionIdx === this.stackTop) {\n            this._updateCurrentElement();\n        }\n        if (this.current && this.currentTagId !== undefined) {\n            this.handler.onItemPush(this.current, this.currentTagId, insertionIdx === this.stackTop);\n        }\n    }\n    popUntilTagNamePopped(tagName) {\n        let targetIdx = this.stackTop + 1;\n        do {\n            targetIdx = this.tagIDs.lastIndexOf(tagName, targetIdx - 1);\n        } while (targetIdx > 0 && this.treeAdapter.getNamespaceURI(this.items[targetIdx]) !== NS.HTML);\n        this.shortenToLength(Math.max(targetIdx, 0));\n    }\n    shortenToLength(idx) {\n        while (this.stackTop >= idx) {\n            const popped = this.current;\n            if (this.tmplCount > 0 && this._isInTemplate()) {\n                this.tmplCount -= 1;\n            }\n            this.stackTop--;\n            this._updateCurrentElement();\n            this.handler.onItemPop(popped, this.stackTop < idx);\n        }\n    }\n    popUntilElementPopped(element) {\n        const idx = this._indexOf(element);\n        this.shortenToLength(Math.max(idx, 0));\n    }\n    popUntilPopped(tagNames, targetNS) {\n        const idx = this._indexOfTagNames(tagNames, targetNS);\n        this.shortenToLength(Math.max(idx, 0));\n    }\n    popUntilNumberedHeaderPopped() {\n        this.popUntilPopped(NUMBERED_HEADERS, NS.HTML);\n    }\n    popUntilTableCellPopped() {\n        this.popUntilPopped(TABLE_CELLS, NS.HTML);\n    }\n    popAllUpToHtmlElement() {\n        //NOTE: here we assume that the root <html> element is always first in the open element stack, so\n        //we perform this fast stack clean up.\n        this.tmplCount = 0;\n        this.shortenToLength(1);\n    }\n    _indexOfTagNames(tagNames, namespace) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            if (tagNames.has(this.tagIDs[i]) && this.treeAdapter.getNamespaceURI(this.items[i]) === namespace) {\n                return i;\n            }\n        }\n        return -1;\n    }\n    clearBackTo(tagNames, targetNS) {\n        const idx = this._indexOfTagNames(tagNames, targetNS);\n        this.shortenToLength(idx + 1);\n    }\n    clearBackToTableContext() {\n        this.clearBackTo(TABLE_CONTEXT, NS.HTML);\n    }\n    clearBackToTableBodyContext() {\n        this.clearBackTo(TABLE_BODY_CONTEXT, NS.HTML);\n    }\n    clearBackToTableRowContext() {\n        this.clearBackTo(TABLE_ROW_CONTEXT, NS.HTML);\n    }\n    remove(element) {\n        const idx = this._indexOf(element);\n        if (idx >= 0) {\n            if (idx === this.stackTop) {\n                this.pop();\n            }\n            else {\n                this.items.splice(idx, 1);\n                this.tagIDs.splice(idx, 1);\n                this.stackTop--;\n                this._updateCurrentElement();\n                this.handler.onItemPop(element, false);\n            }\n        }\n    }\n    //Search\n    tryPeekProperlyNestedBodyElement() {\n        //Properly nested <body> element (should be second element in stack).\n        return this.stackTop >= 1 && this.tagIDs[1] === $.BODY ? this.items[1] : null;\n    }\n    contains(element) {\n        return this._indexOf(element) > -1;\n    }\n    getCommonAncestor(element) {\n        const elementIdx = this._indexOf(element) - 1;\n        return elementIdx >= 0 ? this.items[elementIdx] : null;\n    }\n    isRootHtmlElementCurrent() {\n        return this.stackTop === 0 && this.tagIDs[0] === $.HTML;\n    }\n    //Element in scope\n    hasInDynamicScope(tagName, htmlScope) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            switch (this.treeAdapter.getNamespaceURI(this.items[i])) {\n                case NS.HTML: {\n                    if (tn === tagName)\n                        return true;\n                    if (htmlScope.has(tn))\n                        return false;\n                    break;\n                }\n                case NS.SVG: {\n                    if (SCOPING_ELEMENTS_SVG.has(tn))\n                        return false;\n                    break;\n                }\n                case NS.MATHML: {\n                    if (SCOPING_ELEMENTS_MATHML.has(tn))\n                        return false;\n                    break;\n                }\n            }\n        }\n        return true;\n    }\n    hasInScope(tagName) {\n        return this.hasInDynamicScope(tagName, SCOPING_ELEMENTS_HTML);\n    }\n    hasInListItemScope(tagName) {\n        return this.hasInDynamicScope(tagName, SCOPING_ELEMENTS_HTML_LIST);\n    }\n    hasInButtonScope(tagName) {\n        return this.hasInDynamicScope(tagName, SCOPING_ELEMENTS_HTML_BUTTON);\n    }\n    hasNumberedHeaderInScope() {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            switch (this.treeAdapter.getNamespaceURI(this.items[i])) {\n                case NS.HTML: {\n                    if (NUMBERED_HEADERS.has(tn))\n                        return true;\n                    if (SCOPING_ELEMENTS_HTML.has(tn))\n                        return false;\n                    break;\n                }\n                case NS.SVG: {\n                    if (SCOPING_ELEMENTS_SVG.has(tn))\n                        return false;\n                    break;\n                }\n                case NS.MATHML: {\n                    if (SCOPING_ELEMENTS_MATHML.has(tn))\n                        return false;\n                    break;\n                }\n            }\n        }\n        return true;\n    }\n    hasInTableScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            if (this.treeAdapter.getNamespaceURI(this.items[i]) !== NS.HTML) {\n                continue;\n            }\n            switch (this.tagIDs[i]) {\n                case tagName: {\n                    return true;\n                }\n                case $.TABLE:\n                case $.HTML: {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    hasTableBodyContextInTableScope() {\n        for (let i = this.stackTop; i >= 0; i--) {\n            if (this.treeAdapter.getNamespaceURI(this.items[i]) !== NS.HTML) {\n                continue;\n            }\n            switch (this.tagIDs[i]) {\n                case $.TBODY:\n                case $.THEAD:\n                case $.TFOOT: {\n                    return true;\n                }\n                case $.TABLE:\n                case $.HTML: {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    hasInSelectScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            if (this.treeAdapter.getNamespaceURI(this.items[i]) !== NS.HTML) {\n                continue;\n            }\n            switch (this.tagIDs[i]) {\n                case tagName: {\n                    return true;\n                }\n                case $.OPTION:\n                case $.OPTGROUP: {\n                    break;\n                }\n                default: {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    //Implied end tags\n    generateImpliedEndTags() {\n        while (this.currentTagId !== undefined && IMPLICIT_END_TAG_REQUIRED.has(this.currentTagId)) {\n            this.pop();\n        }\n    }\n    generateImpliedEndTagsThoroughly() {\n        while (this.currentTagId !== undefined && IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {\n            this.pop();\n        }\n    }\n    generateImpliedEndTagsWithExclusion(exclusionId) {\n        while (this.currentTagId !== undefined &&\n            this.currentTagId !== exclusionId &&\n            IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {\n            this.pop();\n        }\n    }\n}\n","//Const\nconst NOAH_ARK_CAPACITY = 3;\nexport var EntryType;\n(function (EntryType) {\n    EntryType[EntryType[\"Marker\"] = 0] = \"Marker\";\n    EntryType[EntryType[\"Element\"] = 1] = \"Element\";\n})(EntryType || (EntryType = {}));\nconst MARKER = { type: EntryType.Marker };\n//List of formatting elements\nexport class FormattingElementList {\n    constructor(treeAdapter) {\n        this.treeAdapter = treeAdapter;\n        this.entries = [];\n        this.bookmark = null;\n    }\n    //Noah Ark's condition\n    //OPTIMIZATION: at first we try to find possible candidates for exclusion using\n    //lightweight heuristics without thorough attributes check.\n    _getNoahArkConditionCandidates(newElement, neAttrs) {\n        const candidates = [];\n        const neAttrsLength = neAttrs.length;\n        const neTagName = this.treeAdapter.getTagName(newElement);\n        const neNamespaceURI = this.treeAdapter.getNamespaceURI(newElement);\n        for (let i = 0; i < this.entries.length; i++) {\n            const entry = this.entries[i];\n            if (entry.type === EntryType.Marker) {\n                break;\n            }\n            const { element } = entry;\n            if (this.treeAdapter.getTagName(element) === neTagName &&\n                this.treeAdapter.getNamespaceURI(element) === neNamespaceURI) {\n                const elementAttrs = this.treeAdapter.getAttrList(element);\n                if (elementAttrs.length === neAttrsLength) {\n                    candidates.push({ idx: i, attrs: elementAttrs });\n                }\n            }\n        }\n        return candidates;\n    }\n    _ensureNoahArkCondition(newElement) {\n        if (this.entries.length < NOAH_ARK_CAPACITY)\n            return;\n        const neAttrs = this.treeAdapter.getAttrList(newElement);\n        const candidates = this._getNoahArkConditionCandidates(newElement, neAttrs);\n        if (candidates.length < NOAH_ARK_CAPACITY)\n            return;\n        //NOTE: build attrs map for the new element, so we can perform fast lookups\n        const neAttrsMap = new Map(neAttrs.map((neAttr) => [neAttr.name, neAttr.value]));\n        let validCandidates = 0;\n        //NOTE: remove bottommost candidates, until Noah's Ark condition will not be met\n        for (let i = 0; i < candidates.length; i++) {\n            const candidate = candidates[i];\n            // We know that `candidate.attrs.length === neAttrs.length`\n            if (candidate.attrs.every((cAttr) => neAttrsMap.get(cAttr.name) === cAttr.value)) {\n                validCandidates += 1;\n                if (validCandidates >= NOAH_ARK_CAPACITY) {\n                    this.entries.splice(candidate.idx, 1);\n                }\n            }\n        }\n    }\n    //Mutations\n    insertMarker() {\n        this.entries.unshift(MARKER);\n    }\n    pushElement(element, token) {\n        this._ensureNoahArkCondition(element);\n        this.entries.unshift({\n            type: EntryType.Element,\n            element,\n            token,\n        });\n    }\n    insertElementAfterBookmark(element, token) {\n        const bookmarkIdx = this.entries.indexOf(this.bookmark);\n        this.entries.splice(bookmarkIdx, 0, {\n            type: EntryType.Element,\n            element,\n            token,\n        });\n    }\n    removeEntry(entry) {\n        const entryIndex = this.entries.indexOf(entry);\n        if (entryIndex !== -1) {\n            this.entries.splice(entryIndex, 1);\n        }\n    }\n    /**\n     * Clears the list of formatting elements up to the last marker.\n     *\n     * @see https://html.spec.whatwg.org/multipage/parsing.html#clear-the-list-of-active-formatting-elements-up-to-the-last-marker\n     */\n    clearToLastMarker() {\n        const markerIdx = this.entries.indexOf(MARKER);\n        if (markerIdx === -1) {\n            this.entries.length = 0;\n        }\n        else {\n            this.entries.splice(0, markerIdx + 1);\n        }\n    }\n    //Search\n    getElementEntryInScopeWithTagName(tagName) {\n        const entry = this.entries.find((entry) => entry.type === EntryType.Marker || this.treeAdapter.getTagName(entry.element) === tagName);\n        return entry && entry.type === EntryType.Element ? entry : null;\n    }\n    getElementEntry(element) {\n        return this.entries.find((entry) => entry.type === EntryType.Element && entry.element === element);\n    }\n}\n","import { TAG_ID as $, NS, ATTRS, getTagID } from './html.js';\n//MIME types\nconst MIME_TYPES = {\n    TEXT_HTML: 'text/html',\n    APPLICATION_XML: 'application/xhtml+xml',\n};\n//Attributes\nconst DEFINITION_URL_ATTR = 'definitionurl';\nconst ADJUSTED_DEFINITION_URL_ATTR = 'definitionURL';\nconst SVG_ATTRS_ADJUSTMENT_MAP = new Map([\n    'attributeName',\n    'attributeType',\n    'baseFrequency',\n    'baseProfile',\n    'calcMode',\n    'clipPathUnits',\n    'diffuseConstant',\n    'edgeMode',\n    'filterUnits',\n    'glyphRef',\n    'gradientTransform',\n    'gradientUnits',\n    'kernelMatrix',\n    'kernelUnitLength',\n    'keyPoints',\n    'keySplines',\n    'keyTimes',\n    'lengthAdjust',\n    'limitingConeAngle',\n    'markerHeight',\n    'markerUnits',\n    'markerWidth',\n    'maskContentUnits',\n    'maskUnits',\n    'numOctaves',\n    'pathLength',\n    'patternContentUnits',\n    'patternTransform',\n    'patternUnits',\n    'pointsAtX',\n    'pointsAtY',\n    'pointsAtZ',\n    'preserveAlpha',\n    'preserveAspectRatio',\n    'primitiveUnits',\n    'refX',\n    'refY',\n    'repeatCount',\n    'repeatDur',\n    'requiredExtensions',\n    'requiredFeatures',\n    'specularConstant',\n    'specularExponent',\n    'spreadMethod',\n    'startOffset',\n    'stdDeviation',\n    'stitchTiles',\n    'surfaceScale',\n    'systemLanguage',\n    'tableValues',\n    'targetX',\n    'targetY',\n    'textLength',\n    'viewBox',\n    'viewTarget',\n    'xChannelSelector',\n    'yChannelSelector',\n    'zoomAndPan',\n].map((attr) => [attr.toLowerCase(), attr]));\nconst XML_ATTRS_ADJUSTMENT_MAP = new Map([\n    ['xlink:actuate', { prefix: 'xlink', name: 'actuate', namespace: NS.XLINK }],\n    ['xlink:arcrole', { prefix: 'xlink', name: 'arcrole', namespace: NS.XLINK }],\n    ['xlink:href', { prefix: 'xlink', name: 'href', namespace: NS.XLINK }],\n    ['xlink:role', { prefix: 'xlink', name: 'role', namespace: NS.XLINK }],\n    ['xlink:show', { prefix: 'xlink', name: 'show', namespace: NS.XLINK }],\n    ['xlink:title', { prefix: 'xlink', name: 'title', namespace: NS.XLINK }],\n    ['xlink:type', { prefix: 'xlink', name: 'type', namespace: NS.XLINK }],\n    ['xml:lang', { prefix: 'xml', name: 'lang', namespace: NS.XML }],\n    ['xml:space', { prefix: 'xml', name: 'space', namespace: NS.XML }],\n    ['xmlns', { prefix: '', name: 'xmlns', namespace: NS.XMLNS }],\n    ['xmlns:xlink', { prefix: 'xmlns', name: 'xlink', namespace: NS.XMLNS }],\n]);\n//SVG tag names adjustment map\nexport const SVG_TAG_NAMES_ADJUSTMENT_MAP = new Map([\n    'altGlyph',\n    'altGlyphDef',\n    'altGlyphItem',\n    'animateColor',\n    'animateMotion',\n    'animateTransform',\n    'clipPath',\n    'feBlend',\n    'feColorMatrix',\n    'feComponentTransfer',\n    'feComposite',\n    'feConvolveMatrix',\n    'feDiffuseLighting',\n    'feDisplacementMap',\n    'feDistantLight',\n    'feFlood',\n    'feFuncA',\n    'feFuncB',\n    'feFuncG',\n    'feFuncR',\n    'feGaussianBlur',\n    'feImage',\n    'feMerge',\n    'feMergeNode',\n    'feMorphology',\n    'feOffset',\n    'fePointLight',\n    'feSpecularLighting',\n    'feSpotLight',\n    'feTile',\n    'feTurbulence',\n    'foreignObject',\n    'glyphRef',\n    'linearGradient',\n    'radialGradient',\n    'textPath',\n].map((tn) => [tn.toLowerCase(), tn]));\n//Tags that causes exit from foreign content\nconst EXITS_FOREIGN_CONTENT = new Set([\n    $.B,\n    $.BIG,\n    $.BLOCKQUOTE,\n    $.BODY,\n    $.BR,\n    $.CENTER,\n    $.CODE,\n    $.DD,\n    $.DIV,\n    $.DL,\n    $.DT,\n    $.EM,\n    $.EMBED,\n    $.H1,\n    $.H2,\n    $.H3,\n    $.H4,\n    $.H5,\n    $.H6,\n    $.HEAD,\n    $.HR,\n    $.I,\n    $.IMG,\n    $.LI,\n    $.LISTING,\n    $.MENU,\n    $.META,\n    $.NOBR,\n    $.OL,\n    $.P,\n    $.PRE,\n    $.RUBY,\n    $.S,\n    $.SMALL,\n    $.SPAN,\n    $.STRONG,\n    $.STRIKE,\n    $.SUB,\n    $.SUP,\n    $.TABLE,\n    $.TT,\n    $.U,\n    $.UL,\n    $.VAR,\n]);\n//Check exit from foreign content\nexport function causesExit(startTagToken) {\n    const tn = startTagToken.tagID;\n    const isFontWithAttrs = tn === $.FONT &&\n        startTagToken.attrs.some(({ name }) => name === ATTRS.COLOR || name === ATTRS.SIZE || name === ATTRS.FACE);\n    return isFontWithAttrs || EXITS_FOREIGN_CONTENT.has(tn);\n}\n//Token adjustments\nexport function adjustTokenMathMLAttrs(token) {\n    for (let i = 0; i < token.attrs.length; i++) {\n        if (token.attrs[i].name === DEFINITION_URL_ATTR) {\n            token.attrs[i].name = ADJUSTED_DEFINITION_URL_ATTR;\n            break;\n        }\n    }\n}\nexport function adjustTokenSVGAttrs(token) {\n    for (let i = 0; i < token.attrs.length; i++) {\n        const adjustedAttrName = SVG_ATTRS_ADJUSTMENT_MAP.get(token.attrs[i].name);\n        if (adjustedAttrName != null) {\n            token.attrs[i].name = adjustedAttrName;\n        }\n    }\n}\nexport function adjustTokenXMLAttrs(token) {\n    for (let i = 0; i < token.attrs.length; i++) {\n        const adjustedAttrEntry = XML_ATTRS_ADJUSTMENT_MAP.get(token.attrs[i].name);\n        if (adjustedAttrEntry) {\n            token.attrs[i].prefix = adjustedAttrEntry.prefix;\n            token.attrs[i].name = adjustedAttrEntry.name;\n            token.attrs[i].namespace = adjustedAttrEntry.namespace;\n        }\n    }\n}\nexport function adjustTokenSVGTagName(token) {\n    const adjustedTagName = SVG_TAG_NAMES_ADJUSTMENT_MAP.get(token.tagName);\n    if (adjustedTagName != null) {\n        token.tagName = adjustedTagName;\n        token.tagID = getTagID(token.tagName);\n    }\n}\n//Integration points\nfunction isMathMLTextIntegrationPoint(tn, ns) {\n    return ns === NS.MATHML && (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS || tn === $.MTEXT);\n}\nfunction isHtmlIntegrationPoint(tn, ns, attrs) {\n    if (ns === NS.MATHML && tn === $.ANNOTATION_XML) {\n        for (let i = 0; i < attrs.length; i++) {\n            if (attrs[i].name === ATTRS.ENCODING) {\n                const value = attrs[i].value.toLowerCase();\n                return value === MIME_TYPES.TEXT_HTML || value === MIME_TYPES.APPLICATION_XML;\n            }\n        }\n    }\n    return ns === NS.SVG && (tn === $.FOREIGN_OBJECT || tn === $.DESC || tn === $.TITLE);\n}\nexport function isIntegrationPoint(tn, ns, attrs, foreignNS) {\n    return (((!foreignNS || foreignNS === NS.HTML) && isHtmlIntegrationPoint(tn, ns, attrs)) ||\n        ((!foreignNS || foreignNS === NS.MATHML) && isMathMLTextIntegrationPoint(tn, ns)));\n}\n","import { Tokenizer, TokenizerMode } from '../tokenizer/index.js';\nimport { OpenElementStack } from './open-element-stack.js';\nimport { FormattingElementList, EntryType } from './formatting-element-list.js';\nimport { defaultTreeAdapter } from '../tree-adapters/default.js';\nimport * as doctype from '../common/doctype.js';\nimport * as foreignContent from '../common/foreign-content.js';\nimport { ERR } from '../common/error-codes.js';\nimport * as unicode from '../common/unicode.js';\nimport { TAG_ID as $, TAG_NAMES as TN, NS, ATTRS, SPECIAL_ELEMENTS, DOCUMENT_MODE, NUMBERED_HEADERS, getTagID, } from '../common/html.js';\nimport { TokenType, getTokenAttr, } from '../common/token.js';\n//Misc constants\nconst HIDDEN_INPUT_TYPE = 'hidden';\n//Adoption agency loops iteration count\nconst AA_OUTER_LOOP_ITER = 8;\nconst AA_INNER_LOOP_ITER = 3;\n//Insertion modes\nvar InsertionMode;\n(function (InsertionMode) {\n    InsertionMode[InsertionMode[\"INITIAL\"] = 0] = \"INITIAL\";\n    InsertionMode[InsertionMode[\"BEFORE_HTML\"] = 1] = \"BEFORE_HTML\";\n    InsertionMode[InsertionMode[\"BEFORE_HEAD\"] = 2] = \"BEFORE_HEAD\";\n    InsertionMode[InsertionMode[\"IN_HEAD\"] = 3] = \"IN_HEAD\";\n    InsertionMode[InsertionMode[\"IN_HEAD_NO_SCRIPT\"] = 4] = \"IN_HEAD_NO_SCRIPT\";\n    InsertionMode[InsertionMode[\"AFTER_HEAD\"] = 5] = \"AFTER_HEAD\";\n    InsertionMode[InsertionMode[\"IN_BODY\"] = 6] = \"IN_BODY\";\n    InsertionMode[InsertionMode[\"TEXT\"] = 7] = \"TEXT\";\n    InsertionMode[InsertionMode[\"IN_TABLE\"] = 8] = \"IN_TABLE\";\n    InsertionMode[InsertionMode[\"IN_TABLE_TEXT\"] = 9] = \"IN_TABLE_TEXT\";\n    InsertionMode[InsertionMode[\"IN_CAPTION\"] = 10] = \"IN_CAPTION\";\n    InsertionMode[InsertionMode[\"IN_COLUMN_GROUP\"] = 11] = \"IN_COLUMN_GROUP\";\n    InsertionMode[InsertionMode[\"IN_TABLE_BODY\"] = 12] = \"IN_TABLE_BODY\";\n    InsertionMode[InsertionMode[\"IN_ROW\"] = 13] = \"IN_ROW\";\n    InsertionMode[InsertionMode[\"IN_CELL\"] = 14] = \"IN_CELL\";\n    InsertionMode[InsertionMode[\"IN_SELECT\"] = 15] = \"IN_SELECT\";\n    InsertionMode[InsertionMode[\"IN_SELECT_IN_TABLE\"] = 16] = \"IN_SELECT_IN_TABLE\";\n    InsertionMode[InsertionMode[\"IN_TEMPLATE\"] = 17] = \"IN_TEMPLATE\";\n    InsertionMode[InsertionMode[\"AFTER_BODY\"] = 18] = \"AFTER_BODY\";\n    InsertionMode[InsertionMode[\"IN_FRAMESET\"] = 19] = \"IN_FRAMESET\";\n    InsertionMode[InsertionMode[\"AFTER_FRAMESET\"] = 20] = \"AFTER_FRAMESET\";\n    InsertionMode[InsertionMode[\"AFTER_AFTER_BODY\"] = 21] = \"AFTER_AFTER_BODY\";\n    InsertionMode[InsertionMode[\"AFTER_AFTER_FRAMESET\"] = 22] = \"AFTER_AFTER_FRAMESET\";\n})(InsertionMode || (InsertionMode = {}));\nconst BASE_LOC = {\n    startLine: -1,\n    startCol: -1,\n    startOffset: -1,\n    endLine: -1,\n    endCol: -1,\n    endOffset: -1,\n};\nconst TABLE_STRUCTURE_TAGS = new Set([$.TABLE, $.TBODY, $.TFOOT, $.THEAD, $.TR]);\nconst defaultParserOptions = {\n    scriptingEnabled: true,\n    sourceCodeLocationInfo: false,\n    treeAdapter: defaultTreeAdapter,\n    onParseError: null,\n};\n//Parser\nexport class Parser {\n    constructor(options, document, \n    /** @internal */\n    fragmentContext = null, \n    /** @internal */\n    scriptHandler = null) {\n        this.fragmentContext = fragmentContext;\n        this.scriptHandler = scriptHandler;\n        this.currentToken = null;\n        this.stopped = false;\n        /** @internal */\n        this.insertionMode = InsertionMode.INITIAL;\n        /** @internal */\n        this.originalInsertionMode = InsertionMode.INITIAL;\n        /** @internal */\n        this.headElement = null;\n        /** @internal */\n        this.formElement = null;\n        /** Indicates that the current node is not an element in the HTML namespace */\n        this.currentNotInHTML = false;\n        /**\n         * The template insertion mode stack is maintained from the left.\n         * Ie. the topmost element will always have index 0.\n         *\n         * @internal\n         */\n        this.tmplInsertionModeStack = [];\n        /** @internal */\n        this.pendingCharacterTokens = [];\n        /** @internal */\n        this.hasNonWhitespacePendingCharacterToken = false;\n        /** @internal */\n        this.framesetOk = true;\n        /** @internal */\n        this.skipNextNewLine = false;\n        /** @internal */\n        this.fosterParentingEnabled = false;\n        this.options = {\n            ...defaultParserOptions,\n            ...options,\n        };\n        this.treeAdapter = this.options.treeAdapter;\n        this.onParseError = this.options.onParseError;\n        // Always enable location info if we report parse errors.\n        if (this.onParseError) {\n            this.options.sourceCodeLocationInfo = true;\n        }\n        this.document = document !== null && document !== void 0 ? document : this.treeAdapter.createDocument();\n        this.tokenizer = new Tokenizer(this.options, this);\n        this.activeFormattingElements = new FormattingElementList(this.treeAdapter);\n        this.fragmentContextID = fragmentContext ? getTagID(this.treeAdapter.getTagName(fragmentContext)) : $.UNKNOWN;\n        this._setContextModes(fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : this.document, this.fragmentContextID);\n        this.openElements = new OpenElementStack(this.document, this.treeAdapter, this);\n    }\n    // API\n    static parse(html, options) {\n        const parser = new this(options);\n        parser.tokenizer.write(html, true);\n        return parser.document;\n    }\n    static getFragmentParser(fragmentContext, options) {\n        const opts = {\n            ...defaultParserOptions,\n            ...options,\n        };\n        //NOTE: use a <template> element as the fragment context if no context element was provided,\n        //so we will parse in a \"forgiving\" manner\n        fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : (fragmentContext = opts.treeAdapter.createElement(TN.TEMPLATE, NS.HTML, []));\n        //NOTE: create a fake element which will be used as the `document` for fragment parsing.\n        //This is important for jsdom, where a new `document` cannot be created. This led to\n        //fragment parsing messing with the main `document`.\n        const documentMock = opts.treeAdapter.createElement('documentmock', NS.HTML, []);\n        const parser = new this(opts, documentMock, fragmentContext);\n        if (parser.fragmentContextID === $.TEMPLATE) {\n            parser.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n        }\n        parser._initTokenizerForFragmentParsing();\n        parser._insertFakeRootElement();\n        parser._resetInsertionMode();\n        parser._findFormInFragmentContext();\n        return parser;\n    }\n    getFragment() {\n        const rootElement = this.treeAdapter.getFirstChild(this.document);\n        const fragment = this.treeAdapter.createDocumentFragment();\n        this._adoptNodes(rootElement, fragment);\n        return fragment;\n    }\n    //Errors\n    /** @internal */\n    _err(token, code, beforeToken) {\n        var _a;\n        if (!this.onParseError)\n            return;\n        const loc = (_a = token.location) !== null && _a !== void 0 ? _a : BASE_LOC;\n        const err = {\n            code,\n            startLine: loc.startLine,\n            startCol: loc.startCol,\n            startOffset: loc.startOffset,\n            endLine: beforeToken ? loc.startLine : loc.endLine,\n            endCol: beforeToken ? loc.startCol : loc.endCol,\n            endOffset: beforeToken ? loc.startOffset : loc.endOffset,\n        };\n        this.onParseError(err);\n    }\n    //Stack events\n    /** @internal */\n    onItemPush(node, tid, isTop) {\n        var _a, _b;\n        (_b = (_a = this.treeAdapter).onItemPush) === null || _b === void 0 ? void 0 : _b.call(_a, node);\n        if (isTop && this.openElements.stackTop > 0)\n            this._setContextModes(node, tid);\n    }\n    /** @internal */\n    onItemPop(node, isTop) {\n        var _a, _b;\n        if (this.options.sourceCodeLocationInfo) {\n            this._setEndLocation(node, this.currentToken);\n        }\n        (_b = (_a = this.treeAdapter).onItemPop) === null || _b === void 0 ? void 0 : _b.call(_a, node, this.openElements.current);\n        if (isTop) {\n            let current;\n            let currentTagId;\n            if (this.openElements.stackTop === 0 && this.fragmentContext) {\n                current = this.fragmentContext;\n                currentTagId = this.fragmentContextID;\n            }\n            else {\n                ({ current, currentTagId } = this.openElements);\n            }\n            this._setContextModes(current, currentTagId);\n        }\n    }\n    _setContextModes(current, tid) {\n        const isHTML = current === this.document || (current && this.treeAdapter.getNamespaceURI(current) === NS.HTML);\n        this.currentNotInHTML = !isHTML;\n        this.tokenizer.inForeignNode =\n            !isHTML && current !== undefined && tid !== undefined && !this._isIntegrationPoint(tid, current);\n    }\n    /** @protected */\n    _switchToTextParsing(currentToken, nextTokenizerState) {\n        this._insertElement(currentToken, NS.HTML);\n        this.tokenizer.state = nextTokenizerState;\n        this.originalInsertionMode = this.insertionMode;\n        this.insertionMode = InsertionMode.TEXT;\n    }\n    switchToPlaintextParsing() {\n        this.insertionMode = InsertionMode.TEXT;\n        this.originalInsertionMode = InsertionMode.IN_BODY;\n        this.tokenizer.state = TokenizerMode.PLAINTEXT;\n    }\n    //Fragment parsing\n    /** @protected */\n    _getAdjustedCurrentElement() {\n        return this.openElements.stackTop === 0 && this.fragmentContext\n            ? this.fragmentContext\n            : this.openElements.current;\n    }\n    /** @protected */\n    _findFormInFragmentContext() {\n        let node = this.fragmentContext;\n        while (node) {\n            if (this.treeAdapter.getTagName(node) === TN.FORM) {\n                this.formElement = node;\n                break;\n            }\n            node = this.treeAdapter.getParentNode(node);\n        }\n    }\n    _initTokenizerForFragmentParsing() {\n        if (!this.fragmentContext || this.treeAdapter.getNamespaceURI(this.fragmentContext) !== NS.HTML) {\n            return;\n        }\n        switch (this.fragmentContextID) {\n            case $.TITLE:\n            case $.TEXTAREA: {\n                this.tokenizer.state = TokenizerMode.RCDATA;\n                break;\n            }\n            case $.STYLE:\n            case $.XMP:\n            case $.IFRAME:\n            case $.NOEMBED:\n            case $.NOFRAMES:\n            case $.NOSCRIPT: {\n                this.tokenizer.state = TokenizerMode.RAWTEXT;\n                break;\n            }\n            case $.SCRIPT: {\n                this.tokenizer.state = TokenizerMode.SCRIPT_DATA;\n                break;\n            }\n            case $.PLAINTEXT: {\n                this.tokenizer.state = TokenizerMode.PLAINTEXT;\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    //Tree mutation\n    /** @protected */\n    _setDocumentType(token) {\n        const name = token.name || '';\n        const publicId = token.publicId || '';\n        const systemId = token.systemId || '';\n        this.treeAdapter.setDocumentType(this.document, name, publicId, systemId);\n        if (token.location) {\n            const documentChildren = this.treeAdapter.getChildNodes(this.document);\n            const docTypeNode = documentChildren.find((node) => this.treeAdapter.isDocumentTypeNode(node));\n            if (docTypeNode) {\n                this.treeAdapter.setNodeSourceCodeLocation(docTypeNode, token.location);\n            }\n        }\n    }\n    /** @protected */\n    _attachElementToTree(element, location) {\n        if (this.options.sourceCodeLocationInfo) {\n            const loc = location && {\n                ...location,\n                startTag: location,\n            };\n            this.treeAdapter.setNodeSourceCodeLocation(element, loc);\n        }\n        if (this._shouldFosterParentOnInsertion()) {\n            this._fosterParentElement(element);\n        }\n        else {\n            const parent = this.openElements.currentTmplContentOrNode;\n            this.treeAdapter.appendChild(parent !== null && parent !== void 0 ? parent : this.document, element);\n        }\n    }\n    /**\n     * For self-closing tags. Add an element to the tree, but skip adding it\n     * to the stack.\n     */\n    /** @protected */\n    _appendElement(token, namespaceURI) {\n        const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n        this._attachElementToTree(element, token.location);\n    }\n    /** @protected */\n    _insertElement(token, namespaceURI) {\n        const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n        this._attachElementToTree(element, token.location);\n        this.openElements.push(element, token.tagID);\n    }\n    /** @protected */\n    _insertFakeElement(tagName, tagID) {\n        const element = this.treeAdapter.createElement(tagName, NS.HTML, []);\n        this._attachElementToTree(element, null);\n        this.openElements.push(element, tagID);\n    }\n    /** @protected */\n    _insertTemplate(token) {\n        const tmpl = this.treeAdapter.createElement(token.tagName, NS.HTML, token.attrs);\n        const content = this.treeAdapter.createDocumentFragment();\n        this.treeAdapter.setTemplateContent(tmpl, content);\n        this._attachElementToTree(tmpl, token.location);\n        this.openElements.push(tmpl, token.tagID);\n        if (this.options.sourceCodeLocationInfo)\n            this.treeAdapter.setNodeSourceCodeLocation(content, null);\n    }\n    /** @protected */\n    _insertFakeRootElement() {\n        const element = this.treeAdapter.createElement(TN.HTML, NS.HTML, []);\n        if (this.options.sourceCodeLocationInfo)\n            this.treeAdapter.setNodeSourceCodeLocation(element, null);\n        this.treeAdapter.appendChild(this.openElements.current, element);\n        this.openElements.push(element, $.HTML);\n    }\n    /** @protected */\n    _appendCommentNode(token, parent) {\n        const commentNode = this.treeAdapter.createCommentNode(token.data);\n        this.treeAdapter.appendChild(parent, commentNode);\n        if (this.options.sourceCodeLocationInfo) {\n            this.treeAdapter.setNodeSourceCodeLocation(commentNode, token.location);\n        }\n    }\n    /** @protected */\n    _insertCharacters(token) {\n        let parent;\n        let beforeElement;\n        if (this._shouldFosterParentOnInsertion()) {\n            ({ parent, beforeElement } = this._findFosterParentingLocation());\n            if (beforeElement) {\n                this.treeAdapter.insertTextBefore(parent, token.chars, beforeElement);\n            }\n            else {\n                this.treeAdapter.insertText(parent, token.chars);\n            }\n        }\n        else {\n            parent = this.openElements.currentTmplContentOrNode;\n            this.treeAdapter.insertText(parent, token.chars);\n        }\n        if (!token.location)\n            return;\n        const siblings = this.treeAdapter.getChildNodes(parent);\n        const textNodeIdx = beforeElement ? siblings.lastIndexOf(beforeElement) : siblings.length;\n        const textNode = siblings[textNodeIdx - 1];\n        //NOTE: if we have a location assigned by another token, then just update the end position\n        const tnLoc = this.treeAdapter.getNodeSourceCodeLocation(textNode);\n        if (tnLoc) {\n            const { endLine, endCol, endOffset } = token.location;\n            this.treeAdapter.updateNodeSourceCodeLocation(textNode, { endLine, endCol, endOffset });\n        }\n        else if (this.options.sourceCodeLocationInfo) {\n            this.treeAdapter.setNodeSourceCodeLocation(textNode, token.location);\n        }\n    }\n    /** @protected */\n    _adoptNodes(donor, recipient) {\n        for (let child = this.treeAdapter.getFirstChild(donor); child; child = this.treeAdapter.getFirstChild(donor)) {\n            this.treeAdapter.detachNode(child);\n            this.treeAdapter.appendChild(recipient, child);\n        }\n    }\n    /** @protected */\n    _setEndLocation(element, closingToken) {\n        if (this.treeAdapter.getNodeSourceCodeLocation(element) && closingToken.location) {\n            const ctLoc = closingToken.location;\n            const tn = this.treeAdapter.getTagName(element);\n            const endLoc = \n            // NOTE: For cases like <p> <p> </p> - First 'p' closes without a closing\n            // tag and for cases like <td> <p> </td> - 'p' closes without a closing tag.\n            closingToken.type === TokenType.END_TAG && tn === closingToken.tagName\n                ? {\n                    endTag: { ...ctLoc },\n                    endLine: ctLoc.endLine,\n                    endCol: ctLoc.endCol,\n                    endOffset: ctLoc.endOffset,\n                }\n                : {\n                    endLine: ctLoc.startLine,\n                    endCol: ctLoc.startCol,\n                    endOffset: ctLoc.startOffset,\n                };\n            this.treeAdapter.updateNodeSourceCodeLocation(element, endLoc);\n        }\n    }\n    //Token processing\n    shouldProcessStartTagTokenInForeignContent(token) {\n        // Check that neither current === document, or ns === NS.HTML\n        if (!this.currentNotInHTML)\n            return false;\n        let current;\n        let currentTagId;\n        if (this.openElements.stackTop === 0 && this.fragmentContext) {\n            current = this.fragmentContext;\n            currentTagId = this.fragmentContextID;\n        }\n        else {\n            ({ current, currentTagId } = this.openElements);\n        }\n        if (token.tagID === $.SVG &&\n            this.treeAdapter.getTagName(current) === TN.ANNOTATION_XML &&\n            this.treeAdapter.getNamespaceURI(current) === NS.MATHML) {\n            return false;\n        }\n        return (\n        // Check that `current` is not an integration point for HTML or MathML elements.\n        this.tokenizer.inForeignNode ||\n            // If it _is_ an integration point, then we might have to check that it is not an HTML\n            // integration point.\n            ((token.tagID === $.MGLYPH || token.tagID === $.MALIGNMARK) &&\n                currentTagId !== undefined &&\n                !this._isIntegrationPoint(currentTagId, current, NS.HTML)));\n    }\n    /** @protected */\n    _processToken(token) {\n        switch (token.type) {\n            case TokenType.CHARACTER: {\n                this.onCharacter(token);\n                break;\n            }\n            case TokenType.NULL_CHARACTER: {\n                this.onNullCharacter(token);\n                break;\n            }\n            case TokenType.COMMENT: {\n                this.onComment(token);\n                break;\n            }\n            case TokenType.DOCTYPE: {\n                this.onDoctype(token);\n                break;\n            }\n            case TokenType.START_TAG: {\n                this._processStartTag(token);\n                break;\n            }\n            case TokenType.END_TAG: {\n                this.onEndTag(token);\n                break;\n            }\n            case TokenType.EOF: {\n                this.onEof(token);\n                break;\n            }\n            case TokenType.WHITESPACE_CHARACTER: {\n                this.onWhitespaceCharacter(token);\n                break;\n            }\n        }\n    }\n    //Integration points\n    /** @protected */\n    _isIntegrationPoint(tid, element, foreignNS) {\n        const ns = this.treeAdapter.getNamespaceURI(element);\n        const attrs = this.treeAdapter.getAttrList(element);\n        return foreignContent.isIntegrationPoint(tid, ns, attrs, foreignNS);\n    }\n    //Active formatting elements reconstruction\n    /** @protected */\n    _reconstructActiveFormattingElements() {\n        const listLength = this.activeFormattingElements.entries.length;\n        if (listLength) {\n            const endIndex = this.activeFormattingElements.entries.findIndex((entry) => entry.type === EntryType.Marker || this.openElements.contains(entry.element));\n            const unopenIdx = endIndex === -1 ? listLength - 1 : endIndex - 1;\n            for (let i = unopenIdx; i >= 0; i--) {\n                const entry = this.activeFormattingElements.entries[i];\n                this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\n                entry.element = this.openElements.current;\n            }\n        }\n    }\n    //Close elements\n    /** @protected */\n    _closeTableCell() {\n        this.openElements.generateImpliedEndTags();\n        this.openElements.popUntilTableCellPopped();\n        this.activeFormattingElements.clearToLastMarker();\n        this.insertionMode = InsertionMode.IN_ROW;\n    }\n    /** @protected */\n    _closePElement() {\n        this.openElements.generateImpliedEndTagsWithExclusion($.P);\n        this.openElements.popUntilTagNamePopped($.P);\n    }\n    //Insertion modes\n    /** @protected */\n    _resetInsertionMode() {\n        for (let i = this.openElements.stackTop; i >= 0; i--) {\n            //Insertion mode reset map\n            switch (i === 0 && this.fragmentContext ? this.fragmentContextID : this.openElements.tagIDs[i]) {\n                case $.TR: {\n                    this.insertionMode = InsertionMode.IN_ROW;\n                    return;\n                }\n                case $.TBODY:\n                case $.THEAD:\n                case $.TFOOT: {\n                    this.insertionMode = InsertionMode.IN_TABLE_BODY;\n                    return;\n                }\n                case $.CAPTION: {\n                    this.insertionMode = InsertionMode.IN_CAPTION;\n                    return;\n                }\n                case $.COLGROUP: {\n                    this.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n                    return;\n                }\n                case $.TABLE: {\n                    this.insertionMode = InsertionMode.IN_TABLE;\n                    return;\n                }\n                case $.BODY: {\n                    this.insertionMode = InsertionMode.IN_BODY;\n                    return;\n                }\n                case $.FRAMESET: {\n                    this.insertionMode = InsertionMode.IN_FRAMESET;\n                    return;\n                }\n                case $.SELECT: {\n                    this._resetInsertionModeForSelect(i);\n                    return;\n                }\n                case $.TEMPLATE: {\n                    this.insertionMode = this.tmplInsertionModeStack[0];\n                    return;\n                }\n                case $.HTML: {\n                    this.insertionMode = this.headElement ? InsertionMode.AFTER_HEAD : InsertionMode.BEFORE_HEAD;\n                    return;\n                }\n                case $.TD:\n                case $.TH: {\n                    if (i > 0) {\n                        this.insertionMode = InsertionMode.IN_CELL;\n                        return;\n                    }\n                    break;\n                }\n                case $.HEAD: {\n                    if (i > 0) {\n                        this.insertionMode = InsertionMode.IN_HEAD;\n                        return;\n                    }\n                    break;\n                }\n            }\n        }\n        this.insertionMode = InsertionMode.IN_BODY;\n    }\n    /** @protected */\n    _resetInsertionModeForSelect(selectIdx) {\n        if (selectIdx > 0) {\n            for (let i = selectIdx - 1; i > 0; i--) {\n                const tn = this.openElements.tagIDs[i];\n                if (tn === $.TEMPLATE) {\n                    break;\n                }\n                else if (tn === $.TABLE) {\n                    this.insertionMode = InsertionMode.IN_SELECT_IN_TABLE;\n                    return;\n                }\n            }\n        }\n        this.insertionMode = InsertionMode.IN_SELECT;\n    }\n    //Foster parenting\n    /** @protected */\n    _isElementCausesFosterParenting(tn) {\n        return TABLE_STRUCTURE_TAGS.has(tn);\n    }\n    /** @protected */\n    _shouldFosterParentOnInsertion() {\n        return (this.fosterParentingEnabled &&\n            this.openElements.currentTagId !== undefined &&\n            this._isElementCausesFosterParenting(this.openElements.currentTagId));\n    }\n    /** @protected */\n    _findFosterParentingLocation() {\n        for (let i = this.openElements.stackTop; i >= 0; i--) {\n            const openElement = this.openElements.items[i];\n            switch (this.openElements.tagIDs[i]) {\n                case $.TEMPLATE: {\n                    if (this.treeAdapter.getNamespaceURI(openElement) === NS.HTML) {\n                        return { parent: this.treeAdapter.getTemplateContent(openElement), beforeElement: null };\n                    }\n                    break;\n                }\n                case $.TABLE: {\n                    const parent = this.treeAdapter.getParentNode(openElement);\n                    if (parent) {\n                        return { parent, beforeElement: openElement };\n                    }\n                    return { parent: this.openElements.items[i - 1], beforeElement: null };\n                }\n                default:\n                // Do nothing\n            }\n        }\n        return { parent: this.openElements.items[0], beforeElement: null };\n    }\n    /** @protected */\n    _fosterParentElement(element) {\n        const location = this._findFosterParentingLocation();\n        if (location.beforeElement) {\n            this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);\n        }\n        else {\n            this.treeAdapter.appendChild(location.parent, element);\n        }\n    }\n    //Special elements\n    /** @protected */\n    _isSpecialElement(element, id) {\n        const ns = this.treeAdapter.getNamespaceURI(element);\n        return SPECIAL_ELEMENTS[ns].has(id);\n    }\n    /** @internal */\n    onCharacter(token) {\n        this.skipNextNewLine = false;\n        if (this.tokenizer.inForeignNode) {\n            characterInForeignContent(this, token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL: {\n                tokenInInitialMode(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HTML: {\n                tokenBeforeHtml(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HEAD: {\n                tokenBeforeHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD: {\n                tokenInHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD_NO_SCRIPT: {\n                tokenInHeadNoScript(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_HEAD: {\n                tokenAfterHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_TEMPLATE: {\n                characterInBody(this, token);\n                break;\n            }\n            case InsertionMode.TEXT:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE: {\n                this._insertCharacters(token);\n                break;\n            }\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW: {\n                characterInTable(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE_TEXT: {\n                characterInTableText(this, token);\n                break;\n            }\n            case InsertionMode.IN_COLUMN_GROUP: {\n                tokenInColumnGroup(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_BODY: {\n                tokenAfterBody(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_AFTER_BODY: {\n                tokenAfterAfterBody(this, token);\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    /** @internal */\n    onNullCharacter(token) {\n        this.skipNextNewLine = false;\n        if (this.tokenizer.inForeignNode) {\n            nullCharacterInForeignContent(this, token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL: {\n                tokenInInitialMode(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HTML: {\n                tokenBeforeHtml(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HEAD: {\n                tokenBeforeHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD: {\n                tokenInHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD_NO_SCRIPT: {\n                tokenInHeadNoScript(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_HEAD: {\n                tokenAfterHead(this, token);\n                break;\n            }\n            case InsertionMode.TEXT: {\n                this._insertCharacters(token);\n                break;\n            }\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW: {\n                characterInTable(this, token);\n                break;\n            }\n            case InsertionMode.IN_COLUMN_GROUP: {\n                tokenInColumnGroup(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_BODY: {\n                tokenAfterBody(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_AFTER_BODY: {\n                tokenAfterAfterBody(this, token);\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    /** @internal */\n    onComment(token) {\n        this.skipNextNewLine = false;\n        if (this.currentNotInHTML) {\n            appendComment(this, token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n            case InsertionMode.BEFORE_HTML:\n            case InsertionMode.BEFORE_HEAD:\n            case InsertionMode.IN_HEAD:\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n            case InsertionMode.AFTER_HEAD:\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_COLUMN_GROUP:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n            case InsertionMode.IN_TEMPLATE:\n            case InsertionMode.IN_FRAMESET:\n            case InsertionMode.AFTER_FRAMESET: {\n                appendComment(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE_TEXT: {\n                tokenInTableText(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_BODY: {\n                appendCommentToRootHtmlElement(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_FRAMESET: {\n                appendCommentToDocument(this, token);\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    /** @internal */\n    onDoctype(token) {\n        this.skipNextNewLine = false;\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL: {\n                doctypeInInitialMode(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HEAD:\n            case InsertionMode.IN_HEAD:\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n            case InsertionMode.AFTER_HEAD: {\n                this._err(token, ERR.misplacedDoctype);\n                break;\n            }\n            case InsertionMode.IN_TABLE_TEXT: {\n                tokenInTableText(this, token);\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    /** @internal */\n    onStartTag(token) {\n        this.skipNextNewLine = false;\n        this.currentToken = token;\n        this._processStartTag(token);\n        if (token.selfClosing && !token.ackSelfClosing) {\n            this._err(token, ERR.nonVoidHtmlElementStartTagWithTrailingSolidus);\n        }\n    }\n    /**\n     * Processes a given start tag.\n     *\n     * `onStartTag` checks if a self-closing tag was recognized. When a token\n     * is moved inbetween multiple insertion modes, this check for self-closing\n     * could lead to false positives. To avoid this, `_processStartTag` is used\n     * for nested calls.\n     *\n     * @param token The token to process.\n     * @protected\n     */\n    _processStartTag(token) {\n        if (this.shouldProcessStartTagTokenInForeignContent(token)) {\n            startTagInForeignContent(this, token);\n        }\n        else {\n            this._startTagOutsideForeignContent(token);\n        }\n    }\n    /** @protected */\n    _startTagOutsideForeignContent(token) {\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL: {\n                tokenInInitialMode(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HTML: {\n                startTagBeforeHtml(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HEAD: {\n                startTagBeforeHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD: {\n                startTagInHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD_NO_SCRIPT: {\n                startTagInHeadNoScript(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_HEAD: {\n                startTagAfterHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_BODY: {\n                startTagInBody(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE: {\n                startTagInTable(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE_TEXT: {\n                tokenInTableText(this, token);\n                break;\n            }\n            case InsertionMode.IN_CAPTION: {\n                startTagInCaption(this, token);\n                break;\n            }\n            case InsertionMode.IN_COLUMN_GROUP: {\n                startTagInColumnGroup(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE_BODY: {\n                startTagInTableBody(this, token);\n                break;\n            }\n            case InsertionMode.IN_ROW: {\n                startTagInRow(this, token);\n                break;\n            }\n            case InsertionMode.IN_CELL: {\n                startTagInCell(this, token);\n                break;\n            }\n            case InsertionMode.IN_SELECT: {\n                startTagInSelect(this, token);\n                break;\n            }\n            case InsertionMode.IN_SELECT_IN_TABLE: {\n                startTagInSelectInTable(this, token);\n                break;\n            }\n            case InsertionMode.IN_TEMPLATE: {\n                startTagInTemplate(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_BODY: {\n                startTagAfterBody(this, token);\n                break;\n            }\n            case InsertionMode.IN_FRAMESET: {\n                startTagInFrameset(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_FRAMESET: {\n                startTagAfterFrameset(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_AFTER_BODY: {\n                startTagAfterAfterBody(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_AFTER_FRAMESET: {\n                startTagAfterAfterFrameset(this, token);\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    /** @internal */\n    onEndTag(token) {\n        this.skipNextNewLine = false;\n        this.currentToken = token;\n        if (this.currentNotInHTML) {\n            endTagInForeignContent(this, token);\n        }\n        else {\n            this._endTagOutsideForeignContent(token);\n        }\n    }\n    /** @protected */\n    _endTagOutsideForeignContent(token) {\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL: {\n                tokenInInitialMode(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HTML: {\n                endTagBeforeHtml(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HEAD: {\n                endTagBeforeHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD: {\n                endTagInHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD_NO_SCRIPT: {\n                endTagInHeadNoScript(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_HEAD: {\n                endTagAfterHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_BODY: {\n                endTagInBody(this, token);\n                break;\n            }\n            case InsertionMode.TEXT: {\n                endTagInText(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE: {\n                endTagInTable(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE_TEXT: {\n                tokenInTableText(this, token);\n                break;\n            }\n            case InsertionMode.IN_CAPTION: {\n                endTagInCaption(this, token);\n                break;\n            }\n            case InsertionMode.IN_COLUMN_GROUP: {\n                endTagInColumnGroup(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE_BODY: {\n                endTagInTableBody(this, token);\n                break;\n            }\n            case InsertionMode.IN_ROW: {\n                endTagInRow(this, token);\n                break;\n            }\n            case InsertionMode.IN_CELL: {\n                endTagInCell(this, token);\n                break;\n            }\n            case InsertionMode.IN_SELECT: {\n                endTagInSelect(this, token);\n                break;\n            }\n            case InsertionMode.IN_SELECT_IN_TABLE: {\n                endTagInSelectInTable(this, token);\n                break;\n            }\n            case InsertionMode.IN_TEMPLATE: {\n                endTagInTemplate(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_BODY: {\n                endTagAfterBody(this, token);\n                break;\n            }\n            case InsertionMode.IN_FRAMESET: {\n                endTagInFrameset(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_FRAMESET: {\n                endTagAfterFrameset(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_AFTER_BODY: {\n                tokenAfterAfterBody(this, token);\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    /** @internal */\n    onEof(token) {\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL: {\n                tokenInInitialMode(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HTML: {\n                tokenBeforeHtml(this, token);\n                break;\n            }\n            case InsertionMode.BEFORE_HEAD: {\n                tokenBeforeHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD: {\n                tokenInHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_HEAD_NO_SCRIPT: {\n                tokenInHeadNoScript(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_HEAD: {\n                tokenAfterHead(this, token);\n                break;\n            }\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_COLUMN_GROUP:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE: {\n                eofInBody(this, token);\n                break;\n            }\n            case InsertionMode.TEXT: {\n                eofInText(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE_TEXT: {\n                tokenInTableText(this, token);\n                break;\n            }\n            case InsertionMode.IN_TEMPLATE: {\n                eofInTemplate(this, token);\n                break;\n            }\n            case InsertionMode.AFTER_BODY:\n            case InsertionMode.IN_FRAMESET:\n            case InsertionMode.AFTER_FRAMESET:\n            case InsertionMode.AFTER_AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_FRAMESET: {\n                stopParsing(this, token);\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    /** @internal */\n    onWhitespaceCharacter(token) {\n        if (this.skipNextNewLine) {\n            this.skipNextNewLine = false;\n            if (token.chars.charCodeAt(0) === unicode.CODE_POINTS.LINE_FEED) {\n                if (token.chars.length === 1) {\n                    return;\n                }\n                token.chars = token.chars.substr(1);\n            }\n        }\n        if (this.tokenizer.inForeignNode) {\n            this._insertCharacters(token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.IN_HEAD:\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n            case InsertionMode.AFTER_HEAD:\n            case InsertionMode.TEXT:\n            case InsertionMode.IN_COLUMN_GROUP:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n            case InsertionMode.IN_FRAMESET:\n            case InsertionMode.AFTER_FRAMESET: {\n                this._insertCharacters(token);\n                break;\n            }\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_TEMPLATE:\n            case InsertionMode.AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_FRAMESET: {\n                whitespaceCharacterInBody(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW: {\n                characterInTable(this, token);\n                break;\n            }\n            case InsertionMode.IN_TABLE_TEXT: {\n                whitespaceCharacterInTableText(this, token);\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n}\n//Adoption agency algorithm\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\n//------------------------------------------------------------------\n//Steps 5-8 of the algorithm\nfunction aaObtainFormattingElementEntry(p, token) {\n    let formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\n    if (formattingElementEntry) {\n        if (!p.openElements.contains(formattingElementEntry.element)) {\n            p.activeFormattingElements.removeEntry(formattingElementEntry);\n            formattingElementEntry = null;\n        }\n        else if (!p.openElements.hasInScope(token.tagID)) {\n            formattingElementEntry = null;\n        }\n    }\n    else {\n        genericEndTagInBody(p, token);\n    }\n    return formattingElementEntry;\n}\n//Steps 9 and 10 of the algorithm\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\n    let furthestBlock = null;\n    let idx = p.openElements.stackTop;\n    for (; idx >= 0; idx--) {\n        const element = p.openElements.items[idx];\n        if (element === formattingElementEntry.element) {\n            break;\n        }\n        if (p._isSpecialElement(element, p.openElements.tagIDs[idx])) {\n            furthestBlock = element;\n        }\n    }\n    if (!furthestBlock) {\n        p.openElements.shortenToLength(Math.max(idx, 0));\n        p.activeFormattingElements.removeEntry(formattingElementEntry);\n    }\n    return furthestBlock;\n}\n//Step 13 of the algorithm\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\n    let lastElement = furthestBlock;\n    let nextElement = p.openElements.getCommonAncestor(furthestBlock);\n    for (let i = 0, element = nextElement; element !== formattingElement; i++, element = nextElement) {\n        //NOTE: store the next element for the next loop iteration (it may be deleted from the stack by step 9.5)\n        nextElement = p.openElements.getCommonAncestor(element);\n        const elementEntry = p.activeFormattingElements.getElementEntry(element);\n        const counterOverflow = elementEntry && i >= AA_INNER_LOOP_ITER;\n        const shouldRemoveFromOpenElements = !elementEntry || counterOverflow;\n        if (shouldRemoveFromOpenElements) {\n            if (counterOverflow) {\n                p.activeFormattingElements.removeEntry(elementEntry);\n            }\n            p.openElements.remove(element);\n        }\n        else {\n            element = aaRecreateElementFromEntry(p, elementEntry);\n            if (lastElement === furthestBlock) {\n                p.activeFormattingElements.bookmark = elementEntry;\n            }\n            p.treeAdapter.detachNode(lastElement);\n            p.treeAdapter.appendChild(element, lastElement);\n            lastElement = element;\n        }\n    }\n    return lastElement;\n}\n//Step 13.7 of the algorithm\nfunction aaRecreateElementFromEntry(p, elementEntry) {\n    const ns = p.treeAdapter.getNamespaceURI(elementEntry.element);\n    const newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\n    p.openElements.replace(elementEntry.element, newElement);\n    elementEntry.element = newElement;\n    return newElement;\n}\n//Step 14 of the algorithm\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\n    const tn = p.treeAdapter.getTagName(commonAncestor);\n    const tid = getTagID(tn);\n    if (p._isElementCausesFosterParenting(tid)) {\n        p._fosterParentElement(lastElement);\n    }\n    else {\n        const ns = p.treeAdapter.getNamespaceURI(commonAncestor);\n        if (tid === $.TEMPLATE && ns === NS.HTML) {\n            commonAncestor = p.treeAdapter.getTemplateContent(commonAncestor);\n        }\n        p.treeAdapter.appendChild(commonAncestor, lastElement);\n    }\n}\n//Steps 15-19 of the algorithm\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\n    const ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element);\n    const { token } = formattingElementEntry;\n    const newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\n    p._adoptNodes(furthestBlock, newElement);\n    p.treeAdapter.appendChild(furthestBlock, newElement);\n    p.activeFormattingElements.insertElementAfterBookmark(newElement, token);\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\n    p.openElements.remove(formattingElementEntry.element);\n    p.openElements.insertAfter(furthestBlock, newElement, token.tagID);\n}\n//Algorithm entry point\nfunction callAdoptionAgency(p, token) {\n    for (let i = 0; i < AA_OUTER_LOOP_ITER; i++) {\n        const formattingElementEntry = aaObtainFormattingElementEntry(p, token);\n        if (!formattingElementEntry) {\n            break;\n        }\n        const furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\n        if (!furthestBlock) {\n            break;\n        }\n        p.activeFormattingElements.bookmark = formattingElementEntry;\n        const lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element);\n        const commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\n        p.treeAdapter.detachNode(lastElement);\n        if (commonAncestor)\n            aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\n        aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\n    }\n}\n//Generic token handlers\n//------------------------------------------------------------------\nfunction appendComment(p, token) {\n    p._appendCommentNode(token, p.openElements.currentTmplContentOrNode);\n}\nfunction appendCommentToRootHtmlElement(p, token) {\n    p._appendCommentNode(token, p.openElements.items[0]);\n}\nfunction appendCommentToDocument(p, token) {\n    p._appendCommentNode(token, p.document);\n}\nfunction stopParsing(p, token) {\n    p.stopped = true;\n    // NOTE: Set end locations for elements that remain on the open element stack.\n    if (token.location) {\n        // NOTE: If we are not in a fragment, `html` and `body` will stay on the stack.\n        // This is a problem, as we might overwrite their end position here.\n        const target = p.fragmentContext ? 0 : 2;\n        for (let i = p.openElements.stackTop; i >= target; i--) {\n            p._setEndLocation(p.openElements.items[i], token);\n        }\n        // Handle `html` and `body`\n        if (!p.fragmentContext && p.openElements.stackTop >= 0) {\n            const htmlElement = p.openElements.items[0];\n            const htmlLocation = p.treeAdapter.getNodeSourceCodeLocation(htmlElement);\n            if (htmlLocation && !htmlLocation.endTag) {\n                p._setEndLocation(htmlElement, token);\n                if (p.openElements.stackTop >= 1) {\n                    const bodyElement = p.openElements.items[1];\n                    const bodyLocation = p.treeAdapter.getNodeSourceCodeLocation(bodyElement);\n                    if (bodyLocation && !bodyLocation.endTag) {\n                        p._setEndLocation(bodyElement, token);\n                    }\n                }\n            }\n        }\n    }\n}\n// The \"initial\" insertion mode\n//------------------------------------------------------------------\nfunction doctypeInInitialMode(p, token) {\n    p._setDocumentType(token);\n    const mode = token.forceQuirks ? DOCUMENT_MODE.QUIRKS : doctype.getDocumentMode(token);\n    if (!doctype.isConforming(token)) {\n        p._err(token, ERR.nonConformingDoctype);\n    }\n    p.treeAdapter.setDocumentMode(p.document, mode);\n    p.insertionMode = InsertionMode.BEFORE_HTML;\n}\nfunction tokenInInitialMode(p, token) {\n    p._err(token, ERR.missingDoctype, true);\n    p.treeAdapter.setDocumentMode(p.document, DOCUMENT_MODE.QUIRKS);\n    p.insertionMode = InsertionMode.BEFORE_HTML;\n    p._processToken(token);\n}\n// The \"before html\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHtml(p, token) {\n    if (token.tagID === $.HTML) {\n        p._insertElement(token, NS.HTML);\n        p.insertionMode = InsertionMode.BEFORE_HEAD;\n    }\n    else {\n        tokenBeforeHtml(p, token);\n    }\n}\nfunction endTagBeforeHtml(p, token) {\n    const tn = token.tagID;\n    if (tn === $.HTML || tn === $.HEAD || tn === $.BODY || tn === $.BR) {\n        tokenBeforeHtml(p, token);\n    }\n}\nfunction tokenBeforeHtml(p, token) {\n    p._insertFakeRootElement();\n    p.insertionMode = InsertionMode.BEFORE_HEAD;\n    p._processToken(token);\n}\n// The \"before head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHead(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.HEAD: {\n            p._insertElement(token, NS.HTML);\n            p.headElement = p.openElements.current;\n            p.insertionMode = InsertionMode.IN_HEAD;\n            break;\n        }\n        default: {\n            tokenBeforeHead(p, token);\n        }\n    }\n}\nfunction endTagBeforeHead(p, token) {\n    const tn = token.tagID;\n    if (tn === $.HEAD || tn === $.BODY || tn === $.HTML || tn === $.BR) {\n        tokenBeforeHead(p, token);\n    }\n    else {\n        p._err(token, ERR.endTagWithoutMatchingOpenElement);\n    }\n}\nfunction tokenBeforeHead(p, token) {\n    p._insertFakeElement(TN.HEAD, $.HEAD);\n    p.headElement = p.openElements.current;\n    p.insertionMode = InsertionMode.IN_HEAD;\n    p._processToken(token);\n}\n// The \"in head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHead(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.BASE:\n        case $.BASEFONT:\n        case $.BGSOUND:\n        case $.LINK:\n        case $.META: {\n            p._appendElement(token, NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case $.TITLE: {\n            p._switchToTextParsing(token, TokenizerMode.RCDATA);\n            break;\n        }\n        case $.NOSCRIPT: {\n            if (p.options.scriptingEnabled) {\n                p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n            }\n            else {\n                p._insertElement(token, NS.HTML);\n                p.insertionMode = InsertionMode.IN_HEAD_NO_SCRIPT;\n            }\n            break;\n        }\n        case $.NOFRAMES:\n        case $.STYLE: {\n            p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n            break;\n        }\n        case $.SCRIPT: {\n            p._switchToTextParsing(token, TokenizerMode.SCRIPT_DATA);\n            break;\n        }\n        case $.TEMPLATE: {\n            p._insertTemplate(token);\n            p.activeFormattingElements.insertMarker();\n            p.framesetOk = false;\n            p.insertionMode = InsertionMode.IN_TEMPLATE;\n            p.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n            break;\n        }\n        case $.HEAD: {\n            p._err(token, ERR.misplacedStartTagForHeadElement);\n            break;\n        }\n        default: {\n            tokenInHead(p, token);\n        }\n    }\n}\nfunction endTagInHead(p, token) {\n    switch (token.tagID) {\n        case $.HEAD: {\n            p.openElements.pop();\n            p.insertionMode = InsertionMode.AFTER_HEAD;\n            break;\n        }\n        case $.BODY:\n        case $.BR:\n        case $.HTML: {\n            tokenInHead(p, token);\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default: {\n            p._err(token, ERR.endTagWithoutMatchingOpenElement);\n        }\n    }\n}\nfunction templateEndTagInHead(p, token) {\n    if (p.openElements.tmplCount > 0) {\n        p.openElements.generateImpliedEndTagsThoroughly();\n        if (p.openElements.currentTagId !== $.TEMPLATE) {\n            p._err(token, ERR.closingOfElementWithOpenChildElements);\n        }\n        p.openElements.popUntilTagNamePopped($.TEMPLATE);\n        p.activeFormattingElements.clearToLastMarker();\n        p.tmplInsertionModeStack.shift();\n        p._resetInsertionMode();\n    }\n    else {\n        p._err(token, ERR.endTagWithoutMatchingOpenElement);\n    }\n}\nfunction tokenInHead(p, token) {\n    p.openElements.pop();\n    p.insertionMode = InsertionMode.AFTER_HEAD;\n    p._processToken(token);\n}\n// The \"in head no script\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHeadNoScript(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.BASEFONT:\n        case $.BGSOUND:\n        case $.HEAD:\n        case $.LINK:\n        case $.META:\n        case $.NOFRAMES:\n        case $.STYLE: {\n            startTagInHead(p, token);\n            break;\n        }\n        case $.NOSCRIPT: {\n            p._err(token, ERR.nestedNoscriptInHead);\n            break;\n        }\n        default: {\n            tokenInHeadNoScript(p, token);\n        }\n    }\n}\nfunction endTagInHeadNoScript(p, token) {\n    switch (token.tagID) {\n        case $.NOSCRIPT: {\n            p.openElements.pop();\n            p.insertionMode = InsertionMode.IN_HEAD;\n            break;\n        }\n        case $.BR: {\n            tokenInHeadNoScript(p, token);\n            break;\n        }\n        default: {\n            p._err(token, ERR.endTagWithoutMatchingOpenElement);\n        }\n    }\n}\nfunction tokenInHeadNoScript(p, token) {\n    const errCode = token.type === TokenType.EOF ? ERR.openElementsLeftAfterEof : ERR.disallowedContentInNoscriptInHead;\n    p._err(token, errCode);\n    p.openElements.pop();\n    p.insertionMode = InsertionMode.IN_HEAD;\n    p._processToken(token);\n}\n// The \"after head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterHead(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.BODY: {\n            p._insertElement(token, NS.HTML);\n            p.framesetOk = false;\n            p.insertionMode = InsertionMode.IN_BODY;\n            break;\n        }\n        case $.FRAMESET: {\n            p._insertElement(token, NS.HTML);\n            p.insertionMode = InsertionMode.IN_FRAMESET;\n            break;\n        }\n        case $.BASE:\n        case $.BASEFONT:\n        case $.BGSOUND:\n        case $.LINK:\n        case $.META:\n        case $.NOFRAMES:\n        case $.SCRIPT:\n        case $.STYLE:\n        case $.TEMPLATE:\n        case $.TITLE: {\n            p._err(token, ERR.abandonedHeadElementChild);\n            p.openElements.push(p.headElement, $.HEAD);\n            startTagInHead(p, token);\n            p.openElements.remove(p.headElement);\n            break;\n        }\n        case $.HEAD: {\n            p._err(token, ERR.misplacedStartTagForHeadElement);\n            break;\n        }\n        default: {\n            tokenAfterHead(p, token);\n        }\n    }\n}\nfunction endTagAfterHead(p, token) {\n    switch (token.tagID) {\n        case $.BODY:\n        case $.HTML:\n        case $.BR: {\n            tokenAfterHead(p, token);\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default: {\n            p._err(token, ERR.endTagWithoutMatchingOpenElement);\n        }\n    }\n}\nfunction tokenAfterHead(p, token) {\n    p._insertFakeElement(TN.BODY, $.BODY);\n    p.insertionMode = InsertionMode.IN_BODY;\n    modeInBody(p, token);\n}\n// The \"in body\" insertion mode\n//------------------------------------------------------------------\nfunction modeInBody(p, token) {\n    switch (token.type) {\n        case TokenType.CHARACTER: {\n            characterInBody(p, token);\n            break;\n        }\n        case TokenType.WHITESPACE_CHARACTER: {\n            whitespaceCharacterInBody(p, token);\n            break;\n        }\n        case TokenType.COMMENT: {\n            appendComment(p, token);\n            break;\n        }\n        case TokenType.START_TAG: {\n            startTagInBody(p, token);\n            break;\n        }\n        case TokenType.END_TAG: {\n            endTagInBody(p, token);\n            break;\n        }\n        case TokenType.EOF: {\n            eofInBody(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction whitespaceCharacterInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertCharacters(token);\n}\nfunction characterInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertCharacters(token);\n    p.framesetOk = false;\n}\nfunction htmlStartTagInBody(p, token) {\n    if (p.openElements.tmplCount === 0) {\n        p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\n    }\n}\nfunction bodyStartTagInBody(p, token) {\n    const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n    if (bodyElement && p.openElements.tmplCount === 0) {\n        p.framesetOk = false;\n        p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\n    }\n}\nfunction framesetStartTagInBody(p, token) {\n    const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n    if (p.framesetOk && bodyElement) {\n        p.treeAdapter.detachNode(bodyElement);\n        p.openElements.popAllUpToHtmlElement();\n        p._insertElement(token, NS.HTML);\n        p.insertionMode = InsertionMode.IN_FRAMESET;\n    }\n}\nfunction addressStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction numberedHeaderStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    if (p.openElements.currentTagId !== undefined && NUMBERED_HEADERS.has(p.openElements.currentTagId)) {\n        p.openElements.pop();\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction preStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n    //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\n    p.skipNextNewLine = true;\n    p.framesetOk = false;\n}\nfunction formStartTagInBody(p, token) {\n    const inTemplate = p.openElements.tmplCount > 0;\n    if (!p.formElement || inTemplate) {\n        if (p.openElements.hasInButtonScope($.P)) {\n            p._closePElement();\n        }\n        p._insertElement(token, NS.HTML);\n        if (!inTemplate) {\n            p.formElement = p.openElements.current;\n        }\n    }\n}\nfunction listItemStartTagInBody(p, token) {\n    p.framesetOk = false;\n    const tn = token.tagID;\n    for (let i = p.openElements.stackTop; i >= 0; i--) {\n        const elementId = p.openElements.tagIDs[i];\n        if ((tn === $.LI && elementId === $.LI) ||\n            ((tn === $.DD || tn === $.DT) && (elementId === $.DD || elementId === $.DT))) {\n            p.openElements.generateImpliedEndTagsWithExclusion(elementId);\n            p.openElements.popUntilTagNamePopped(elementId);\n            break;\n        }\n        if (elementId !== $.ADDRESS &&\n            elementId !== $.DIV &&\n            elementId !== $.P &&\n            p._isSpecialElement(p.openElements.items[i], elementId)) {\n            break;\n        }\n    }\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction plaintextStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n    p.tokenizer.state = TokenizerMode.PLAINTEXT;\n}\nfunction buttonStartTagInBody(p, token) {\n    if (p.openElements.hasInScope($.BUTTON)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped($.BUTTON);\n    }\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n}\nfunction aStartTagInBody(p, token) {\n    const activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(TN.A);\n    if (activeElementEntry) {\n        callAdoptionAgency(p, token);\n        p.openElements.remove(activeElementEntry.element);\n        p.activeFormattingElements.removeEntry(activeElementEntry);\n    }\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction bStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction nobrStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    if (p.openElements.hasInScope($.NOBR)) {\n        callAdoptionAgency(p, token);\n        p._reconstructActiveFormattingElements();\n    }\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction appletStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.activeFormattingElements.insertMarker();\n    p.framesetOk = false;\n}\nfunction tableStartTagInBody(p, token) {\n    if (p.treeAdapter.getDocumentMode(p.document) !== DOCUMENT_MODE.QUIRKS && p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n    p.insertionMode = InsertionMode.IN_TABLE;\n}\nfunction areaStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._appendElement(token, NS.HTML);\n    p.framesetOk = false;\n    token.ackSelfClosing = true;\n}\nfunction isHiddenInput(token) {\n    const inputType = getTokenAttr(token, ATTRS.TYPE);\n    return inputType != null && inputType.toLowerCase() === HIDDEN_INPUT_TYPE;\n}\nfunction inputStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._appendElement(token, NS.HTML);\n    if (!isHiddenInput(token)) {\n        p.framesetOk = false;\n    }\n    token.ackSelfClosing = true;\n}\nfunction paramStartTagInBody(p, token) {\n    p._appendElement(token, NS.HTML);\n    token.ackSelfClosing = true;\n}\nfunction hrStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._appendElement(token, NS.HTML);\n    p.framesetOk = false;\n    token.ackSelfClosing = true;\n}\nfunction imageStartTagInBody(p, token) {\n    token.tagName = TN.IMG;\n    token.tagID = $.IMG;\n    areaStartTagInBody(p, token);\n}\nfunction textareaStartTagInBody(p, token) {\n    p._insertElement(token, NS.HTML);\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n    //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\n    p.skipNextNewLine = true;\n    p.tokenizer.state = TokenizerMode.RCDATA;\n    p.originalInsertionMode = p.insertionMode;\n    p.framesetOk = false;\n    p.insertionMode = InsertionMode.TEXT;\n}\nfunction xmpStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope($.P)) {\n        p._closePElement();\n    }\n    p._reconstructActiveFormattingElements();\n    p.framesetOk = false;\n    p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n}\nfunction iframeStartTagInBody(p, token) {\n    p.framesetOk = false;\n    p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n}\n//NOTE: here we assume that we always act as a user agent with enabled plugins/frames, so we parse\n//<noembed>/<noframes> as rawtext.\nfunction rawTextStartTagInBody(p, token) {\n    p._switchToTextParsing(token, TokenizerMode.RAWTEXT);\n}\nfunction selectStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n    p.framesetOk = false;\n    p.insertionMode =\n        p.insertionMode === InsertionMode.IN_TABLE ||\n            p.insertionMode === InsertionMode.IN_CAPTION ||\n            p.insertionMode === InsertionMode.IN_TABLE_BODY ||\n            p.insertionMode === InsertionMode.IN_ROW ||\n            p.insertionMode === InsertionMode.IN_CELL\n            ? InsertionMode.IN_SELECT_IN_TABLE\n            : InsertionMode.IN_SELECT;\n}\nfunction optgroupStartTagInBody(p, token) {\n    if (p.openElements.currentTagId === $.OPTION) {\n        p.openElements.pop();\n    }\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n}\nfunction rbStartTagInBody(p, token) {\n    if (p.openElements.hasInScope($.RUBY)) {\n        p.openElements.generateImpliedEndTags();\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction rtStartTagInBody(p, token) {\n    if (p.openElements.hasInScope($.RUBY)) {\n        p.openElements.generateImpliedEndTagsWithExclusion($.RTC);\n    }\n    p._insertElement(token, NS.HTML);\n}\nfunction mathStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    foreignContent.adjustTokenMathMLAttrs(token);\n    foreignContent.adjustTokenXMLAttrs(token);\n    if (token.selfClosing) {\n        p._appendElement(token, NS.MATHML);\n    }\n    else {\n        p._insertElement(token, NS.MATHML);\n    }\n    token.ackSelfClosing = true;\n}\nfunction svgStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    foreignContent.adjustTokenSVGAttrs(token);\n    foreignContent.adjustTokenXMLAttrs(token);\n    if (token.selfClosing) {\n        p._appendElement(token, NS.SVG);\n    }\n    else {\n        p._insertElement(token, NS.SVG);\n    }\n    token.ackSelfClosing = true;\n}\nfunction genericStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, NS.HTML);\n}\nfunction startTagInBody(p, token) {\n    switch (token.tagID) {\n        case $.I:\n        case $.S:\n        case $.B:\n        case $.U:\n        case $.EM:\n        case $.TT:\n        case $.BIG:\n        case $.CODE:\n        case $.FONT:\n        case $.SMALL:\n        case $.STRIKE:\n        case $.STRONG: {\n            bStartTagInBody(p, token);\n            break;\n        }\n        case $.A: {\n            aStartTagInBody(p, token);\n            break;\n        }\n        case $.H1:\n        case $.H2:\n        case $.H3:\n        case $.H4:\n        case $.H5:\n        case $.H6: {\n            numberedHeaderStartTagInBody(p, token);\n            break;\n        }\n        case $.P:\n        case $.DL:\n        case $.OL:\n        case $.UL:\n        case $.DIV:\n        case $.DIR:\n        case $.NAV:\n        case $.MAIN:\n        case $.MENU:\n        case $.ASIDE:\n        case $.CENTER:\n        case $.FIGURE:\n        case $.FOOTER:\n        case $.HEADER:\n        case $.HGROUP:\n        case $.DIALOG:\n        case $.DETAILS:\n        case $.ADDRESS:\n        case $.ARTICLE:\n        case $.SEARCH:\n        case $.SECTION:\n        case $.SUMMARY:\n        case $.FIELDSET:\n        case $.BLOCKQUOTE:\n        case $.FIGCAPTION: {\n            addressStartTagInBody(p, token);\n            break;\n        }\n        case $.LI:\n        case $.DD:\n        case $.DT: {\n            listItemStartTagInBody(p, token);\n            break;\n        }\n        case $.BR:\n        case $.IMG:\n        case $.WBR:\n        case $.AREA:\n        case $.EMBED:\n        case $.KEYGEN: {\n            areaStartTagInBody(p, token);\n            break;\n        }\n        case $.HR: {\n            hrStartTagInBody(p, token);\n            break;\n        }\n        case $.RB:\n        case $.RTC: {\n            rbStartTagInBody(p, token);\n            break;\n        }\n        case $.RT:\n        case $.RP: {\n            rtStartTagInBody(p, token);\n            break;\n        }\n        case $.PRE:\n        case $.LISTING: {\n            preStartTagInBody(p, token);\n            break;\n        }\n        case $.XMP: {\n            xmpStartTagInBody(p, token);\n            break;\n        }\n        case $.SVG: {\n            svgStartTagInBody(p, token);\n            break;\n        }\n        case $.HTML: {\n            htmlStartTagInBody(p, token);\n            break;\n        }\n        case $.BASE:\n        case $.LINK:\n        case $.META:\n        case $.STYLE:\n        case $.TITLE:\n        case $.SCRIPT:\n        case $.BGSOUND:\n        case $.BASEFONT:\n        case $.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        case $.BODY: {\n            bodyStartTagInBody(p, token);\n            break;\n        }\n        case $.FORM: {\n            formStartTagInBody(p, token);\n            break;\n        }\n        case $.NOBR: {\n            nobrStartTagInBody(p, token);\n            break;\n        }\n        case $.MATH: {\n            mathStartTagInBody(p, token);\n            break;\n        }\n        case $.TABLE: {\n            tableStartTagInBody(p, token);\n            break;\n        }\n        case $.INPUT: {\n            inputStartTagInBody(p, token);\n            break;\n        }\n        case $.PARAM:\n        case $.TRACK:\n        case $.SOURCE: {\n            paramStartTagInBody(p, token);\n            break;\n        }\n        case $.IMAGE: {\n            imageStartTagInBody(p, token);\n            break;\n        }\n        case $.BUTTON: {\n            buttonStartTagInBody(p, token);\n            break;\n        }\n        case $.APPLET:\n        case $.OBJECT:\n        case $.MARQUEE: {\n            appletStartTagInBody(p, token);\n            break;\n        }\n        case $.IFRAME: {\n            iframeStartTagInBody(p, token);\n            break;\n        }\n        case $.SELECT: {\n            selectStartTagInBody(p, token);\n            break;\n        }\n        case $.OPTION:\n        case $.OPTGROUP: {\n            optgroupStartTagInBody(p, token);\n            break;\n        }\n        case $.NOEMBED:\n        case $.NOFRAMES: {\n            rawTextStartTagInBody(p, token);\n            break;\n        }\n        case $.FRAMESET: {\n            framesetStartTagInBody(p, token);\n            break;\n        }\n        case $.TEXTAREA: {\n            textareaStartTagInBody(p, token);\n            break;\n        }\n        case $.NOSCRIPT: {\n            if (p.options.scriptingEnabled) {\n                rawTextStartTagInBody(p, token);\n            }\n            else {\n                genericStartTagInBody(p, token);\n            }\n            break;\n        }\n        case $.PLAINTEXT: {\n            plaintextStartTagInBody(p, token);\n            break;\n        }\n        case $.COL:\n        case $.TH:\n        case $.TD:\n        case $.TR:\n        case $.HEAD:\n        case $.FRAME:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD:\n        case $.CAPTION:\n        case $.COLGROUP: {\n            // Ignore token\n            break;\n        }\n        default: {\n            genericStartTagInBody(p, token);\n        }\n    }\n}\nfunction bodyEndTagInBody(p, token) {\n    if (p.openElements.hasInScope($.BODY)) {\n        p.insertionMode = InsertionMode.AFTER_BODY;\n        //NOTE: <body> is never popped from the stack, so we need to updated\n        //the end location explicitly.\n        if (p.options.sourceCodeLocationInfo) {\n            const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n            if (bodyElement) {\n                p._setEndLocation(bodyElement, token);\n            }\n        }\n    }\n}\nfunction htmlEndTagInBody(p, token) {\n    if (p.openElements.hasInScope($.BODY)) {\n        p.insertionMode = InsertionMode.AFTER_BODY;\n        endTagAfterBody(p, token);\n    }\n}\nfunction addressEndTagInBody(p, token) {\n    const tn = token.tagID;\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped(tn);\n    }\n}\nfunction formEndTagInBody(p) {\n    const inTemplate = p.openElements.tmplCount > 0;\n    const { formElement } = p;\n    if (!inTemplate) {\n        p.formElement = null;\n    }\n    if ((formElement || inTemplate) && p.openElements.hasInScope($.FORM)) {\n        p.openElements.generateImpliedEndTags();\n        if (inTemplate) {\n            p.openElements.popUntilTagNamePopped($.FORM);\n        }\n        else if (formElement) {\n            p.openElements.remove(formElement);\n        }\n    }\n}\nfunction pEndTagInBody(p) {\n    if (!p.openElements.hasInButtonScope($.P)) {\n        p._insertFakeElement(TN.P, $.P);\n    }\n    p._closePElement();\n}\nfunction liEndTagInBody(p) {\n    if (p.openElements.hasInListItemScope($.LI)) {\n        p.openElements.generateImpliedEndTagsWithExclusion($.LI);\n        p.openElements.popUntilTagNamePopped($.LI);\n    }\n}\nfunction ddEndTagInBody(p, token) {\n    const tn = token.tagID;\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTagsWithExclusion(tn);\n        p.openElements.popUntilTagNamePopped(tn);\n    }\n}\nfunction numberedHeaderEndTagInBody(p) {\n    if (p.openElements.hasNumberedHeaderInScope()) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilNumberedHeaderPopped();\n    }\n}\nfunction appletEndTagInBody(p, token) {\n    const tn = token.tagID;\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped(tn);\n        p.activeFormattingElements.clearToLastMarker();\n    }\n}\nfunction brEndTagInBody(p) {\n    p._reconstructActiveFormattingElements();\n    p._insertFakeElement(TN.BR, $.BR);\n    p.openElements.pop();\n    p.framesetOk = false;\n}\nfunction genericEndTagInBody(p, token) {\n    const tn = token.tagName;\n    const tid = token.tagID;\n    for (let i = p.openElements.stackTop; i > 0; i--) {\n        const element = p.openElements.items[i];\n        const elementId = p.openElements.tagIDs[i];\n        // Compare the tag name here, as the tag might not be a known tag with an ID.\n        if (tid === elementId && (tid !== $.UNKNOWN || p.treeAdapter.getTagName(element) === tn)) {\n            p.openElements.generateImpliedEndTagsWithExclusion(tid);\n            if (p.openElements.stackTop >= i)\n                p.openElements.shortenToLength(i);\n            break;\n        }\n        if (p._isSpecialElement(element, elementId)) {\n            break;\n        }\n    }\n}\nfunction endTagInBody(p, token) {\n    switch (token.tagID) {\n        case $.A:\n        case $.B:\n        case $.I:\n        case $.S:\n        case $.U:\n        case $.EM:\n        case $.TT:\n        case $.BIG:\n        case $.CODE:\n        case $.FONT:\n        case $.NOBR:\n        case $.SMALL:\n        case $.STRIKE:\n        case $.STRONG: {\n            callAdoptionAgency(p, token);\n            break;\n        }\n        case $.P: {\n            pEndTagInBody(p);\n            break;\n        }\n        case $.DL:\n        case $.UL:\n        case $.OL:\n        case $.DIR:\n        case $.DIV:\n        case $.NAV:\n        case $.PRE:\n        case $.MAIN:\n        case $.MENU:\n        case $.ASIDE:\n        case $.BUTTON:\n        case $.CENTER:\n        case $.FIGURE:\n        case $.FOOTER:\n        case $.HEADER:\n        case $.HGROUP:\n        case $.DIALOG:\n        case $.ADDRESS:\n        case $.ARTICLE:\n        case $.DETAILS:\n        case $.SEARCH:\n        case $.SECTION:\n        case $.SUMMARY:\n        case $.LISTING:\n        case $.FIELDSET:\n        case $.BLOCKQUOTE:\n        case $.FIGCAPTION: {\n            addressEndTagInBody(p, token);\n            break;\n        }\n        case $.LI: {\n            liEndTagInBody(p);\n            break;\n        }\n        case $.DD:\n        case $.DT: {\n            ddEndTagInBody(p, token);\n            break;\n        }\n        case $.H1:\n        case $.H2:\n        case $.H3:\n        case $.H4:\n        case $.H5:\n        case $.H6: {\n            numberedHeaderEndTagInBody(p);\n            break;\n        }\n        case $.BR: {\n            brEndTagInBody(p);\n            break;\n        }\n        case $.BODY: {\n            bodyEndTagInBody(p, token);\n            break;\n        }\n        case $.HTML: {\n            htmlEndTagInBody(p, token);\n            break;\n        }\n        case $.FORM: {\n            formEndTagInBody(p);\n            break;\n        }\n        case $.APPLET:\n        case $.OBJECT:\n        case $.MARQUEE: {\n            appletEndTagInBody(p, token);\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default: {\n            genericEndTagInBody(p, token);\n        }\n    }\n}\nfunction eofInBody(p, token) {\n    if (p.tmplInsertionModeStack.length > 0) {\n        eofInTemplate(p, token);\n    }\n    else {\n        stopParsing(p, token);\n    }\n}\n// The \"text\" insertion mode\n//------------------------------------------------------------------\nfunction endTagInText(p, token) {\n    var _a;\n    if (token.tagID === $.SCRIPT) {\n        (_a = p.scriptHandler) === null || _a === void 0 ? void 0 : _a.call(p, p.openElements.current);\n    }\n    p.openElements.pop();\n    p.insertionMode = p.originalInsertionMode;\n}\nfunction eofInText(p, token) {\n    p._err(token, ERR.eofInElementThatCanContainOnlyText);\n    p.openElements.pop();\n    p.insertionMode = p.originalInsertionMode;\n    p.onEof(token);\n}\n// The \"in table\" insertion mode\n//------------------------------------------------------------------\nfunction characterInTable(p, token) {\n    if (p.openElements.currentTagId !== undefined && TABLE_STRUCTURE_TAGS.has(p.openElements.currentTagId)) {\n        p.pendingCharacterTokens.length = 0;\n        p.hasNonWhitespacePendingCharacterToken = false;\n        p.originalInsertionMode = p.insertionMode;\n        p.insertionMode = InsertionMode.IN_TABLE_TEXT;\n        switch (token.type) {\n            case TokenType.CHARACTER: {\n                characterInTableText(p, token);\n                break;\n            }\n            case TokenType.WHITESPACE_CHARACTER: {\n                whitespaceCharacterInTableText(p, token);\n                break;\n            }\n            // Ignore null\n        }\n    }\n    else {\n        tokenInTable(p, token);\n    }\n}\nfunction captionStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p.activeFormattingElements.insertMarker();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = InsertionMode.IN_CAPTION;\n}\nfunction colgroupStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n}\nfunction colStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertFakeElement(TN.COLGROUP, $.COLGROUP);\n    p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n    startTagInColumnGroup(p, token);\n}\nfunction tbodyStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertElement(token, NS.HTML);\n    p.insertionMode = InsertionMode.IN_TABLE_BODY;\n}\nfunction tdStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertFakeElement(TN.TBODY, $.TBODY);\n    p.insertionMode = InsertionMode.IN_TABLE_BODY;\n    startTagInTableBody(p, token);\n}\nfunction tableStartTagInTable(p, token) {\n    if (p.openElements.hasInTableScope($.TABLE)) {\n        p.openElements.popUntilTagNamePopped($.TABLE);\n        p._resetInsertionMode();\n        p._processStartTag(token);\n    }\n}\nfunction inputStartTagInTable(p, token) {\n    if (isHiddenInput(token)) {\n        p._appendElement(token, NS.HTML);\n    }\n    else {\n        tokenInTable(p, token);\n    }\n    token.ackSelfClosing = true;\n}\nfunction formStartTagInTable(p, token) {\n    if (!p.formElement && p.openElements.tmplCount === 0) {\n        p._insertElement(token, NS.HTML);\n        p.formElement = p.openElements.current;\n        p.openElements.pop();\n    }\n}\nfunction startTagInTable(p, token) {\n    switch (token.tagID) {\n        case $.TD:\n        case $.TH:\n        case $.TR: {\n            tdStartTagInTable(p, token);\n            break;\n        }\n        case $.STYLE:\n        case $.SCRIPT:\n        case $.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        case $.COL: {\n            colStartTagInTable(p, token);\n            break;\n        }\n        case $.FORM: {\n            formStartTagInTable(p, token);\n            break;\n        }\n        case $.TABLE: {\n            tableStartTagInTable(p, token);\n            break;\n        }\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD: {\n            tbodyStartTagInTable(p, token);\n            break;\n        }\n        case $.INPUT: {\n            inputStartTagInTable(p, token);\n            break;\n        }\n        case $.CAPTION: {\n            captionStartTagInTable(p, token);\n            break;\n        }\n        case $.COLGROUP: {\n            colgroupStartTagInTable(p, token);\n            break;\n        }\n        default: {\n            tokenInTable(p, token);\n        }\n    }\n}\nfunction endTagInTable(p, token) {\n    switch (token.tagID) {\n        case $.TABLE: {\n            if (p.openElements.hasInTableScope($.TABLE)) {\n                p.openElements.popUntilTagNamePopped($.TABLE);\n                p._resetInsertionMode();\n            }\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        case $.BODY:\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML:\n        case $.TBODY:\n        case $.TD:\n        case $.TFOOT:\n        case $.TH:\n        case $.THEAD:\n        case $.TR: {\n            // Ignore token\n            break;\n        }\n        default: {\n            tokenInTable(p, token);\n        }\n    }\n}\nfunction tokenInTable(p, token) {\n    const savedFosterParentingState = p.fosterParentingEnabled;\n    p.fosterParentingEnabled = true;\n    // Process token in `In Body` mode\n    modeInBody(p, token);\n    p.fosterParentingEnabled = savedFosterParentingState;\n}\n// The \"in table text\" insertion mode\n//------------------------------------------------------------------\nfunction whitespaceCharacterInTableText(p, token) {\n    p.pendingCharacterTokens.push(token);\n}\nfunction characterInTableText(p, token) {\n    p.pendingCharacterTokens.push(token);\n    p.hasNonWhitespacePendingCharacterToken = true;\n}\nfunction tokenInTableText(p, token) {\n    let i = 0;\n    if (p.hasNonWhitespacePendingCharacterToken) {\n        for (; i < p.pendingCharacterTokens.length; i++) {\n            tokenInTable(p, p.pendingCharacterTokens[i]);\n        }\n    }\n    else {\n        for (; i < p.pendingCharacterTokens.length; i++) {\n            p._insertCharacters(p.pendingCharacterTokens[i]);\n        }\n    }\n    p.insertionMode = p.originalInsertionMode;\n    p._processToken(token);\n}\n// The \"in caption\" insertion mode\n//------------------------------------------------------------------\nconst TABLE_VOID_ELEMENTS = new Set([$.CAPTION, $.COL, $.COLGROUP, $.TBODY, $.TD, $.TFOOT, $.TH, $.THEAD, $.TR]);\nfunction startTagInCaption(p, token) {\n    const tn = token.tagID;\n    if (TABLE_VOID_ELEMENTS.has(tn)) {\n        if (p.openElements.hasInTableScope($.CAPTION)) {\n            p.openElements.generateImpliedEndTags();\n            p.openElements.popUntilTagNamePopped($.CAPTION);\n            p.activeFormattingElements.clearToLastMarker();\n            p.insertionMode = InsertionMode.IN_TABLE;\n            startTagInTable(p, token);\n        }\n    }\n    else {\n        startTagInBody(p, token);\n    }\n}\nfunction endTagInCaption(p, token) {\n    const tn = token.tagID;\n    switch (tn) {\n        case $.CAPTION:\n        case $.TABLE: {\n            if (p.openElements.hasInTableScope($.CAPTION)) {\n                p.openElements.generateImpliedEndTags();\n                p.openElements.popUntilTagNamePopped($.CAPTION);\n                p.activeFormattingElements.clearToLastMarker();\n                p.insertionMode = InsertionMode.IN_TABLE;\n                if (tn === $.TABLE) {\n                    endTagInTable(p, token);\n                }\n            }\n            break;\n        }\n        case $.BODY:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML:\n        case $.TBODY:\n        case $.TD:\n        case $.TFOOT:\n        case $.TH:\n        case $.THEAD:\n        case $.TR: {\n            // Ignore token\n            break;\n        }\n        default: {\n            endTagInBody(p, token);\n        }\n    }\n}\n// The \"in column group\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInColumnGroup(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.COL: {\n            p._appendElement(token, NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case $.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        default: {\n            tokenInColumnGroup(p, token);\n        }\n    }\n}\nfunction endTagInColumnGroup(p, token) {\n    switch (token.tagID) {\n        case $.COLGROUP: {\n            if (p.openElements.currentTagId === $.COLGROUP) {\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n            }\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        case $.COL: {\n            // Ignore token\n            break;\n        }\n        default: {\n            tokenInColumnGroup(p, token);\n        }\n    }\n}\nfunction tokenInColumnGroup(p, token) {\n    if (p.openElements.currentTagId === $.COLGROUP) {\n        p.openElements.pop();\n        p.insertionMode = InsertionMode.IN_TABLE;\n        p._processToken(token);\n    }\n}\n// The \"in table body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTableBody(p, token) {\n    switch (token.tagID) {\n        case $.TR: {\n            p.openElements.clearBackToTableBodyContext();\n            p._insertElement(token, NS.HTML);\n            p.insertionMode = InsertionMode.IN_ROW;\n            break;\n        }\n        case $.TH:\n        case $.TD: {\n            p.openElements.clearBackToTableBodyContext();\n            p._insertFakeElement(TN.TR, $.TR);\n            p.insertionMode = InsertionMode.IN_ROW;\n            startTagInRow(p, token);\n            break;\n        }\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD: {\n            if (p.openElements.hasTableBodyContextInTableScope()) {\n                p.openElements.clearBackToTableBodyContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n                startTagInTable(p, token);\n            }\n            break;\n        }\n        default: {\n            startTagInTable(p, token);\n        }\n    }\n}\nfunction endTagInTableBody(p, token) {\n    const tn = token.tagID;\n    switch (token.tagID) {\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD: {\n            if (p.openElements.hasInTableScope(tn)) {\n                p.openElements.clearBackToTableBodyContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n            }\n            break;\n        }\n        case $.TABLE: {\n            if (p.openElements.hasTableBodyContextInTableScope()) {\n                p.openElements.clearBackToTableBodyContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n                endTagInTable(p, token);\n            }\n            break;\n        }\n        case $.BODY:\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML:\n        case $.TD:\n        case $.TH:\n        case $.TR: {\n            // Ignore token\n            break;\n        }\n        default: {\n            endTagInTable(p, token);\n        }\n    }\n}\n// The \"in row\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInRow(p, token) {\n    switch (token.tagID) {\n        case $.TH:\n        case $.TD: {\n            p.openElements.clearBackToTableRowContext();\n            p._insertElement(token, NS.HTML);\n            p.insertionMode = InsertionMode.IN_CELL;\n            p.activeFormattingElements.insertMarker();\n            break;\n        }\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD:\n        case $.TR: {\n            if (p.openElements.hasInTableScope($.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n                startTagInTableBody(p, token);\n            }\n            break;\n        }\n        default: {\n            startTagInTable(p, token);\n        }\n    }\n}\nfunction endTagInRow(p, token) {\n    switch (token.tagID) {\n        case $.TR: {\n            if (p.openElements.hasInTableScope($.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n            }\n            break;\n        }\n        case $.TABLE: {\n            if (p.openElements.hasInTableScope($.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n                endTagInTableBody(p, token);\n            }\n            break;\n        }\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD: {\n            if (p.openElements.hasInTableScope(token.tagID) || p.openElements.hasInTableScope($.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n                endTagInTableBody(p, token);\n            }\n            break;\n        }\n        case $.BODY:\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML:\n        case $.TD:\n        case $.TH: {\n            // Ignore end tag\n            break;\n        }\n        default: {\n            endTagInTable(p, token);\n        }\n    }\n}\n// The \"in cell\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInCell(p, token) {\n    const tn = token.tagID;\n    if (TABLE_VOID_ELEMENTS.has(tn)) {\n        if (p.openElements.hasInTableScope($.TD) || p.openElements.hasInTableScope($.TH)) {\n            p._closeTableCell();\n            startTagInRow(p, token);\n        }\n    }\n    else {\n        startTagInBody(p, token);\n    }\n}\nfunction endTagInCell(p, token) {\n    const tn = token.tagID;\n    switch (tn) {\n        case $.TD:\n        case $.TH: {\n            if (p.openElements.hasInTableScope(tn)) {\n                p.openElements.generateImpliedEndTags();\n                p.openElements.popUntilTagNamePopped(tn);\n                p.activeFormattingElements.clearToLastMarker();\n                p.insertionMode = InsertionMode.IN_ROW;\n            }\n            break;\n        }\n        case $.TABLE:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD:\n        case $.TR: {\n            if (p.openElements.hasInTableScope(tn)) {\n                p._closeTableCell();\n                endTagInRow(p, token);\n            }\n            break;\n        }\n        case $.BODY:\n        case $.CAPTION:\n        case $.COL:\n        case $.COLGROUP:\n        case $.HTML: {\n            // Ignore token\n            break;\n        }\n        default: {\n            endTagInBody(p, token);\n        }\n    }\n}\n// The \"in select\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelect(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.OPTION: {\n            if (p.openElements.currentTagId === $.OPTION) {\n                p.openElements.pop();\n            }\n            p._insertElement(token, NS.HTML);\n            break;\n        }\n        case $.OPTGROUP: {\n            if (p.openElements.currentTagId === $.OPTION) {\n                p.openElements.pop();\n            }\n            if (p.openElements.currentTagId === $.OPTGROUP) {\n                p.openElements.pop();\n            }\n            p._insertElement(token, NS.HTML);\n            break;\n        }\n        case $.HR: {\n            if (p.openElements.currentTagId === $.OPTION) {\n                p.openElements.pop();\n            }\n            if (p.openElements.currentTagId === $.OPTGROUP) {\n                p.openElements.pop();\n            }\n            p._appendElement(token, NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case $.INPUT:\n        case $.KEYGEN:\n        case $.TEXTAREA:\n        case $.SELECT: {\n            if (p.openElements.hasInSelectScope($.SELECT)) {\n                p.openElements.popUntilTagNamePopped($.SELECT);\n                p._resetInsertionMode();\n                if (token.tagID !== $.SELECT) {\n                    p._processStartTag(token);\n                }\n            }\n            break;\n        }\n        case $.SCRIPT:\n        case $.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction endTagInSelect(p, token) {\n    switch (token.tagID) {\n        case $.OPTGROUP: {\n            if (p.openElements.stackTop > 0 &&\n                p.openElements.currentTagId === $.OPTION &&\n                p.openElements.tagIDs[p.openElements.stackTop - 1] === $.OPTGROUP) {\n                p.openElements.pop();\n            }\n            if (p.openElements.currentTagId === $.OPTGROUP) {\n                p.openElements.pop();\n            }\n            break;\n        }\n        case $.OPTION: {\n            if (p.openElements.currentTagId === $.OPTION) {\n                p.openElements.pop();\n            }\n            break;\n        }\n        case $.SELECT: {\n            if (p.openElements.hasInSelectScope($.SELECT)) {\n                p.openElements.popUntilTagNamePopped($.SELECT);\n                p._resetInsertionMode();\n            }\n            break;\n        }\n        case $.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\n// The \"in select in table\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelectInTable(p, token) {\n    const tn = token.tagID;\n    if (tn === $.CAPTION ||\n        tn === $.TABLE ||\n        tn === $.TBODY ||\n        tn === $.TFOOT ||\n        tn === $.THEAD ||\n        tn === $.TR ||\n        tn === $.TD ||\n        tn === $.TH) {\n        p.openElements.popUntilTagNamePopped($.SELECT);\n        p._resetInsertionMode();\n        p._processStartTag(token);\n    }\n    else {\n        startTagInSelect(p, token);\n    }\n}\nfunction endTagInSelectInTable(p, token) {\n    const tn = token.tagID;\n    if (tn === $.CAPTION ||\n        tn === $.TABLE ||\n        tn === $.TBODY ||\n        tn === $.TFOOT ||\n        tn === $.THEAD ||\n        tn === $.TR ||\n        tn === $.TD ||\n        tn === $.TH) {\n        if (p.openElements.hasInTableScope(tn)) {\n            p.openElements.popUntilTagNamePopped($.SELECT);\n            p._resetInsertionMode();\n            p.onEndTag(token);\n        }\n    }\n    else {\n        endTagInSelect(p, token);\n    }\n}\n// The \"in template\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTemplate(p, token) {\n    switch (token.tagID) {\n        // First, handle tags that can start without a mode change\n        case $.BASE:\n        case $.BASEFONT:\n        case $.BGSOUND:\n        case $.LINK:\n        case $.META:\n        case $.NOFRAMES:\n        case $.SCRIPT:\n        case $.STYLE:\n        case $.TEMPLATE:\n        case $.TITLE: {\n            startTagInHead(p, token);\n            break;\n        }\n        // Re-process the token in the appropriate mode\n        case $.CAPTION:\n        case $.COLGROUP:\n        case $.TBODY:\n        case $.TFOOT:\n        case $.THEAD: {\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE;\n            p.insertionMode = InsertionMode.IN_TABLE;\n            startTagInTable(p, token);\n            break;\n        }\n        case $.COL: {\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_COLUMN_GROUP;\n            p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n            startTagInColumnGroup(p, token);\n            break;\n        }\n        case $.TR: {\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE_BODY;\n            p.insertionMode = InsertionMode.IN_TABLE_BODY;\n            startTagInTableBody(p, token);\n            break;\n        }\n        case $.TD:\n        case $.TH: {\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_ROW;\n            p.insertionMode = InsertionMode.IN_ROW;\n            startTagInRow(p, token);\n            break;\n        }\n        default: {\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_BODY;\n            p.insertionMode = InsertionMode.IN_BODY;\n            startTagInBody(p, token);\n        }\n    }\n}\nfunction endTagInTemplate(p, token) {\n    if (token.tagID === $.TEMPLATE) {\n        templateEndTagInHead(p, token);\n    }\n}\nfunction eofInTemplate(p, token) {\n    if (p.openElements.tmplCount > 0) {\n        p.openElements.popUntilTagNamePopped($.TEMPLATE);\n        p.activeFormattingElements.clearToLastMarker();\n        p.tmplInsertionModeStack.shift();\n        p._resetInsertionMode();\n        p.onEof(token);\n    }\n    else {\n        stopParsing(p, token);\n    }\n}\n// The \"after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterBody(p, token) {\n    if (token.tagID === $.HTML) {\n        startTagInBody(p, token);\n    }\n    else {\n        tokenAfterBody(p, token);\n    }\n}\nfunction endTagAfterBody(p, token) {\n    var _a;\n    if (token.tagID === $.HTML) {\n        if (!p.fragmentContext) {\n            p.insertionMode = InsertionMode.AFTER_AFTER_BODY;\n        }\n        //NOTE: <html> is never popped from the stack, so we need to updated\n        //the end location explicitly.\n        if (p.options.sourceCodeLocationInfo && p.openElements.tagIDs[0] === $.HTML) {\n            p._setEndLocation(p.openElements.items[0], token);\n            // Update the body element, if it doesn't have an end tag\n            const bodyElement = p.openElements.items[1];\n            if (bodyElement && !((_a = p.treeAdapter.getNodeSourceCodeLocation(bodyElement)) === null || _a === void 0 ? void 0 : _a.endTag)) {\n                p._setEndLocation(bodyElement, token);\n            }\n        }\n    }\n    else {\n        tokenAfterBody(p, token);\n    }\n}\nfunction tokenAfterBody(p, token) {\n    p.insertionMode = InsertionMode.IN_BODY;\n    modeInBody(p, token);\n}\n// The \"in frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInFrameset(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.FRAMESET: {\n            p._insertElement(token, NS.HTML);\n            break;\n        }\n        case $.FRAME: {\n            p._appendElement(token, NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case $.NOFRAMES: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction endTagInFrameset(p, token) {\n    if (token.tagID === $.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\n        p.openElements.pop();\n        if (!p.fragmentContext && p.openElements.currentTagId !== $.FRAMESET) {\n            p.insertionMode = InsertionMode.AFTER_FRAMESET;\n        }\n    }\n}\n// The \"after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterFrameset(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.NOFRAMES: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction endTagAfterFrameset(p, token) {\n    if (token.tagID === $.HTML) {\n        p.insertionMode = InsertionMode.AFTER_AFTER_FRAMESET;\n    }\n}\n// The \"after after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterBody(p, token) {\n    if (token.tagID === $.HTML) {\n        startTagInBody(p, token);\n    }\n    else {\n        tokenAfterAfterBody(p, token);\n    }\n}\nfunction tokenAfterAfterBody(p, token) {\n    p.insertionMode = InsertionMode.IN_BODY;\n    modeInBody(p, token);\n}\n// The \"after after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterFrameset(p, token) {\n    switch (token.tagID) {\n        case $.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case $.NOFRAMES: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\n// The rules for parsing tokens in foreign content\n//------------------------------------------------------------------\nfunction nullCharacterInForeignContent(p, token) {\n    token.chars = unicode.REPLACEMENT_CHARACTER;\n    p._insertCharacters(token);\n}\nfunction characterInForeignContent(p, token) {\n    p._insertCharacters(token);\n    p.framesetOk = false;\n}\nfunction popUntilHtmlOrIntegrationPoint(p) {\n    while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== NS.HTML &&\n        p.openElements.currentTagId !== undefined &&\n        !p._isIntegrationPoint(p.openElements.currentTagId, p.openElements.current)) {\n        p.openElements.pop();\n    }\n}\nfunction startTagInForeignContent(p, token) {\n    if (foreignContent.causesExit(token)) {\n        popUntilHtmlOrIntegrationPoint(p);\n        p._startTagOutsideForeignContent(token);\n    }\n    else {\n        const current = p._getAdjustedCurrentElement();\n        const currentNs = p.treeAdapter.getNamespaceURI(current);\n        if (currentNs === NS.MATHML) {\n            foreignContent.adjustTokenMathMLAttrs(token);\n        }\n        else if (currentNs === NS.SVG) {\n            foreignContent.adjustTokenSVGTagName(token);\n            foreignContent.adjustTokenSVGAttrs(token);\n        }\n        foreignContent.adjustTokenXMLAttrs(token);\n        if (token.selfClosing) {\n            p._appendElement(token, currentNs);\n        }\n        else {\n            p._insertElement(token, currentNs);\n        }\n        token.ackSelfClosing = true;\n    }\n}\nfunction endTagInForeignContent(p, token) {\n    if (token.tagID === $.P || token.tagID === $.BR) {\n        popUntilHtmlOrIntegrationPoint(p);\n        p._endTagOutsideForeignContent(token);\n        return;\n    }\n    for (let i = p.openElements.stackTop; i > 0; i--) {\n        const element = p.openElements.items[i];\n        if (p.treeAdapter.getNamespaceURI(element) === NS.HTML) {\n            p._endTagOutsideForeignContent(token);\n            break;\n        }\n        const tagName = p.treeAdapter.getTagName(element);\n        if (tagName.toLowerCase() === token.tagName) {\n            //NOTE: update the token tag name for `_setEndLocation`.\n            token.tagName = tagName;\n            p.openElements.shortenToLength(i);\n            break;\n        }\n    }\n}\n","import { TAG_NAMES as $, NS, hasUnescapedText } from '../common/html.js';\nimport { escapeText, escapeAttribute } from 'entities/escape';\nimport { defaultTreeAdapter } from '../tree-adapters/default.js';\n// Sets\nconst VOID_ELEMENTS = new Set([\n    $.AREA,\n    $.BASE,\n    $.BASEFONT,\n    $.BGSOUND,\n    $.BR,\n    $.COL,\n    $.EMBED,\n    $.FRAME,\n    $.HR,\n    $.IMG,\n    $.INPUT,\n    $.KEYGEN,\n    $.LINK,\n    $.META,\n    $.PARAM,\n    $.SOURCE,\n    $.TRACK,\n    $.WBR,\n]);\nfunction isVoidElement(node, options) {\n    return (options.treeAdapter.isElementNode(node) &&\n        options.treeAdapter.getNamespaceURI(node) === NS.HTML &&\n        VOID_ELEMENTS.has(options.treeAdapter.getTagName(node)));\n}\nconst defaultOpts = { treeAdapter: defaultTreeAdapter, scriptingEnabled: true };\n/**\n * Serializes an AST node to an HTML string.\n *\n * @example\n *\n * ```js\n * const parse5 = require('parse5');\n *\n * const document = parse5.parse('<!DOCTYPE html><html><head></head><body>Hi there!</body></html>');\n *\n * // Serializes a document.\n * const html = parse5.serialize(document);\n *\n * // Serializes the <html> element content.\n * const str = parse5.serialize(document.childNodes[1]);\n *\n * console.log(str); //> '<head></head><body>Hi there!</body>'\n * ```\n *\n * @param node Node to serialize.\n * @param options Serialization options.\n */\nexport function serialize(node, options) {\n    const opts = { ...defaultOpts, ...options };\n    if (isVoidElement(node, opts)) {\n        return '';\n    }\n    return serializeChildNodes(node, opts);\n}\n/**\n * Serializes an AST element node to an HTML string, including the element node.\n *\n * @example\n *\n * ```js\n * const parse5 = require('parse5');\n *\n * const document = parse5.parseFragment('<div>Hello, <b>world</b>!</div>');\n *\n * // Serializes the <div> element.\n * const str = parse5.serializeOuter(document.childNodes[0]);\n *\n * console.log(str); //> '<div>Hello, <b>world</b>!</div>'\n * ```\n *\n * @param node Node to serialize.\n * @param options Serialization options.\n */\nexport function serializeOuter(node, options) {\n    const opts = { ...defaultOpts, ...options };\n    return serializeNode(node, opts);\n}\nfunction serializeChildNodes(parentNode, options) {\n    let html = '';\n    // Get container of the child nodes\n    const container = options.treeAdapter.isElementNode(parentNode) &&\n        options.treeAdapter.getTagName(parentNode) === $.TEMPLATE &&\n        options.treeAdapter.getNamespaceURI(parentNode) === NS.HTML\n        ? options.treeAdapter.getTemplateContent(parentNode)\n        : parentNode;\n    const childNodes = options.treeAdapter.getChildNodes(container);\n    if (childNodes) {\n        for (const currentNode of childNodes) {\n            html += serializeNode(currentNode, options);\n        }\n    }\n    return html;\n}\nfunction serializeNode(node, options) {\n    if (options.treeAdapter.isElementNode(node)) {\n        return serializeElement(node, options);\n    }\n    if (options.treeAdapter.isTextNode(node)) {\n        return serializeTextNode(node, options);\n    }\n    if (options.treeAdapter.isCommentNode(node)) {\n        return serializeCommentNode(node, options);\n    }\n    if (options.treeAdapter.isDocumentTypeNode(node)) {\n        return serializeDocumentTypeNode(node, options);\n    }\n    // Return an empty string for unknown nodes\n    return '';\n}\nfunction serializeElement(node, options) {\n    const tn = options.treeAdapter.getTagName(node);\n    return `<${tn}${serializeAttributes(node, options)}>${isVoidElement(node, options) ? '' : `${serializeChildNodes(node, options)}</${tn}>`}`;\n}\nfunction serializeAttributes(node, { treeAdapter }) {\n    let html = '';\n    for (const attr of treeAdapter.getAttrList(node)) {\n        html += ' ';\n        if (attr.namespace) {\n            switch (attr.namespace) {\n                case NS.XML: {\n                    html += `xml:${attr.name}`;\n                    break;\n                }\n                case NS.XMLNS: {\n                    if (attr.name !== 'xmlns') {\n                        html += 'xmlns:';\n                    }\n                    html += attr.name;\n                    break;\n                }\n                case NS.XLINK: {\n                    html += `xlink:${attr.name}`;\n                    break;\n                }\n                default: {\n                    html += `${attr.prefix}:${attr.name}`;\n                }\n            }\n        }\n        else {\n            html += attr.name;\n        }\n        html += `=\"${escapeAttribute(attr.value)}\"`;\n    }\n    return html;\n}\nfunction serializeTextNode(node, options) {\n    const { treeAdapter } = options;\n    const content = treeAdapter.getTextNodeContent(node);\n    const parent = treeAdapter.getParentNode(node);\n    const parentTn = parent && treeAdapter.isElementNode(parent) && treeAdapter.getTagName(parent);\n    return parentTn &&\n        treeAdapter.getNamespaceURI(parent) === NS.HTML &&\n        hasUnescapedText(parentTn, options.scriptingEnabled)\n        ? content\n        : escapeText(content);\n}\nfunction serializeCommentNode(node, { treeAdapter }) {\n    return `<!--${treeAdapter.getCommentNodeContent(node)}-->`;\n}\nfunction serializeDocumentTypeNode(node, { treeAdapter }) {\n    return `<!DOCTYPE ${treeAdapter.getDocumentTypeNodeName(node)}>`;\n}\n","/**\n * AIdeas - Proxy Service\n * Gestisce le richieste proxy per estrazione metadati\n */\n\nimport * as cheerio from 'cheerio';\n\nexport default class ProxyService {\n  constructor() {\n    // Lista di proxy pubblici disponibili (pi robusta)\n    this.proxies = [\n      'https://api.allorigins.win/raw?url=',\n      'https://cors-anywhere.herokuapp.com/',\n      'https://thingproxy.freeboard.io/fetch/',\n      'https://cors.bridged.cc/',\n      'https://api.codetabs.com/v1/proxy?quest=',\n      'https://corsproxy.io/?',\n      'https://cors-anywhere.1d4s.me/',\n      'https://cors-anywhere.herokuapp.com/'\n    ];\n    \n    this.currentProxyIndex = 0;\n  }\n\n  /**\n   * Recupera contenuto usando proxy rotanti\n   */\n  async fetchWithFallback(url, options = {}) {\n    return this.fetchWithProxy(url);\n  }\n\n  /**\n   * Recupera contenuto HTML usando proxy rotanti\n   */\n  async fetchWithProxy(url) {\n    let lastError = null;\n\n    // Prova tutti i proxy disponibili\n    for (let i = 0; i < this.proxies.length; i++) {\n      const proxyIndex = (this.currentProxyIndex + i) % this.proxies.length;\n      const proxy = this.proxies[proxyIndex];\n\n      try {\n        const response = await fetch(proxy + encodeURIComponent(url), {\n          method: 'GET',\n          headers: {\n            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n            'Accept-Language': 'en-US,en;q=0.5',\n            'Accept-Encoding': 'gzip, deflate',\n            'DNT': '1',\n            'Connection': 'keep-alive',\n            'Upgrade-Insecure-Requests': '1',\n            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'\n          },\n          timeout: 10000\n        });\n\n        if (response.ok) {\n          const content = await response.text();\n          \n          // Verifica che sia HTML valido\n          if (content.includes('<html') || content.includes('<head') || content.includes('<body')) {\n            this.currentProxyIndex = proxyIndex; // Aggiorna proxy di successo\n            return content;\n          }\n        }\n      } catch (error) {\n        console.log(`Proxy ${proxyIndex} fallito:`, error.message);\n        lastError = error;\n      }\n    }\n\n    // Se tutti i proxy falliscono, prova approccio diretto\n    try {\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n          'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'\n        }\n      });\n\n      if (response.ok) {\n        return await response.text();\n      }\n    } catch (error) {\n      console.log('Anche l\\'approccio diretto  fallito:', error);\n    }\n\n    throw lastError || new Error('Impossibile recuperare il contenuto');\n  }\n\n  /**\n   * Estrae metadati da una URL usando il proxy locale\n   */\n  async extractMetadata(url) {\n    try {\n      // Ottieni la lingua dalle impostazioni o usa italiano di default\n      const userLang = localStorage.getItem('aideas-language') || 'it';\n      const response = await fetch(`http://localhost:4000/extract?url=${encodeURIComponent(url)}&lang=${userLang}`);\n      if (!response.ok) throw new Error('Proxy meta fallito');\n      return await response.json();\n    } catch (error) {\n      // Fallback: solo dominio e favicon\n      const domain = new URL(url).hostname;\n      return {\n        title: domain,\n        description: `App web da ${domain}`,\n        icon: `https://www.google.com/s2/favicons?domain=${domain}&sz=64`\n      };\n    }\n  }\n\n  /**\n   * Estrae la migliore icona disponibile\n   */\n  extractBestIcon($, baseUrl) {\n    // Priorit delle icone\n    const iconSelectors = [\n      'link[rel=\"apple-touch-icon\"][sizes=\"180x180\"]',\n      'link[rel=\"apple-touch-icon\"][sizes=\"152x152\"]',\n      'link[rel=\"apple-touch-icon\"][sizes=\"144x144\"]',\n      'link[rel=\"apple-touch-icon\"][sizes=\"120x120\"]',\n      'link[rel=\"apple-touch-icon\"]',\n      'link[rel=\"icon\"][type=\"image/png\"][sizes=\"32x32\"]',\n      'link[rel=\"icon\"][type=\"image/png\"][sizes=\"16x16\"]',\n      'link[rel=\"icon\"][type=\"image/svg+xml\"]',\n      'link[rel=\"shortcut icon\"]',\n      'link[rel=\"icon\"]'\n    ];\n\n    for (const selector of iconSelectors) {\n      const icon = $(selector).attr('href');\n      if (icon) {\n        return new URL(icon, baseUrl).href;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Estrae il titolo della pagina\n   */\n  extractTitle(html) {\n    const patterns = [\n      /<title[^>]*>([^<]+)<\\/title>/i,\n      /<meta[^>]*property=[\"']og:title[\"'][^>]*content=[\"']([^\"']+)[\"']/i,\n      /<meta[^>]*content=[\"']([^\"']+)[\"'][^>]*property=[\"']og:title[\"']/i\n    ];\n    \n    for (const pattern of patterns) {\n      const match = html.match(pattern);\n      if (match) {\n        const title = match[1].trim();\n        if (title && title.length > 0) {\n          return title;\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * Estrae la descrizione dai meta tag\n   */\n  extractDescription(html) {\n    const patterns = [\n      /<meta[^>]*name=[\"']description[\"'][^>]*content=[\"']([^\"']+)[\"']/i,\n      /<meta[^>]*content=[\"']([^\"']+)[\"'][^>]*name=[\"']description[\"']/i,\n      /<meta[^>]*property=[\"']og:description[\"'][^>]*content=[\"']([^\"']+)[\"']/i,\n      /<meta[^>]*content=[\"']([^\"']+)[\"'][^>]*property=[\"']og:description[\"']/i\n    ];\n    \n    for (const pattern of patterns) {\n      const match = html.match(pattern);\n      if (match) {\n        const desc = match[1].trim();\n        if (desc && desc.length > 0) {\n          return desc;\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * Estrae l'icona/favicon\n   */\n  extractIcon(html, baseUrl) {\n    const patterns = [\n      /<link[^>]*rel=[\"'](?:icon|shortcut icon)[\"'][^>]*href=[\"']([^\"']+)[\"']/i,\n      /<link[^>]*href=[\"']([^\"']+)[\"'][^>]*rel=[\"'](?:icon|shortcut icon)[\"']/i,\n      /<link[^>]*rel=[\"']apple-touch-icon[\"'][^>]*href=[\"']([^\"']+)[\"']/i,\n      /<link[^>]*href=[\"']([^\"']+)[\"'][^>]*rel=[\"']apple-touch-icon[\"']/i\n    ];\n    \n    for (const pattern of patterns) {\n      const match = html.match(pattern);\n      if (match) {\n        try {\n          const iconUrl = new URL(match[1], baseUrl).href;\n          console.log('Icona trovata:', iconUrl);\n          return iconUrl;\n        } catch (e) {\n          console.log('URL icona non valido:', match[1]);\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * Estrae specificamente l'apple-touch-icon\n   */\n  extractAppleTouchIcon(html, baseUrl) {\n    const patterns = [\n      /<link[^>]*rel=[\"']apple-touch-icon[\"'][^>]*href=[\"']([^\"']+)[\"']/i,\n      /<link[^>]*href=[\"']([^\"']+)[\"'][^>]*rel=[\"']apple-touch-icon[\"']/i,\n      /<link[^>]*rel=[\"']apple-touch-icon-precomposed[\"'][^>]*href=[\"']([^\"']+)[\"']/i,\n      /<link[^>]*href=[\"']([^\"']+)[\"'][^>]*rel=[\"']apple-touch-icon-precomposed[\"']/i\n    ];\n    \n    for (const pattern of patterns) {\n      const match = html.match(pattern);\n      if (match) {\n        try {\n          const iconUrl = new URL(match[1], baseUrl).href;\n          console.log('Apple Touch Icon trovata:', iconUrl);\n          return iconUrl;\n        } catch (e) {\n          console.log('URL apple-touch-icon non valido:', match[1]);\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * Estrae le keywords\n   */\n  extractKeywords(html) {\n    const match = html.match(/<meta[^>]*name=[\"']keywords[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n    return match ? match[1].trim() : null;\n  }\n\n  /**\n   * Estrae l'autore\n   */\n  extractAuthor(html) {\n    const match = html.match(/<meta[^>]*name=[\"']author[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n    return match ? match[1].trim() : null;\n  }\n\n  /**\n   * Estrae l'immagine Open Graph\n   */\n  extractOGImage(html) {\n    const match = html.match(/<meta[^>]*property=[\"']og:image[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n    return match ? match[1].trim() : null;\n  }\n\n  /**\n   * Estrae il titolo Open Graph\n   */\n  extractOGTitle(html) {\n    const match = html.match(/<meta[^>]*property=[\"']og:title[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n    return match ? match[1].trim() : null;\n  }\n\n  /**\n   * Estrae la descrizione Open Graph\n   */\n  extractOGDescription(html) {\n    const match = html.match(/<meta[^>]*property=[\"']og:description[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n    return match ? match[1].trim() : null;\n  }\n\n  /**\n   * Testa la connettivit di un proxy\n   */\n  async testProxy(proxyUrl) {\n    try {\n      const response = await fetch(proxyUrl + encodeURIComponent('https://httpbin.org/ip'), {\n        method: 'GET',\n        timeout: 5000\n      });\n      return response.ok;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  /**\n   * Ottiene informazioni sui proxy disponibili\n   */\n  async getProxyStatus() {\n    const status = {};\n    \n    for (let i = 0; i < this.proxies.length; i++) {\n      const proxy = this.proxies[i];\n      status[proxy] = await this.testProxy(proxy);\n    }\n    \n    return status;\n  }\n} ","/**\n * AIdeas - App Importer Component\n * Gestisce l'importazione di applicazioni da vari formati\n */\n\nimport StorageService from '../services/StorageService.js';\nimport ProxyService from '../services/ProxyService.js';\nimport { showToast, showModal, hideModal, escapeHtml, generateId, isValidUrl, extractDomain, formatFileSize } from '../utils/helpers.js';\nimport JSZip from 'jszip';\n\n/**\n * Classe per gestire l'importazione delle applicazioni\n */\nexport default class AppImporter {\n  constructor() {\n    this.maxFileSize = 50 * 1024 * 1024; // 50MB\n    this.supportedFormats = ['zip'];\n    this.categories = [\n      'productivity', 'entertainment', 'communication', 'development', \n      'design', 'finance', 'health', 'news', 'shopping', 'travel',\n      'ai', 'social', 'education', 'business', 'utility', 'pwa'\n    ];\n\n    // Inizializza il proxy service\n    this.proxyService = new ProxyService();\n\n    // Bind methods - solo se esistono\n    if (this.init) this.init = this.init.bind(this);\n    if (this.showModal) this.showModal = this.showModal.bind(this);\n    if (this.importFromZip) this.importFromZip = this.importFromZip.bind(this);\n    if (this.importFromUrl) this.importFromUrl = this.importFromUrl.bind(this);\n    if (this.importFromGitHub) this.importFromGitHub = this.importFromGitHub.bind(this);\n    if (this.validateAppData) this.validateAppData = this.validateAppData.bind(this);\n    if (this.extractAppMetadata) this.extractAppMetadata = this.extractAppMetadata.bind(this);\n    if (this.setupDropZone) this.setupDropZone = this.setupDropZone.bind(this);\n  }\n\n  /**\n   * Inizializza l'importatore\n   */\n  async init() {\n    console.log(' Inizializzazione AppImporter...');\n    this.setupDropZone();\n    this.setupKeyboardShortcuts();\n  }\n\n  /**\n   * Mostra il modal di importazione\n   */\n  showModal() {\n    const modalContent = this.createImportModal();\n    showModal('app-import-modal', modalContent, {\n      size: 'modal-xl',\n      disableBackdropClose: false\n    });\n\n    // Setup event listeners dopo che il modal  stato creato\n    setTimeout(() => {\n      this.setupModalEventListeners();\n      \n      // Imposta il form HTML come attivo di default\n      const htmlForm = document.getElementById('form-html');\n      if (htmlForm) {\n        htmlForm.classList.add('active');\n      }\n      \n      // Imposta il pulsante HTML come attivo di default\n      const htmlBtn = document.querySelector('[data-section=\"html\"]');\n      if (htmlBtn) {\n        htmlBtn.classList.add('active');\n      }\n    }, 100);\n  }\n\n  /**\n   * Crea il contenuto del modal di importazione\n   */\n  createImportModal() {\n    return `\n      <div class=\"modal-header\">\n        <h2>\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"header-icon\">\n            <path d=\"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\"/>\n          </svg>\n          Aggiungi Nuova App\n        </h2>\n        <button class=\"modal-close\">&times;</button>\n      </div>\n      \n      <div class=\"modal-body\">\n        <!-- Import Layout (come settings) -->\n        <div class=\"settings-layout\">\n          <!-- Import Navigation -->\n          <nav class=\"settings-nav\">\n            <ul class=\"settings-nav-list\">\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary active\" type=\"button\" data-section=\"html\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>\n                  </svg>\n                  File HTML\n                </button>\n              </li>\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary\" type=\"button\" data-section=\"url\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M3.9,12C3.9,10.29 5.29,8.9 7,8.9H11V7H7C4.24,7 2,9.24 2,12C2,14.76 4.24,17 7,17H11V15.1H7C5.29,15.1 3.9,13.71 3.9,12M8,13H16V11H8V13M17,7H13V8.9H17C18.71,8.9 20.1,10.29 20.1,12C20.1,13.71 18.71,15.1 17,15.1H13V17H17C19.76,17 22,14.76 22,12C22,9.24 19.76,7 17,7Z\"/>\n                  </svg>\n                  Importa da URL\n                </button>\n              </li>\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary\" type=\"button\" data-section=\"github\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z\"/>\n                  </svg>\n                  Repository GitHub\n                </button>\n              </li>\n            </ul>\n          </nav>\n\n          <!-- Import Content -->\n          <div class=\"settings-content\">\n          \n            <!-- HTML Import Section -->\n            <div class=\"settings-section active\" id=\"section-html\">\n              <h3>Importa da File HTML</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Carica File</h4>\n                \n                <div class=\"setting-item\">\n                  <label for=\"html-file-input\">File HTML</label>\n                  <input type=\"file\" id=\"html-file-input\" accept=\".html,text/html\" class=\"form-input\">\n                  <p class=\"setting-description\">Carica un file HTML standalone (senza risorse esterne)</p>\n                </div>\n              </div>\n            </div>\n\n            <!-- URL Import Section -->\n            <div class=\"settings-section\" id=\"section-url\">\n              <h3>Importa da URL</h3>\n              \n              <div class=\"settings-group\">\n                <h4>URL dell'Applicazione</h4>\n              \n                <div class=\"setting-item\">\n                  <label for=\"url-input\">URL</label>\n                  <div class=\"input-with-button\">\n                    <input \n                      type=\"url\" \n                      id=\"url-input\" \n                      class=\"form-input\" \n                      placeholder=\"https://esempio.com/app\"\n                      required\n                    >\n                    <button class=\"btn btn-secondary\" id=\"test-url-btn\">Test</button>\n                  </div>\n                  <p class=\"setting-description\">Inserisci l'URL dell'applicazione web. Il sistema rilever automaticamente se  una PWA o un sito normale.</p>\n                </div>\n              \n                <div class=\"setting-item\" id=\"url-preview-container\" style=\"display: none;\">\n                  <label>Anteprima del sito</label>\n                  <div class=\"url-preview\" id=\"url-preview\">\n                    <div class=\"preview-content\">\n                      <div class=\"preview-info\">\n                        <h5>Anteprima del sito:</h5>\n                        <div class=\"preview-details\">\n                          <div class=\"preview-favicon\"></div>\n                          <div class=\"preview-text\">\n                            <p class=\"preview-title\">Caricamento...</p>\n                            <p class=\"preview-url\"></p>\n                          </div>\n                        </div>\n                      </div>\n                      <div class=\"preview-status\">\n                        <span class=\"status-badge\">Verificando...</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <!-- GitHub Import Section -->\n            <div class=\"settings-section\" id=\"section-github\">\n              <h3>Importa da GitHub</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Repository GitHub</h4>\n              \n                <div class=\"setting-item\">\n                  <label for=\"github-url-input\">URL del Repository</label>\n                  <input \n                    type=\"url\" \n                    id=\"github-url-input\" \n                    class=\"form-input\" \n                    placeholder=\"https://github.com/username/repository\"\n                    required\n                  >\n                  <p class=\"setting-description\">Inserisci l'URL di un repository GitHub. Il sistema cercher automaticamente i file di build o demo.</p>\n                </div>\n              \n                <div class=\"setting-item\" id=\"github-preview-container\" style=\"display: none;\">\n                  <label>Anteprima del Repository</label>\n                  <div class=\"github-preview\" id=\"github-preview\">\n                    <div class=\"preview-content\">\n                      <div class=\"preview-info\">\n                        <h5>Repository GitHub:</h5>\n                        <div class=\"preview-details\">\n                          <div class=\"preview-favicon\"></div>\n                          <div class=\"preview-text\">\n                            <p class=\"preview-title\">Caricamento...</p>\n                            <p class=\"preview-description\"></p>\n                          </div>\n                        </div>\n                      </div>\n                      <div class=\"preview-status\">\n                        <span class=\"status-badge\">Verificando...</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <!-- App Metadata Section (Comune per tutti i tipi) -->\n            <div class=\"settings-section\" id=\"section-metadata\" style=\"display: none;\">\n              <h3>Informazioni App</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Dettagli Base</h4>\n              \n                <div class=\"setting-item\">\n                  <label for=\"app-name\">Nome App *</label>\n                  <input \n                    type=\"text\" \n                    id=\"app-name\" \n                    class=\"form-input\" \n                    placeholder=\"Il mio Tool Fantastico\"\n                    required\n                    maxlength=\"50\"\n                  >\n                  <p class=\"setting-description\">Nome dell'applicazione che verr visualizzato</p>\n                </div>\n              \n                <div class=\"setting-item\">\n                  <label for=\"app-version\">Versione</label>\n                  <input \n                    type=\"text\" \n                    id=\"app-version\" \n                    class=\"form-input\" \n                    placeholder=\"1.0.0\"\n                    value=\"1.0.0\"\n                  >\n                  <p class=\"setting-description\">Versione dell'applicazione</p>\n                </div>\n              \n                <div class=\"setting-item\">\n                  <label for=\"app-description\">Descrizione</label>\n                  <textarea \n                    id=\"app-description\" \n                    class=\"form-input\" \n                    rows=\"3\"\n                    placeholder=\"Descrivi cosa fa questa app...\"\n                    maxlength=\"200\"\n                  ></textarea>\n                  <div class=\"char-count\">\n                    <span id=\"desc-char-count\">0</span>/200\n                  </div>\n                  <p class=\"setting-description\">Breve descrizione dell'applicazione</p>\n                </div>\n              </div>\n              \n              <div class=\"settings-group\">\n                <h4>Categorizzazione</h4>\n                \n                <div class=\"setting-item\">\n                  <label for=\"app-category\">Categoria</label>\n                  <select id=\"app-category\" class=\"form-input\">\n                    <option value=\"\">Seleziona categoria...</option>\n                    ${this.categories.map(cat => \n                      `<option value=\"${cat}\">${this.getCategoryLabel(cat)}</option>`\n                    ).join('')}\n                  </select>\n                  <p class=\"setting-description\">Categoria per organizzare le app</p>\n                </div>\n              \n                <div class=\"setting-item\">\n                  <label for=\"app-tags\">Tag (separati da virgola)</label>\n                  <input \n                    type=\"text\" \n                    id=\"app-tags\" \n                    class=\"form-input\" \n                    placeholder=\"ai, produttivit, strumento\"\n                  >\n                  <p class=\"setting-description\">Tag per facilitare la ricerca</p>\n                </div>\n              </div>\n\n              <div class=\"settings-group\">\n                <h4>Personalizzazione</h4>\n                \n                <div class=\"setting-item\">\n                  <label for=\"app-icon\">Icona App (URL o carica file)</label>\n                  <div class=\"icon-input-group\">\n                    <input \n                      type=\"url\" \n                      id=\"app-icon\" \n                      class=\"form-input\" \n                      placeholder=\"https://esempio.com/icon.png\"\n                    >\n                    <button class=\"btn btn-secondary\" id=\"upload-icon-btn\">Carica</button>\n                    <input type=\"file\" id=\"icon-file-input\" accept=\"image/*\" style=\"display: none;\">\n                  </div>\n                  <div class=\"icon-preview\" id=\"icon-preview\" style=\"display: none;\">\n                    <img src=\"\" alt=\"Preview icona\" id=\"icon-preview-img\">\n                  </div>\n                  <p class=\"setting-description\">Icona personalizzata per l'app</p>\n                </div>\n              \n                <div class=\"setting-item\">\n                  <label for=\"app-launch-mode\">Modalit di apertura</label>\n                  <select id=\"app-launch-mode\" class=\"form-input\">\n                    <option value=\"\">Usa impostazione globale</option>\n                    <option value=\"iframe\">Sempre in finestra modale</option>\n                    <option value=\"newpage\">Sempre in nuova pagina</option>\n                  </select>\n                  <p class=\"setting-description\">\n                    Scegli come questa app dovrebbe aprirsi di default. \n                    <span id=\"current-default-mode\" style=\"font-weight: bold; color: #2563eb;\"></span>\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"modal-footer\">\n        <div class=\"import-progress\" id=\"import-progress\" style=\"display: none;\">\n          <div class=\"progress-bar\">\n            <div class=\"progress-fill\" id=\"progress-fill\"></div>\n          </div>\n          <p class=\"progress-text\" id=\"progress-text\">Importazione in corso...</p>\n        </div>\n        \n        <div class=\"modal-actions\" id=\"modal-actions\">\n          <button class=\"btn btn-secondary\" id=\"cancel-import\" type=\"button\">Annulla</button>\n          <button class=\"btn btn-primary\" id=\"start-import\" type=\"button\" disabled>\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\"/>\n            </svg>\n            Importa App\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Setup event listeners per il modal\n   */\n  setupModalEventListeners() {\n    const modal = document.getElementById('app-import-modal');\n    if (!modal) return;\n\n    // Import section navigation (come settings)\n    const navButtons = modal.querySelectorAll('.settings-nav-btn');\n    const sections = modal.querySelectorAll('.settings-section');\n\n    navButtons.forEach(btn => {\n      btn.addEventListener('click', () => {\n        const sectionName = btn.dataset.section;\n        \n        // Aggiorna UI buttons\n        navButtons.forEach(b => b.classList.remove('active'));\n        btn.classList.add('active');\n        \n        // Mostra sezione corrispondente\n        sections.forEach(section => {\n          section.style.display = 'none';\n          section.classList.remove('active');\n          if (section.id === `section-${sectionName}`) {\n            section.style.display = 'block';\n            section.classList.add('active');\n          }\n        });\n      });\n    });\n\n    // Setup form specifici\n    this.setupHtmlImport(modal);\n    this.setupUrlImport(modal);\n    this.setupGitHubImport(modal);\n    this.setupMetadataForm(modal);\n\n    // Start import button\n    const startImportBtn = modal.querySelector('#start-import');\n    startImportBtn?.addEventListener('click', () => {\n      this.startImport();\n    });\n\n    // Cancel button\n    const cancelBtn = modal.querySelector('#cancel-import');\n    cancelBtn?.addEventListener('click', () => {\n      hideModal('app-import-modal');\n    });\n\n    // Close button\n    const closeBtn = modal.querySelector('.modal-close');\n    closeBtn?.addEventListener('click', () => {\n      hideModal('app-import-modal');\n    });\n\n    // Keyboard shortcuts\n    modal.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        hideModal('app-import-modal');\n      }\n    });\n  }\n\n  /**\n   * Setup ZIP import\n   */\n  setupZipImport(modal) {\n    const dropZone = modal.querySelector('#zip-drop-zone');\n    const fileInput = modal.querySelector('#zip-file-input');\n    const selectBtn = modal.querySelector('#select-zip-btn');\n\n    // Click su pulsante selezione\n    selectBtn?.addEventListener('click', () => {\n      fileInput?.click();\n    });\n\n    // File selection\n    fileInput?.addEventListener('change', (e) => {\n      const file = e.target.files[0];\n      if (file) {\n        this.handleZipFile(file);\n      }\n    });\n\n    // Drag & Drop\n    dropZone?.addEventListener('dragover', (e) => {\n      e.preventDefault();\n      dropZone.classList.add('drag-over');\n    });\n\n    dropZone?.addEventListener('dragleave', (e) => {\n      e.preventDefault();\n      dropZone.classList.remove('drag-over');\n    });\n\n    dropZone?.addEventListener('drop', (e) => {\n      e.preventDefault();\n      dropZone.classList.remove('drag-over');\n      \n      const file = e.dataTransfer.files[0];\n      if (file && file.name.endsWith('.zip')) {\n        this.handleZipFile(file);\n      } else {\n        showToast('Per favore seleziona un file ZIP valido', 'error');\n      }\n    });\n  }\n\n  /**\n   * Setup URL import\n   */\n  setupUrlImport(modal) {\n    const urlInput = modal.querySelector('#url-input');\n    const testBtn = modal.querySelector('#test-url-btn');\n    const previewContainer = modal.querySelector('#url-preview-container');\n\n    // Test URL button\n    testBtn?.addEventListener('click', async () => {\n      const url = urlInput?.value.trim();\n      if (!url) {\n        showToast('Inserisci un URL valido', 'error');\n        return;\n      }\n\n      if (!isValidUrl(url)) {\n        showToast('URL non valido', 'error');\n        return;\n      }\n\n      try {\n        testBtn.disabled = true;\n        testBtn.textContent = 'Testando...';\n        \n        await this.testUrl(url, previewContainer);\n        \n        testBtn.textContent = 'Test';\n        testBtn.disabled = false;\n      } catch (error) {\n        console.error('Errore test URL:', error);\n        showToast('Errore durante il test dell\\'URL', 'error');\n        testBtn.textContent = 'Test';\n        testBtn.disabled = false;\n      }\n    });\n\n    // URL input change\n    urlInput?.addEventListener('input', () => {\n      const url = urlInput.value.trim();\n      if (url && isValidUrl(url)) {\n        this.enableImportButton();\n      } else {\n        this.disableImportButton();\n      }\n    });\n  }\n\n  /**\n   * Setup GitHub import\n   */\n  setupGitHubImport(modal) {\n    const githubInput = modal.querySelector('#github-url-input');\n    const previewContainer = modal.querySelector('#github-preview-container');\n\n    // GitHub URL input change\n    githubInput?.addEventListener('input', async () => {\n      const url = githubInput.value.trim();\n      if (url && this.isGitHubUrl(url)) {\n        try {\n          await this.fetchGitHubInfo(url, previewContainer);\n          this.enableImportButton();\n        } catch (error) {\n          console.error('Errore fetch GitHub:', error);\n          showToast('Errore durante il recupero delle informazioni GitHub', 'error');\n        }\n      } else {\n        this.disableImportButton();\n        if (previewContainer) {\n          previewContainer.style.display = 'none';\n        }\n      }\n    });\n  }\n\n  /**\n   * Setup metadata form\n   */\n  setupMetadataForm(modal) {\n    // Popola modalit di default corrente\n    this.updateDefaultModeIndicator();\n    \n    // Icon upload\n    const iconInput = modal.querySelector('#app-icon');\n    const uploadBtn = modal.querySelector('#upload-icon-btn');\n    const fileInput = modal.querySelector('#icon-file-input');\n    const preview = modal.querySelector('#icon-preview');\n    const previewImg = modal.querySelector('#icon-preview-img');\n\n    uploadBtn?.addEventListener('click', () => {\n      fileInput?.click();\n    });\n\n    fileInput?.addEventListener('change', (e) => {\n      const file = e.target.files[0];\n      if (file) {\n        this.handleIconUpload(file, iconInput, preview);\n      }\n    });\n\n    // Icon preview on URL change\n    iconInput?.addEventListener('input', () => {\n      const url = iconInput.value.trim();\n      if (url) {\n        this.showIconPreview(url, preview);\n      } else {\n        preview.style.display = 'none';\n      }\n    });\n\n    // Form validation\n    const nameInput = modal.querySelector('#app-name');\n    nameInput?.addEventListener('input', () => {\n      this.validateForm();\n    });\n  }\n\n  /**\n   * Aggiorna l'indicazione della modalit di default corrente\n   */\n  async updateDefaultModeIndicator() {\n    try {\n      const currentMode = await StorageService.getSetting('defaultLaunchMode', 'newpage');\n      const indicator = document.getElementById('current-default-mode');\n      \n      if (indicator) {\n        const modeLabel = currentMode === 'newpage' ? 'Nuova pagina' : 'Finestra modale';\n        indicator.textContent = `(Impostazione globale corrente: ${modeLabel})`;\n      }\n    } catch (error) {\n      console.warn('Impossibile caricare modalit di default:', error);\n    }\n  }\n\n  /**\n   * Valida il form di importazione\n   */\n  validateForm() {\n    const nameInput = document.getElementById('app-name');\n    const startImportBtn = document.getElementById('start-import');\n    \n    if (nameInput && startImportBtn) {\n      const isValid = nameInput.value.trim().length > 0;\n      startImportBtn.disabled = !isValid;\n    }\n  }\n\n  /**\n   * Setup HTML import\n   */\n  setupHtmlImport(modal) {\n    const fileInput = modal.querySelector('#html-file-input');\n\n    // File selection\n    fileInput?.addEventListener('change', (e) => {\n      const file = e.target.files[0];\n      if (file) {\n        this.handleHtmlFile(file);\n      }\n    });\n  }\n\n  /**\n   * Gestisce il file ZIP caricato\n   */\n  async handleZipFile(file) {\n    try {\n      // Validazione dimensione\n      if (file.size > this.maxFileSize) {\n        showToast(`File troppo grande. Massimo: ${formatFileSize(this.maxFileSize)}`, 'error');\n        return;\n      }\n\n      showToast('Analizzando file ZIP...', 'info');\n\n      // Leggi ZIP\n      const zip = new JSZip();\n      const contents = await zip.loadAsync(file);\n\n      // Estrai file\n      const files = [];\n      let manifest = null;\n\n      for (const [filename, fileObj] of Object.entries(contents.files)) {\n        if (fileObj.dir) continue;\n\n        const content = await fileObj.async('text');\n        const fileData = {\n          filename,\n          content,\n          size: content.length,\n          mimeType: this.getMimeType(filename)\n        };\n\n        files.push(fileData);\n\n        // Cerca manifest AIdeas\n        if (filename === 'aideas.json') {\n          try {\n            manifest = JSON.parse(content);\n          } catch (e) {\n            console.warn('Manifest aideas.json non valido:', e);\n          }\n        }\n      }\n\n      // Validazione contenuto\n      const hasHTML = files.some(f => f.filename.endsWith('.html'));\n      if (!hasHTML) {\n        showToast('Il ZIP deve contenere almeno un file HTML', 'error');\n        return;\n      }\n\n      // Estrai metadati\n      const metadata = this.extractZipMetadata(files, manifest);\n      \n      // Popola form con metadati estratti\n      this.populateMetadataForm(metadata);\n      \n      // Mostra form metadata\n      const metadataSection = document.getElementById('section-metadata');\n      if (metadataSection) {\n        metadataSection.style.display = 'block';\n      }\n\n      // Salva dati per l'importazione\n      this.currentImportData = {\n        type: 'zip',\n        files,\n        manifest,\n        metadata,\n        originalFile: file\n      };\n\n      // Abilita pulsante importazione\n      const importBtn = document.getElementById('start-import');\n      if (importBtn) {\n        importBtn.disabled = false;\n      }\n\n      showToast('ZIP analizzato con successo!', 'success');\n\n    } catch (error) {\n      console.error('Errore durante l\\'analisi del ZIP:', error);\n      showToast('Errore durante l\\'analisi del file ZIP', 'error');\n    }\n  }\n\n  /**\n   * Testa un URL e mostra anteprima\n   */\n  async testUrl(url, previewElement) {\n    if (!previewElement) return;\n\n    previewElement.style.display = 'block';\n    const statusBadge = previewElement.querySelector('.status-badge');\n    const titleEl = previewElement.querySelector('.preview-title');\n    const urlEl = previewElement.querySelector('.preview-url');\n\n    // Reset stato\n    statusBadge.textContent = 'Verificando...';\n    statusBadge.className = 'status-badge';\n    titleEl.textContent = 'Caricamento...';\n    urlEl.textContent = url;\n\n    try {\n      // Estrai metadati avanzati\n      const metadata = await this.extractUrlMetadata(url);\n      \n      // Aggiorna preview\n      titleEl.textContent = metadata.title || metadata.name || extractDomain(url);\n      statusBadge.textContent = metadata.isPWA ? ' PWA Rilevata' : ' Sito Web';\n      statusBadge.className = metadata.isPWA ? 'status-badge badge-success' : 'status-badge badge-info';\n\n      // Popola form metadata\n      this.populateMetadataForm(metadata);\n      \n      // Mostra form metadata\n      const metadataSection = document.getElementById('section-metadata');\n      if (metadataSection) {\n        metadataSection.style.display = 'block';\n      }\n\n      // Salva dati per importazione\n      this.currentImportData = {\n        type: metadata.isPWA ? 'pwa' : 'url',\n        url,\n        metadata\n      };\n\n      // Abilita importazione\n      const importBtn = document.getElementById('start-import');\n      if (importBtn) {\n        importBtn.disabled = false;\n      }\n\n    } catch (error) {\n      console.error('Errore test URL:', error);\n      statusBadge.textContent = ' Errore';\n      statusBadge.className = 'status-badge badge-error';\n      titleEl.textContent = 'Impossibile verificare il sito';\n    }\n  }\n\n  /**\n   * Fetch informazioni repository GitHub\n   */\n  async fetchGitHubInfo(url, previewElement) {\n    if (!previewElement) return;\n\n    const repoInfo = this.parseGitHubUrl(url);\n    if (!repoInfo) {\n      showToast('URL GitHub non valido', 'error');\n      return;\n    }\n\n    try {\n      // Chiamata API GitHub\n      const apiUrl = `https://api.github.com/repos/${repoInfo.owner}/${repoInfo.repo}`;\n      const response = await fetch(apiUrl);\n      \n      if (!response.ok) {\n        throw new Error('Repository non trovato o non accessibile');\n      }\n\n      const repoData = await response.json();\n\n      // Mostra info repository\n      previewElement.style.display = 'block';\n      previewElement.querySelector('#repo-avatar').src = repoData.owner.avatar_url;\n      previewElement.querySelector('#repo-name').textContent = repoData.full_name;\n      previewElement.querySelector('#repo-description').textContent = repoData.description || 'Nessuna descrizione';\n      previewElement.querySelector('#repo-stars').textContent = repoData.stargazers_count;\n      previewElement.querySelector('#repo-forks').textContent = repoData.forks_count;\n      previewElement.querySelector('#repo-updated').textContent = new Date(repoData.updated_at).toLocaleDateString();\n\n      // Popola metadata form\n      const metadata = {\n        name: repoData.name,\n        description: repoData.description,\n        category: 'tools',\n        version: '1.0.0',\n        githubUrl: url\n      };\n\n      this.populateMetadataForm(metadata);\n\n      // Mostra form metadata\n      const metadataSection = document.getElementById('section-metadata');\n      if (metadataSection) {\n        metadataSection.style.display = 'block';\n      }\n\n      // Salva dati\n      this.currentImportData = {\n        type: 'github',\n        url,\n        githubUrl: url,\n        repoData,\n        metadata\n      };\n\n      // Abilita importazione\n      const importBtn = document.getElementById('start-import');\n      if (importBtn) {\n        importBtn.disabled = false;\n      }\n\n    } catch (error) {\n      console.error('Errore fetch GitHub:', error);\n      showToast(`Errore: ${error.message}`, 'error');\n    }\n  }\n\n  /**\n   * Avvia il processo di importazione\n   */\n  async startImport() {\n    if (!this.currentImportData) {\n      showToast('Nessun dato da importare', 'error');\n      return;\n    }\n\n    try {\n      // Mostra progress\n      this.showImportProgress(true);\n\n      // Raccogli dati dal form\n      const formData = this.collectFormData();\n      \n      // Valida dati\n      const validation = this.validateAppData(formData);\n      if (!validation.valid) {\n        throw new Error(validation.error);\n      }\n\n      // Combina dati\n      const appData = {\n        ...this.currentImportData.metadata,\n        ...formData,\n        type: this.currentImportData.type,\n        url: this.currentImportData.url,\n        githubUrl: this.currentImportData.githubUrl,\n        files: this.currentImportData.files,\n        content: this.currentImportData.content\n      };\n\n      // Log modalit di lancio\n      console.log(` Installazione app: ${appData.name}`);\n      console.log(` Modalit di lancio app-specifica: ${appData.metadata?.launchMode || 'non specificata'}`);\n      \n      // Verifica modalit di default globale\n      const globalLaunchMode = await StorageService.getSetting('defaultLaunchMode', 'newpage');\n      console.log(` Modalit di lancio globale: ${globalLaunchMode}`);\n      \n      // Determina modalit finale che verr usata\n      const finalLaunchMode = appData.metadata?.launchMode || globalLaunchMode;\n      console.log(` Modalit finale per questa app: ${finalLaunchMode}`);\n\n      // Aggiorna progress\n      this.updateImportProgress(50, 'Salvando app...');\n\n      // Salva nel database\n      const appId = await StorageService.installApp(appData);\n\n      // Aggiorna progress\n      this.updateImportProgress(100, 'Importazione completata!');\n\n      // Successo\n      setTimeout(() => {\n        hideModal('app-import-modal');\n        showToast(`App \"${appData.name}\" importata con successo!`, 'success');\n        \n        // Ricarica la lista app (se disponibile)\n        if (window.aideasApp && window.aideasApp.loadApps) {\n          window.aideasApp.loadApps();\n        }\n      }, 1000);\n\n    } catch (error) {\n      console.error('Errore durante l\\'importazione:', error);\n      showToast(`Errore importazione: ${error.message}`, 'error');\n      this.showImportProgress(false);\n    }\n  }\n\n  /**\n   * Utility methods\n   */\n\n  // Estrai metadati da ZIP\n  extractZipMetadata(files, manifest) {\n    const metadata = {\n      name: manifest?.name || 'App Importata',\n      description: manifest?.description || '',\n      version: manifest?.version || '1.0.0',\n      category: manifest?.category || 'tools',\n      tags: manifest?.tags || [],\n      icon: manifest?.icon || null,\n      permissions: manifest?.permissions || []\n    };\n\n    // Cerca icona nei file se non specificata nel manifest\n    if (!metadata.icon) {\n      const iconFile = files.find(f => \n        f.filename.match(/^(icon|logo|app-icon)\\.(png|jpg|jpeg|svg)$/i)\n      );\n      if (iconFile) {\n        const blob = new Blob([iconFile.content], { type: iconFile.mimeType });\n        metadata.icon = URL.createObjectURL(blob);\n      }\n    }\n\n    return metadata;\n  }\n\n  // Estrai metadati da URL\n  async extractUrlMetadata(url) {\n    const domain = extractDomain(url);\n    const baseUrl = new URL(url).origin;\n    \n    try {\n      // Prima prova a ottenere il manifest per verificare se  una PWA\n      const manifestData = await this.fetchManifest(url);\n      \n      if (manifestData) {\n        //  una PWA - usa i dati del manifest\n        return {\n          name: manifestData.name || manifestData.short_name || domain,\n          title: manifestData.name || manifestData.short_name || domain,\n          description: manifestData.description || `Progressive Web App da ${domain}`,\n          category: 'pwa',\n          url: url,\n          icon: this.getBestIcon(manifestData.icons, baseUrl),\n          isPWA: true,\n          manifest: manifestData,\n          version: manifestData.version || '1.0.0',\n          theme_color: manifestData.theme_color,\n          background_color: manifestData.background_color\n        };\n      }\n      \n      // Non  una PWA - prova a estrarre metadati dalla pagina HTML\n      const htmlMetadata = await this.fetchHtmlMetadata(url);\n      \n      if (htmlMetadata) {\n        // Usa apple-touch-icon come fallback se disponibile\n        const icon = htmlMetadata.icon || htmlMetadata.appleTouchIcon || `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;\n        \n        return {\n          name: htmlMetadata.title || htmlMetadata.ogTitle || domain,\n          title: htmlMetadata.title || htmlMetadata.ogTitle || domain,\n          description: htmlMetadata.description || htmlMetadata.ogDescription || `App web da ${domain}`,\n          category: 'tools',\n          url: url,\n          icon: icon,\n          isPWA: false,\n          version: '1.0.0'\n        };\n      }\n      \n      // Fallback - usa solo il dominio\n      return {\n        name: domain,\n        title: domain,\n        description: `App web da ${domain}`,\n        category: 'tools',\n        url: url,\n        icon: `https://www.google.com/s2/favicons?domain=${domain}&sz=64`,\n        isPWA: false,\n        version: '1.0.0'\n      };\n      \n    } catch (error) {\n      console.error('Errore estrazione metadati:', error);\n      // Fallback in caso di errore\n      return {\n        name: domain,\n        title: domain,\n        description: `App web da ${domain}`,\n        category: 'tools',\n        url: url,\n        icon: `https://www.google.com/s2/favicons?domain=${domain}&sz=64`,\n        isPWA: false,\n        version: '1.0.0'\n      };\n    }\n  }\n\n  /**\n   * Prova a ottenere il manifest.json di una PWA\n   */\n  async fetchManifest(url) {\n    try {\n      const baseUrl = new URL(url).origin;\n      const manifestUrl = `${baseUrl}/manifest.json`;\n      \n      const response = await fetch(manifestUrl, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json'\n        }\n      });\n      \n      if (response.ok) {\n        const manifest = await response.json();\n        \n        // Valida che sia un manifest valido\n        if (manifest.name || manifest.short_name) {\n          return manifest;\n        }\n      }\n      \n      return null;\n    } catch (error) {\n      console.log('Manifest non trovato:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Estrae metadati da una pagina HTML\n   */\n  async fetchHtmlMetadata(url) {\n    try {\n      // Usa il proxy service per estrarre metadati\n      const metadata = await this.proxyService.extractMetadata(url);\n      \n      return {\n        title: metadata.title || metadata.ogTitle,\n        description: metadata.description || metadata.ogDescription,\n        icon: metadata.icon,\n        appleTouchIcon: metadata.appleTouchIcon,\n        keywords: metadata.keywords,\n        author: metadata.author,\n        ogImage: metadata.ogImage,\n        ogTitle: metadata.ogTitle,\n        ogDescription: metadata.ogDescription\n      };\n      \n    } catch (error) {\n      console.log('Impossibile estrarre metadati HTML con proxy, provo approccio diretto:', error);\n      \n      // Fallback: prova approccio diretto\n      try {\n        const response = await fetch(url, {\n          method: 'GET',\n          headers: {\n            'Accept': 'text/html'\n          }\n        });\n        \n        if (!response.ok) {\n          throw new Error('Pagina non accessibile');\n        }\n        \n        const html = await response.text();\n        \n        // Estrai metadati usando regex (approccio semplificato)\n        const titleMatch = html.match(/<title[^>]*>([^<]+)<\\/title>/i);\n        const descriptionMatch = html.match(/<meta[^>]*name=[\"']description[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n        const iconMatch = html.match(/<link[^>]*rel=[\"'](?:icon|shortcut icon)[\"'][^>]*href=[\"']([^\"']+)[\"']/i);\n        const appleIconMatch = html.match(/<link[^>]*rel=[\"']apple-touch-icon[\"'][^>]*href=[\"']([^\"']+)[\"']/i);\n        \n        const baseUrl = new URL(url).origin;\n        \n        return {\n          title: titleMatch ? titleMatch[1].trim() : null,\n          description: descriptionMatch ? descriptionMatch[1].trim() : null,\n          icon: iconMatch ? new URL(iconMatch[1], baseUrl).href : null,\n          appleTouchIcon: appleIconMatch ? new URL(appleIconMatch[1], baseUrl).href : null\n        };\n        \n      } catch (fallbackError) {\n        console.log('Anche l\\'approccio diretto  fallito:', fallbackError);\n        return null;\n      }\n    }\n  }\n\n  /**\n   * Seleziona la migliore icona dal manifest\n   */\n  getBestIcon(icons, baseUrl) {\n    if (!icons || !Array.isArray(icons)) {\n      return null;\n    }\n    \n    // Cerca un'icona di dimensioni adeguate (preferibilmente 192x192 o 512x512)\n    const preferredSizes = ['512x512', '192x192', '144x144', '96x96'];\n    \n    for (const size of preferredSizes) {\n      const icon = icons.find(icon => \n        icon.sizes === size || \n        (icon.sizes && icon.sizes.includes(size))\n      );\n      \n      if (icon) {\n        return new URL(icon.src, baseUrl).href;\n      }\n    }\n    \n    // Fallback alla prima icona disponibile\n    if (icons.length > 0) {\n      return new URL(icons[0].src, baseUrl).href;\n    }\n    \n    return null;\n  }\n\n  // Parsing URL GitHub\n  parseGitHubUrl(url) {\n    const patterns = [\n      /github\\.com\\/([^\\/]+)\\/([^\\/]+)/,\n      /([^\\/]+)\\.github\\.io\\/([^\\/]+)/\n    ];\n\n    for (const pattern of patterns) {\n      const match = url.match(pattern);\n      if (match) {\n        return {\n          owner: match[1],\n          repo: match[2].replace('.git', '')\n        };\n      }\n    }\n    return null;\n  }\n\n  // Validazione URL GitHub\n  isGitHubUrl(url) {\n    return url.includes('github.com') || url.includes('github.io');\n  }\n\n  // Get MIME type\n  getMimeType(filename) {\n    const ext = filename.split('.').pop().toLowerCase();\n    const mimeTypes = {\n      'html': 'text/html',\n      'css': 'text/css',\n      'js': 'application/javascript',\n      'json': 'application/json',\n      'png': 'image/png',\n      'jpg': 'image/jpeg',\n      'jpeg': 'image/jpeg',\n      'gif': 'image/gif',\n      'svg': 'image/svg+xml',\n      'txt': 'text/plain'\n    };\n    return mimeTypes[ext] || 'application/octet-stream';\n  }\n\n  // Get category label\n  getCategoryLabel(category) {\n    const labels = {\n      'productivity': 'Produttivit',\n      'entertainment': 'Intrattenimento',\n      'tools': 'Strumenti',\n      'games': 'Giochi',\n      'ai': 'Intelligenza Artificiale',\n      'social': 'Social',\n      'education': 'Educazione',\n      'business': 'Business',\n      'utility': 'Utilit',\n      'pwa': 'Progressive Web App'\n    };\n    return labels[category] || category;\n  }\n\n  // Popola form metadata\n  populateMetadataForm(metadata) {\n    const fields = {\n      'app-name': metadata.name || metadata.title,\n      'app-description': metadata.description,\n      'app-version': metadata.version,\n      'app-category': metadata.category,\n      'app-tags': Array.isArray(metadata.tags) ? metadata.tags.join(', ') : metadata.tags,\n      'app-icon': metadata.icon\n    };\n\n    for (const [fieldId, value] of Object.entries(fields)) {\n      const field = document.getElementById(fieldId);\n      if (field && value) {\n        field.value = value;\n        \n        // Trigger events\n        field.dispatchEvent(new Event('input'));\n        field.dispatchEvent(new Event('change'));\n      }\n    }\n\n    // Gestione speciale per PWA\n    if (metadata.isPWA && metadata.manifest) {\n      // Aggiungi informazioni PWA specifiche se disponibili\n      if (metadata.theme_color) {\n        const themeColorField = document.getElementById('app-theme-color');\n        if (themeColorField) {\n          themeColorField.value = metadata.theme_color;\n        }\n      }\n      \n      if (metadata.background_color) {\n        const bgColorField = document.getElementById('app-bg-color');\n        if (bgColorField) {\n          bgColorField.value = metadata.background_color;\n        }\n      }\n    }\n  }\n\n  // Raccogli dati dal form\n  collectFormData() {\n    const nameEl = document.getElementById('app-name');\n    const descEl = document.getElementById('app-description');\n    const versionEl = document.getElementById('app-version');\n    const categoryEl = document.getElementById('app-category');\n    const launchModeEl = document.getElementById('app-launch-mode');\n    const tagsEl = document.getElementById('app-tags');\n    const iconEl = document.getElementById('app-icon');\n\n    const tags = tagsEl?.value ? \n      tagsEl.value.split(',').map(tag => tag.trim()).filter(tag => tag) : \n      [];\n\n    const formData = {\n      name: nameEl?.value.trim() || '',\n      description: descEl?.value.trim() || '',\n      version: versionEl?.value.trim() || '1.0.0',\n      category: categoryEl?.value || 'tools',\n      tags,\n      icon: iconEl?.value.trim() || null\n    };\n\n    // Aggiungi modalit di lancio ai metadata se specificata\n    if (launchModeEl && launchModeEl.value) {\n      formData.metadata = formData.metadata || {};\n      formData.metadata.launchMode = launchModeEl.value;\n      console.log(` Modalit di lancio specificata per app: ${launchModeEl.value}`);\n    } else {\n      console.log(` Nessuna modalit specifica, user impostazione globale`);\n    }\n\n    return formData;\n  }\n\n  // Validazione dati app\n  validateAppData(data) {\n    if (!data.name) {\n      return { valid: false, error: 'Nome app richiesto' };\n    }\n\n    if (data.name.length > 50) {\n      return { valid: false, error: 'Nome app troppo lungo (max 50 caratteri)' };\n    }\n\n    if (data.description && data.description.length > 200) {\n      return { valid: false, error: 'Descrizione troppo lunga (max 200 caratteri)' };\n    }\n\n    return { valid: true };\n  }\n\n  // Gestione progress importazione\n  showImportProgress(show) {\n    const progress = document.getElementById('import-progress');\n    const actions = document.getElementById('modal-actions');\n    \n    if (progress && actions) {\n      progress.style.display = show ? 'block' : 'none';\n      actions.style.display = show ? 'none' : 'flex';\n    }\n  }\n\n  updateImportProgress(percent, text) {\n    const fill = document.getElementById('progress-fill');\n    const textEl = document.getElementById('progress-text');\n    \n    if (fill) fill.style.width = `${percent}%`;\n    if (textEl) textEl.textContent = text;\n  }\n\n  // Abilita/disabilita pulsante importazione\n  enableImportButton() {\n    const importBtn = document.getElementById('start-import');\n    if (importBtn) {\n      importBtn.disabled = false;\n    }\n  }\n\n  disableImportButton() {\n    const importBtn = document.getElementById('start-import');\n    if (importBtn) {\n      importBtn.disabled = true;\n    }\n  }\n\n  // Setup drag & drop globale\n  setupDropZone() {\n    // Previeni drop su tutta la pagina\n    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n      document.addEventListener(eventName, (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n      }, false);\n    });\n\n    // Mostra modal su drop globale\n    document.addEventListener('drop', (e) => {\n      const file = e.dataTransfer.files[0];\n      if (file && file.name.endsWith('.zip')) {\n        this.showModal();\n        setTimeout(() => {\n          this.handleZipFile(file);\n        }, 200);\n      }\n    });\n  }\n\n  // Setup keyboard shortcuts\n  setupKeyboardShortcuts() {\n    document.addEventListener('keydown', (e) => {\n      // Ctrl/Cmd + I per importare\n      if ((e.ctrlKey || e.metaKey) && e.key === 'i') {\n        e.preventDefault();\n        this.showModal();\n      }\n    });\n  }\n\n  // Handle icon upload\n  async handleIconUpload(file, iconInput, iconPreview) {\n    if (!file.type.startsWith('image/')) {\n      showToast('Per favore seleziona un file immagine', 'error');\n      return;\n    }\n\n    if (file.size > 2 * 1024 * 1024) { // 2MB\n      showToast('Immagine troppo grande (max 2MB)', 'error');\n      return;\n    }\n\n    try {\n      // Converti in base64\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const dataUrl = e.target.result;\n        iconInput.value = dataUrl;\n        this.showIconPreview(dataUrl, iconPreview);\n      };\n      reader.readAsDataURL(file);\n    } catch (error) {\n      console.error('Errore upload icona:', error);\n      showToast('Errore durante l\\'upload dell\\'icona', 'error');\n    }\n  }\n\n  // Mostra preview icona\n  showIconPreview(url, previewElement) {\n    if (!previewElement) return;\n    \n    const img = previewElement.querySelector('#icon-preview-img');\n    if (img) {\n      img.src = url;\n      img.onload = () => {\n        previewElement.style.display = 'block';\n      };\n      img.onerror = () => {\n        previewElement.style.display = 'none';\n        showToast('Impossibile caricare l\\'icona', 'warning');\n      };\n    }\n  }\n\n  // Handle HTML file\n  async handleHtmlFile(file) {\n    if (!file.type.startsWith('text/html')) {\n      showToast('Per favore seleziona un file HTML', 'error');\n      return;\n    }\n\n    if (file.size > 2 * 1024 * 1024) { // 2MB\n      showToast('File troppo grande (max 2MB)', 'error');\n      return;\n    }\n\n    try {\n      const content = await file.text();\n      \n      // Estrai metadati dal contenuto HTML\n      const metadata = this.extractHtmlMetadata(content, file.name);\n      \n      // Popola il form con i metadati estratti\n      this.populateMetadataForm(metadata);\n\n      // Mostra sezione metadata\n      const metadataSection = document.getElementById('section-metadata');\n      if (metadataSection) {\n        metadataSection.style.display = 'block';\n        metadataSection.classList.add('active');\n      }\n\n      // Salva dati\n      this.currentImportData = {\n        type: 'html',\n        content: content,\n        metadata: metadata\n      };\n\n      // Abilita importazione\n      this.enableImportButton();\n\n      showToast('File HTML analizzato con successo!', 'success');\n\n    } catch (error) {\n      console.error('Errore durante l\\'importazione del file HTML:', error);\n      showToast('Errore durante l\\'importazione del file HTML', 'error');\n    }\n  }\n\n  /**\n   * Estrae metadati da un file HTML\n   * @param {string} htmlContent - Contenuto HTML\n   * @param {string} filename - Nome del file\n   * @returns {Object} Metadati estratti\n   */\n  extractHtmlMetadata(htmlContent, filename) {\n    // Crea un DOM parser temporaneo\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(htmlContent, 'text/html');\n    \n    // Estrai titolo\n    const title = doc.querySelector('title')?.textContent?.trim() || \n                  doc.querySelector('meta[property=\"og:title\"]')?.getAttribute('content') ||\n                  filename.replace('.html', '').replace(/[-_]/g, ' ');\n    \n    // Estrai descrizione\n    const description = doc.querySelector('meta[name=\"description\"]')?.getAttribute('content') ||\n                       doc.querySelector('meta[property=\"og:description\"]')?.getAttribute('content') ||\n                       'App web standalone';\n    \n    // Estrai favicon/icona\n    let icon = null;\n    const favicon = doc.querySelector('link[rel=\"icon\"]')?.getAttribute('href') ||\n                   doc.querySelector('link[rel=\"shortcut icon\"]')?.getAttribute('href') ||\n                   doc.querySelector('link[rel=\"apple-touch-icon\"]')?.getAttribute('href');\n    \n    if (favicon) {\n      // Se  un URL relativo, convertilo in data URL se possibile\n      if (favicon.startsWith('data:')) {\n        icon = favicon;\n      } else if (favicon.startsWith('http')) {\n        icon = favicon;\n      } else {\n        // Per URL relativi, usa un'icona di default per ora\n        icon = null;\n      }\n    }\n    \n    // Estrai keywords/tags\n    const keywords = doc.querySelector('meta[name=\"keywords\"]')?.getAttribute('content') || '';\n    const tags = keywords.split(',').map(k => k.trim()).filter(k => k.length > 0);\n    \n    // Determina categoria basata su contenuto\n    let category = 'tools';\n    const bodyText = doc.body?.textContent?.toLowerCase() || '';\n    if (bodyText.includes('calcolatric') || bodyText.includes('calculator')) {\n      category = 'utilities';\n    } else if (bodyText.includes('game') || bodyText.includes('gioco')) {\n      category = 'games';\n    } else if (bodyText.includes('editor') || bodyText.includes('text')) {\n      category = 'productivity';\n    }\n    \n    return {\n      name: title,\n      description: description,\n      category: category,\n      type: 'html',\n      content: htmlContent,\n      icon: icon,\n      tags: tags,\n      version: '1.0.0'\n    };\n  }\n}","/**\n * AIdeas - App Card Component\n * Componente per la visualizzazione delle card delle applicazioni\n */\n\nimport { formatRelativeDate, formatFileSize, escapeHtml } from '../utils/helpers.js';\n\n/**\n * Classe per gestire il rendering e l'interazione delle app cards\n */\nexport default class AppCard {\n  \n  /**\n   * Renderizza una singola app card\n   * @param {Object} app - Dati dell'app\n   * @param {string} viewMode - Modalit vista: 'grid' o 'list'\n   * @returns {string} HTML della card\n   */\n  static render(app, viewMode = 'grid') {\n    if (viewMode === 'list') {\n      return this.renderListView(app);\n    }\n    return this.renderGridView(app);\n  }\n\n  /**\n   * Renderizza app card in vista griglia\n   * @param {Object} app - Dati dell'app\n   * @returns {string} HTML della card\n   */\n  static renderGridView(app) {\n    const {\n      id,\n      name,\n      description,\n      category,\n      version,\n      type,\n      lastUsed,\n      installDate,\n      favorite,\n      tags,\n      icon,\n      url,\n      githubUrl,\n      metadata\n    } = app;\n\n    const displayName = escapeHtml(name || 'App Senza Nome');\n    const displayDescription = escapeHtml(description || 'Nessuna descrizione disponibile');\n    const displayCategory = this.getCategoryInfo(category);\n    const appIcon = this.getAppIcon(app);\n    const typeInfo = this.getTypeInfo(type);\n    const lastUsedFormatted = formatRelativeDate(lastUsed);\n\n    return `\n      <div class=\"app-card\" data-app-id=\"${id}\" data-category=\"${category}\" data-type=\"${type}\">\n        <!-- App Icon & Status -->\n        <div class=\"app-card-header\">\n          <div class=\"app-icon-container\">\n            ${appIcon}\n            <div class=\"app-type-badge\" title=\"${typeInfo.label}\">\n              ${typeInfo.icon}\n            </div>\n          </div>\n          \n          <!-- Favorite Button -->\n          <button \n            class=\"app-card-favorite ${favorite ? 'is-favorite' : ''}\" \n            data-app-id=\"${id}\"\n            aria-label=\"${favorite ? 'Rimuovi dai preferiti' : 'Aggiungi ai preferiti'}\"\n            title=\"${favorite ? 'Rimuovi dai preferiti' : 'Aggiungi ai preferiti'}\"\n          >\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"/>\n            </svg>\n          </button>\n        </div>\n\n        <!-- App Info -->\n        <div class=\"app-card-body\">\n          <!-- App Name -->\n          <div class=\"app-card-title\">\n            <div class=\"app-name\" title=\"${displayName}\">${displayName}</div>\n          </div>\n\n          <!-- Tags -->\n          ${tags && tags.length > 0 ? `\n            <div class=\"app-tags\">\n              ${tags.slice(0, 3).map(tag => `\n                <span class=\"app-tag\">${escapeHtml(tag)}</span>\n              `).join('')}\n              ${tags.length > 3 ? `<span class=\"app-tag-more\">+${tags.length - 3}</span>` : ''}\n            </div>\n          ` : ''}\n\n          <!-- Metadata -->\n          <div class=\"app-metadata\">\n            <div class=\"app-category\" title=\"Categoria\">\n              ${displayCategory.icon}\n              <span>${displayCategory.name}</span>\n            </div>\n            <div class=\"app-last-used\" title=\"Ultimo utilizzo: ${new Date(lastUsed).toLocaleString()}\">\n              <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                <path d=\"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.7L16.2,16.2Z\"/>\n              </svg>\n              <span>${lastUsedFormatted}</span>\n            </div>\n          </div>\n\n          <!-- App Description -->\n          <div class=\"app-description-container\">\n            <p class=\"app-description\" title=\"${displayDescription}\">\n              ${this.truncateText(displayDescription, 100)}\n            </p>\n          </div>\n        </div>\n\n        <!-- App Actions -->\n        <div class=\"app-card-actions\">\n          <button \n            class=\"app-card-launch btn btn-primary\" \n            data-app-id=\"${id}\"\n            aria-label=\"Avvia ${displayName}\"\n          >\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M8,5.14V19.14L19,12.14L8,5.14Z\"/>\n            </svg>\n            Avvia\n          </button>\n          \n          <div class=\"app-card-menu-container\">\n            <button \n              class=\"app-card-menu btn btn-secondary\" \n              data-app-id=\"${id}\"\n              aria-label=\"Menu ${displayName}\"\n              title=\"Opzioni app\"\n            >\n              <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                <path d=\"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        <!-- Hover Overlay -->\n        <div class=\"app-card-overlay\">\n          <div class=\"app-card-overlay-content\">\n            <div class=\"app-overlay-stats\">\n              <div class=\"stat\">\n                <span class=\"stat-label\">Installata:</span>\n                <span class=\"stat-value\">${formatRelativeDate(installDate)}</span>\n              </div>\n              <div class=\"stat\">\n                <span class=\"stat-label\">Tipo:</span>\n                <span class=\"stat-value\">${typeInfo.label}</span>\n              </div>\n              ${metadata?.size ? `\n                <div class=\"stat\">\n                  <span class=\"stat-label\">Dimensione:</span>\n                  <span class=\"stat-value\">${formatFileSize(metadata.size)}</span>\n                </div>\n              ` : ''}\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Renderizza app card in vista lista\n   * @param {Object} app - Dati dell'app\n   * @returns {string} HTML della card\n   */\n  static renderListView(app) {\n    const {\n      id,\n      name,\n      description,\n      category,\n      version,\n      type,\n      lastUsed,\n      installDate,\n      favorite,\n      tags,\n      metadata\n    } = app;\n\n    const displayName = escapeHtml(name || 'App Senza Nome');\n    const displayDescription = escapeHtml(description || 'Nessuna descrizione disponibile');\n    const displayCategory = this.getCategoryInfo(category);\n    const appIcon = this.getAppIcon(app);\n    const typeInfo = this.getTypeInfo(type);\n    const lastUsedFormatted = formatRelativeDate(lastUsed);\n    const installDateFormatted = formatRelativeDate(installDate);\n\n    return `\n      <div class=\"app-card app-card-list\" data-app-id=\"${id}\" data-category=\"${category}\" data-type=\"${type}\">\n        <!-- App Icon -->\n        <div class=\"app-list-icon\">\n          ${appIcon}\n          <div class=\"app-type-badge-mini\" title=\"${typeInfo.label}\">\n            ${typeInfo.icon}\n          </div>\n        </div>\n\n        <!-- App Info -->\n        <div class=\"app-list-info\">\n          <div class=\"app-list-header\">\n            <h3 class=\"app-list-name\">${displayName}</h3>\n            <span class=\"app-list-version\">v${version || '1.0.0'}</span>\n            <div class=\"app-list-category\" title=\"Categoria\">\n              ${displayCategory.icon}\n              <span>${displayCategory.name}</span>\n            </div>\n          </div>\n          \n          <!-- Tags in list view -->\n          ${tags && tags.length > 0 ? `\n            <div class=\"app-list-tags\">\n              ${tags.slice(0, 5).map(tag => `\n                <span class=\"app-tag app-tag-small\">${escapeHtml(tag)}</span>\n              `).join('')}\n              ${tags.length > 5 ? `<span class=\"app-tag-more app-tag-small\">+${tags.length - 5}</span>` : ''}\n            </div>\n          ` : ''}\n        </div>\n\n        <!-- App Metadata -->\n        <div class=\"app-list-metadata\">\n          <div class=\"app-list-stat\">\n            <span class=\"stat-label\">Ultimo utilizzo:</span>\n            <span class=\"stat-value\">${lastUsedFormatted}</span>\n          </div>\n          <div class=\"app-list-stat\">\n            <span class=\"stat-label\">Installata:</span>\n            <span class=\"stat-value\">${installDateFormatted}</span>\n          </div>\n          ${metadata?.size ? `\n            <div class=\"app-list-stat\">\n              <span class=\"stat-label\">Dimensione:</span>\n              <span class=\"stat-value\">${formatFileSize(metadata.size)}</span>\n            </div>\n          ` : ''}\n        </div>\n\n        <!-- App Actions -->\n        <div class=\"app-list-actions\">\n          <button \n            class=\"app-card-favorite ${favorite ? 'is-favorite' : ''}\" \n            data-app-id=\"${id}\"\n            aria-label=\"${favorite ? 'Rimuovi dai preferiti' : 'Aggiungi ai preferiti'}\"\n            title=\"${favorite ? 'Rimuovi dai preferiti' : 'Aggiungi ai preferiti'}\"\n          >\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"/>\n            </svg>\n          </button>\n          \n          <button \n            class=\"app-card-launch btn btn-primary\" \n            data-app-id=\"${id}\"\n            aria-label=\"Avvia ${displayName}\"\n          >\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M8,5.14V19.14L19,12.14L8,5.14Z\"/>\n            </svg>\n            Avvia\n          </button>\n          \n          <button \n            class=\"app-card-menu btn btn-secondary\" \n            data-app-id=\"${id}\"\n            aria-label=\"Menu ${displayName}\"\n            title=\"Opzioni app\"\n          >\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z\"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Ottiene l'icona dell'app\n   * @param {Object} app - Dati dell'app\n   * @returns {string} HTML dell'icona\n   */\n  static getAppIcon(app) {\n    if (app.icon) {\n      // Se  un'icona custom (base64, URL, etc.)\n      if (app.icon.startsWith('data:') || app.icon.startsWith('http')) {\n        return `<img src=\"${app.icon}\" alt=\"${app.name}\" class=\"app-icon\" loading=\"lazy\" onerror=\"this.style.display='none'; this.nextElementSibling.style.display='flex';\">\n                <div class=\"app-icon-fallback\" style=\"display: none;\">${this.getDefaultIcon(app.type)}</div>`;\n      }\n      // Se  un'icona SVG inline\n      if (app.icon.includes('<svg')) {\n        return `<div class=\"app-icon app-icon-svg\">${app.icon}</div>`;\n      }\n    }\n\n    // Fallback: icona basata sul tipo di app\n    return `<div class=\"app-icon app-icon-default\">${this.getDefaultIcon(app.type)}</div>`;\n  }\n\n  /**\n   * Ottiene l'icona di default basata sul tipo\n   * @param {string} type - Tipo di app\n   * @returns {string} SVG icon\n   */\n  static getDefaultIcon(type) {\n    const icons = {\n      zip: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n        <path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>\n      </svg>`,\n      url: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n        <path d=\"M16.36,14C16.44,13.34 16.5,12.68 16.5,12C16.5,11.32 16.44,10.66 16.36,10H19.74C19.9,10.64 20,11.31 20,12C20,12.69 19.9,13.36 19.74,14M14.59,19.56C15.19,18.45 15.65,17.25 15.97,16H18.92C17.96,17.65 16.43,18.93 14.59,19.56M14.34,14H9.66C9.56,13.34 9.5,12.68 9.5,12C9.5,11.32 9.56,10.65 9.66,10H14.34C14.43,10.65 14.5,11.32 14.5,12C14.5,12.68 14.43,13.34 14.34,14M12,19.96C11.17,18.76 10.5,17.43 10.09,16H13.91C13.5,17.43 12.83,18.76 12,19.96M8,8H5.08C6.03,6.34 7.57,5.06 9.4,4.44C8.8,5.55 8.35,6.75 8,8M5.08,16H8C8.35,17.25 8.8,18.45 9.4,19.56C7.57,18.93 6.03,17.65 5.08,16M4.26,14C4.1,13.36 4,12.69 4,12C4,11.31 4.1,10.64 4.26,10H7.64C7.56,10.66 7.5,11.32 7.5,12C7.5,12.68 7.56,13.34 7.64,14M12,4.03C12.83,5.23 13.5,6.57 13.91,8H10.09C10.5,6.57 11.17,5.23 12,4.03M18.92,8H15.97C15.65,6.75 15.19,5.55 14.59,4.44C16.43,5.07 17.96,6.34 18.92,8Z\"/>\n      </svg>`,\n      github: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n        <path d=\"M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z\"/>\n      </svg>`,\n      pwa: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n        <path d=\"M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C7.14,19.87 7.64,20 8,20C9,20 10,19 11,17H12C14,15 16,13 17,8M18.5,2C16.7,2 15.14,2.9 14.22,4.22L15.63,5.63C16.07,5 16.72,4.5 17.5,4.5C18.61,4.5 19.5,5.39 19.5,6.5C19.5,7.28 19,7.93 18.37,8.37L19.78,9.78C21.1,8.86 22,7.3 22,5.5C22,3.57 20.43,2 18.5,2Z\"/>\n      </svg>`\n    };\n\n    return icons[type] || icons.url;\n  }\n\n  /**\n   * Ottiene informazioni sul tipo di app\n   * @param {string} type - Tipo di app\n   * @returns {Object} Info tipo con label e icona\n   */\n  static getTypeInfo(type) {\n    const types = {\n      zip: {\n        label: 'App ZIP',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>\n        </svg>`\n      },\n      url: {\n        label: 'Web App',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M10.59,13.41C11,13.8 11,14.4 10.59,14.81C10.2,15.2 9.6,15.2 9.19,14.81L7.77,13.39L6.36,14.81C5.95,15.22 5.34,15.22 4.93,14.81C4.53,14.4 4.53,13.8 4.93,13.39L6.34,12L4.93,10.59C4.53,10.2 4.53,9.59 4.93,9.18C5.34,8.78 5.95,8.78 6.36,9.18L7.77,10.6L9.19,9.19C9.6,8.78 10.2,8.78 10.59,9.19C11,9.6 11,10.2 10.59,10.61L9.17,12L10.59,13.41M19.07,4.93C19.47,5.34 19.47,5.95 19.07,6.36L17.65,7.77L19.07,9.19C19.47,9.6 19.47,10.2 19.07,10.61C18.66,11 18.05,11 17.64,10.61L16.23,9.19L14.81,10.61C14.4,11 13.8,11 13.39,10.61C13,10.2 13,9.6 13.39,9.19L14.81,7.77L13.39,6.36C13,5.95 13,5.34 13.39,4.93C13.8,4.53 14.4,4.53 14.81,4.93L16.23,6.34L17.64,4.93C18.05,4.53 18.66,4.53 19.07,4.93Z\"/>\n        </svg>`\n      },\n      github: {\n        label: 'GitHub App',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z\"/>\n        </svg>`\n      },\n      pwa: {\n        label: 'PWA',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z\"/>\n        </svg>`\n      }\n    };\n\n    return types[type] || types.url;\n  }\n\n  /**\n   * Ottiene informazioni sulla categoria\n   * @param {string} category - Categoria dell'app\n   * @returns {Object} Info categoria con nome e icona\n   */\n  static getCategoryInfo(category) {\n    const categories = {\n      productivity: {\n        name: 'Produttivit',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z\"/>\n        </svg>`\n      },\n      entertainment: {\n        name: 'Intrattenimento',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M13,2.05V5.08C16.39,5.57 19,8.47 19,12C19,12.9 18.82,13.75 18.5,14.54L21.12,16.07C21.68,14.83 22,13.45 22,12C22,6.82 18.05,2.55 13,2.05M12,19A7,7 0 0,1 5,12C5,8.47 7.61,5.57 11,5.08V2.05C5.94,2.55 2,6.81 2,12A10,10 0 0,0 12,22C15.3,22 18.23,20.39 20.05,17.91L17.45,16.38C16.17,18 14.21,19 12,19Z\"/>\n        </svg>`\n      },\n      tools: {\n        name: 'Strumenti',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M22.7,19L13.6,9.9C14.5,7.6 14,4.9 12.1,3C10.1,1 7.1,0.6 4.7,1.7L9,6L6,9L1.6,4.7C0.4,7.1 0.9,10.1 2.9,12.1C4.8,14 7.5,14.5 9.8,13.6L18.9,22.7C19.3,23.1 19.9,23.1 20.3,22.7L22.6,20.4C23.1,20 23.1,19.3 22.7,19Z\"/>\n        </svg>`\n      },\n      games: {\n        name: 'Giochi',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M7.97,16L5,19C4.67,19.3 4.23,19.5 3.75,19.5A1.75,1.75 0 0,1 2,17.75V17.5L3,10.12C3.21,7.81 5.14,6 7.5,6H16.5C18.86,6 20.79,7.81 21,10.12L22,17.5V17.75A1.75,1.75 0 0,1 20.25,19.5C19.77,19.5 19.33,19.3 19,19L16.03,16H7.97M9.5,8A1.5,1.5 0 0,0 8,9.5A1.5,1.5 0 0,0 9.5,11A1.5,1.5 0 0,0 11,9.5A1.5,1.5 0 0,0 9.5,8M14.5,8A1.5,1.5 0 0,0 13,9.5A1.5,1.5 0 0,0 14.5,11A1.5,1.5 0 0,0 16,9.5A1.5,1.5 0 0,0 14.5,8Z\"/>\n        </svg>`\n      },\n      ai: {\n        name: 'Intelligenza Artificiale',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7.27C13.6,7.61 14,8.26 14,9A2,2 0 0,1 12,11A2,2 0 0,1 10,9A2,2 0 0,1 12,7A2,2 0 0,1 14,9A2,2 0 0,1 12,11A2,2 0 0,1 10,9C10,8.26 10.4,7.61 11,7.27V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M9,9A2,2 0 0,1 11,11A2,2 0 0,1 9,13A2,2 0 0,1 7,11A2,2 0 0,1 9,9M15,9A2,2 0 0,1 17,11A2,2 0 0,1 15,13A2,2 0 0,1 13,11A2,2 0 0,1 15,9M12,12A2,2 0 0,1 14,14C14,14.74 13.6,15.39 13,15.73V17.27C13.6,17.61 14,18.26 14,19A2,2 0 0,1 12,21A2,2 0 0,1 10,19A2,2 0 0,1 12,17A2,2 0 0,1 14,19A2,2 0 0,1 12,21A2,2 0 0,1 10,19C10,18.26 10.4,17.61 11,17.27V15.73C10.4,15.39 10,14.74 10,14A2,2 0 0,1 12,12Z\"/>\n        </svg>`\n      },\n      social: {\n        name: 'Social',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z\"/>\n        </svg>`\n      },\n      uncategorized: {\n        name: 'Altro',\n        icon: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z\"/>\n        </svg>`\n      }\n    };\n\n    return categories[category] || categories.uncategorized;\n  }\n\n  /**\n   * Tronca testo a lunghezza specificata\n   * @param {string} text - Testo da troncare\n   * @param {number} maxLength - Lunghezza massima\n   * @returns {string} Testo troncato\n   */\n  static truncateText(text, maxLength) {\n    if (!text || text.length <= maxLength) return text;\n    return text.substring(0, maxLength).trim() + '...';\n  }\n\n  /**\n   * Genera il menu di contesto per un'app\n   * @param {Object} app - Dati dell'app\n   * @returns {string} HTML del menu\n   */\n  static generateContextMenu(app) {\n    const { id, name, type, favorite, githubUrl, url } = app;\n\n    return `\n      <div class=\"app-context-menu\" data-app-id=\"${id}\">\n        <div class=\"context-menu-item\" data-action=\"launch\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M8,5.14V19.14L19,12.14L8,5.14Z\"/>\n          </svg>\n          Avvia\n        </div>\n        \n        <div class=\"context-menu-item\" data-action=\"favorite\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"/>\n          </svg>\n          ${favorite ? 'Rimuovi dai preferiti' : 'Aggiungi ai preferiti'}\n        </div>\n        \n        <div class=\"context-menu-separator\"></div>\n        \n        <div class=\"context-menu-item\" data-action=\"edit\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z\"/>\n          </svg>\n          Modifica\n        </div>\n        \n        <div class=\"context-menu-item\" data-action=\"duplicate\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"/>\n          </svg>\n          Duplica\n        </div>\n        \n        <div class=\"context-menu-item\" data-action=\"export\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>\n          </svg>\n          Esporta\n        </div>\n        \n        ${(githubUrl || url) ? `\n          <div class=\"context-menu-separator\"></div>\n          ${githubUrl ? `\n            <div class=\"context-menu-item\" data-action=\"open-github\">\n              <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                <path d=\"M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z\"/>\n              </svg>\n              Apri GitHub\n            </div>\n          ` : ''}\n          ${url && type === 'url' ? `\n            <div class=\"context-menu-item\" data-action=\"open-original\">\n              <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                <path d=\"M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z\"/>\n              </svg>\n              Apri originale\n            </div>\n          ` : ''}\n        ` : ''}\n        \n        <div class=\"context-menu-separator\"></div>\n        \n        <div class=\"context-menu-item context-menu-danger\" data-action=\"delete\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z\"/>\n          </svg>\n          Elimina\n        </div>\n      </div>\n    `;\n  }\n}","/**\n * AIdeas - Constants & Configuration\n * Costanti e configurazioni globali dell'applicazione\n */\n\n// Informazioni applicazione\nexport const APP_INFO = {\n  name: 'AIdeas',\n  fullName: 'Swiss Army Knife by AI',\n  version: '1.0.0',\n  description: 'Launcher per applicazioni web generate da AI',\n  author: 'AIdeas Team',\n  website: 'https://aideas.run',\n  repository: 'https://github.com/aideas-run/aideas-run',\n  license: 'MIT'\n};\n\n// Database configuration\nexport const DATABASE_CONFIG = {\n  name: 'AIdeas_DB',\n  version: 1,\n  maxSize: 100 * 1024 * 1024, // 100MB\n  backupRetention: 30 // giorni\n};\n\n// Limiti applicazione\nexport const LIMITS = {\n  maxApps: 1000,\n  maxConcurrentApps: 10,\n  maxAppSize: 50 * 1024 * 1024, // 50MB per app ZIP\n  maxIconSize: 2 * 1024 * 1024, // 2MB per icona\n  maxDescriptionLength: 500,\n  maxNameLength: 100,\n  maxTagsCount: 20,\n  maxTagLength: 30\n};\n\n// Tipi di app supportati\nexport const APP_TYPES = {\n  ZIP: 'zip',\n  URL: 'url',\n  GITHUB: 'github',\n  PWA: 'pwa'\n};\n\n// Categorie predefinite\nexport const CATEGORIES = {\n  PRODUCTIVITY: 'productivity',\n  ENTERTAINMENT: 'entertainment',\n  TOOLS: 'tools',\n  GAMES: 'games',\n  AI: 'ai',\n  SOCIAL: 'social',\n  EDUCATION: 'education',\n  BUSINESS: 'business',\n  UTILITY: 'utility',\n  UNCATEGORIZED: 'uncategorized'\n};\n\n// Labels per le categorie\nexport const CATEGORY_LABELS = {\n  [CATEGORIES.PRODUCTIVITY]: 'Produttivit',\n  [CATEGORIES.ENTERTAINMENT]: 'Intrattenimento',\n  [CATEGORIES.TOOLS]: 'Strumenti',\n  [CATEGORIES.GAMES]: 'Giochi',\n  [CATEGORIES.AI]: 'Intelligenza Artificiale',\n  [CATEGORIES.SOCIAL]: 'Social',\n  [CATEGORIES.EDUCATION]: 'Educazione',\n  [CATEGORIES.BUSINESS]: 'Business',\n  [CATEGORIES.UTILITY]: 'Utilit',\n  [CATEGORIES.UNCATEGORIZED]: 'Altro'\n};\n\n// Icone per le categorie\nexport const CATEGORY_ICONS = {\n  [CATEGORIES.PRODUCTIVITY]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z\"/>\n  </svg>`,\n  [CATEGORIES.ENTERTAINMENT]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M13,2.05V5.08C16.39,5.57 19,8.47 19,12C19,12.9 18.82,13.75 18.5,14.54L21.12,16.07C21.68,14.83 22,13.45 22,12C22,6.82 18.05,2.55 13,2.05M12,19A7,7 0 0,1 5,12C5,8.47 7.61,5.57 11,5.08V2.05C5.94,2.55 2,6.81 2,12A10,10 0 0,0 12,22C15.3,22 18.23,20.39 20.05,17.91L17.45,16.38C16.17,18 14.21,19 12,19Z\"/>\n  </svg>`,\n  [CATEGORIES.TOOLS]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M22.7,19L13.6,9.9C14.5,7.6 14,4.9 12.1,3C10.1,1 7.1,0.6 4.7,1.7L9,6L6,9L1.6,4.7C0.4,7.1 0.9,10.1 2.9,12.1C4.8,14 7.5,14.5 9.8,13.6L18.9,22.7C19.3,23.1 19.9,23.1 20.3,22.7L22.6,20.4C23.1,20 23.1,19.3 22.7,19Z\"/>\n  </svg>`,\n  [CATEGORIES.GAMES]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M7.97,16L5,19C4.67,19.3 4.23,19.5 3.75,19.5A1.75,1.75 0 0,1 2,17.75V17.5L3,10.12C3.21,7.81 5.14,6 7.5,6H16.5C18.86,6 20.79,7.81 21,10.12L22,17.5V17.75A1.75,1.75 0 0,1 20.25,19.5C19.77,19.5 19.33,19.3 19,19L16.03,16H7.97M9.5,8A1.5,1.5 0 0,0 8,9.5A1.5,1.5 0 0,0 9.5,11A1.5,1.5 0 0,0 11,9.5A1.5,1.5 0 0,0 9.5,8M14.5,8A1.5,1.5 0 0,0 13,9.5A1.5,1.5 0 0,0 14.5,11A1.5,1.5 0 0,0 16,9.5A1.5,1.5 0 0,0 14.5,8Z\"/>\n  </svg>`,\n  [CATEGORIES.AI]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7.27C13.6,7.61 14,8.26 14,9A2,2 0 0,1 12,11A2,2 0 0,1 10,9A2,2 0 0,1 12,7A2,2 0 0,1 14,9A2,2 0 0,1 12,11A2,2 0 0,1 10,9C10,8.26 10.4,7.61 11,7.27V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M9,9A2,2 0 0,1 11,11A2,2 0 0,1 9,13A2,2 0 0,1 7,11A2,2 0 0,1 9,9M15,9A2,2 0 0,1 17,11A2,2 0 0,1 15,13A2,2 0 0,1 13,11A2,2 0 0,1 15,9M12,12A2,2 0 0,1 14,14C14,14.74 13.6,15.39 13,15.73V17.27C13.6,17.61 14,18.26 14,19A2,2 0 0,1 12,21A2,2 0 0,1 10,19A2,2 0 0,1 12,17A2,2 0 0,1 14,19A2,2 0 0,1 12,21A2,2 0 0,1 10,19C10,18.26 10.4,17.61 11,17.27V15.73C10.4,15.39 10,14.74 10,14A2,2 0 0,1 12,12Z\"/>\n  </svg>`,\n  [CATEGORIES.SOCIAL]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M16,4C18.11,4 19.8,5.69 19.8,7.8C19.8,9.91 18.11,11.6 16,11.6C13.89,11.6 12.2,9.91 12.2,7.8C12.2,5.69 13.89,4 16,4M16,5.9C15,5.9 14.1,6.8 14.1,7.8C14.1,8.8 15,9.7 16,9.7C17,9.7 17.9,8.8 17.9,7.8C17.9,6.8 17,5.9 16,5.9M16,13.64C18.67,13.64 22.4,14.97 22.4,17.64V20H9.6V17.64C9.6,14.97 13.33,13.64 16,13.64M16,15.26C14.5,15.26 11.22,16 11.22,17.64V18.38H20.78V17.64C20.78,16 17.5,15.26 16,15.26M7.76,4C9.87,4 11.56,5.69 11.56,7.8C11.56,9.91 9.87,11.6 7.76,11.6C5.65,11.6 3.96,9.91 3.96,7.8C3.96,5.69 5.65,4 7.76,4M7.76,5.9C6.76,5.9 5.86,6.8 5.86,7.8C5.86,8.8 6.76,9.7 7.76,9.7C8.76,9.7 9.66,8.8 9.66,7.8C9.66,6.8 8.76,5.9 7.76,5.9M7.76,13.64C10.43,13.64 14.16,14.97 14.16,17.64V20H1.36V17.64C1.36,14.97 5.09,13.64 7.76,13.64M7.76,15.26C6.26,15.26 2.98,16 2.98,17.64V18.38H12.54V17.64C12.54,16 9.26,15.26 7.76,15.26Z\"/>\n  </svg>`,\n  [CATEGORIES.EDUCATION]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M12,3L1,9L12,15L21,10.09V17H23V9M5,13.18V17.18L12,21L19,17.18V13.18L12,17L5,13.18Z\"/>\n  </svg>`,\n  [CATEGORIES.BUSINESS]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M12,7V3H2V21H22V7H12M6,19H4V17H6V19M6,15H4V13H6V15M6,11H4V9H6V11M6,7H4V5H6V7M10,19H8V17H10V19M10,15H8V13H10V15M10,11H8V9H10V11M10,7H8V5H10V7M20,19H12V17H14V15H12V13H14V11H12V9H20V19M18,11H16V13H18V11M18,15H16V17H18V15Z\"/>\n  </svg>`,\n  [CATEGORIES.UTILITY]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C7.14,19.87 7.64,20 8,20C9,20 10,19 11,17H12C14,15 16,13 17,8M18.5,2C16.7,2 15.14,2.9 14.22,4.22L15.63,5.63C16.07,5 16.72,4.5 17.5,4.5C18.61,4.5 19.5,5.39 19.5,6.5C19.5,7.28 19,7.93 18.37,8.37L19.78,9.78C21.1,8.86 22,7.3 22,5.5C22,3.57 20.43,2 18.5,2Z\"/>\n  </svg>`,\n  [CATEGORIES.UNCATEGORIZED]: `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n    <path d=\"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z\"/>\n  </svg>`\n};\n\n// Modalit di lancio app\nexport const LAUNCH_MODES = {\n  IFRAME: 'iframe',\n  NEW_PAGE: 'newpage',\n  AUTO: 'auto'\n};\n\n// Permessi sandbox per iframe\nexport const SANDBOX_PERMISSIONS = {\n  STRICT: 'allow-scripts allow-forms',\n  MODERATE: 'allow-scripts allow-forms allow-modals allow-popups-to-escape-sandbox',\n  PERMISSIVE: 'allow-scripts allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin'\n};\n\n// Estensioni file supportate\nexport const SUPPORTED_EXTENSIONS = {\n  ARCHIVES: ['.zip'],\n  IMAGES: ['.png', '.jpg', '.jpeg', '.gif', '.svg', '.webp'],\n  DOCUMENTS: ['.html', '.css', '.js', '.json', '.md', '.txt'],\n  MANIFESTS: ['manifest.json', 'aideas.json', 'package.json']\n};\n\n// MIME types\nexport const MIME_TYPES = {\n  'html': 'text/html',\n  'css': 'text/css',\n  'js': 'application/javascript',\n  'mjs': 'application/javascript',\n  'json': 'application/json',\n  'txt': 'text/plain',\n  'md': 'text/markdown',\n  'png': 'image/png',\n  'jpg': 'image/jpeg',\n  'jpeg': 'image/jpeg',\n  'gif': 'image/gif',\n  'svg': 'image/svg+xml',\n  'webp': 'image/webp',\n  'ico': 'image/x-icon',\n  'zip': 'application/zip',\n  'pdf': 'application/pdf',\n  'xml': 'application/xml'\n};\n\n// Provider di sincronizzazione\nexport const SYNC_PROVIDERS = {\n  GITHUB: 'github',\n  GOOGLE_DRIVE: 'googledrive'\n};\n\n// URL e endpoint API\nexport const API_ENDPOINTS = {\n  GITHUB: {\n    BASE: 'https://api.github.com',\n    USER: 'https://api.github.com/user',\n    GISTS: 'https://api.github.com/gists',\n    REPOS: 'https://api.github.com/repos'\n  },\n  GOOGLE: {\n    DRIVE: 'https://www.googleapis.com/drive/v3',\n    AUTH: 'https://accounts.google.com/o/oauth2/v2/auth',\n    TOKEN: 'https://oauth2.googleapis.com/token'\n  },\n  CDN: {\n    CDNJS: 'https://cdnjs.cloudflare.com/ajax/libs',\n    JSDELIVR: 'https://cdn.jsdelivr.net/npm',\n    UNPKG: 'https://unpkg.com'\n  }\n};\n\n// Temi disponibili\nexport const THEMES = {\n  AUTO: 'auto',\n  LIGHT: 'light',\n  DARK: 'dark'\n};\n\n// Lingue supportate\nexport const LANGUAGES = {\n  IT: 'it',\n  EN: 'en',\n  ES: 'es',\n  FR: 'fr',\n  DE: 'de'\n};\n\n// Strategie di cache\nexport const CACHE_STRATEGIES = {\n  AGGRESSIVE: 'aggressive',\n  MODERATE: 'moderate',\n  MINIMAL: 'minimal'\n};\n\n// Eventi personalizzati\nexport const CUSTOM_EVENTS = {\n  APP_LAUNCHED: 'aideas:app:launched',\n  APP_CLOSED: 'aideas:app:closed',\n  APP_INSTALLED: 'aideas:app:installed',\n  APP_UPDATED: 'aideas:app:updated',\n  APP_DELETED: 'aideas:app:deleted',\n  SYNC_STARTED: 'aideas:sync:started',\n  SYNC_COMPLETED: 'aideas:sync:completed',\n  SYNC_FAILED: 'aideas:sync:failed',\n  SETTINGS_CHANGED: 'aideas:settings:changed',\n  THEME_CHANGED: 'aideas:theme:changed'\n};\n\n// Chiavi localStorage\nexport const STORAGE_KEYS = {\n  THEME: 'aideas_theme',\n  LANGUAGE: 'aideas_language',\n  FIRST_RUN: 'aideas_first_run',\n  INSTALL_PROMPT: 'aideas_install_prompt_dismissed',\n  LAST_BACKUP: 'aideas_last_backup',\n  DEV_MODE: 'aideas_dev_mode'\n};\n\n// Configurazione PWA\nexport const PWA_CONFIG = {\n  INSTALL_PROMPT_DELAY: 3000, // ms\n  OFFLINE_READY_DELAY: 1000,  // ms\n  UPDATE_CHECK_INTERVAL: 60000, // ms\n  CACHE_VERSION: 'v1',\n  PRECACHE_ROUTES: [\n    '/',\n    '/manifest.json',\n    '/favicon.ico'\n  ]\n};\n\n// Configurazioni di sicurezza\nexport const SECURITY_CONFIG = {\n  ALLOWED_PROTOCOLS: ['http:', 'https:', 'data:', 'blob:'],\n  BLOCKED_DOMAINS: [\n    'malware.example.com',\n    'phishing.example.com'\n  ],\n  MAX_REDIRECTS: 5,\n  REQUEST_TIMEOUT: 30000, // ms\n  CSP_DIRECTIVES: {\n    'default-src': ['\\'self\\''],\n    'script-src': ['\\'self\\'', '\\'unsafe-inline\\'', 'https://cdnjs.cloudflare.com'],\n    'style-src': ['\\'self\\'', '\\'unsafe-inline\\'', 'https://fonts.googleapis.com'],\n    'img-src': ['\\'self\\'', 'data:', 'https:', 'blob:'],\n    'connect-src': ['\\'self\\'', 'https://api.github.com', 'https://www.googleapis.com'],\n    'font-src': ['\\'self\\'', 'https://fonts.gstatic.com']\n  }\n};\n\n// Configurazioni performance\nexport const PERFORMANCE_CONFIG = {\n  LAZY_LOAD_THRESHOLD: 200, // px\n  DEBOUNCE_SEARCH: 300, // ms\n  THROTTLE_SCROLL: 16, // ms\n  IMAGE_QUALITY: 0.8,\n  MAX_PARALLEL_DOWNLOADS: 3,\n  CHUNK_SIZE: 64 * 1024, // 64KB\n  PREFETCH_DELAY: 2000 // ms\n};\n\n// Formati di data\nexport const DATE_FORMATS = {\n  SHORT: 'dd/MM/yyyy',\n  LONG: 'dd MMMM yyyy',\n  WITH_TIME: 'dd/MM/yyyy HH:mm',\n  ISO: 'yyyy-MM-dd\\'T\\'HH:mm:ss.SSSxxx',\n  RELATIVE_THRESHOLDS: {\n    MINUTE: 60 * 1000,\n    HOUR: 60 * 60 * 1000,\n    DAY: 24 * 60 * 60 * 1000,\n    WEEK: 7 * 24 * 60 * 60 * 1000,\n    MONTH: 30 * 24 * 60 * 60 * 1000,\n    YEAR: 365 * 24 * 60 * 60 * 1000\n  }\n};\n\n// Messaggi di errore standard\nexport const ERROR_MESSAGES = {\n  NETWORK_ERROR: 'Errore di connessione. Controlla la tua connessione internet.',\n  INVALID_FILE: 'Formato file non supportato.',\n  FILE_TOO_LARGE: 'File troppo grande.',\n  STORAGE_FULL: 'Spazio di archiviazione esaurito.',\n  INVALID_URL: 'URL non valido.',\n  SYNC_FAILED: 'Sincronizzazione fallita.',\n  IMPORT_FAILED: 'Importazione fallita.',\n  EXPORT_FAILED: 'Esportazione fallita.',\n  PERMISSION_DENIED: 'Permesso negato.',\n  APP_NOT_FOUND: 'Applicazione non trovata.',\n  INVALID_MANIFEST: 'Manifest non valido.',\n  UNSUPPORTED_BROWSER: 'Browser non supportato.'\n};\n\n// Messaggi di successo standard\nexport const SUCCESS_MESSAGES = {\n  APP_INSTALLED: 'Applicazione installata con successo',\n  APP_UPDATED: 'Applicazione aggiornata',\n  APP_DELETED: 'Applicazione rimossa',\n  SYNC_COMPLETED: 'Sincronizzazione completata',\n  BACKUP_CREATED: 'Backup creato',\n  SETTINGS_SAVED: 'Impostazioni salvate',\n  EXPORT_COMPLETED: 'Esportazione completata',\n  IMPORT_COMPLETED: 'Importazione completata'\n};\n\n// Configurazioni debug\nexport const DEBUG_CONFIG = {\n  ENABLE_CONSOLE_LOGS: true,\n  ENABLE_PERFORMANCE_MARKS: false,\n  ENABLE_ERROR_BOUNDARY: true,\n  LOG_LEVELS: {\n    ERROR: 0,\n    WARN: 1,\n    INFO: 2,\n    DEBUG: 3,\n    TRACE: 4\n  }\n};\n\n// Breakpoints responsive\nexport const BREAKPOINTS = {\n  MOBILE: 480,\n  TABLET: 768,\n  DESKTOP: 1024,\n  LARGE: 1200,\n  XLARGE: 1440\n};\n\n// Configurazioni animazioni\nexport const ANIMATION_CONFIG = {\n  DURATION: {\n    FAST: 150,\n    NORMAL: 300,\n    SLOW: 500\n  },\n  EASING: {\n    EASE: 'ease',\n    EASE_IN: 'ease-in',\n    EASE_OUT: 'ease-out',\n    EASE_IN_OUT: 'ease-in-out'\n  },\n  SPRING: {\n    BOUNCE: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',\n    SMOOTH: 'cubic-bezier(0.4, 0, 0.2, 1)'\n  }\n};\n\n// Default settings dell'applicazione\nexport const DEFAULT_SETTINGS = {\n  // Generali\n  language: LANGUAGES.IT,\n  theme: THEMES.AUTO,\n  \n  // Launcher\n  defaultLaunchMode: LAUNCH_MODES.NEW_PAGE,\n  maxConcurrentApps: 5,\n  showAppTooltips: true,\n  enableKeyboardShortcuts: true,\n  autoUpdateApps: false,\n  \n  // UI/UX\n  viewMode: 'grid',\n  sortBy: 'lastUsed',\n  showWelcomeMessage: true,\n  enableAnimations: true,\n  compactMode: false,\n  \n  // Sync & Backup\n  syncEnabled: false,\n  syncProvider: SYNC_PROVIDERS.GITHUB,\n  autoSyncInterval: 60,\n  backupBeforeSync: true,\n  \n  // Privacy & Security\n  analyticsEnabled: false,\n  crashReportingEnabled: true,\n  allowTelemetry: false,\n  validateAppsOnLaunch: true,\n  sandboxMode: 'strict',\n  \n  // Performance\n  enableServiceWorker: true,\n  cacheStrategy: CACHE_STRATEGIES.MODERATE,\n  preloadApps: false,\n  lazyLoadImages: true,\n  \n  // Developer\n  enableDebugMode: false,\n  showConsoleErrors: false,\n  enableExperimentalFeatures: false\n};\n\n// Regex patterns utili\nexport const REGEX_PATTERNS = {\n  EMAIL: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\n  URL: /^https?:\\/\\/.+/,\n  GITHUB_URL: /github\\.com\\/([^\\/]+)\\/([^\\/]+)/,\n  GITHUB_PAGES: /([^\\.]+)\\.github\\.io\\/([^\\/]+)/,\n  SEMVER: /^(\\d+)\\.(\\d+)\\.(\\d+)(?:-([0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*))?(?:\\+([0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*))?$/,\n  HEX_COLOR: /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,\n  SAFE_FILENAME: /^[a-zA-Z0-9._-]+$/\n};\n\n// Feature flags per controllo funzionalit\nexport const FEATURE_FLAGS = {\n  ENABLE_PWA_INSTALL: true,\n  ENABLE_GITHUB_SYNC: true,\n  ENABLE_GOOGLE_DRIVE_SYNC: false,\n  ENABLE_APP_STORE: false,\n  ENABLE_ANALYTICS: false,\n  ENABLE_CRASH_REPORTING: true,\n  ENABLE_BACKGROUND_SYNC: true,\n  ENABLE_PUSH_NOTIFICATIONS: false,\n  ENABLE_DARK_MODE: true,\n  ENABLE_EXPERIMENTAL_FEATURES: false\n};\n\n// Export default configuration object\nexport default {\n  APP_INFO,\n  DATABASE_CONFIG,\n  LIMITS,\n  APP_TYPES,\n  CATEGORIES,\n  CATEGORY_LABELS,\n  CATEGORY_ICONS,\n  LAUNCH_MODES,\n  SANDBOX_PERMISSIONS,\n  SUPPORTED_EXTENSIONS,\n  MIME_TYPES,\n  SYNC_PROVIDERS,\n  API_ENDPOINTS,\n  THEMES,\n  LANGUAGES,\n  CACHE_STRATEGIES,\n  CUSTOM_EVENTS,\n  STORAGE_KEYS,\n  PWA_CONFIG,\n  SECURITY_CONFIG,\n  PERFORMANCE_CONFIG,\n  DATE_FORMATS,\n  ERROR_MESSAGES,\n  SUCCESS_MESSAGES,\n  DEBUG_CONFIG,\n  BREAKPOINTS,\n  ANIMATION_CONFIG,\n  DEFAULT_SETTINGS,\n  REGEX_PATTERNS,\n  FEATURE_FLAGS\n};","/**\n * AIdeas - GitHub Service\n * Gestione sincronizzazione con GitHub Gists\n */\n\nimport { API_ENDPOINTS, REGEX_PATTERNS } from '../utils/constants.js';\nimport { showToast } from '../utils/helpers.js';\n\n/**\n * Servizio per interazioni con GitHub API\n */\nexport default class GitHubService {\n  constructor() {\n    this.baseUrl = API_ENDPOINTS.GITHUB.BASE;\n    this.rateLimitRemaining = 5000;\n    this.rateLimitReset = null;\n    this.authenticated = false;\n    this.userInfo = null;\n    \n    // Cache per ridurre chiamate API\n    this.cache = new Map();\n    this.cacheTimeout = 5 * 60 * 1000; // 5 minuti\n  }\n\n  /**\n   * Autentica con GitHub usando Personal Access Token\n   * @param {string} token - GitHub Personal Access Token\n   * @returns {Promise<Object>} User info se successo\n   */\n  async authenticate(token) {\n    try {\n      if (!token || !token.startsWith('ghp_')) {\n        throw new Error('Token GitHub non valido');\n      }\n\n      const response = await this.makeRequest('/user', {\n        headers: {\n          'Authorization': `token ${token}`,\n          'Accept': 'application/vnd.github.v3+json'\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error(`Autenticazione fallita: ${response.statusText}`);\n      }\n\n      this.userInfo = await response.json();\n      this.authenticated = true;\n      \n      // Salva token in modo sicuro\n      await this.saveToken(token);\n      \n      console.log(' GitHub autenticato:', this.userInfo.login);\n      return this.userInfo;\n\n    } catch (error) {\n      console.error(' Errore autenticazione GitHub:', error);\n      this.authenticated = false;\n      throw error;\n    }\n  }\n\n  /**\n   * Verifica se l'utente  autenticato\n   * @returns {Promise<boolean>} Stato autenticazione\n   */\n  async isAuthenticated() {\n    if (this.authenticated && this.userInfo) {\n      return true;\n    }\n\n    try {\n      const token = await this.getToken();\n      if (token) {\n        await this.authenticate(token);\n        return this.authenticated;\n      }\n    } catch (error) {\n      console.error('Errore verifica autenticazione:', error);\n    }\n\n    return false;\n  }\n\n  /**\n   * Effettua logout\n   */\n  async logout() {\n    this.authenticated = false;\n    this.userInfo = null;\n    await this.clearToken();\n    this.cache.clear();\n  }\n\n  /**\n   * Ottiene informazioni su un repository\n   * @param {string} owner - Proprietario del repo\n   * @param {string} repo - Nome del repository\n   * @returns {Promise<Object>} Info repository\n   */\n  async getRepository(owner, repo) {\n    try {\n      const cacheKey = `repo:${owner}/${repo}`;\n      const cached = this.getFromCache(cacheKey);\n      if (cached) return cached;\n\n      const endpoint = `/repos/${owner}/${repo}`;\n      const response = await this.makeRequest(endpoint);\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          throw new Error('Repository non trovato');\n        }\n        throw new Error(`Errore API GitHub: ${response.statusText}`);\n      }\n\n      const repoData = await response.json();\n      this.setCache(cacheKey, repoData);\n      \n      return repoData;\n\n    } catch (error) {\n      console.error('Errore recupero repository:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Ottiene il contenuto di un file dal repository\n   * @param {string} owner - Proprietario del repo\n   * @param {string} repo - Nome del repository\n   * @param {string} path - Percorso del file\n   * @param {string} ref - Branch/commit ref (default: main)\n   * @returns {Promise<Object>} Contenuto del file\n   */\n  async getFileContent(owner, repo, path, ref = 'main') {\n    try {\n      const cacheKey = `file:${owner}/${repo}/${path}@${ref}`;\n      const cached = this.getFromCache(cacheKey);\n      if (cached) return cached;\n\n      const endpoint = `/repos/${owner}/${repo}/contents/${path}?ref=${ref}`;\n      const response = await this.makeRequest(endpoint);\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          throw new Error(`File ${path} non trovato`);\n        }\n        throw new Error(`Errore recupero file: ${response.statusText}`);\n      }\n\n      const fileData = await response.json();\n      \n      // Decodifica contenuto se  base64\n      if (fileData.encoding === 'base64') {\n        fileData.decodedContent = atob(fileData.content.replace(/\\n/g, ''));\n      }\n\n      this.setCache(cacheKey, fileData);\n      return fileData;\n\n    } catch (error) {\n      console.error('Errore recupero file:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Ottiene la lista dei file del repository\n   * @param {string} owner - Proprietario del repo\n   * @param {string} repo - Nome del repository\n   * @param {string} path - Percorso directory (default: root)\n   * @param {string} ref - Branch/commit ref\n   * @returns {Promise<Array>} Lista file e directory\n   */\n  async getDirectoryContents(owner, repo, path = '', ref = 'main') {\n    try {\n      const cacheKey = `dir:${owner}/${repo}/${path}@${ref}`;\n      const cached = this.getFromCache(cacheKey);\n      if (cached) return cached;\n\n      const endpoint = `/repos/${owner}/${repo}/contents/${path}?ref=${ref}`;\n      const response = await this.makeRequest(endpoint);\n\n      if (!response.ok) {\n        throw new Error(`Errore recupero directory: ${response.statusText}`);\n      }\n\n      const contents = await response.json();\n      this.setCache(cacheKey, contents);\n      \n      return contents;\n\n    } catch (error) {\n      console.error('Errore recupero directory:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Scarica tutto il repository come ZIP\n   * @param {string} owner - Proprietario del repo\n   * @param {string} repo - Nome del repository\n   * @param {string} ref - Branch/commit ref\n   * @returns {Promise<Blob>} ZIP del repository\n   */\n  async downloadRepositoryZip(owner, repo, ref = 'main') {\n    try {\n      const endpoint = `/repos/${owner}/${repo}/zipball/${ref}`;\n      const response = await this.makeRequest(endpoint, {\n        headers: await this.getAuthHeaders()\n      });\n\n      if (!response.ok) {\n        throw new Error(`Errore download repository: ${response.statusText}`);\n      }\n\n      return await response.blob();\n\n    } catch (error) {\n      console.error('Errore download repository:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Cerca repository pubblici\n   * @param {string} query - Query di ricerca\n   * @param {Object} options - Opzioni di ricerca\n   * @returns {Promise<Object>} Risultati ricerca\n   */\n  async searchRepositories(query, options = {}) {\n    try {\n      const params = new URLSearchParams({\n        q: query,\n        sort: options.sort || 'stars',\n        order: options.order || 'desc',\n        per_page: options.perPage || 20,\n        page: options.page || 1\n      });\n\n      const endpoint = `/search/repositories?${params.toString()}`;\n      const response = await this.makeRequest(endpoint);\n\n      if (!response.ok) {\n        throw new Error(`Errore ricerca: ${response.statusText}`);\n      }\n\n      return await response.json();\n\n    } catch (error) {\n      console.error('Errore ricerca repository:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * GIST MANAGEMENT per sincronizzazione\n   */\n\n  /**\n   * Crea un nuovo Gist\n   * @param {Object} gistData - Dati del Gist\n   * @returns {Promise<Object>} Gist creato\n   */\n  async createGist(gistData) {\n    try {\n      const response = await this.makeRequest('/gists', {\n        method: 'POST',\n        headers: {\n          ...await this.getAuthHeaders(),\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          description: gistData.description || 'AIdeas Sync Data',\n          public: gistData.public || false,\n          files: gistData.files\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Errore creazione Gist: ${response.statusText}`);\n      }\n\n      const gist = await response.json();\n      console.log(' Gist creato:', gist.id);\n      return gist;\n\n    } catch (error) {\n      console.error('Errore creazione Gist:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Aggiorna un Gist esistente\n   * @param {string} gistId - ID del Gist\n   * @param {Object} gistData - Nuovi dati del Gist\n   * @returns {Promise<Object>} Gist aggiornato\n   */\n  async updateGist(gistId, gistData) {\n    try {\n      const response = await this.makeRequest(`/gists/${gistId}`, {\n        method: 'PATCH',\n        headers: {\n          ...await this.getAuthHeaders(),\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          description: gistData.description,\n          files: gistData.files\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Errore aggiornamento Gist: ${response.statusText}`);\n      }\n\n      const gist = await response.json();\n      console.log(' Gist aggiornato:', gist.id);\n      return gist;\n\n    } catch (error) {\n      console.error('Errore aggiornamento Gist:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Ottiene un Gist\n   * @param {string} gistId - ID del Gist\n   * @returns {Promise<Object>} Dati del Gist\n   */\n  async getGist(gistId) {\n    try {\n      const cacheKey = `gist:${gistId}`;\n      const cached = this.getFromCache(cacheKey);\n      if (cached) return cached;\n\n      const response = await this.makeRequest(`/gists/${gistId}`, {\n        headers: await this.getAuthHeaders()\n      });\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          throw new Error('Gist non trovato');\n        }\n        throw new Error(`Errore recupero Gist: ${response.statusText}`);\n      }\n\n      const gist = await response.json();\n      this.setCache(cacheKey, gist, 60000); // Cache pi breve per Gist\n      \n      return gist;\n\n    } catch (error) {\n      console.error('Errore recupero Gist:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Elimina un Gist\n   * @param {string} gistId - ID del Gist\n   * @returns {Promise<boolean>} Successo operazione\n   */\n  async deleteGist(gistId) {\n    try {\n      const response = await this.makeRequest(`/gists/${gistId}`, {\n        method: 'DELETE',\n        headers: await this.getAuthHeaders()\n      });\n\n      if (!response.ok) {\n        throw new Error(`Errore eliminazione Gist: ${response.statusText}`);\n      }\n\n      console.log(' Gist eliminato:', gistId);\n      return true;\n\n    } catch (error) {\n      console.error('Errore eliminazione Gist:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Lista i Gist dell'utente\n   * @param {Object} options - Opzioni di listaggio\n   * @returns {Promise<Array>} Lista Gist\n   */\n  async listGists(options = {}) {\n    try {\n      const params = new URLSearchParams({\n        per_page: options.perPage || 30,\n        page: options.page || 1\n      });\n\n      const endpoint = `/gists?${params.toString()}`;\n      const response = await this.makeRequest(endpoint, {\n        headers: await this.getAuthHeaders()\n      });\n\n      if (!response.ok) {\n        throw new Error(`Errore lista Gist: ${response.statusText}`);\n      }\n\n      return await response.json();\n\n    } catch (error) {\n      console.error('Errore lista Gist:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * UTILITY METHODS\n   */\n\n  /**\n   * Parsa URL GitHub per estrarre owner e repo\n   * @param {string} url - URL GitHub\n   * @returns {Object|null} {owner, repo, branch}\n   */\n  parseGitHubUrl(url) {\n    // Pattern per repository normale\n    const repoMatch = url.match(REGEX_PATTERNS.GITHUB_URL);\n    if (repoMatch) {\n      return {\n        owner: repoMatch[1],\n        repo: repoMatch[2].replace('.git', ''),\n        branch: 'main'\n      };\n    }\n\n    // Pattern per GitHub Pages\n    const pagesMatch = url.match(REGEX_PATTERNS.GITHUB_PAGES);\n    if (pagesMatch) {\n      return {\n        owner: pagesMatch[1],\n        repo: pagesMatch[2],\n        branch: 'gh-pages',\n        isPages: true\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * Verifica se un repository ha GitHub Pages attivo\n   * @param {string} owner - Proprietario del repo\n   * @param {string} repo - Nome del repository\n   * @returns {Promise<Object|null>} Info Pages se attivo\n   */\n  async getGitHubPages(owner, repo) {\n    try {\n      const endpoint = `/repos/${owner}/${repo}/pages`;\n      const response = await this.makeRequest(endpoint, {\n        headers: await this.getAuthHeaders()\n      });\n\n      if (!response.ok) {\n        return null; // Pages non attivo\n      }\n\n      return await response.json();\n\n    } catch (error) {\n      return null;\n    }\n  }\n\n  /**\n   * Ottiene le release del repository\n   * @param {string} owner - Proprietario del repo\n   * @param {string} repo - Nome del repository\n   * @returns {Promise<Array>} Lista release\n   */\n  async getReleases(owner, repo) {\n    try {\n      const endpoint = `/repos/${owner}/${repo}/releases`;\n      const response = await this.makeRequest(endpoint);\n\n      if (!response.ok) {\n        throw new Error(`Errore recupero release: ${response.statusText}`);\n      }\n\n      return await response.json();\n\n    } catch (error) {\n      console.error('Errore recupero release:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * PRIVATE METHODS\n   */\n\n  /**\n   * Effettua richiesta HTTP con gestione rate limit\n   * @param {string} endpoint - Endpoint API\n   * @param {Object} options - Opzioni fetch\n   * @returns {Promise<Response>} Response\n   */\n  async makeRequest(endpoint, options = {}) {\n    const url = endpoint.startsWith('http') ? endpoint : `${this.baseUrl}${endpoint}`;\n    \n    // Controllo rate limit\n    if (this.rateLimitRemaining <= 10) {\n      const resetTime = new Date(this.rateLimitReset * 1000);\n      const waitTime = resetTime - new Date();\n      \n      if (waitTime > 0) {\n        console.warn(` Rate limit GitHub, attesa ${Math.ceil(waitTime / 1000)}s`);\n        await new Promise(resolve => setTimeout(resolve, waitTime));\n      }\n    }\n\n    const response = await fetch(url, {\n      ...options,\n      headers: {\n        'User-Agent': 'AIdeas-App/1.0.0',\n        ...options.headers\n      }\n    });\n\n    // Aggiorna info rate limit\n    this.updateRateLimit(response);\n\n    return response;\n  }\n\n  /**\n   * Aggiorna informazioni rate limit\n   * @param {Response} response - Response della richiesta\n   */\n  updateRateLimit(response) {\n    const remaining = response.headers.get('X-RateLimit-Remaining');\n    const reset = response.headers.get('X-RateLimit-Reset');\n    \n    if (remaining) this.rateLimitRemaining = parseInt(remaining);\n    if (reset) this.rateLimitReset = parseInt(reset);\n\n    if (this.rateLimitRemaining <= 50) {\n      console.warn(` Rate limit GitHub basso: ${this.rateLimitRemaining} rimanenti`);\n    }\n  }\n\n  /**\n   * Ottiene headers di autenticazione\n   * @returns {Promise<Object>} Headers con token\n   */\n  async getAuthHeaders() {\n    const token = await this.getToken();\n    if (!token) {\n      throw new Error('Token GitHub non trovato');\n    }\n\n    return {\n      'Authorization': `token ${token}`,\n      'Accept': 'application/vnd.github.v3+json'\n    };\n  }\n\n  /**\n   * Salva token in modo sicuro\n   * @param {string} token - GitHub token\n   */\n  async saveToken(token) {\n    // In produzione, usa un sistema pi sicuro\n    const encrypted = btoa(token); // Crittografia base64 semplice\n    localStorage.setItem('aideas_github_token', encrypted);\n  }\n\n  /**\n   * Recupera token salvato\n   * @returns {Promise<string|null>} Token se presente\n   */\n  async getToken() {\n    const encrypted = localStorage.getItem('aideas_github_token');\n    if (!encrypted) return null;\n\n    try {\n      return atob(encrypted);\n    } catch (error) {\n      console.error('Errore decrittazione token:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Rimuove token salvato\n   */\n  async clearToken() {\n    localStorage.removeItem('aideas_github_token');\n  }\n\n  /**\n   * CACHE MANAGEMENT\n   */\n\n  /**\n   * Ottiene valore dalla cache\n   * @param {string} key - Chiave cache\n   * @returns {*} Valore cached o null\n   */\n  getFromCache(key) {\n    const cached = this.cache.get(key);\n    if (!cached) return null;\n\n    if (Date.now() - cached.timestamp > this.cacheTimeout) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return cached.data;\n  }\n\n  /**\n   * Salva valore in cache\n   * @param {string} key - Chiave cache\n   * @param {*} data - Dati da cachare\n   * @param {number} timeout - Timeout custom (opzionale)\n   */\n  setCache(key, data, timeout = null) {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now(),\n      timeout: timeout || this.cacheTimeout\n    });\n  }\n\n  /**\n   * Pulisce cache\n   */\n  clearCache() {\n    this.cache.clear();\n  }\n\n  /**\n   * SYNC INTEGRATION\n   */\n\n  /**\n   * Upload dati di sync su Gist\n   * @param {Object} syncData - Dati da sincronizzare\n   * @param {string} gistId - ID Gist esistente (opzionale)\n   * @returns {Promise<Object>} Risultato operazione\n   */\n  async uploadSyncData(syncData, gistId = null) {\n    try {\n      const gistContent = {\n        description: 'AIdeas Sync Data',\n        public: false,\n        files: {\n          'aideas-sync.json': {\n            content: JSON.stringify(syncData, null, 2)\n          },\n          'aideas-meta.json': {\n            content: JSON.stringify({\n              version: '1.0.0',\n              timestamp: new Date().toISOString(),\n              device: navigator.userAgent,\n              checksum: await this.generateChecksum(syncData)\n            }, null, 2)\n          }\n        }\n      };\n\n      let result;\n      if (gistId) {\n        result = await this.updateGist(gistId, gistContent);\n      } else {\n        result = await this.createGist(gistContent);\n      }\n\n      return {\n        success: true,\n        gistId: result.id,\n        url: result.html_url,\n        size: JSON.stringify(syncData).length\n      };\n\n    } catch (error) {\n      console.error('Errore upload sync data:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Download dati di sync da Gist\n   * @param {string} gistId - ID del Gist\n   * @returns {Promise<Object>} Dati scaricati\n   */\n  async downloadSyncData(gistId) {\n    try {\n      const gist = await this.getGist(gistId);\n      \n      const syncFile = gist.files['aideas-sync.json'];\n      const metaFile = gist.files['aideas-meta.json'];\n\n      if (!syncFile) {\n        throw new Error('File sync non trovato nel Gist');\n      }\n\n      const syncData = JSON.parse(syncFile.content);\n      let metadata = null;\n\n      if (metaFile) {\n        metadata = JSON.parse(metaFile.content);\n        \n        // Verifica checksum\n        const currentChecksum = await this.generateChecksum(syncData);\n        if (metadata.checksum && metadata.checksum !== currentChecksum) {\n          console.warn(' Checksum sync data non corrisponde');\n        }\n      }\n\n      return {\n        success: true,\n        data: syncData,\n        metadata,\n        gistInfo: {\n          id: gist.id,\n          url: gist.html_url,\n          updatedAt: gist.updated_at\n        }\n      };\n\n    } catch (error) {\n      console.error('Errore download sync data:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Genera checksum per validazione dati\n   * @param {Object} data - Dati da verificare\n   * @returns {Promise<string>} Checksum\n   */\n  async generateChecksum(data) {\n    const text = JSON.stringify(data);\n    const encoder = new TextEncoder();\n    const dataBuffer = encoder.encode(text);\n    const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n  }\n\n  /**\n   * Ottiene statistiche rate limit\n   * @returns {Object} Info rate limit\n   */\n  getRateLimitInfo() {\n    return {\n      remaining: this.rateLimitRemaining,\n      reset: this.rateLimitReset ? new Date(this.rateLimitReset * 1000) : null,\n      authenticated: this.authenticated\n    };\n  }\n\n  /**\n   * Testa connessione e autenticazione\n   * @returns {Promise<Object>} Risultato test\n   */\n  async testConnection() {\n    try {\n      if (!await this.isAuthenticated()) {\n        return {\n          success: false,\n          error: 'Non autenticato'\n        };\n      }\n\n      const endpoint = '/user';\n      const response = await this.makeRequest(endpoint, {\n        headers: await this.getAuthHeaders()\n      });\n\n      return {\n        success: response.ok,\n        user: response.ok ? await response.json() : null,\n        rateLimit: this.getRateLimitInfo()\n      };\n\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n}","/**\n * AIdeas - Google Drive Service\n * Gestione sincronizzazione con Google Drive\n */\n\nimport { API_ENDPOINTS } from '../utils/constants.js';\nimport { showToast, generateId } from '../utils/helpers.js';\n\n/**\n * Servizio per interazioni con Google Drive API\n */\nexport default class GoogleDriveService {\n  constructor() {\n    this.baseUrl = API_ENDPOINTS.GOOGLE.DRIVE;\n    this.authUrl = API_ENDPOINTS.GOOGLE.AUTH;\n    this.tokenUrl = API_ENDPOINTS.GOOGLE.TOKEN;\n    \n    this.clientId = null;\n    this.clientSecret = null;\n    this.redirectUri = window.location.origin + '/auth/google';\n    \n    this.authenticated = false;\n    this.accessToken = null;\n    this.refreshToken = null;\n    this.tokenExpiry = null;\n    this.userInfo = null;\n    \n    // Scopes necessari per AIdeas\n    this.scopes = [\n      'https://www.googleapis.com/auth/drive.file',\n      'https://www.googleapis.com/auth/drive.appdata',\n      'https://www.googleapis.com/auth/userinfo.profile'\n    ];\n\n    // Cache per ridurre chiamate API\n    this.cache = new Map();\n    this.cacheTimeout = 5 * 60 * 1000; // 5 minuti\n\n    // Cartella AIdeas su Drive\n    this.aideasFolder = null;\n  }\n\n  /**\n   * Configura credenziali OAuth2\n   * @param {string} clientId - Google Client ID\n   * @param {string} clientSecret - Google Client Secret (opzionale per PKCE)\n   */\n  configure(clientId, clientSecret = null) {\n    this.clientId = clientId;\n    this.clientSecret = clientSecret;\n  }\n\n  /**\n   * Inizia il processo di autenticazione OAuth2\n   * @param {boolean} usePopup - Usa popup invece di redirect\n   * @returns {Promise<Object>} Risultato autenticazione\n   */\n  async authenticate(usePopup = true) {\n    try {\n      if (!this.clientId) {\n        throw new Error('Client ID Google non configurato');\n      }\n\n      // Genera code verifier per PKCE\n      const codeVerifier = this.generateCodeVerifier();\n      const codeChallenge = await this.generateCodeChallenge(codeVerifier);\n      \n      // Salva code verifier per dopo\n      sessionStorage.setItem('google_code_verifier', codeVerifier);\n\n      const authParams = new URLSearchParams({\n        client_id: this.clientId,\n        redirect_uri: this.redirectUri,\n        scope: this.scopes.join(' '),\n        response_type: 'code',\n        access_type: 'offline',\n        prompt: 'consent',\n        code_challenge: codeChallenge,\n        code_challenge_method: 'S256',\n        state: generateId('auth')\n      });\n\n      const authUrl = `${this.authUrl}?${authParams.toString()}`;\n\n      if (usePopup) {\n        return await this.authenticateWithPopup(authUrl);\n      } else {\n        // Redirect diretto\n        window.location.href = authUrl;\n        return { pending: true };\n      }\n\n    } catch (error) {\n      console.error('Errore autenticazione Google:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Autenticazione tramite popup\n   * @param {string} authUrl - URL di autenticazione\n   * @returns {Promise<Object>} Risultato autenticazione\n   */\n  async authenticateWithPopup(authUrl) {\n    return new Promise((resolve, reject) => {\n      const popup = window.open(\n        authUrl,\n        'google-auth',\n        'width=500,height=600,scrollbars=yes,resizable=yes'\n      );\n\n      if (!popup) {\n        reject(new Error('Popup bloccato dal browser'));\n        return;\n      }\n\n      // Polling per verificare completamento auth\n      const checkClosed = setInterval(() => {\n        if (popup.closed) {\n          clearInterval(checkClosed);\n          reject(new Error('Autenticazione annullata'));\n        }\n      }, 1000);\n\n      // Listener per messaggi dal popup\n      const messageHandler = async (event) => {\n        if (event.origin !== window.location.origin) return;\n\n        if (event.data.type === 'GOOGLE_AUTH_SUCCESS') {\n          clearInterval(checkClosed);\n          popup.close();\n          window.removeEventListener('message', messageHandler);\n\n          try {\n            const result = await this.handleAuthCallback(event.data.code, event.data.state);\n            resolve(result);\n          } catch (error) {\n            reject(error);\n          }\n        } else if (event.data.type === 'GOOGLE_AUTH_ERROR') {\n          clearInterval(checkClosed);\n          popup.close();\n          window.removeEventListener('message', messageHandler);\n          reject(new Error(event.data.error));\n        }\n      };\n\n      window.addEventListener('message', messageHandler);\n    });\n  }\n\n  /**\n   * Gestisce il callback di autenticazione\n   * @param {string} code - Authorization code\n   * @param {string} state - State parameter\n   * @returns {Promise<Object>} Token e user info\n   */\n  async handleAuthCallback(code, state) {\n    try {\n      const codeVerifier = sessionStorage.getItem('google_code_verifier');\n      if (!codeVerifier) {\n        throw new Error('Code verifier non trovato');\n      }\n\n      // Scambia authorization code con access token\n      const tokenData = await this.exchangeCodeForToken(code, codeVerifier);\n      \n      // Salva token\n      this.accessToken = tokenData.access_token;\n      this.refreshToken = tokenData.refresh_token;\n      this.tokenExpiry = new Date(Date.now() + (tokenData.expires_in * 1000));\n      this.authenticated = true;\n\n      // Ottieni info utente\n      this.userInfo = await this.getUserInfo();\n\n      // Salva credenziali\n      await this.saveCredentials();\n\n      // Inizializza cartella AIdeas\n      await this.initializeAIdeasFolder();\n\n      console.log(' Google Drive autenticato:', this.userInfo.name);\n      \n      // Pulisce storage temporaneo\n      sessionStorage.removeItem('google_code_verifier');\n\n      return {\n        success: true,\n        user: this.userInfo,\n        tokens: {\n          access_token: this.accessToken,\n          expires_at: this.tokenExpiry\n        }\n      };\n\n    } catch (error) {\n      console.error('Errore callback auth:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Scambia authorization code con token\n   * @param {string} code - Authorization code\n   * @param {string} codeVerifier - PKCE code verifier\n   * @returns {Promise<Object>} Token data\n   */\n  async exchangeCodeForToken(code, codeVerifier) {\n    const tokenParams = {\n      client_id: this.clientId,\n      code: code,\n      code_verifier: codeVerifier,\n      grant_type: 'authorization_code',\n      redirect_uri: this.redirectUri\n    };\n\n    // Aggiungi client secret se disponibile\n    if (this.clientSecret) {\n      tokenParams.client_secret = this.clientSecret;\n    }\n\n    const response = await fetch(this.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      },\n      body: new URLSearchParams(tokenParams)\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(`Token exchange failed: ${error.error_description || error.error}`);\n    }\n\n    return await response.json();\n  }\n\n  /**\n   * Refresh access token usando refresh token\n   * @returns {Promise<Object>} Nuovo access token\n   */\n  async refreshAccessToken() {\n    try {\n      if (!this.refreshToken) {\n        throw new Error('Refresh token non disponibile');\n      }\n\n      const tokenParams = {\n        client_id: this.clientId,\n        refresh_token: this.refreshToken,\n        grant_type: 'refresh_token'\n      };\n\n      if (this.clientSecret) {\n        tokenParams.client_secret = this.clientSecret;\n      }\n\n      const response = await fetch(this.tokenUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: new URLSearchParams(tokenParams)\n      });\n\n      if (!response.ok) {\n        throw new Error('Token refresh failed');\n      }\n\n      const tokenData = await response.json();\n      \n      this.accessToken = tokenData.access_token;\n      this.tokenExpiry = new Date(Date.now() + (tokenData.expires_in * 1000));\n      \n      // Aggiorna refresh token se fornito\n      if (tokenData.refresh_token) {\n        this.refreshToken = tokenData.refresh_token;\n      }\n\n      await this.saveCredentials();\n      \n      return tokenData;\n\n    } catch (error) {\n      console.error('Errore refresh token:', error);\n      this.authenticated = false;\n      throw error;\n    }\n  }\n\n  /**\n   * Verifica e assicura che il token sia valido\n   * @returns {Promise<boolean>} Token valido\n   */\n  async ensureValidToken() {\n    if (!this.accessToken) {\n      return false;\n    }\n\n    // Controlla se il token  scaduto (con margine di 5 minuti)\n    if (this.tokenExpiry && Date.now() >= (this.tokenExpiry.getTime() - 300000)) {\n      try {\n        await this.refreshAccessToken();\n      } catch (error) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Ottiene informazioni sull'utente autenticato\n   * @returns {Promise<Object>} Info utente\n   */\n  async getUserInfo() {\n    try {\n      const response = await this.makeRequest(\n        'https://www.googleapis.com/oauth2/v2/userinfo'\n      );\n\n      if (!response.ok) {\n        throw new Error('Errore recupero info utente');\n      }\n\n      return await response.json();\n\n    } catch (error) {\n      console.error('Errore info utente:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Verifica se l'utente  autenticato\n   * @returns {Promise<boolean>} Stato autenticazione\n   */\n  async isAuthenticated() {\n    if (this.authenticated && await this.ensureValidToken()) {\n      return true;\n    }\n\n    try {\n      // Prova a caricare credenziali salvate\n      const loaded = await this.loadCredentials();\n      if (loaded && await this.ensureValidToken()) {\n        this.authenticated = true;\n        return true;\n      }\n    } catch (error) {\n      console.error('Errore verifica autenticazione:', error);\n    }\n\n    return false;\n  }\n\n  /**\n   * Effettua logout\n   */\n  async logout() {\n    this.authenticated = false;\n    this.accessToken = null;\n    this.refreshToken = null;\n    this.tokenExpiry = null;\n    this.userInfo = null;\n    this.aideasFolder = null;\n    \n    await this.clearCredentials();\n    this.cache.clear();\n  }\n\n  /**\n   * DRIVE FILE OPERATIONS\n   */\n\n  /**\n   * Inizializza cartella AIdeas su Drive\n   * @returns {Promise<Object>} Info cartella\n   */\n  async initializeAIdeasFolder() {\n    try {\n      // Cerca cartella AIdeas esistente\n      const existing = await this.findAIdeasFolder();\n      if (existing) {\n        this.aideasFolder = existing;\n        return existing;\n      }\n\n      // Crea nuova cartella AIdeas\n      const folder = await this.createFolder('AIdeas', null, {\n        description: 'AIdeas App Data - Swiss Army Knife by AI'\n      });\n\n      this.aideasFolder = folder;\n      return folder;\n\n    } catch (error) {\n      console.error('Errore inizializzazione cartella AIdeas:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Cerca cartella AIdeas esistente\n   * @returns {Promise<Object|null>} Cartella se trovata\n   */\n  async findAIdeasFolder() {\n    try {\n      const query = 'name=\\'AIdeas\\' and mimeType=\\'application/vnd.google-apps.folder\\' and trashed=false';\n      const response = await this.makeRequest(`/files?q=${encodeURIComponent(query)}`);\n\n      if (!response.ok) {\n        throw new Error('Errore ricerca cartella AIdeas');\n      }\n\n      const data = await response.json();\n      return data.files.length > 0 ? data.files[0] : null;\n\n    } catch (error) {\n      console.error('Errore ricerca cartella:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Crea una cartella su Drive\n   * @param {string} name - Nome cartella\n   * @param {string} parentId - ID cartella parent (null per root)\n   * @param {Object} metadata - Metadati aggiuntivi\n   * @returns {Promise<Object>} Cartella creata\n   */\n  async createFolder(name, parentId = null, metadata = {}) {\n    try {\n      const folderMetadata = {\n        name,\n        mimeType: 'application/vnd.google-apps.folder',\n        ...metadata\n      };\n\n      if (parentId) {\n        folderMetadata.parents = [parentId];\n      }\n\n      const response = await this.makeRequest('/files', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(folderMetadata)\n      });\n\n      if (!response.ok) {\n        throw new Error('Errore creazione cartella');\n      }\n\n      const folder = await response.json();\n      console.log(' Cartella creata:', folder.name);\n      return folder;\n\n    } catch (error) {\n      console.error('Errore creazione cartella:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Carica un file su Drive\n   * @param {string} filename - Nome file\n   * @param {string|Blob} content - Contenuto file\n   * @param {string} mimeType - MIME type\n   * @param {string} parentId - ID cartella parent\n   * @param {Object} metadata - Metadati aggiuntivi\n   * @returns {Promise<Object>} File caricato\n   */\n  async uploadFile(filename, content, mimeType, parentId = null, metadata = {}) {\n    try {\n      const fileMetadata = {\n        name: filename,\n        ...metadata\n      };\n\n      if (parentId) {\n        fileMetadata.parents = [parentId];\n      }\n\n      // Prepare multipart upload\n      const delimiter = '-------314159265358979323846';\n      const close_delim = `\\r\\n--${delimiter}--`;\n\n      let body = `--${delimiter}\\r\\n`;\n      body += 'Content-Type: application/json\\r\\n\\r\\n';\n      body += JSON.stringify(fileMetadata) + '\\r\\n';\n      body += `--${delimiter}\\r\\n`;\n      body += `Content-Type: ${mimeType}\\r\\n\\r\\n`;\n\n      if (typeof content === 'string') {\n        body += content;\n      } else {\n        // Per Blob, usa FormData approach diverso\n        return await this.uploadFileBlob(filename, content, mimeType, parentId, metadata);\n      }\n\n      body += close_delim;\n\n      const response = await this.makeRequest('/upload/files?uploadType=multipart', {\n        method: 'POST',\n        headers: {\n          'Content-Type': `multipart/related; boundary=\"${delimiter}\"`\n        },\n        body: body\n      });\n\n      if (!response.ok) {\n        throw new Error('Errore upload file');\n      }\n\n      const file = await response.json();\n      console.log(' File caricato:', file.name);\n      return file;\n\n    } catch (error) {\n      console.error('Errore upload file:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Carica un file Blob su Drive\n   * @param {string} filename - Nome file\n   * @param {Blob} blob - Contenuto blob\n   * @param {string} mimeType - MIME type\n   * @param {string} parentId - ID cartella parent\n   * @param {Object} metadata - Metadati aggiuntivi\n   * @returns {Promise<Object>} File caricato\n   */\n  async uploadFileBlob(filename, blob, mimeType, parentId = null, metadata = {}) {\n    try {\n      const fileMetadata = {\n        name: filename,\n        ...metadata\n      };\n\n      if (parentId) {\n        fileMetadata.parents = [parentId];\n      }\n\n      // Prima crea il file con metadati\n      const metadataResponse = await this.makeRequest('/files', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(fileMetadata)\n      });\n\n      if (!metadataResponse.ok) {\n        throw new Error('Errore creazione metadati file');\n      }\n\n      const file = await metadataResponse.json();\n\n      // Poi carica il contenuto\n      const uploadResponse = await this.makeRequest(`/upload/files/${file.id}?uploadType=media`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': mimeType\n        },\n        body: blob\n      });\n\n      if (!uploadResponse.ok) {\n        throw new Error('Errore upload contenuto file');\n      }\n\n      const updatedFile = await uploadResponse.json();\n      console.log(' File blob caricato:', updatedFile.name);\n      return updatedFile;\n\n    } catch (error) {\n      console.error('Errore upload blob:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Scarica un file da Drive\n   * @param {string} fileId - ID del file\n   * @returns {Promise<Blob>} Contenuto file\n   */\n  async downloadFile(fileId) {\n    try {\n      const response = await this.makeRequest(`/files/${fileId}?alt=media`);\n\n      if (!response.ok) {\n        throw new Error('Errore download file');\n      }\n\n      return await response.blob();\n\n    } catch (error) {\n      console.error('Errore download file:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Ottiene metadati di un file\n   * @param {string} fileId - ID del file\n   * @param {string} fields - Campi da includere\n   * @returns {Promise<Object>} Metadati file\n   */\n  async getFileMetadata(fileId, fields = 'id,name,mimeType,size,modifiedTime,parents') {\n    try {\n      const response = await this.makeRequest(`/files/${fileId}?fields=${fields}`);\n\n      if (!response.ok) {\n        throw new Error('Errore recupero metadati file');\n      }\n\n      return await response.json();\n\n    } catch (error) {\n      console.error('Errore metadati file:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Lista file in una cartella\n   * @param {string} folderId - ID cartella (null per root)\n   * @param {Object} options - Opzioni di ricerca\n   * @returns {Promise<Array>} Lista file\n   */\n  async listFiles(folderId = null, options = {}) {\n    try {\n      let query = 'trashed=false';\n      \n      if (folderId) {\n        query += ` and '${folderId}' in parents`;\n      }\n\n      if (options.mimeType) {\n        query += ` and mimeType='${options.mimeType}'`;\n      }\n\n      if (options.nameContains) {\n        query += ` and name contains '${options.nameContains}'`;\n      }\n\n      const params = new URLSearchParams({\n        q: query,\n        fields: options.fields || 'files(id,name,mimeType,size,modifiedTime)',\n        pageSize: options.pageSize || 100\n      });\n\n      if (options.orderBy) {\n        params.set('orderBy', options.orderBy);\n      }\n\n      const response = await this.makeRequest(`/files?${params.toString()}`);\n\n      if (!response.ok) {\n        throw new Error('Errore lista file');\n      }\n\n      const data = await response.json();\n      return data.files || [];\n\n    } catch (error) {\n      console.error('Errore lista file:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Elimina un file\n   * @param {string} fileId - ID del file\n   * @returns {Promise<boolean>} Successo operazione\n   */\n  async deleteFile(fileId) {\n    try {\n      const response = await this.makeRequest(`/files/${fileId}`, {\n        method: 'DELETE'\n      });\n\n      if (!response.ok) {\n        throw new Error('Errore eliminazione file');\n      }\n\n      console.log(' File eliminato:', fileId);\n      return true;\n\n    } catch (error) {\n      console.error('Errore eliminazione file:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * SYNC INTEGRATION\n   */\n\n  /**\n   * Upload dati di sync su Google Drive\n   * @param {Object} syncData - Dati da sincronizzare\n   * @returns {Promise<Object>} Risultato operazione\n   */\n  async uploadSyncData(syncData) {\n    try {\n      if (!this.aideasFolder) {\n        await this.initializeAIdeasFolder();\n      }\n\n      const syncContent = JSON.stringify(syncData, null, 2);\n      const metadata = {\n        version: '1.0.0',\n        timestamp: new Date().toISOString(),\n        device: navigator.userAgent,\n        checksum: await this.generateChecksum(syncData)\n      };\n\n      // Upload file sync principale\n      const syncFile = await this.uploadFile(\n        'aideas-sync.json',\n        syncContent,\n        'application/json',\n        this.aideasFolder.id,\n        {\n          description: 'AIdeas Sync Data - Apps and Settings'\n        }\n      );\n\n      // Upload metadati\n      const metaFile = await this.uploadFile(\n        'aideas-meta.json',\n        JSON.stringify(metadata, null, 2),\n        'application/json',\n        this.aideasFolder.id,\n        {\n          description: 'AIdeas Sync Metadata'\n        }\n      );\n\n      return {\n        success: true,\n        syncFile: {\n          id: syncFile.id,\n          name: syncFile.name,\n          size: syncContent.length\n        },\n        metaFile: {\n          id: metaFile.id,\n          name: metaFile.name\n        },\n        metadata\n      };\n\n    } catch (error) {\n      console.error('Errore upload sync data:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Download dati di sync da Google Drive\n   * @returns {Promise<Object>} Dati scaricati\n   */\n  async downloadSyncData() {\n    try {\n      if (!this.aideasFolder) {\n        await this.initializeAIdeasFolder();\n      }\n\n      // Cerca file sync\n      const syncFiles = await this.listFiles(this.aideasFolder.id, {\n        nameContains: 'aideas-sync.json'\n      });\n\n      if (syncFiles.length === 0) {\n        throw new Error('File sync non trovato');\n      }\n\n      const syncFile = syncFiles[0];\n      \n      // Scarica contenuto sync\n      const syncBlob = await this.downloadFile(syncFile.id);\n      const syncContent = await syncBlob.text();\n      const syncData = JSON.parse(syncContent);\n\n      // Prova a scaricare metadati\n      let metadata = null;\n      try {\n        const metaFiles = await this.listFiles(this.aideasFolder.id, {\n          nameContains: 'aideas-meta.json'\n        });\n\n        if (metaFiles.length > 0) {\n          const metaBlob = await this.downloadFile(metaFiles[0].id);\n          const metaContent = await metaBlob.text();\n          metadata = JSON.parse(metaContent);\n\n          // Verifica checksum\n          const currentChecksum = await this.generateChecksum(syncData);\n          if (metadata.checksum && metadata.checksum !== currentChecksum) {\n            console.warn(' Checksum sync data non corrisponde');\n          }\n        }\n      } catch (metaError) {\n        console.warn('Warning: impossibile caricare metadati sync');\n      }\n\n      return {\n        success: true,\n        data: syncData,\n        metadata,\n        fileInfo: {\n          id: syncFile.id,\n          name: syncFile.name,\n          size: syncFile.size,\n          modifiedTime: syncFile.modifiedTime\n        }\n      };\n\n    } catch (error) {\n      console.error('Errore download sync data:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * UTILITY METHODS\n   */\n\n  /**\n   * Effettua richiesta HTTP con gestione token\n   * @param {string} endpoint - Endpoint API\n   * @param {Object} options - Opzioni fetch\n   * @returns {Promise<Response>} Response\n   */\n  async makeRequest(endpoint, options = {}) {\n    if (!await this.ensureValidToken()) {\n      throw new Error('Token non valido, riautenticarsi');\n    }\n\n    const url = endpoint.startsWith('http') ? endpoint : `${this.baseUrl}${endpoint}`;\n    \n    const response = await fetch(url, {\n      ...options,\n      headers: {\n        'Authorization': `Bearer ${this.accessToken}`,\n        ...options.headers\n      }\n    });\n\n    return response;\n  }\n\n  /**\n   * Genera code verifier per PKCE\n   * @returns {string} Code verifier\n   */\n  generateCodeVerifier() {\n    const array = new Uint8Array(32);\n    crypto.getRandomValues(array);\n    return this.base64URLEncode(array);\n  }\n\n  /**\n   * Genera code challenge da verifier\n   * @param {string} codeVerifier - Code verifier\n   * @returns {Promise<string>} Code challenge\n   */\n  async generateCodeChallenge(codeVerifier) {\n    const encoder = new TextEncoder();\n    const data = encoder.encode(codeVerifier);\n    const digest = await crypto.subtle.digest('SHA-256', data);\n    return this.base64URLEncode(new Uint8Array(digest));\n  }\n\n  /**\n   * Encode base64 URL-safe\n   * @param {Uint8Array} buffer - Buffer da encodare\n   * @returns {string} String base64 URL-safe\n   */\n  base64URLEncode(buffer) {\n    const base64 = btoa(String.fromCharCode(...buffer));\n    return base64.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\n  }\n\n  /**\n   * Genera checksum per validazione dati\n   * @param {Object} data - Dati da verificare\n   * @returns {Promise<string>} Checksum\n   */\n  async generateChecksum(data) {\n    const text = JSON.stringify(data);\n    const encoder = new TextEncoder();\n    const dataBuffer = encoder.encode(text);\n    const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n  }\n\n  /**\n   * Salva credenziali in modo sicuro\n   */\n  async saveCredentials() {\n    const credentials = {\n      accessToken: this.accessToken,\n      refreshToken: this.refreshToken,\n      tokenExpiry: this.tokenExpiry?.toISOString(),\n      userInfo: this.userInfo\n    };\n\n    // In produzione, usa crittografia pi robusta\n    const encrypted = btoa(JSON.stringify(credentials));\n    localStorage.setItem('aideas_googledrive_creds', encrypted);\n  }\n\n  /**\n   * Carica credenziali salvate\n   * @returns {Promise<boolean>} Successo caricamento\n   */\n  async loadCredentials() {\n    try {\n      const encrypted = localStorage.getItem('aideas_googledrive_creds');\n      if (!encrypted) return false;\n\n      const credentials = JSON.parse(atob(encrypted));\n      \n      this.accessToken = credentials.accessToken;\n      this.refreshToken = credentials.refreshToken;\n      this.tokenExpiry = credentials.tokenExpiry ? new Date(credentials.tokenExpiry) : null;\n      this.userInfo = credentials.userInfo;\n\n      return true;\n\n    } catch (error) {\n      console.error('Errore caricamento credenziali:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Rimuove credenziali salvate\n   */\n  async clearCredentials() {\n    localStorage.removeItem('aideas_googledrive_creds');\n  }\n\n  /**\n   * Testa connessione e autenticazione\n   * @returns {Promise<Object>} Risultato test\n   */\n  async testConnection() {\n    try {\n      if (!await this.isAuthenticated()) {\n        return {\n          success: false,\n          error: 'Non autenticato'\n        };\n      }\n\n      const userInfo = await this.getUserInfo();\n      \n      return {\n        success: true,\n        user: userInfo,\n        quotaInfo: await this.getStorageQuota()\n      };\n\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Ottiene informazioni quota storage\n   * @returns {Promise<Object>} Info quota\n   */\n  async getStorageQuota() {\n    try {\n      const response = await this.makeRequest('/about?fields=storageQuota');\n      \n      if (!response.ok) {\n        throw new Error('Errore recupero quota');\n      }\n\n      return await response.json();\n\n    } catch (error) {\n      console.error('Errore quota storage:', error);\n      return null;\n    }\n  }\n\n  /**\n   * CACHE MANAGEMENT\n   */\n\n  /**\n   * Ottiene valore dalla cache\n   * @param {string} key - Chiave cache\n   * @returns {*} Valore cached o null\n   */\n  getFromCache(key) {\n    const cached = this.cache.get(key);\n    if (!cached) return null;\n\n    if (Date.now() - cached.timestamp > this.cacheTimeout) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return cached.data;\n  }\n\n  /**\n   * Salva valore in cache\n   * @param {string} key - Chiave cache\n   * @param {*} data - Dati da cachare\n   */\n  setCache(key, data) {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now()\n    });\n  }\n\n  /**\n   * Pulisce cache\n   */\n  clearCache() {\n    this.cache.clear();\n  }\n}","/**\n * AIdeas - Sync Manager Component\n * Gestisce la sincronizzazione dei dati con servizi esterni\n */\n\nimport StorageService from '../services/StorageService.js';\nimport GitHubService from '../services/GitHubService.js';\nimport GoogleDriveService from '../services/GoogleDriveService.js';\nimport { showToast, showModal, hideModal, escapeHtml, generateId, getStringHash } from '../utils/helpers.js';\n\n/**\n * Classe per gestire la sincronizzazione cloud\n */\nexport default class SyncManager {\n  constructor() {\n    this.syncProviders = {\n      github: new GitHubService(),\n      googledrive: new GoogleDriveService()\n    };\n    \n    // Controllo di sicurezza sui provider\n    Object.entries(this.syncProviders).forEach(([key, provider]) => {\n      if (!provider) {\n        console.error(`[SyncManager] Provider '${key}' non istanziato correttamente!`);\n      } else {\n        console.log(`[SyncManager] Provider '${key}' istanziato:`, provider.constructor.name);\n      }\n    });\n    \n    this.syncStatus = {\n      isEnabled: false,\n      lastSync: null,\n      provider: 'github',\n      isInProgress: false,\n      autoSyncInterval: null\n    };\n\n    this.syncQueue = [];\n    this.conflictResolutions = [];\n\n    // Bind methods\n    this.init = this.init.bind(this);\n    this.enableSync = this.enableSync.bind(this);\n    this.disableSync = this.disableSync.bind(this);\n    this.performSync = this.performSync.bind(this);\n    this.showSyncModal = this.showSyncModal.bind(this);\n    this.handleConflict = this.handleConflict.bind(this);\n    this.autoSync = this.autoSync.bind(this);\n  }\n\n  /**\n   * Inizializza il sync manager\n   */\n  async init() {\n    console.log(' Inizializzazione SyncManager...');\n    \n    try {\n      // Carica configurazione sync\n      await this.loadSyncConfig();\n      \n      // Setup auto-sync se abilitato\n      if (this.syncStatus.isEnabled) {\n        await this.setupAutoSync();\n      }\n      \n      // Ascolta eventi di background sync\n      this.setupBackgroundSync();\n      \n    } catch (error) {\n      console.error('Errore inizializzazione SyncManager:', error);\n    }\n  }\n\n  /**\n   * Carica configurazione sync dal database\n   */\n  async loadSyncConfig() {\n    try {\n      this.syncStatus.isEnabled = await StorageService.getSetting('syncEnabled', false);\n      this.syncStatus.provider = await StorageService.getSetting('syncProvider', 'github');\n      this.syncStatus.lastSync = await StorageService.getSetting('lastSyncTime', null);\n      \n      const autoSyncInterval = await StorageService.getSetting('autoSyncInterval', 60);\n      this.syncStatus.autoSyncInterval = autoSyncInterval * 60 * 1000; // Converti in ms\n      \n    } catch (error) {\n      console.error('Errore caricamento configurazione sync:', error);\n    }\n  }\n\n  /**\n   * Abilita la sincronizzazione\n   */\n  async enableSync(provider = 'github', credentials = {}) {\n    try {\n      this.syncStatus.isEnabled = true;\n      this.syncStatus.provider = provider;\n      \n      // Testa la connessione\n      const syncProvider = this.syncProviders[provider];\n      const isConnected = await syncProvider.testConnection(credentials);\n      \n      if (!isConnected) {\n        throw new Error('Impossibile connettersi al provider di sincronizzazione');\n      }\n      \n      // Salva configurazione\n      await StorageService.setSetting('syncEnabled', true);\n      await StorageService.setSetting('syncProvider', provider);\n      \n      // Salva credenziali in modo sicuro\n      await this.saveCredentials(provider, credentials);\n      \n      // Setup auto-sync\n      await this.setupAutoSync();\n      \n      showToast('Sincronizzazione abilitata con successo', 'success');\n      \n    } catch (error) {\n      console.error('Errore abilitazione sync:', error);\n      showToast(`Errore: ${error.message}`, 'error');\n      this.syncStatus.isEnabled = false;\n    }\n  }\n\n  /**\n   * Disabilita la sincronizzazione\n   */\n  async disableSync() {\n    try {\n      this.syncStatus.isEnabled = false;\n      \n      // Ferma auto-sync\n      if (this.autoSyncTimer) {\n        clearInterval(this.autoSyncTimer);\n        this.autoSyncTimer = null;\n      }\n      \n      // Salva configurazione\n      await StorageService.setSetting('syncEnabled', false);\n      \n      // Rimuovi credenziali\n      await this.clearCredentials();\n      \n      showToast('Sincronizzazione disabilitata', 'info');\n      \n    } catch (error) {\n      console.error('Errore disabilitazione sync:', error);\n      showToast('Errore durante la disabilitazione della sincronizzazione', 'error');\n    }\n  }\n\n  /**\n   * Esegue sincronizzazione manuale\n   */\n  async performSync(direction = 'bidirectional') {\n    if (this.syncStatus.isInProgress) {\n      showToast('Sincronizzazione gi in corso', 'warning');\n      return;\n    }\n\n    if (!this.syncStatus.isEnabled) {\n      showToast('Sincronizzazione non abilitata', 'warning');\n      return;\n    }\n\n    try {\n      this.syncStatus.isInProgress = true;\n      this.updateSyncStatus('Sincronizzazione in corso...');\n\n      const provider = this.syncProviders[this.syncStatus.provider];\n      const credentials = await this.getCredentials(this.syncStatus.provider);\n\n      // Backup locale prima della sincronizzazione\n      const backupBeforeSync = await StorageService.getSetting('backupBeforeSync', true);\n      if (backupBeforeSync) {\n        await this.createBackup();\n      }\n\n      let result;\n      switch (direction) {\n      case 'upload':\n        result = await this.uploadToCloud(provider, credentials);\n        break;\n      case 'download':\n        result = await this.downloadFromCloud(provider, credentials);\n        break;\n      case 'bidirectional':\n      default:\n        result = await this.bidirectionalSync(provider, credentials);\n        break;\n      }\n\n      // Aggiorna ultimo sync\n      this.syncStatus.lastSync = new Date();\n      await StorageService.setSetting('lastSyncTime', this.syncStatus.lastSync.toISOString());\n\n      this.updateSyncStatus('Sincronizzazione completata');\n      showToast('Sincronizzazione completata con successo', 'success');\n\n      return result;\n\n    } catch (error) {\n      console.error('Errore durante la sincronizzazione:', error);\n      this.updateSyncStatus('Errore sincronizzazione');\n      showToast(`Errore sincronizzazione: ${error.message}`, 'error');\n      throw error;\n    } finally {\n      this.syncStatus.isInProgress = false;\n    }\n  }\n\n  /**\n   * Sincronizzazione bidirezionale con gestione conflitti\n   */\n  async bidirectionalSync(provider, credentials) {\n    try {\n      // 1. Ottieni dati locali\n      const localData = await this.getLocalData();\n      const localHash = await getStringHash(JSON.stringify(localData));\n\n      // 2. Ottieni dati remoti\n      const remoteData = await provider.download(credentials);\n      \n      if (!remoteData) {\n        // Primo sync - upload tutto\n        return await this.uploadToCloud(provider, credentials);\n      }\n\n      const remoteHash = await getStringHash(JSON.stringify(remoteData.data));\n\n      // 3. Confronta hash per rilevare modifiche\n      if (localHash === remoteHash) {\n        return { status: 'no_changes', message: 'Nessuna modifica da sincronizzare' };\n      }\n\n      // 4. Analizza modifiche e conflitti\n      const analysis = await this.analyzeChanges(localData, remoteData.data);\n      \n      if (analysis.conflicts.length > 0) {\n        // Gestisci conflitti\n        const resolutions = await this.resolveConflicts(analysis.conflicts);\n        analysis.resolutions = resolutions;\n      }\n\n      // 5. Applica modifiche\n      const mergedData = await this.mergeData(localData, remoteData.data, analysis);\n      \n      // 6. Salva localmente\n      await this.saveLocalData(mergedData);\n      \n      // 7. Upload versione merged\n      await provider.upload(credentials, {\n        data: mergedData,\n        timestamp: new Date().toISOString(),\n        version: '1.0.0',\n        device: await StorageService.getSetting('deviceId')\n      });\n\n      return {\n        status: 'success',\n        changes: analysis.changes,\n        conflicts: analysis.conflicts.length,\n        resolved: analysis.resolutions ? analysis.resolutions.length : 0\n      };\n\n    } catch (error) {\n      console.error('Errore sync bidirezionale:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Upload dati al cloud\n   */\n  async uploadToCloud(provider, credentials) {\n    try {\n      const localData = await this.getLocalData();\n      \n      const syncPackage = {\n        data: localData,\n        timestamp: new Date().toISOString(),\n        version: '1.0.0',\n        device: await StorageService.getSetting('deviceId'),\n        hash: await getStringHash(JSON.stringify(localData))\n      };\n\n      await provider.upload(credentials, syncPackage);\n      \n      return { status: 'uploaded', message: 'Dati caricati sul cloud' };\n      \n    } catch (error) {\n      console.error('Errore upload cloud:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Download dati dal cloud\n   */\n  async downloadFromCloud(provider, credentials) {\n    try {\n      const remoteData = await provider.download(credentials);\n      \n      if (!remoteData) {\n        throw new Error('Nessun dato trovato sul cloud');\n      }\n\n      // Valida dati remoti\n      if (!this.validateRemoteData(remoteData)) {\n        throw new Error('Dati remoti non validi');\n      }\n\n      // Salva localmente\n      await this.saveLocalData(remoteData.data);\n      \n      return { status: 'downloaded', message: 'Dati scaricati dal cloud' };\n      \n    } catch (error) {\n      console.error('Errore download cloud:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Analizza le modifiche tra locale e remoto\n   */\n  async analyzeChanges(localData, remoteData) {\n    const analysis = {\n      changes: {\n        apps: { added: [], modified: [], deleted: [] },\n        settings: { added: [], modified: [], deleted: [] }\n      },\n      conflicts: []\n    };\n\n    // Analizza app\n    const localApps = new Map(localData.apps.map(app => [app.id, app]));\n    const remoteApps = new Map(remoteData.apps.map(app => [app.id, app]));\n\n    // App aggiunte localmente\n    for (const [id, app] of localApps) {\n      if (!remoteApps.has(id)) {\n        analysis.changes.apps.added.push(app);\n      } else {\n        // Controlla modifiche\n        const remoteApp = remoteApps.get(id);\n        const localModified = new Date(app.lastUsed || app.installDate);\n        const remoteModified = new Date(remoteApp.lastUsed || remoteApp.installDate);\n        \n        if (localModified > remoteModified) {\n          analysis.changes.apps.modified.push({ local: app, remote: remoteApp, winner: 'local' });\n        } else if (remoteModified > localModified) {\n          analysis.changes.apps.modified.push({ local: app, remote: remoteApp, winner: 'remote' });\n        } else if (JSON.stringify(app) !== JSON.stringify(remoteApp)) {\n          // Conflitto: stesso timestamp ma contenuto diverso\n          analysis.conflicts.push({\n            type: 'app',\n            id: id,\n            local: app,\n            remote: remoteApp\n          });\n        }\n      }\n    }\n\n    // App aggiunte da remoto\n    for (const [id, app] of remoteApps) {\n      if (!localApps.has(id)) {\n        analysis.changes.apps.added.push(app);\n      }\n    }\n\n    // Analisi simile per settings...\n    \n    return analysis;\n  }\n\n  /**\n   * Risolve conflitti interattivamente\n   */\n  async resolveConflicts(conflicts) {\n    const resolutions = [];\n    \n    for (const conflict of conflicts) {\n      const resolution = await this.showConflictDialog(conflict);\n      resolutions.push(resolution);\n    }\n    \n    return resolutions;\n  }\n\n  /**\n   * Mostra dialog per risoluzione conflitto\n   */\n  async showConflictDialog(conflict) {\n    return new Promise((resolve) => {\n      const modalContent = `\n        <div class=\"modal-header\">\n          <h2> Conflitto di Sincronizzazione</h2>\n          <button class=\"modal-close\">&times;</button>\n        </div>\n        <div class=\"modal-body\">\n          <div class=\"conflict-info\">\n            <p> stato rilevato un conflitto per <strong>${conflict.type}</strong>:</p>\n            <p><strong>ID:</strong> ${conflict.id}</p>\n          </div>\n          \n          <div class=\"conflict-options\">\n            <div class=\"conflict-option\">\n              <h4>Versione Locale</h4>\n              <div class=\"conflict-data\">\n                <pre>${JSON.stringify(conflict.local, null, 2)}</pre>\n              </div>\n              <button class=\"btn btn-primary\" id=\"choose-local\">Usa Versione Locale</button>\n            </div>\n            \n            <div class=\"conflict-option\">\n              <h4>Versione Remota</h4>\n              <div class=\"conflict-data\">\n                <pre>${JSON.stringify(conflict.remote, null, 2)}</pre>\n              </div>\n              <button class=\"btn btn-primary\" id=\"choose-remote\">Usa Versione Remota</button>\n            </div>\n          </div>\n          \n          <div class=\"conflict-actions\">\n            <button class=\"btn btn-secondary\" id=\"skip-conflict\">Salta (mantieni locale)</button>\n          </div>\n        </div>\n      `;\n\n      const modal = showModal('conflict-modal', modalContent, { size: 'modal-xl' });\n\n      // Event listeners\n      modal.querySelector('#choose-local')?.addEventListener('click', () => {\n        hideModal('conflict-modal');\n        resolve({ action: 'use_local', data: conflict.local });\n      });\n\n      modal.querySelector('#choose-remote')?.addEventListener('click', () => {\n        hideModal('conflict-modal');\n        resolve({ action: 'use_remote', data: conflict.remote });\n      });\n\n      modal.querySelector('#skip-conflict')?.addEventListener('click', () => {\n        hideModal('conflict-modal');\n        resolve({ action: 'skip', data: conflict.local });\n      });\n    });\n  }\n\n  /**\n   * Unisce i dati con le risoluzioni dei conflitti\n   */\n  async mergeData(localData, remoteData, analysis) {\n    const mergedData = {\n      apps: [...localData.apps],\n      settings: [...localData.settings]\n    };\n\n    // Applica modifiche apps\n    for (const app of analysis.changes.apps.added) {\n      mergedData.apps.push(app);\n    }\n\n    for (const change of analysis.changes.apps.modified) {\n      const index = mergedData.apps.findIndex(a => a.id === change.local.id);\n      if (index !== -1) {\n        mergedData.apps[index] = change.winner === 'local' ? change.local : change.remote;\n      }\n    }\n\n    // Applica risoluzioni conflitti\n    if (analysis.resolutions) {\n      for (const resolution of analysis.resolutions) {\n        if (resolution.action === 'use_remote') {\n          const index = mergedData.apps.findIndex(a => a.id === resolution.data.id);\n          if (index !== -1) {\n            mergedData.apps[index] = resolution.data;\n          } else {\n            mergedData.apps.push(resolution.data);\n          }\n        }\n      }\n    }\n\n    return mergedData;\n  }\n\n  /**\n   * Mostra modal di gestione sync\n   */\n  showSyncModal() {\n    const modalContent = this.createSyncModal();\n    showModal('sync-modal', modalContent, {\n      size: 'modal-lg',\n      disableBackdropClose: false\n    });\n\n    setTimeout(() => {\n      this.setupSyncModalListeners();\n      this.updateSyncModalStatus();\n    }, 100);\n  }\n\n  /**\n   * Crea il contenuto del modal sync\n   */\n  createSyncModal() {\n    return `\n      <div class=\"modal-header\">\n        <h2>\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"header-icon\">\n            <path d=\"M12,18A6,6 0 0,1 6,12C6,11 6.25,10.03 6.7,9.2L5.24,7.74C4.46,8.97 4,10.43 4,12A8,8 0 0,0 12,20V23L16,19L12,15M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12C18,13 17.75,13.97 17.3,14.8L18.76,16.26C19.54,15.03 20,13.57 20,12A8,8 0 0,0 12,4Z\"/>\n          </svg>\n          Gestione Sincronizzazione\n        </h2>\n        <button class=\"modal-close\">&times;</button>\n      </div>\n      \n      <div class=\"modal-body\">\n        <!-- Sync Status -->\n        <div class=\"sync-status-card\">\n          <div class=\"sync-status-header\">\n            <h3>Stato Sincronizzazione</h3>\n            <div class=\"sync-status-indicator\" id=\"sync-status-indicator\">\n              <span class=\"status-dot\"></span>\n              <span class=\"status-text\" id=\"sync-status-text\">Caricamento...</span>\n            </div>\n          </div>\n          \n          <div class=\"sync-status-details\" id=\"sync-status-details\">\n            <div class=\"status-item\">\n              <span class=\"status-label\">Provider:</span>\n              <span class=\"status-value\" id=\"sync-provider\">-</span>\n            </div>\n            <div class=\"status-item\">\n              <span class=\"status-label\">Ultima sincronizzazione:</span>\n              <span class=\"status-value\" id=\"last-sync\">-</span>\n            </div>\n            <div class=\"status-item\">\n              <span class=\"status-label\">Auto-sync:</span>\n              <span class=\"status-value\" id=\"auto-sync-status\">-</span>\n            </div>\n          </div>\n        </div>\n\n        <!-- Sync Setup -->\n        <div class=\"sync-setup\" id=\"sync-setup\" style=\"display: none;\">\n          <h3>Configura Sincronizzazione</h3>\n          \n          <div class=\"provider-selection\">\n            <h4>Scegli Provider</h4>\n            <div class=\"provider-options\">\n              <label class=\"provider-option\">\n                <input type=\"radio\" name=\"sync-provider\" value=\"github\" checked>\n                <div class=\"provider-card\">\n                  <div class=\"provider-icon\"></div>\n                  <div class=\"provider-info\">\n                    <h5>GitHub Gist</h5>\n                    <p>Sincronizzazione tramite GitHub Gist privati</p>\n                  </div>\n                </div>\n              </label>\n              \n              <label class=\"provider-option\">\n                <input type=\"radio\" name=\"sync-provider\" value=\"googledrive\">\n                <div class=\"provider-card\">\n                  <div class=\"provider-icon\"></div>\n                  <div class=\"provider-info\">\n                    <h5>Google Drive</h5>\n                    <p>Sincronizzazione tramite Google Drive</p>\n                  </div>\n                </div>\n              </label>\n            </div>\n          </div>\n          \n          <!-- GitHub Setup -->\n          <div class=\"provider-setup\" id=\"github-setup\">\n            <h4>Configurazione GitHub</h4>\n            <div class=\"form-group\">\n              <label for=\"github-token\">Personal Access Token</label>\n              <input type=\"password\" id=\"github-token\" class=\"form-input\" placeholder=\"ghp_xxxxxxxxxxxx\">\n              <div class=\"form-help\">\n                <p>Crea un token su <a href=\"https://github.com/settings/tokens\" target=\"_blank\">GitHub Settings</a> con scope \"gist\"</p>\n              </div>\n            </div>\n          </div>\n          \n          <!-- Google Drive Setup -->\n          <div class=\"provider-setup\" id=\"googledrive-setup\" style=\"display: none;\">\n            <h4>Configurazione Google Drive</h4>\n            <div class=\"form-group\">\n              <p>Clicca il pulsante per autorizzare l'accesso a Google Drive:</p>\n              <button class=\"btn btn-primary\" id=\"google-auth-btn\">\n                <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M22.56,12.25C22.56,11.47 22.49,10.72 22.37,10H12V14.26H17.92C17.66,15.69 16.88,16.93 15.71,17.77V20.96H19.28C21.45,18.96 22.56,15.83 22.56,12.25Z\"/>\n                  <path d=\"M12,23C15.24,23 17.96,21.92 19.28,20.96L15.71,17.77C14.74,18.42 13.48,18.81 12,18.81C8.91,18.81 6.26,16.77 5.4,13.96H1.67V17.28C2.98,19.89 7.24,23 12,23Z\"/>\n                  <path d=\"M5.4,13.96C5.18,13.31 5.05,12.62 5.05,11.91C5.05,11.2 5.18,10.51 5.4,9.86V6.54H1.67C0.61,8.65 0,10.72 0,11.91C0,13.1 0.61,15.17 1.67,17.28L5.4,13.96Z\"/>\n                  <path d=\"M12,4.75C13.77,4.75 15.35,5.36 16.6,6.55L19.84,3.31C17.96,1.56 15.24,0.5 12,0.5C7.24,0.5 2.98,3.61 1.67,6.22L5.4,9.54C6.26,6.73 8.91,4.75 12,4.75Z\"/>\n                </svg>\n                Autorizza Google Drive\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <!-- Sync Actions -->\n        <div class=\"sync-actions\" id=\"sync-actions\">\n          <div class=\"action-group\">\n            <h4>Azioni Sincronizzazione</h4>\n            \n            <div class=\"action-buttons\">\n              <button class=\"btn btn-primary\" id=\"sync-now-btn\" disabled>\n                <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M12,18A6,6 0 0,1 6,12C6,11 6.25,10.03 6.7,9.2L5.24,7.74C4.46,8.97 4,10.43 4,12A8,8 0 0,0 12,20V23L16,19L12,15M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12C18,13 17.75,13.97 17.3,14.8L18.76,16.26C19.54,15.03 20,13.57 20,12A8,8 0 0,0 12,4Z\"/>\n                </svg>\n                Sincronizza Ora\n              </button>\n              \n              <button class=\"btn btn-secondary\" id=\"upload-only-btn\" disabled>\n                <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z\"/>\n                </svg>\n                Solo Upload\n              </button>\n              \n              <button class=\"btn btn-secondary\" id=\"download-only-btn\" disabled>\n                <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z\"/>\n                </svg>\n                Solo Download\n              </button>\n            </div>\n          </div>\n          \n          <div class=\"action-group\">\n            <h4>Gestione Backup</h4>\n            \n            <div class=\"action-buttons\">\n              <button class=\"btn btn-secondary\" id=\"create-backup-btn\">\n                <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>\n                </svg>\n                Crea Backup\n              </button>\n              \n              <button class=\"btn btn-secondary\" id=\"restore-backup-btn\">\n                <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>\n                </svg>\n                Ripristina Backup\n              </button>\n              \n              <button class=\"btn btn-warning\" id=\"disable-sync-btn\">\n                <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M14.5,9L12,11.5L9.5,9L8,10.5L10.5,13L8,15.5L9.5,17L12,14.5L14.5,17L16,15.5L13.5,13L16,10.5L14.5,9Z\"/>\n                </svg>\n                Disabilita Sync\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <!-- Sync Progress -->\n        <div class=\"sync-progress\" id=\"sync-progress\" style=\"display: none;\">\n          <div class=\"progress-info\">\n            <h4>Sincronizzazione in corso...</h4>\n            <p id=\"sync-progress-text\">Preparazione...</p>\n          </div>\n          <div class=\"progress-bar\">\n            <div class=\"progress-fill\" id=\"sync-progress-fill\"></div>\n          </div>\n        </div>\n\n        <!-- Sync History -->\n        <div class=\"sync-history\">\n          <h4>Cronologia Sincronizzazioni</h4>\n          <div class=\"history-list\" id=\"sync-history-list\">\n            <p class=\"history-empty\">Nessuna sincronizzazione effettuata</p>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"modal-footer\">\n        <button class=\"btn btn-secondary\" id=\"close-sync-modal\">Chiudi</button>\n        <button class=\"btn btn-primary\" id=\"setup-sync-btn\">Configura Sincronizzazione</button>\n      </div>\n    `;\n  }\n\n  /**\n   * Setup event listeners per sync modal\n   */\n  setupSyncModalListeners() {\n    const modal = document.getElementById('sync-modal');\n    if (!modal) return;\n\n    // Provider selection\n    const providerRadios = modal.querySelectorAll('input[name=\"sync-provider\"]');\n    providerRadios.forEach(radio => {\n      radio.addEventListener('change', () => {\n        this.showProviderSetup(radio.value);\n      });\n    });\n\n    // Setup sync\n    modal.querySelector('#setup-sync-btn')?.addEventListener('click', () => {\n      this.setupSyncFromModal();\n    });\n\n    // Sync actions\n    modal.querySelector('#sync-now-btn')?.addEventListener('click', () => {\n      this.performSync('bidirectional');\n    });\n\n    modal.querySelector('#upload-only-btn')?.addEventListener('click', () => {\n      this.performSync('upload');\n    });\n\n    modal.querySelector('#download-only-btn')?.addEventListener('click', () => {\n      this.performSync('download');\n    });\n\n    // Backup actions\n    modal.querySelector('#create-backup-btn')?.addEventListener('click', () => {\n      this.createBackup();\n    });\n\n    modal.querySelector('#restore-backup-btn')?.addEventListener('click', () => {\n      this.restoreBackup();\n    });\n\n    modal.querySelector('#disable-sync-btn')?.addEventListener('click', () => {\n      this.disableSync();\n    });\n\n    // Google auth\n    modal.querySelector('#google-auth-btn')?.addEventListener('click', () => {\n      this.authenticateGoogle();\n    });\n\n    // Close modal\n    modal.querySelector('#close-sync-modal')?.addEventListener('click', () => {\n      hideModal('sync-modal');\n    });\n  }\n\n  /**\n   * Utility methods\n   */\n\n  // Ottieni dati locali per sync\n  async getLocalData() {\n    try {\n      const [apps, settings] = await Promise.all([\n        StorageService.getAllApps(),\n        StorageService.getAllSettings()\n      ]);\n\n      return { apps, settings };\n    } catch (error) {\n      console.error('Errore recupero dati locali:', error);\n      throw error;\n    }\n  }\n\n  // Salva dati locali da sync\n  async saveLocalData(data) {\n    try {\n      // Implementa il salvataggio dei dati sincronizzati\n      // Questo richiederebbe metodi aggiuntivi in StorageService\n      await StorageService.importData({ data });\n    } catch (error) {\n      console.error('Errore salvataggio dati locali:', error);\n      throw error;\n    }\n  }\n\n  // Valida dati remoti\n  validateRemoteData(data) {\n    return data && \n           data.data && \n           Array.isArray(data.data.apps) && \n           Array.isArray(data.data.settings);\n  }\n\n  // Crea backup locale\n  async createBackup() {\n    try {\n      const backupData = await StorageService.exportAllData();\n      const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });\n      \n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `aideas-backup-${new Date().toISOString().split('T')[0]}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      \n      showToast('Backup creato con successo', 'success');\n    } catch (error) {\n      console.error('Errore creazione backup:', error);\n      showToast('Errore durante la creazione del backup', 'error');\n    }\n  }\n\n  // Gestisci credenziali in modo sicuro\n  async saveCredentials(provider, credentials) {\n    // In un'implementazione reale, si dovrebbe usare una forma di crittografia\n    // Per semplicit, salviamo in localStorage con un prefix\n    const key = `aideas_sync_${provider}`;\n    const encrypted = btoa(JSON.stringify(credentials)); // Crittografia base64 semplice\n    localStorage.setItem(key, encrypted);\n  }\n\n  async getCredentials(provider) {\n    const key = `aideas_sync_${provider}`;\n    const encrypted = localStorage.getItem(key);\n    if (!encrypted) return null;\n    \n    try {\n      return JSON.parse(atob(encrypted));\n    } catch (error) {\n      console.error('Errore decrittazione credenziali:', error);\n      return null;\n    }\n  }\n\n  async clearCredentials() {\n    const keys = Object.keys(localStorage).filter(key => key.startsWith('aideas_sync_'));\n    keys.forEach(key => localStorage.removeItem(key));\n  }\n\n  // Setup auto-sync\n  async setupAutoSync() {\n    if (this.autoSyncTimer) {\n      clearInterval(this.autoSyncTimer);\n    }\n\n    if (this.syncStatus.isEnabled && this.syncStatus.autoSyncInterval > 0) {\n      this.autoSyncTimer = setInterval(() => {\n        this.autoSync();\n      }, this.syncStatus.autoSyncInterval);\n    }\n  }\n\n  // Auto sync (silenzioso)\n  async autoSync() {\n    try {\n      if (!this.syncStatus.isEnabled || this.syncStatus.isInProgress) {\n        return;\n      }\n\n      console.log(' Auto-sync in corso...');\n      await this.performSync('bidirectional');\n      \n    } catch (error) {\n      console.error('Errore auto-sync:', error);\n      // Non mostrare toast per auto-sync falliti\n    }\n  }\n\n  // Setup background sync\n  setupBackgroundSync() {\n    // Ascolta messaggi dal service worker\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker.addEventListener('message', (event) => {\n        if (event.data.type === 'BACKGROUND_SYNC') {\n          if (event.data.action === 'sync-apps') {\n            this.performSync('bidirectional').catch(console.error);\n          }\n        }\n      });\n    }\n  }\n\n  // Aggiorna status sync\n  updateSyncStatus(message) {\n    const statusEl = document.getElementById('sync-status-text');\n    if (statusEl) {\n      statusEl.textContent = message;\n    }\n  }\n\n  // Altri metodi helper...\n  showProviderSetup(provider) {\n    // Implementa la logica per mostrare/nascondere setup provider\n  }\n\n  updateSyncModalStatus() {\n    // Implementa l'aggiornamento dello stato nel modal\n  }\n\n  setupSyncFromModal() {\n    // Implementa la configurazione sync dal modal\n  }\n\n  authenticateGoogle() {\n    // Implementa l'autenticazione Google OAuth\n  }\n\n  restoreBackup() {\n    // Implementa il ripristino da backup\n  }\n}","/**\n * AIdeas - Settings Panel Component\n * Gestisce le impostazioni dell'applicazione\n */\n\nimport StorageService from '../services/StorageService.js';\nimport { \n  showToast, \n  showModal, \n  hideModal,\n  showConfirmPopup,\n  showDeleteAppConfirm,\n  showImportAppConfirm,\n  showResetSettingsConfirm,\n  escapeHtml, \n  formatFileSize, \n  getDeviceInfo\n} from '../utils/helpers.js';\n\n/**\n * Classe per gestire il pannello delle impostazioni\n */\nexport default class SettingsPanel {\n  constructor() {\n    this.currentSettings = {};\n    this.defaultSettings = {\n      // Generali\n      language: 'it',\n      theme: 'auto', // 'light', 'dark', 'auto'\n      \n      // Launcher\n      defaultLaunchMode: 'newpage', // Cambiato da 'iframe' a 'newpage' per evitare problemi di sicurezza\n      maxConcurrentApps: 5,\n      showAppTooltips: true,\n      enableKeyboardShortcuts: true,\n      autoUpdateApps: false,\n      \n      // UI/UX\n      viewMode: 'grid', // 'grid', 'list'\n      sortBy: 'lastUsed', // 'lastUsed', 'name', 'installDate', 'category'\n      showWelcomeMessage: true,\n      enableAnimations: true,\n      compactMode: false,\n      \n      // Sync & Backup\n      syncEnabled: false,\n      syncProvider: 'github', // 'github', 'googledrive'\n      autoSyncInterval: 60, // minuti\n      backupBeforeSync: true,\n      \n      // Privacy & Security\n      analyticsEnabled: false,\n      crashReportingEnabled: true,\n      allowTelemetry: false,\n      validateAppsOnLaunch: true,\n      sandboxMode: 'strict', // 'strict', 'moderate', 'permissive'\n      \n      // Performance\n      enableServiceWorker: true,\n      cacheStrategy: 'aggressive', // 'aggressive', 'moderate', 'minimal'\n      preloadApps: false,\n      lazyLoadImages: true,\n      \n      // Developer\n      enableDebugMode: false,\n      showConsoleErrors: false,\n      enableExperimentalFeatures: false\n    };\n\n    // Funzionalit disabilitate\n    this.disabledFeatures = {\n      // syncEnabled: true, // SyncManager disabilitato\n      autoUpdateApps: true, // Non implementato\n      analyticsEnabled: true, // Non implementato\n      crashReportingEnabled: true, // Non implementato\n      allowTelemetry: true, // Non implementato\n      enableServiceWorker: true, // PWA disabilitato\n      preloadApps: true, // Non implementato\n      enableExperimentalFeatures: true // Non implementato\n    };\n\n    // Bind methods\n    this.init = this.init.bind(this);\n    this.showModal = this.showModal.bind(this);\n    this.loadSettings = this.loadSettings.bind(this);\n    this.saveSettings = this.saveSettings.bind(this);\n    this.resetSettings = this.resetSettings.bind(this);\n    this.exportSettings = this.exportSettings.bind(this);\n    this.importSettings = this.importSettings.bind(this);\n  }\n\n  /**\n   * Inizializza il pannello impostazioni\n   */\n  async init() {\n    try {\n      console.log(' Inizializzazione pannello impostazioni...');\n      \n      // Carica impostazioni esistenti\n      await this.loadSettings();\n      \n      // Verifica e correggi impostazioni\n      await this.validateAndFixSettings();\n      \n      // Applica impostazioni\n      this.applySettings();\n      \n      console.log(' Pannello impostazioni inizializzato');\n    } catch (error) {\n      console.error(' Errore inizializzazione pannello impostazioni:', error);\n    }\n  }\n\n  /**\n   * Verifica e correggi le impostazioni per assicurarsi che siano valide\n   */\n  async validateAndFixSettings() {\n    console.log(' Verifica impostazioni...');\n    \n    let needsUpdate = false;\n    const currentSettings = { ...this.currentSettings };\n    \n    // Verifica defaultLaunchMode\n    if (!currentSettings.defaultLaunchMode || \n        !['iframe', 'newpage'].includes(currentSettings.defaultLaunchMode)) {\n      console.log(' defaultLaunchMode non valido, correzione a \"newpage\"');\n      currentSettings.defaultLaunchMode = 'newpage';\n      needsUpdate = true;\n    }\n    \n    // Verifica altre impostazioni critiche\n    const criticalSettings = {\n      maxConcurrentApps: { min: 1, max: 10, default: 5 },\n      autoSyncInterval: { min: 5, max: 1440, default: 60 },\n      language: { valid: ['it', 'en'], default: 'it' },\n      theme: { valid: ['light', 'dark', 'auto'], default: 'auto' }\n    };\n    \n    for (const [key, validation] of Object.entries(criticalSettings)) {\n      const value = currentSettings[key];\n      \n      if (validation.min !== undefined && validation.max !== undefined) {\n        // Validazione numerica\n        if (typeof value !== 'number' || value < validation.min || value > validation.max) {\n          console.log(` ${key} non valido (${value}), correzione a ${validation.default}`);\n          currentSettings[key] = validation.default;\n          needsUpdate = true;\n        }\n      } else if (validation.valid) {\n        // Validazione enum\n        if (!validation.valid.includes(value)) {\n          console.log(` ${key} non valido (${value}), correzione a ${validation.default}`);\n          currentSettings[key] = validation.default;\n          needsUpdate = true;\n        }\n      }\n    }\n    \n    // Salva correzioni se necessarie\n    if (needsUpdate) {\n      console.log(' Salvataggio correzioni impostazioni...');\n      this.currentSettings = currentSettings;\n      \n      for (const [key, value] of Object.entries(currentSettings)) {\n        await StorageService.setSetting(key, value);\n      }\n      \n      console.log(' Impostazioni corrette salvate');\n    } else {\n      console.log(' Tutte le impostazioni sono valide');\n    }\n  }\n\n  /**\n   * Carica le impostazioni dal database\n   */\n  async loadSettings() {\n    try {\n      const savedSettings = await StorageService.getAllSettings();\n      this.currentSettings = { ...this.defaultSettings, ...savedSettings };\n    } catch (error) {\n      console.error('Errore caricamento impostazioni:', error);\n      this.currentSettings = { ...this.defaultSettings };\n    }\n  }\n\n  /**\n   * Applica le impostazioni all'interfaccia\n   */\n  applySettings() {\n    // Tema\n    this.applyTheme(this.currentSettings.theme);\n    \n    // Lingua\n    this.applyLanguage(this.currentSettings.language);\n    \n    // Animazioni\n    this.applyAnimations(this.currentSettings.enableAnimations);\n    \n    // Modalit compatta\n    this.applyCompactMode(this.currentSettings.compactMode);\n    \n    // Debug mode\n    this.applyDebugMode(this.currentSettings.enableDebugMode);\n  }\n\n  /**\n   * Mostra il modal delle impostazioni\n   */\n  showModal() {\n    const modalContent = this.createSettingsModal();\n    showModal('settings-modal', modalContent, {\n      size: 'modal-xl',\n      disableBackdropClose: false\n    });\n\n    // Setup event listeners dopo che il modal  stato creato\n    setTimeout(() => {\n      this.setupModalEventListeners();\n      this.populateForm();\n      this.markDisabledFeatures();\n      \n      // Inizializza la prima sezione\n      this.showSection('general');\n    }, 100);\n  }\n\n  /**\n   * Crea il contenuto del modal delle impostazioni\n   */\n  createSettingsModal() {\n    return `\n      <div class=\"modal-header\">\n        <h2>\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"header-icon\">\n            <path d=\"M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11L19.5,12L19.43,13L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z\"/>\n          </svg>\n          Impostazioni AIdeas\n        </h2>\n        <button class=\"modal-close\">&times;</button>\n      </div>\n      \n      <div class=\"modal-body\">\n        <!-- Settings Navigation -->\n        <div class=\"settings-layout\">\n          <nav class=\"settings-nav\">\n            <ul class=\"settings-nav-list\">\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary active\" type=\"button\" data-section=\"general\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z\"/>\n                  </svg>\n                  Generale\n                </button>\n              </li>\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary\" type=\"button\" data-section=\"launcher\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M8,5.14V19.14L19,12.14L8,5.14Z\"/>\n                  </svg>\n                  Launcher\n                </button>\n              </li>\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary\" type=\"button\" data-section=\"interface\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15Z\"/>\n                  </svg>\n                  Interfaccia\n                </button>\n              </li>\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary\" type=\"button\" data-section=\"sync\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M12,18A6,6 0 0,1 6,12C6,11 6.25,10.03 6.7,9.2L5.24,7.74C4.46,8.97 4,10.43 4,12A8,8 0 0,0 12,20V23L16,19L12,15M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12C18,13 17.75,13.97 17.3,14.8L18.76,16.26C19.54,15.03 20,13.57 20,12A8,8 0 0,0 12,4Z\"/>\n                  </svg>\n                  Sincronizzazione\n                </button>\n              </li>\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary\" type=\"button\" data-section=\"privacy\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11H16V18H8V11H9.2V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.4,8.7 10.4,10V11H13.6V10C13.6,8.7 12.8,8.2 12,8.2Z\"/>\n                  </svg>\n                  Privacy & Sicurezza\n                </button>\n              </li>\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary\" type=\"button\" data-section=\"performance\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12H16A4,4 0 0,0 12,8V6Z\"/>\n                  </svg>\n                  Performance\n                </button>\n              </li>\n              <li class=\"settings-nav-item\">\n                <button class=\"settings-nav-btn btn btn-secondary\" type=\"button\" data-section=\"advanced\">\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C7.14,19.87 7.64,20 8,20C9,20 10,19 11,17H12C14,15 16,13 17,8M18.5,2C16.7,2 15.14,2.9 14.22,4.22L15.63,5.63C16.07,5 16.72,4.5 17.5,4.5C18.61,4.5 19.5,5.39 19.5,6.5C19.5,7.28 19,7.93 18.37,8.37L19.78,9.78C21.1,8.86 22,7.3 22,5.5C22,3.57 20.43,2 18.5,2Z\"/>\n                  </svg>\n                  Avanzate\n                </button>\n              </li>\n            </ul>\n          </nav>\n\n          <!-- Settings Content -->\n          <div class=\"settings-content\">\n            \n            <!-- General Section -->\n            <div class=\"settings-section active\" id=\"section-general\">\n              <h3>Impostazioni Generali</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Localizzazione</h4>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-language\">Lingua</label>\n                  <select id=\"setting-language\" class=\"form-input\">\n                    <option value=\"it\">Italiano</option>\n                    <option value=\"en\">English</option>\n                    <option value=\"es\">Espaol</option>\n                    <option value=\"fr\">Franais</option>\n                    <option value=\"de\">Deutsch</option>\n                  </select>\n                  <p class=\"setting-description\">Lingua dell'interfaccia utente</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-theme\">Tema</label>\n                  <select id=\"setting-theme\" class=\"form-input\">\n                    <option value=\"auto\">Automatico (segue sistema)</option>\n                    <option value=\"light\">Chiaro</option>\n                    <option value=\"dark\">Scuro</option>\n                  </select>\n                  <p class=\"setting-description\">Aspetto dell'interfaccia</p>\n                </div>\n              </div>\n              \n              <div class=\"settings-group\">\n                <h4>Comportamento</h4>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-showWelcomeMessage\">\n                    <span class=\"checkmark\"></span>\n                    Mostra messaggio di benvenuto\n                  </label>\n                  <p class=\"setting-description\">Visualizza il messaggio al primo avvio</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-enableKeyboardShortcuts\">\n                    <span class=\"checkmark\"></span>\n                    Abilita scorciatoie da tastiera\n                  </label>\n                  <p class=\"setting-description\">Ctrl+K per ricerca, Ctrl+N per nuova app, etc.</p>\n                </div>\n              </div>\n            </div>\n\n            <!-- Launcher Section -->\n            <div class=\"settings-section\" id=\"section-launcher\">\n              <h3>Configurazione Launcher</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Modalit di Apertura App</h4>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-defaultLaunchMode\">Modalit predefinita</label>\n                  <select id=\"setting-defaultLaunchMode\" class=\"form-input\">\n                    <option value=\"iframe\">Finestra modale (sicura)</option>\n                    <option value=\"newpage\">Nuova pagina del browser</option>\n                  </select>\n                  <p class=\"setting-description\">Come aprire le app per default</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-maxConcurrentApps\">App concorrenti massime</label>\n                  <input type=\"number\" id=\"setting-maxConcurrentApps\" class=\"form-input\" min=\"1\" max=\"20\" value=\"5\">\n                  <p class=\"setting-description\">Numero massimo di app aperte contemporaneamente</p>\n                </div>\n                \n                <div class=\"setting-item\" id=\"setting-autoUpdateApps-container\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-autoUpdateApps\">\n                    <span class=\"checkmark\"></span>\n                    Aggiornamento automatico app\n                  </label>\n                  <p class=\"setting-description\">Controlla automaticamente aggiornamenti da GitHub</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-validateAppsOnLaunch\">\n                    <span class=\"checkmark\"></span>\n                    Valida app al lancio\n                  </label>\n                  <p class=\"setting-description\">Controlla integrit delle app prima dell'esecuzione</p>\n                </div>\n              </div>\n              \n              <div class=\"settings-group\">\n                <h4>Sandbox e Sicurezza</h4>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-sandboxMode\">Modalit sandbox</label>\n                  <select id=\"setting-sandboxMode\" class=\"form-input\">\n                    <option value=\"strict\">Rigorosa (massima sicurezza)</option>\n                    <option value=\"moderate\">Moderata (bilanciata)</option>\n                    <option value=\"permissive\">Permissiva (pi libert)</option>\n                  </select>\n                  <p class=\"setting-description\">Livello di restrizioni per l'esecuzione delle app</p>\n                </div>\n              </div>\n            </div>\n\n            <!-- Interface Section -->\n            <div class=\"settings-section\" id=\"section-interface\">\n              <h3>Configurazione Interfaccia</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Visualizzazione</h4>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-viewMode\">Vista predefinita</label>\n                  <select id=\"setting-viewMode\" class=\"form-input\">\n                    <option value=\"grid\">Griglia</option>\n                    <option value=\"list\">Lista</option>\n                  </select>\n                  <p class=\"setting-description\">Come visualizzare le app nella dashboard</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-sortBy\">Ordinamento predefinito</label>\n                  <select id=\"setting-sortBy\" class=\"form-input\">\n                    <option value=\"lastUsed\">Ultimo utilizzo</option>\n                    <option value=\"name\">Nome A-Z</option>\n                    <option value=\"installDate\">Data installazione</option>\n                    <option value=\"category\">Categoria</option>\n                  </select>\n                  <p class=\"setting-description\">Criterio di ordinamento delle app</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-compactMode\">\n                    <span class=\"checkmark\"></span>\n                    Modalit compatta\n                  </label>\n                  <p class=\"setting-description\">Interfaccia pi densa con meno spazi</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-enableAnimations\">\n                    <span class=\"checkmark\"></span>\n                    Abilita animazioni\n                  </label>\n                  <p class=\"setting-description\">Transizioni ed effetti animati</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-showAppTooltips\">\n                    <span class=\"checkmark\"></span>\n                    Mostra tooltip\n                  </label>\n                  <p class=\"setting-description\">Suggerimenti al passaggio del mouse</p>\n                </div>\n              </div>\n            </div>\n\n            <!-- Sync Section -->\n            <div class=\"settings-section\" id=\"section-sync\">\n              <h3>Sincronizzazione e Backup</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Configurazione Cloud</h4>\n                \n                <div class=\"setting-item\" id=\"setting-syncEnabled-container\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-syncEnabled\">\n                    <span class=\"checkmark\"></span>\n                    Abilita sincronizzazione\n                  </label>\n                  <p class=\"setting-description\">Sincronizza app e impostazioni su cloud</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-syncProvider\">Provider di sincronizzazione</label>\n                  <select id=\"setting-syncProvider\" class=\"form-input\">\n                    <option value=\"github\">GitHub Gist</option>\n                    <option value=\"googledrive\">Google Drive</option>\n                  </select>\n                  <p class=\"setting-description\">Servizio cloud per la sincronizzazione</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-autoSyncInterval\">Intervallo auto-sync (minuti)</label>\n                  <input type=\"number\" id=\"setting-autoSyncInterval\" class=\"form-input\" min=\"5\" max=\"1440\" value=\"60\">\n                  <p class=\"setting-description\">Frequenza di sincronizzazione automatica</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-backupBeforeSync\">\n                    <span class=\"checkmark\"></span>\n                    Backup prima della sincronizzazione\n                  </label>\n                  <p class=\"setting-description\">Crea backup locale prima di ogni sync</p>\n                </div>\n              </div>\n              \n              <div class=\"settings-group\">\n                <h4>Gestione Dati</h4>\n                \n                <div class=\"setting-actions\">\n                  <button class=\"btn btn-secondary\" id=\"export-settings-btn\">\n                    <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                      <path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>\n                    </svg>\n                    Esporta Impostazioni\n                  </button>\n                  \n                  <button class=\"btn btn-secondary\" id=\"import-settings-btn\">\n                    <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                      <path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>\n                    </svg>\n                    Importa Impostazioni\n                  </button>\n                  \n                  <button class=\"btn btn-warning\" id=\"reset-settings-btn\">\n                    <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                      <path d=\"M12,4C14.1,4 16.1,4.8 17.6,6.3C20.7,9.4 20.7,14.5 17.6,17.6C15.8,19.5 13.3,20.2 10.9,19.9L11.4,17.9C13.1,18.1 14.9,17.5 16.2,16.2C18.5,13.9 18.5,10.1 16.2,7.7C15.1,6.6 13.5,6 12,6V10.6L7,5.6L12,0.6V4M6.3,17.6C3.7,15 3.3,11 5.1,7.9L6.6,9.4C5.5,11.6 5.9,14.4 7.8,16.2C8.3,16.7 8.9,17.1 9.6,17.4L9,19.4C8,19 7.1,18.4 6.3,17.6Z\"/>\n                    </svg>\n                    Ripristina Predefinite\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <!-- Privacy Section -->\n            <div class=\"settings-section\" id=\"section-privacy\">\n              <h3>Privacy e Sicurezza</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Raccolta Dati</h4>\n                \n                <div class=\"setting-item\" id=\"setting-analyticsEnabled-container\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-analyticsEnabled\">\n                    <span class=\"checkmark\"></span>\n                    Abilita analytics\n                  </label>\n                  <p class=\"setting-description\">Raccolta dati anonimi per migliorare l'app</p>\n                </div>\n                \n                <div class=\"setting-item\" id=\"setting-crashReportingEnabled-container\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-crashReportingEnabled\">\n                    <span class=\"checkmark\"></span>\n                    Report errori automatici\n                  </label>\n                  <p class=\"setting-description\">Invia automaticamente report degli errori</p>\n                </div>\n                \n                <div class=\"setting-item\" id=\"setting-allowTelemetry-container\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-allowTelemetry\">\n                    <span class=\"checkmark\"></span>\n                    Telemetria di utilizzo\n                  </label>\n                  <p class=\"setting-description\">Condividi statistiche d'uso anonime</p>\n                </div>\n              </div>\n              \n              <div class=\"settings-group\">\n                <h4>Gestione Privacy</h4>\n                \n                <div class=\"setting-actions\">\n                  <button class=\"btn btn-secondary\" id=\"clear-cache-btn\">\n                    <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                      <path d=\"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z\"/>\n                    </svg>\n                    Svuota Cache\n                  </button>\n                  \n                  <button class=\"btn btn-warning\" id=\"clear-all-data-btn\">\n                    <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                      <path d=\"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z\"/>\n                    </svg>\n                    Elimina Tutti i Dati\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <!-- Performance Section -->\n            <div class=\"settings-section\" id=\"section-performance\">\n              <h3>Performance e Cache</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Ottimizzazioni</h4>\n                \n                <div class=\"setting-item\" id=\"setting-enableServiceWorker-container\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-enableServiceWorker\">\n                    <span class=\"checkmark\"></span>\n                    Abilita Service Worker\n                  </label>\n                  <p class=\"setting-description\">Cache intelligente e funzionalit offline</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label for=\"setting-cacheStrategy\">Strategia cache</label>\n                  <select id=\"setting-cacheStrategy\" class=\"form-input\">\n                    <option value=\"aggressive\">Aggressiva (pi veloce, pi spazio)</option>\n                    <option value=\"moderate\">Moderata (bilanciata)</option>\n                    <option value=\"minimal\">Minimale (meno spazio)</option>\n                  </select>\n                  <p class=\"setting-description\">Quanto contenuto cachare per l'offline</p>\n                </div>\n                \n                <div class=\"setting-item\" id=\"setting-preloadApps-container\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-preloadApps\">\n                    <span class=\"checkmark\"></span>\n                    Precarica app frequenti\n                  </label>\n                  <p class=\"setting-description\">Carica in background le app pi usate</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-lazyLoadImages\">\n                    <span class=\"checkmark\"></span>\n                    Caricamento lazy delle immagini\n                  </label>\n                  <p class=\"setting-description\">Carica le immagini solo quando necessario</p>\n                </div>\n              </div>\n              \n              <div class=\"settings-group\">\n                <h4>Statistiche Storage</h4>\n                <div class=\"storage-stats\" id=\"storage-stats\">\n                  <div class=\"stat-item\">\n                    <span class=\"stat-label\">Spazio utilizzato:</span>\n                    <span class=\"stat-value\" id=\"storage-used\">Caricamento...</span>\n                  </div>\n                  <div class=\"stat-item\">\n                    <span class=\"stat-label\">App installate:</span>\n                    <span class=\"stat-value\" id=\"apps-count\">Caricamento...</span>\n                  </div>\n                  <div class=\"stat-item\">\n                    <span class=\"stat-label\">Cache size:</span>\n                    <span class=\"stat-value\" id=\"cache-size\">Caricamento...</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <!-- Advanced Section -->\n            <div class=\"settings-section\" id=\"section-advanced\">\n              <h3>Impostazioni Avanzate</h3>\n              \n              <div class=\"settings-group\">\n                <h4>Developer Options</h4>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-enableDebugMode\">\n                    <span class=\"checkmark\"></span>\n                    Modalit debug\n                  </label>\n                  <p class=\"setting-description\">Mostra informazioni di debug nell'interfaccia</p>\n                </div>\n                \n                <div class=\"setting-item\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-showConsoleErrors\">\n                    <span class=\"checkmark\"></span>\n                    Mostra errori console\n                  </label>\n                  <p class=\"setting-description\">Visualizza errori JavaScript nell'interfaccia</p>\n                </div>\n                \n                <div class=\"setting-item\" id=\"setting-enableExperimentalFeatures-container\">\n                  <label class=\"setting-checkbox\">\n                    <input type=\"checkbox\" id=\"setting-enableExperimentalFeatures\">\n                    <span class=\"checkmark\"></span>\n                    Funzionalit sperimentali\n                  </label>\n                  <p class=\"setting-description\">Abilita features in fase di test</p>\n                </div>\n              </div>\n              \n              <div class=\"settings-group\">\n                <h4>Informazioni Sistema</h4>\n                <div class=\"system-info\" id=\"system-info\">\n                  <div class=\"info-item\">\n                    <span class=\"info-label\">Versione SAKAI:</span>\n                    <span class=\"info-value\">1.0.0</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <span class=\"info-label\">User Agent:</span>\n                    <span class=\"info-value\" id=\"user-agent\">Caricamento...</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <span class=\"info-label\">Platform:</span>\n                    <span class=\"info-value\" id=\"platform\">Caricamento...</span>\n                  </div>\n                  <div class=\"info-item\">\n                    <span class=\"info-label\">PWA Support:</span>\n                    <span class=\"info-value\" id=\"pwa-support\">Caricamento...</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"modal-footer\">\n        <button class=\"btn btn-secondary\" id=\"cancel-settings\" type=\"button\">Annulla</button>\n        <button class=\"btn btn-primary\" id=\"save-settings\" type=\"button\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z\"/>\n          </svg>\n          Salva Impostazioni\n        </button>\n      </div>\n    `;\n  }\n\n  /**\n   * Marca le funzionalit disabilitate\n   */\n  markDisabledFeatures() {\n    const modal = document.getElementById('settings-modal');\n    if (!modal) return;\n\n    Object.entries(this.disabledFeatures).forEach(([feature, isDisabled]) => {\n      if (isDisabled) {\n        const container = modal.querySelector(`#setting-${this.camelToKebab(feature)}-container`);\n        const input = modal.querySelector(`#setting-${this.camelToKebab(feature)}`);\n        \n        if (container) {\n          container.classList.add('disabled');\n        }\n        \n        if (input) {\n          input.disabled = true;\n          input.checked = false;\n        }\n      }\n    });\n  }\n\n  /**\n   * Setup event listeners per il modal\n   */\n  setupModalEventListeners() {\n    const modal = document.getElementById('settings-modal');\n    if (!modal) return;\n\n    // Navigation between sections\n    const navButtons = modal.querySelectorAll('.settings-nav-btn');\n    navButtons.forEach(btn => {\n      btn.addEventListener('click', () => {\n        const section = btn.dataset.section;\n        this.showSection(section);\n      });\n    });\n\n    // Settings actions\n    modal.querySelector('#export-settings-btn')?.addEventListener('click', () => {\n      this.exportSettings();\n    });\n\n    modal.querySelector('#import-settings-btn')?.addEventListener('click', () => {\n      this.importSettings();\n    });\n\n    modal.querySelector('#reset-settings-btn')?.addEventListener('click', () => {\n      this.resetSettings();\n    });\n\n    modal.querySelector('#clear-cache-btn')?.addEventListener('click', () => {\n      this.clearCache();\n    });\n\n    modal.querySelector('#clear-all-data-btn')?.addEventListener('click', () => {\n      this.clearAllData();\n    });\n\n    // Modal actions\n    modal.querySelector('#cancel-settings')?.addEventListener('click', () => {\n      hideModal('settings-modal');\n    });\n\n    modal.querySelector('#save-settings')?.addEventListener('click', () => {\n      this.saveSettings();\n    });\n\n    // Real-time theme preview\n    modal.querySelector('#setting-theme')?.addEventListener('change', (e) => {\n      this.applyTheme(e.target.value);\n    });\n\n    // Real-time animation preview\n    modal.querySelector('#setting-enableAnimations')?.addEventListener('change', (e) => {\n      this.applyAnimations(e.target.checked);\n    });\n\n    // Real-time compact mode preview\n    modal.querySelector('#setting-compactMode')?.addEventListener('change', (e) => {\n      this.applyCompactMode(e.target.checked);\n    });\n\n    // Load statistics\n    this.loadStorageStats();\n    this.loadSystemInfo();\n  }\n\n  /**\n   * Mostra una sezione specifica\n   */\n  showSection(sectionName) {\n    const modal = document.getElementById('settings-modal');\n    if (!modal) return;\n\n    // Nascondi tutte le sezioni\n    const sections = modal.querySelectorAll('.settings-section');\n    sections.forEach(section => {\n      section.style.display = 'none';\n      section.classList.remove('active');\n    });\n\n    // Mostra la sezione selezionata\n    const targetSection = modal.querySelector(`#section-${sectionName}`);\n    if (targetSection) {\n      targetSection.style.display = 'block';\n      targetSection.classList.add('active');\n    }\n\n    // Aggiorna i pulsanti di navigazione\n    const navButtons = modal.querySelectorAll('.settings-nav-btn');\n    navButtons.forEach(btn => {\n      btn.classList.remove('active');\n      if (btn.dataset.section === sectionName) {\n        btn.classList.add('active');\n      }\n    });\n  }\n\n  /**\n   * Popola il form con le impostazioni correnti\n   */\n  populateForm() {\n    const modal = document.getElementById('settings-modal');\n    if (!modal) return;\n\n    // Mappa inversa dei campi\n    const fieldMapping = {\n      'language': 'setting-language',\n      'theme': 'setting-theme',\n      'showWelcomeMessage': 'setting-showWelcomeMessage',\n      'enableKeyboardShortcuts': 'setting-enableKeyboardShortcuts',\n      'defaultLaunchMode': 'setting-defaultLaunchMode',\n      'maxConcurrentApps': 'setting-maxConcurrentApps',\n      'autoUpdateApps': 'setting-autoUpdateApps',\n      'validateAppsOnLaunch': 'setting-validateAppsOnLaunch',\n      'sandboxMode': 'setting-sandboxMode',\n      'viewMode': 'setting-viewMode',\n      'sortBy': 'setting-sortBy',\n      'compactMode': 'setting-compactMode',\n      'enableAnimations': 'setting-enableAnimations',\n      'showAppTooltips': 'setting-showAppTooltips',\n      'syncEnabled': 'setting-syncEnabled',\n      'syncProvider': 'setting-syncProvider',\n      'autoSyncInterval': 'setting-autoSyncInterval',\n      'backupBeforeSync': 'setting-backupBeforeSync',\n      'analyticsEnabled': 'setting-analyticsEnabled',\n      'crashReportingEnabled': 'setting-crashReportingEnabled',\n      'allowTelemetry': 'setting-allowTelemetry',\n      'enableServiceWorker': 'setting-enableServiceWorker',\n      'cacheStrategy': 'setting-cacheStrategy',\n      'preloadApps': 'setting-preloadApps',\n      'lazyLoadImages': 'setting-lazyLoadImages',\n      'enableDebugMode': 'setting-enableDebugMode',\n      'showConsoleErrors': 'setting-showConsoleErrors',\n      'enableExperimentalFeatures': 'setting-enableExperimentalFeatures'\n    };\n\n    // Itera su tutte le impostazioni e popola i campi\n    for (const [key, value] of Object.entries(this.currentSettings)) {\n      const fieldId = fieldMapping[key];\n      if (fieldId) {\n        const field = modal.querySelector(`#${fieldId}`);\n        if (field && !field.disabled) {\n          if (field.type === 'checkbox') {\n            field.checked = Boolean(value);\n          } else {\n            field.value = value;\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Salva le impostazioni\n   */\n  async saveSettings() {\n    try {\n      // Raccogli dati dal form\n      const formData = this.collectFormData();\n      \n      // Aggiorna impostazioni correnti\n      this.currentSettings = { ...this.currentSettings, ...formData };\n      \n      // Salva nel database\n      for (const [key, value] of Object.entries(this.currentSettings)) {\n        await StorageService.setSetting(key, value);\n      }\n      \n      // Applica le impostazioni\n      this.applySettings();\n      \n      // Chiudi modal\n      hideModal('settings-modal');\n      \n      // Mostra conferma\n      showToast('Impostazioni salvate con successo', 'success');\n      \n      // Ricarica pagina se necessario\n      if (this.requiresReload(formData)) {\n        const confirmed = await showConfirmPopup({\n          title: 'Ricarica Pagina',\n          message: 'Alcune modifiche richiedono il ricaricamento della pagina. Ricaricare ora?',\n          icon: 'info',\n          confirmText: 'Ricarica',\n          cancelText: 'Pi tardi',\n          type: 'default'\n        });\n        \n        if (confirmed) {\n          window.location.reload();\n        }\n      }\n      \n    } catch (error) {\n      console.error('Errore salvataggio impostazioni:', error);\n      showToast('Errore durante il salvataggio delle impostazioni', 'error');\n    }\n  }\n\n  /**\n   * Raccogli dati dal form\n   */\n  collectFormData() {\n    const formData = {};\n    const modal = document.getElementById('settings-modal');\n    if (!modal) return formData;\n\n    // Mappa dei campi per gestire le differenze tra ID e chiavi\n    const fieldMapping = {\n      'setting-language': 'language',\n      'setting-theme': 'theme',\n      'setting-showWelcomeMessage': 'showWelcomeMessage',\n      'setting-enableKeyboardShortcuts': 'enableKeyboardShortcuts',\n      'setting-defaultLaunchMode': 'defaultLaunchMode',\n      'setting-maxConcurrentApps': 'maxConcurrentApps',\n      'setting-autoUpdateApps': 'autoUpdateApps',\n      'setting-validateAppsOnLaunch': 'validateAppsOnLaunch',\n      'setting-sandboxMode': 'sandboxMode',\n      'setting-viewMode': 'viewMode',\n      'setting-sortBy': 'sortBy',\n      'setting-compactMode': 'compactMode',\n      'setting-enableAnimations': 'enableAnimations',\n      'setting-showAppTooltips': 'showAppTooltips',\n      'setting-syncEnabled': 'syncEnabled',\n      'setting-syncProvider': 'syncProvider',\n      'setting-autoSyncInterval': 'autoSyncInterval',\n      'setting-backupBeforeSync': 'backupBeforeSync',\n      'setting-analyticsEnabled': 'analyticsEnabled',\n      'setting-crashReportingEnabled': 'crashReportingEnabled',\n      'setting-allowTelemetry': 'allowTelemetry',\n      'setting-enableServiceWorker': 'enableServiceWorker',\n      'setting-cacheStrategy': 'cacheStrategy',\n      'setting-preloadApps': 'preloadApps',\n      'setting-lazyLoadImages': 'lazyLoadImages',\n      'setting-enableDebugMode': 'enableDebugMode',\n      'setting-showConsoleErrors': 'showConsoleErrors',\n      'setting-enableExperimentalFeatures': 'enableExperimentalFeatures'\n    };\n\n    const inputs = modal.querySelectorAll('input[id^=\"setting-\"], select[id^=\"setting-\"], textarea[id^=\"setting-\"]');\n    inputs.forEach(input => {\n      const fieldId = input.id;\n      const key = fieldMapping[fieldId];\n      \n      if (key && !input.disabled) {\n        if (input.type === 'checkbox') {\n          formData[key] = input.checked;\n        } else if (input.type === 'number') {\n          formData[key] = parseInt(input.value) || 0;\n        } else {\n          formData[key] = input.value;\n        }\n      }\n    });\n\n    return formData;\n  }\n\n  /**\n   * Applica le impostazioni all'interfaccia\n   */\n  applyTheme(theme) {\n    const root = document.documentElement;\n    \n    if (theme === 'auto') {\n      // Segui preferenza sistema\n      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n      root.setAttribute('data-theme', prefersDark ? 'dark' : 'light');\n    } else {\n      root.setAttribute('data-theme', theme);\n    }\n  }\n\n  applyLanguage(language) {\n    document.documentElement.setAttribute('lang', language);\n    // Qui si potrebbe implementare l'i18n completo\n  }\n\n  applyAnimations(enabled) {\n    const root = document.documentElement;\n    if (enabled) {\n      root.classList.remove('no-animations');\n    } else {\n      root.classList.add('no-animations');\n    }\n  }\n\n  applyCompactMode(enabled) {\n    const root = document.documentElement;\n    if (enabled) {\n      root.classList.add('compact-mode');\n    } else {\n      root.classList.remove('compact-mode');\n    }\n  }\n\n  applyDebugMode(enabled) {\n    const root = document.documentElement;\n    if (enabled) {\n      root.classList.add('debug-mode');\n    } else {\n      root.classList.remove('debug-mode');\n    }\n  }\n\n  /**\n   * Reset alle impostazioni predefinite\n   */\n  async resetSettings() {\n    const confirmed = await showConfirmPopup({\n      title: 'Reset Impostazioni',\n      message: 'Sei sicuro di voler ripristinare tutte le impostazioni ai valori predefiniti?',\n      icon: 'warning',\n      confirmText: 'Reset',\n      cancelText: 'Annulla',\n      type: 'default'\n    });\n    if (!confirmed) return;\n\n    try {\n      // Reset alle impostazioni predefinite\n      this.currentSettings = { ...this.defaultSettings };\n      \n      // Salva nel database\n      for (const [key, value] of Object.entries(this.currentSettings)) {\n        await StorageService.setSetting(key, value);\n      }\n      \n      // Ripopola form\n      this.populateForm();\n      \n      // Applica impostazioni\n      this.applySettings();\n      \n      showToast('Impostazioni ripristinate ai valori predefiniti', 'success');\n      \n    } catch (error) {\n      console.error('Errore reset impostazioni:', error);\n      showToast('Errore durante il ripristino delle impostazioni', 'error');\n    }\n  }\n\n  /**\n   * Esporta impostazioni\n   */\n  async exportSettings() {\n    try {\n      const exportData = {\n        version: '1.0.0',\n        timestamp: new Date().toISOString(),\n        settings: this.currentSettings,\n        deviceInfo: getDeviceInfo()\n      };\n      \n      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      \n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `sakai-settings-${new Date().toISOString().split('T')[0]}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      \n      showToast('Impostazioni esportate con successo', 'success');\n      \n    } catch (error) {\n      console.error('Errore export impostazioni:', error);\n      showToast('Errore durante l\\'esportazione delle impostazioni', 'error');\n    }\n  }\n\n  /**\n   * Importa impostazioni\n   */\n  importSettings() {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.json';\n    \n    input.onchange = async (e) => {\n      try {\n        const file = e.target.files[0];\n        if (!file) return;\n        \n        const text = await file.text();\n        const importData = JSON.parse(text);\n        \n        // Validazione formato\n        if (!importData.settings || !importData.version) {\n          throw new Error('Formato file non valido');\n        }\n        \n        // Merge con impostazioni attuali\n        this.currentSettings = { ...this.defaultSettings, ...importData.settings };\n        \n        // Salva nel database\n        for (const [key, value] of Object.entries(this.currentSettings)) {\n          await StorageService.setSetting(key, value);\n        }\n        \n        // Ripopola form\n        this.populateForm();\n        \n        // Applica impostazioni\n        this.applySettings();\n        \n        showToast('Impostazioni importate con successo', 'success');\n        \n      } catch (error) {\n        console.error('Errore import impostazioni:', error);\n        showToast('Errore durante l\\'importazione delle impostazioni', 'error');\n      }\n    };\n    \n    input.click();\n  }\n\n  /**\n   * Svuota cache\n   */\n  async clearCache() {\n    try {\n      if ('caches' in window) {\n        const cacheNames = await caches.keys();\n        await Promise.all(cacheNames.map(name => caches.delete(name)));\n      }\n      \n      showToast('Cache svuotata con successo', 'success');\n      this.loadStorageStats(); // Ricarica statistiche\n      \n    } catch (error) {\n      console.error('Errore svuotamento cache:', error);\n      showToast('Errore durante lo svuotamento della cache', 'error');\n    }\n  }\n\n  /**\n   * Elimina tutti i dati\n   */\n  async clearAllData() {\n    const confirmed = await showConfirmPopup({\n      title: 'Elimina Tutti i Dati',\n      message: 'ATTENZIONE: Questa operazione eliminer TUTTI i dati di SAKAI incluse app, impostazioni e cache. Continuare?',\n      icon: 'warning',\n      confirmText: 'Elimina',\n      cancelText: 'Annulla',\n      type: 'default'\n    });\n    if (!confirmed) return;\n\n    const doubleConfirm = await showConfirmPopup({\n      title: 'Conferma Eliminazione',\n      message: 'Sei veramente sicuro? Questa operazione NON pu essere annullata!',\n      icon: 'warning',\n      confirmText: 'Elimina',\n      cancelText: 'Annulla',\n      type: 'default'\n    });\n    if (!doubleConfirm) return;\n\n    try {\n      // Elimina database IndexedDB\n      await StorageService.close();\n      indexedDB.deleteDatabase('SAKAI_DB');\n      \n      // Elimina localStorage\n      Object.keys(localStorage).forEach(key => {\n        if (key.startsWith('sakai_')) {\n          localStorage.removeItem(key);\n        }\n      });\n      \n      // Elimina cache\n      if ('caches' in window) {\n        const cacheNames = await caches.keys();\n        await Promise.all(cacheNames.map(name => caches.delete(name)));\n      }\n      \n      showToast('Tutti i dati sono stati eliminati', 'success');\n      \n      // Ricarica la pagina dopo un breve delay\n      setTimeout(() => {\n        window.location.reload();\n      }, 2000);\n      \n    } catch (error) {\n      console.error('Errore eliminazione dati:', error);\n      showToast('Errore durante l\\'eliminazione dei dati', 'error');\n    }\n  }\n\n  /**\n   * Carica le statistiche dello storage\n   */\n  async loadStorageStats() {\n    try {\n      const modal = document.getElementById('settings-modal');\n      if (!modal) return;\n\n      // Ottieni statistiche dal database\n      const stats = await StorageService.getStats();\n      const apps = await StorageService.getAllApps();\n      \n      // Calcola dimensioni\n      const dbSize = await StorageService.estimateDbSize();\n      \n      // Aggiorna UI\n      const storageUsedEl = modal.querySelector('#storage-used');\n      const appsCountEl = modal.querySelector('#apps-count');\n      const cacheSizeEl = modal.querySelector('#cache-size');\n      \n      if (storageUsedEl) {\n        storageUsedEl.textContent = formatFileSize(dbSize);\n      }\n      \n      if (appsCountEl) {\n        appsCountEl.textContent = apps.length.toString();\n      }\n      \n      if (cacheSizeEl) {\n        // Stima della cache (se disponibile)\n        const cacheSize = stats.cacheSize || 0;\n        cacheSizeEl.textContent = formatFileSize(cacheSize);\n      }\n      \n    } catch (error) {\n      console.error('Errore caricamento statistiche storage:', error);\n      \n      const modal = document.getElementById('settings-modal');\n      if (modal) {\n        const elements = ['storage-used', 'apps-count', 'cache-size'];\n        elements.forEach(id => {\n          const el = modal.querySelector(`#${id}`);\n          if (el) el.textContent = 'Errore caricamento';\n        });\n      }\n    }\n  }\n\n  /**\n   * Carica le informazioni di sistema\n   */\n  loadSystemInfo() {\n    try {\n      const modal = document.getElementById('settings-modal');\n      if (!modal) return;\n\n      // Informazioni di sistema\n      const userAgentEl = modal.querySelector('#user-agent');\n      const platformEl = modal.querySelector('#platform');\n      const pwaSupportEl = modal.querySelector('#pwa-support');\n      \n      if (userAgentEl) {\n        userAgentEl.textContent = navigator.userAgent.substring(0, 50) + '...';\n      }\n      \n      if (platformEl) {\n        platformEl.textContent = navigator.platform || 'Sconosciuto';\n      }\n      \n      if (pwaSupportEl) {\n        const hasServiceWorker = 'serviceWorker' in navigator;\n        const hasManifest = 'manifest' in document.createElement('link');\n        const hasPushManager = 'PushManager' in window;\n        \n        const pwaFeatures = [];\n        if (hasServiceWorker) pwaFeatures.push('Service Worker');\n        if (hasManifest) pwaFeatures.push('Web App Manifest');\n        if (hasPushManager) pwaFeatures.push('Push Notifications');\n        \n        pwaSupportEl.textContent = pwaFeatures.length > 0 ? pwaFeatures.join(', ') : 'Non supportato';\n      }\n      \n    } catch (error) {\n      console.error('Errore caricamento informazioni sistema:', error);\n      \n      const modal = document.getElementById('settings-modal');\n      if (modal) {\n        const elements = ['user-agent', 'platform', 'pwa-support'];\n        elements.forEach(id => {\n          const el = modal.querySelector(`#${id}`);\n          if (el) el.textContent = 'Errore caricamento';\n        });\n      }\n    }\n  }\n\n  /**\n   * Utility methods\n   */\n  camelToKebab(str) {\n    return str.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, '$1-$2').toLowerCase();\n  }\n\n  kebabToCamel(str) {\n    return str.replace(/-([a-z])/g, (g) => g[1].toUpperCase());\n  }\n\n  /**\n   * Determina se le modifiche richiedono ricaricamento della pagina\n   */\n  requiresReload(formData) {\n    const reloadSettings = [\n      'language',\n      'theme',\n      'enableServiceWorker',\n      'cacheStrategy'\n    ];\n    \n    return reloadSettings.some(setting => {\n      const oldValue = this.currentSettings[setting];\n      const newValue = formData[setting];\n      return oldValue !== undefined && oldValue !== newValue;\n    });\n  }\n\n  /**\n   * Getter per impostazioni correnti\n   */\n  getSetting(key, defaultValue = null) {\n    return this.currentSettings[key] !== undefined ? this.currentSettings[key] : defaultValue;\n  }\n\n  /**\n   * Setter per singola impostazione\n   */\n  async setSetting(key, value) {\n    this.currentSettings[key] = value;\n    await StorageService.setSetting(key, value);\n    this.applySettings();\n  }\n}","/**\n * AIdeas - Debug Utilities\n * Utility per debugging e sviluppo\n */\n\nimport { DEBUG_CONFIG } from './constants.js';\nimport { showToast, showConfirmPopup } from './helpers.js';\n\nexport const DEBUG = {\n  enabled: import.meta.env.DEV || localStorage.getItem('aideas_debug') === 'true',\n  verbose: localStorage.getItem('aideas_verbose_logging') === 'true',\n  \n  log(...args) {\n    if (this.enabled) {\n      console.log('[AIdeas Debug]', ...args);\n    }\n  },\n  \n  warn(...args) {\n    if (this.enabled) {\n      console.warn('[AIdeas Debug]', ...args);\n    }\n  },\n  \n  error(...args) {\n    console.error('[AIdeas Debug]', ...args);\n  },\n  \n  table(data) {\n    if (this.enabled) {\n      console.table(data);\n    }\n  },\n  \n  group(label) {\n    if (this.enabled) {\n      console.group(label);\n    }\n  },\n  \n  groupEnd() {\n    if (this.enabled) {\n      console.groupEnd();\n    }\n  }\n};\n\n// Development console tools\nif (import.meta.env.DEV || DEBUG.enabled) {\n  window.AIdeas_DEV = {\n    // Storage inspection\n    async inspectStorage() {\n      const StorageService = await import('../services/StorageService.js').then(m => m.default);\n      const stats = await StorageService.getStats();\n      const apps = await StorageService.getAllApps();\n      const settings = await StorageService.getAllSettings();\n      \n      console.group(' AIdeas Storage Inspection');\n      console.log('Stats:', stats);\n      console.table(apps);\n      console.log('Settings:', settings);\n      console.groupEnd();\n    },\n    \n    // Performance metrics\n    getPerformance() {\n      return {\n        timing: performance.timing,\n        navigation: performance.navigation,\n        memory: performance.memory\n      };\n    },\n    \n    // Error log\n    getErrors() {\n      return window.AIdeas_ERRORS || [];\n    },\n    \n    // Clear all data\n    clearAllData() {\n      showConfirmPopup({\n        title: 'Pulisci Dati',\n        message: 'Eliminare tutti i dati di AIdeas? Questa operazione non pu essere annullata!',\n        icon: 'danger',\n        confirmText: 'Elimina',\n        cancelText: 'Annulla',\n        type: 'danger'\n      }).then(confirmed => {\n        if (confirmed) {\n          localStorage.clear();\n          sessionStorage.clear();\n          indexedDB.deleteDatabase('aideas-db');\n          showToast('Tutti i dati eliminati', 'success');\n          setTimeout(() => window.location.reload(), 1000);\n        }\n      });\n    },\n    \n    // Enable verbose logging\n    enableVerbose() {\n      localStorage.setItem('aideas_verbose_logging', 'true');\n      DEBUG.verbose = true;\n      console.log('Verbose logging enabled');\n    },\n    \n    // Disable verbose logging\n    disableVerbose() {\n      localStorage.removeItem('aideas_verbose_logging');\n      DEBUG.verbose = false;\n      console.log('Verbose logging disabled');\n    }\n  };\n}\n\n// Tracking degli errori globali\nexport class ErrorTracker {\n  static errors = [];\n  \n  static init() {\n    window.AIdeas_ERRORS = this.errors;\n    \n    window.addEventListener('error', (event) => {\n      this.trackError({\n        type: 'runtime',\n        message: event.message,\n        source: event.filename,\n        lineno: event.lineno,\n        colno: event.colno,\n        stack: event.error?.stack,\n        timestamp: new Date().toISOString()\n      });\n    });\n    \n    window.addEventListener('unhandledrejection', (event) => {\n      this.trackError({\n        type: 'promise',\n        message: event.reason?.message || 'Unhandled Promise Rejection',\n        stack: event.reason?.stack,\n        timestamp: new Date().toISOString()\n      });\n    });\n  }\n  \n  static trackError(error) {\n    this.errors.push(error);\n    if (DEBUG.enabled) {\n      console.error('[AIdeas Error Tracker]', error);\n    }\n    \n    // Limita il numero di errori memorizzati\n    if (this.errors.length > 100) {\n      this.errors.shift();\n    }\n  }\n  \n  static getErrors() {\n    return this.errors;\n  }\n  \n  static clearErrors() {\n    this.errors = [];\n    return true;\n  }\n}\n\n// Performance monitoring\nexport class PerformanceMonitor {\n  static metrics = {\n    marks: {},\n    measures: {},\n    counters: {}\n  };\n  \n  static mark(name) {\n    if (!DEBUG_CONFIG.ENABLE_PERFORMANCE_MARKS) return;\n    \n    const timestamp = performance.now();\n    this.metrics.marks[name] = timestamp;\n    \n    if (DEBUG.verbose) {\n      DEBUG.log(`Performance mark: ${name} at ${timestamp.toFixed(2)}ms`);\n    }\n  }\n  \n  static measure(name, startMark, endMark) {\n    if (!DEBUG_CONFIG.ENABLE_PERFORMANCE_MARKS) return;\n    \n    if (!this.metrics.marks[startMark] || !this.metrics.marks[endMark]) {\n      DEBUG.warn(`Cannot measure ${name}: marks not found`);\n      return;\n    }\n    \n    const duration = this.metrics.marks[endMark] - this.metrics.marks[startMark];\n    this.metrics.measures[name] = duration;\n    \n    if (DEBUG.verbose) {\n      DEBUG.log(`Performance measure: ${name} = ${duration.toFixed(2)}ms`);\n    }\n  }\n  \n  static count(name) {\n    if (!DEBUG_CONFIG.ENABLE_PERFORMANCE_MARKS) return;\n    \n    if (!this.metrics.counters[name]) {\n      this.metrics.counters[name] = 0;\n    }\n    \n    this.metrics.counters[name]++;\n  }\n  \n  static getMetrics() {\n    return this.metrics;\n  }\n  \n  static clearMetrics() {\n    this.metrics = {\n      marks: {},\n      measures: {},\n      counters: {}\n    };\n  }\n}\n\n// Inizializza il tracker degli errori\nErrorTracker.init();","/**\n * AIdeas - Main Entry Point\n * Punto di ingresso principale dell'applicazione\n */\n\nimport StorageService from './services/StorageService.js';\nimport AppLauncher from './components/AppLauncher.js';\nimport AppImporter from './components/AppImporter.js';\nimport AppCard from './components/AppCard.js';\nimport SyncManager from './components/SyncManager.js';\nimport SettingPanel from './components/SettingPanel.js';\nimport { \n  showToast, \n  hideToast, \n  showModal,\n  hideModal,\n  showConfirmPopup,\n  showDeleteAppConfirm,\n  showImportAppConfirm,\n  showResetSettingsConfirm\n} from './utils/helpers.js';\nimport { DEBUG, ErrorTracker, PerformanceMonitor } from './utils/debug.js';\n\n/**\n * Classe principale dell'applicazione AIdeas\n * Gestisce l'inizializzazione e il ciclo di vita dell'app\n */\nclass AIdeasApp {\n  constructor() {\n    this.currentView = 'all';\n    this.currentSort = 'lastUsed';\n    this.currentViewMode = 'grid';\n    this.searchQuery = '';\n    this.apps = [];\n    this.filteredApps = [];\n    \n    // Componenti\n    this.storage = StorageService;\n    this.appLauncher = new AppLauncher();\n    this.appImporter = new AppImporter();\n    this.settingsPanel = new SettingPanel();\n    this.syncManager = new SyncManager();\n    \n    // Inizializza debug\n    ErrorTracker.init(); // Inizializza il tracker di errori\n    \n    // Bind methods\n    this.init = this.init.bind(this);\n    this.setupEventListeners = this.setupEventListeners.bind(this);\n    this.loadApps = this.loadApps.bind(this);\n    this.renderApps = this.renderApps.bind(this);\n    this.filterApps = this.filterApps.bind(this);\n    this.handleSearch = this.handleSearch.bind(this);\n    this.handleCategoryChange = this.handleCategoryChange.bind(this);\n    this.handleSortChange = this.handleSortChange.bind(this);\n    this.handleViewChange = this.handleViewChange.bind(this);\n    this.showAppMenu = this.showAppMenu.bind(this);\n  }\n\n  /**\n   * Inizializza l'applicazione\n   */\n  async init() {\n    try {\n      console.log(' Inizializzazione AIdeas...');\n      \n      // Inizializza storage\n      await this.storage.ensureDbOpen();\n      \n      // Verifica e correggi impostazioni critiche\n      await this.verifyCriticalSettings();\n      \n      // Test impostazioni (solo in debug)\n      if (localStorage.getItem('aideas_debug') === 'true') {\n        await this.testSettings();\n      }\n      \n      // Inizializza componenti\n      await this.appLauncher.init();\n      await this.appImporter.init();\n      await this.settingsPanel.init();\n      await this.syncManager.init();\n      \n      // Configura Google Drive OAuth2 (solo se provider presente)\n      if (this.syncManager.syncProviders && this.syncManager.syncProviders.googledrive) {\n        this.syncManager.syncProviders.googledrive.configure(\n          import.meta.env.VITE_GOOGLE_CLIENT_ID,\n          import.meta.env.VITE_GOOGLE_CLIENT_SECRET\n        );\n      }\n      \n      // Carica app\n      await this.loadApps();\n      \n      // Setup event listeners\n      this.setupEventListeners();\n      \n      // Nascondi loading screen\n      this.hideLoadingScreen();\n      \n      console.log(' AIdeas inizializzata con successo');\n      \n    } catch (error) {\n      console.error(' Errore inizializzazione AIdeas:', error);\n      this.showErrorScreen(error);\n    }\n  }\n\n  /**\n   * Verifica e correggi le impostazioni critiche all'avvio\n   */\n  async verifyCriticalSettings() {\n    console.log(' Verifica impostazioni critiche...');\n    \n    // Verifica defaultLaunchMode\n    const currentLaunchMode = await this.storage.getSetting('defaultLaunchMode');\n    if (!currentLaunchMode || !['iframe', 'newpage'].includes(currentLaunchMode)) {\n      console.log(' defaultLaunchMode non valido, correzione a \"newpage\"');\n      await this.storage.setSetting('defaultLaunchMode', 'newpage');\n    }\n    \n    // Verifica altre impostazioni critiche\n    const criticalSettings = {\n      maxConcurrentApps: { min: 1, max: 10, default: 5 },\n      language: { valid: ['it', 'en'], default: 'it' },\n      theme: { valid: ['light', 'dark', 'auto'], default: 'auto' }\n    };\n    \n    for (const [key, validation] of Object.entries(criticalSettings)) {\n      const value = await this.storage.getSetting(key);\n      \n      if (validation.min !== undefined && validation.max !== undefined) {\n        // Validazione numerica\n        if (typeof value !== 'number' || value < validation.min || value > validation.max) {\n          console.log(` ${key} non valido (${value}), correzione a ${validation.default}`);\n          await this.storage.setSetting(key, validation.default);\n        }\n      } else if (validation.valid) {\n        // Validazione enum\n        if (!validation.valid.includes(value)) {\n          console.log(` ${key} non valido (${value}), correzione a ${validation.default}`);\n          await this.storage.setSetting(key, validation.default);\n        }\n      }\n    }\n    \n    console.log(' Impostazioni critiche verificate');\n  }\n\n  /**\n   * Mostra loading screen\n   */\n  showLoadingScreen() {\n    const loadingScreen = document.getElementById('loading-screen');\n    const appContainer = document.getElementById('app');\n    \n    if (loadingScreen && appContainer) {\n      loadingScreen.style.display = 'flex';\n      appContainer.style.display = 'none';\n    }\n  }\n\n  /**\n   * Nascondi loading screen\n   */\n  hideLoadingScreen() {\n    const loadingScreen = document.getElementById('loading-screen');\n    const appContainer = document.getElementById('app');\n    \n    if (loadingScreen) {\n      loadingScreen.style.opacity = '0';\n      setTimeout(() => {\n        loadingScreen.style.display = 'none';\n      }, 300);\n    }\n    \n    if (appContainer) {\n      appContainer.style.display = 'block';\n    }\n  }\n\n  /**\n   * Mostra schermata di errore\n   */\n  showErrorScreen(error) {\n    console.error('Errore critico:', error);\n    \n    const loadingScreen = document.getElementById('loading-screen');\n    if (loadingScreen) {\n      loadingScreen.innerHTML = `\n        <div class=\"error-screen\">\n          <div class=\"error-icon\"></div>\n          <h1>Errore di Inizializzazione</h1>\n          <p>Si  verificato un errore durante l'avvio dell'applicazione.</p>\n          <p class=\"error-details\">${error.message}</p>\n          <button onclick=\"location.reload()\" class=\"btn btn-primary\">Riprova</button>\n        </div>\n      `;\n    }\n  }\n\n  /**\n   * Mostra messaggio di benvenuto se abilitato\n   */\n  async showWelcomeMessage() {\n    const showWelcome = await this.storage.getSetting('showWelcomeMessage', true);\n    if (showWelcome) {\n      // Mostra messaggio di benvenuto\n      showToast('Benvenuto in AIdeas! ', 'success', 3000);\n    }\n  }\n\n  /**\n   * Inizializza il database storage\n   */\n  async initializeStorage() {\n    try {\n      // Il StorageService  gi inizializzato come singleton\n      const stats = await StorageService.getStats();\n      console.log(' Database stats:', stats);\n    } catch (error) {\n      console.error('Errore inizializzazione storage:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Carica impostazioni utente\n   */\n  async loadUserSettings() {\n    try {\n      const settings = await StorageService.getAllSettings();\n      \n      // Applica impostazioni\n      this.currentViewMode = settings.viewMode || 'grid';\n      this.currentSort = settings.sortBy || 'lastUsed';\n      \n      // Applica tema\n      if (settings.theme) {\n        document.documentElement.setAttribute('data-theme', settings.theme);\n      } else {\n        document.documentElement.setAttribute('data-theme', 'dark');\n      }\n      \n      // Applica lingua\n      if (settings.language) {\n        document.documentElement.setAttribute('lang', settings.language);\n      }\n      \n    } catch (error) {\n      console.error('Errore caricamento impostazioni:', error);\n      // Forza comunque il tema scuro in caso di errore\n      document.documentElement.setAttribute('data-theme', 'dark');\n    }\n  }\n\n  /**\n   * Setup event listeners\n   */\n  setupEventListeners() {\n    // Sidebar toggle\n    const sidebarToggle = document.getElementById('sidebar-toggle');\n    const sidebar = document.getElementById('sidebar');\n    const layout = document.querySelector('.app-layout');\n    \n    sidebarToggle?.addEventListener('click', () => {\n      sidebar?.classList.toggle('sidebar-open');\n      // Aggiungi/rimuovi classe al layout per gestire l'espansione del contenuto\n      if (sidebar?.classList.contains('sidebar-open')) {\n        layout?.classList.remove('sidebar-collapsed');\n      } else {\n        layout?.classList.add('sidebar-collapsed');\n      }\n    });\n\n    // Mobile search toggle\n    const mobileSearchToggle = document.getElementById('mobile-search-toggle');\n    const mobileSearchClose = document.getElementById('mobile-search-close');\n    const searchContainer = document.querySelector('.search-container');\n    const headerSearch = document.querySelector('.header-search');\n    const searchInput = document.getElementById('search-input');\n    \n    mobileSearchToggle?.addEventListener('click', () => {\n      headerSearch?.classList.toggle('search-active');\n      if (headerSearch?.classList.contains('search-active')) {\n        // Focus sull'input quando si apre\n        setTimeout(() => {\n          searchInput?.focus();\n        }, 100);\n      }\n    });\n\n    mobileSearchClose?.addEventListener('click', () => {\n      headerSearch?.classList.remove('search-active');\n      searchInput?.blur();\n    });\n\n    // Chiudi ricerca mobile quando si clicca fuori\n    document.addEventListener('click', (e) => {\n      if (!searchContainer?.contains(e.target) && !mobileSearchToggle?.contains(e.target)) {\n        headerSearch?.classList.remove('search-active');\n      }\n    });\n\n    // Search input\n    const searchInputEl = document.getElementById('search-input');\n    searchInputEl?.addEventListener('input', this.handleSearch);\n    searchInputEl?.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        // Chiudi ricerca mobile su ESC\n        headerSearch?.classList.remove('search-active');\n        searchInputEl.blur();\n      }\n    });\n\n    // Category navigation\n    const categoryNavs = document.querySelectorAll('[data-category]');\n    categoryNavs.forEach(nav => {\n      nav.addEventListener('click', this.handleCategoryChange);\n    });\n\n    // Sort select\n    const sortSelect = document.getElementById('sort-select');\n    sortSelect?.addEventListener('change', this.handleSortChange);\n\n    // View toggle\n    const viewButtons = document.querySelectorAll('.view-btn');\n    viewButtons.forEach(btn => {\n      btn.addEventListener('click', this.handleViewChange);\n    });\n\n    // Add app buttons\n    const addAppBtns = document.querySelectorAll('#add-app-btn, #fab-add, #empty-add-btn');\n    addAppBtns.forEach(btn => {\n      btn.addEventListener('click', () => this.showAddAppModal());\n    });\n\n    // Settings button\n    const settingsBtn = document.getElementById('settings-btn');\n    settingsBtn?.addEventListener('click', () => {\n      this.showSettingsModal();\n    });\n\n    // User menu\n    const userBtn = document.getElementById('user-btn');\n    const userDropdown = document.getElementById('user-dropdown');\n    \n    userBtn?.addEventListener('click', (e) => {\n      e.stopPropagation();\n      userDropdown?.classList.toggle('show');\n    });\n\n    document.addEventListener('click', () => {\n      userDropdown?.classList.remove('show');\n    });\n\n    // User menu actions\n    document.getElementById('settings-link')?.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.showSettingsModal();\n    });\n\n    document.getElementById('export-link')?.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.exportData();\n    });\n\n    document.getElementById('import-link')?.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.importData();\n    });\n\n    document.getElementById('about-link')?.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.showAboutModal();\n    });\n\n    // Sync button\n    document.getElementById('sync-btn')?.addEventListener('click', () => {\n      this.syncManager.showSyncModal();\n    });\n\n    // App store button\n    document.getElementById('app-store-btn')?.addEventListener('click', () => {\n      this.showAppStoreModal();\n    });\n\n    // Keyboard shortcuts\n    document.addEventListener('keydown', this.handleKeyboardShortcuts.bind(this));\n\n    // Resize handler\n    window.addEventListener('resize', this.handleResize.bind(this));\n\n    // Chiudi sidebar su click esterno\n    document.addEventListener('click', (e) => {\n      if (!sidebar?.contains(e.target) && !sidebarToggle?.contains(e.target)) {\n        sidebar?.classList.remove('sidebar-open');\n        layout?.classList.add('sidebar-collapsed');\n      }\n    });\n  }\n\n  /**\n   * Carica tutte le app dal database\n   */\n  async loadApps() {\n    try {\n      this.apps = await StorageService.getAllApps();\n      this.filterApps();\n      this.updateCategoryCounts();\n    } catch (error) {\n      console.error('Errore caricamento apps:', error);\n      showToast('Errore durante il caricamento delle app', 'error');\n    }\n  }\n\n  /**\n   * Filtra e ordina le app\n   */\n  filterApps() {\n    let filtered = [...this.apps];\n\n    // Filtra per categoria\n    if (this.currentView === 'favorites') {\n      filtered = filtered.filter(app => app.favorite);\n    } else if (this.currentView === 'recent') {\n      // Ultimi 30 giorni\n      const thirtyDaysAgo = new Date();\n      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n      filtered = filtered.filter(app => new Date(app.lastUsed) > thirtyDaysAgo);\n    } else if (this.currentView !== 'all') {\n      filtered = filtered.filter(app => app.category === this.currentView);\n    }\n\n    // Filtra per ricerca\n    if (this.searchQuery) {\n      const query = this.searchQuery.toLowerCase();\n      filtered = filtered.filter(app => \n        app.name.toLowerCase().includes(query) ||\n        app.description.toLowerCase().includes(query) ||\n        app.tags.some(tag => tag.toLowerCase().includes(query))\n      );\n    }\n\n    // Ordina\n    filtered.sort((a, b) => {\n      switch (this.currentSort) {\n      case 'name':\n        return a.name.localeCompare(b.name);\n      case 'installDate':\n        return new Date(b.installDate) - new Date(a.installDate);\n      case 'category':\n        return a.category.localeCompare(b.category);\n      case 'lastUsed':\n      default:\n        return new Date(b.lastUsed) - new Date(a.lastUsed);\n      }\n    });\n\n    this.filteredApps = filtered;\n    this.renderApps();\n  }\n\n  /**\n   * Renderizza le app nella UI\n   */\n  renderApps() {\n    const appsGrid = document.getElementById('apps-grid');\n    const emptyState = document.getElementById('empty-state');\n\n    if (!appsGrid) return;\n\n    // Aggiorna classe per view mode\n    appsGrid.className = `apps-${this.currentViewMode}`;\n\n    if (this.filteredApps.length === 0) {\n      appsGrid.style.display = 'none';\n      emptyState.style.display = 'flex';\n      return;\n    }\n\n    emptyState.style.display = 'none';\n    \n    // Imposta display corretto per ogni modalit\n    if (this.currentViewMode === 'launcher') {\n      appsGrid.style.display = 'grid';\n      appsGrid.innerHTML = this.filteredApps.map(app => \n        this.renderLauncherItem(app)\n      ).join('');\n    } else {\n      appsGrid.style.display = this.currentViewMode === 'list' ? 'flex' : 'grid';\n      appsGrid.innerHTML = this.filteredApps.map(app => \n        AppCard.render(app)\n      ).join('');\n    }\n\n    // Aggiungi event listeners alle app cards\n    this.setupAppCardListeners();\n  }\n\n  /**\n   * Renderizza un elemento della vista launcher\n   */\n  renderLauncherItem(app) {\n    const iconHtml = app.icon ? \n      `<img src=\"${app.icon}\" alt=\"${app.name}\" onerror=\"this.style.display='none'; this.nextElementSibling.style.display='flex';\">` : \n      '';\n    \n    const defaultIcon = `\n      <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" style=\"display: ${app.icon ? 'none' : 'flex'};\">\n        <path d=\"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z\"/>\n      </svg>\n    `;\n\n    const badgeHtml = app.type ? `\n      <div class=\"app-launcher-badge\">\n        <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          ${app.type === 'pwa' ? '<path d=\"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4Z\"/>' : \n            app.type === 'zip' ? '<path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>' :\n            '<path d=\"M3.27,1L2,2.27L5.18,5.44L5.64,6H21L19.73,7L21,8.27L19,10.27V20A1,1 0 0,1 18,21H6A1,1 0 0,1 5,20V10L3.27,8.27L1,6L2.28,4.73L3.27,1M7,18H17V10H7V18Z\"/>'}\n        </svg>\n      </div>\n    ` : '';\n\n    return `\n      <div class=\"app-launcher-item\" data-app-id=\"${app.id}\" data-app-name=\"${app.name}\">\n        <div class=\"app-launcher-icon\">\n          ${iconHtml}\n          ${defaultIcon}\n          ${badgeHtml}\n        </div>\n        <div class=\"app-launcher-name\">${app.name}</div>\n      </div>\n    `;\n  }\n\n  /**\n   * Setup event listeners per le app cards\n   */\n  setupAppCardListeners() {\n    // Launch app\n    document.querySelectorAll('.app-card-launch').forEach(btn => {\n      btn.addEventListener('click', async (e) => {\n        e.stopPropagation();\n        const appId = parseInt(btn.dataset.appId);\n        await this.launchApp(appId);\n      });\n    });\n\n    // Toggle favorite\n    document.querySelectorAll('.app-card-favorite').forEach(btn => {\n      btn.addEventListener('click', async (e) => {\n        e.stopPropagation();\n        const appId = parseInt(btn.dataset.appId);\n        await this.toggleFavorite(appId);\n      });\n    });\n\n    // App menu\n    document.querySelectorAll('.app-card-menu').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        const appId = parseInt(btn.dataset.appId);\n        this.showAppMenu(appId, e.target);\n      });\n    });\n\n    // Card click to launch\n    document.querySelectorAll('.app-card').forEach(card => {\n      card.addEventListener('click', async () => {\n        const appId = parseInt(card.dataset.appId);\n        await this.launchApp(appId);\n      });\n    });\n\n    // Launcher view items\n    document.querySelectorAll('.app-launcher-item').forEach(item => {\n      let pressTimer;\n      let isLongPress = false;\n\n      // Click per avviare\n      item.addEventListener('click', async (e) => {\n        if (!isLongPress) {\n          const appId = parseInt(item.dataset.appId);\n          await this.launchApp(appId);\n        }\n        isLongPress = false;\n      });\n\n      // Long press per informazioni\n      item.addEventListener('mousedown', (e) => {\n        pressTimer = setTimeout(() => {\n          isLongPress = true;\n          const appId = parseInt(item.dataset.appId);\n          this.showLauncherAppInfo(appId, item);\n        }, 500); // 500ms per long press\n      });\n\n      item.addEventListener('mouseup', () => {\n        clearTimeout(pressTimer);\n      });\n\n      item.addEventListener('mouseleave', () => {\n        clearTimeout(pressTimer);\n      });\n\n      // Touch events per mobile\n      item.addEventListener('touchstart', (e) => {\n        pressTimer = setTimeout(() => {\n          isLongPress = true;\n          const appId = parseInt(item.dataset.appId);\n          this.showLauncherAppInfo(appId, item);\n        }, 500);\n      });\n\n      item.addEventListener('touchend', () => {\n        clearTimeout(pressTimer);\n      });\n\n      item.addEventListener('touchcancel', () => {\n        clearTimeout(pressTimer);\n      });\n    });\n  }\n\n  /**\n   * Lancia un'app\n   */\n  async launchApp(appId) {\n    try {\n      const app = await StorageService.getApp(appId);\n      if (!app) {\n        showToast('App non trovata', 'error');\n        return;\n      }\n\n      // Aggiorna ultimo utilizzo\n      await StorageService.updateLastUsed(appId);\n      \n      // Lancia l'app\n      await this.appLauncher.launch(app);\n      \n      // Aggiorna la lista\n      await this.loadApps();\n      \n    } catch (error) {\n      console.error('Errore lancio app:', error);\n      showToast('Errore durante il lancio dell\\'app', 'error');\n    }\n  }\n\n  /**\n   * Toggle favorite status\n   */\n  async toggleFavorite(appId) {\n    try {\n      const newStatus = await StorageService.toggleFavorite(appId);\n      showToast(newStatus ? 'Aggiunta ai preferiti' : 'Rimossa dai preferiti', 'success');\n      await this.loadApps();\n    } catch (error) {\n      console.error('Errore toggle favorite:', error);\n      showToast('Errore durante l\\'operazione', 'error');\n    }\n  }\n\n  /**\n   * Handlers per eventi UI\n   */\n  handleSearch(e) {\n    this.searchQuery = e.target.value.trim();\n    this.filterApps();\n  }\n\n  handleCategoryChange(e) {\n    e.preventDefault();\n    const category = e.target.dataset.category || e.target.closest('[data-category]').dataset.category;\n    \n    // Aggiorna UI navigazione\n    document.querySelectorAll('.nav-link').forEach(link => {\n      link.classList.remove('active');\n    });\n    \n    // Controllo null per evitare errore\n    const clickedLink = e.target.closest('.nav-link');\n    if (clickedLink) {\n      clickedLink.classList.add('active');\n    }\n    \n    // Aggiorna view\n    this.currentView = category;\n    this.updateSectionTitle();\n    this.filterApps();\n  }\n\n  handleSortChange(e) {\n    this.currentSort = e.target.value;\n    StorageService.setSetting('sortBy', this.currentSort);\n    this.filterApps();\n  }\n\n  handleViewChange(e) {\n    const viewMode = e.target.dataset.view || e.target.closest('[data-view]').dataset.view;\n    \n    // Aggiorna UI buttons - rimuovi active da tutti i pulsanti di vista\n    document.querySelectorAll('.view-btn[data-view]').forEach(btn => {\n      btn.classList.remove('active');\n    });\n    \n    // Aggiungi active solo al pulsante cliccato\n    const clickedBtn = e.target.closest('.view-btn[data-view]');\n    if (clickedBtn) {\n      clickedBtn.classList.add('active');\n    }\n    \n    // Aggiorna view\n    this.currentViewMode = viewMode;\n    StorageService.setSetting('viewMode', this.currentViewMode);\n    this.renderApps();\n  }\n\n  /**\n   * Gestione keyboard shortcuts\n   */\n  handleKeyboardShortcuts(e) {\n    // Ctrl/Cmd + K per focus search\n    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {\n      e.preventDefault();\n      document.getElementById('search-input')?.focus();\n    }\n    \n    // Ctrl/Cmd + N per nuova app\n    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {\n      e.preventDefault();\n      this.showAddAppModal();\n    }\n    \n    // Escape per chiudere modals\n    if (e.key === 'Escape') {\n      this.closeAllModals();\n    }\n  }\n\n  /**\n   * Gestione resize\n   */\n  handleResize() {\n    const sidebar = document.getElementById('sidebar');\n    const layout = document.querySelector('.app-layout');\n    \n    // Chiudi sidebar su resize se mobile e sidebar  aperta\n    if (window.innerWidth > 768) {\n      // Su desktop, mantieni lo stato della sidebar\n      // Non chiudere automaticamente\n    } else {\n      // Su mobile, chiudi la sidebar se  aperta\n      if (sidebar?.classList.contains('sidebar-open')) {\n        sidebar.classList.remove('sidebar-open');\n        layout?.classList.add('sidebar-collapsed');\n      }\n    }\n  }\n\n  /**\n   * Aggiorna titolo sezione\n   */\n  updateSectionTitle() {\n    const sectionTitle = document.getElementById('section-title');\n    const sectionSubtitle = document.getElementById('section-subtitle');\n    \n    const titles = {\n      'all': { title: 'Tutte le App', subtitle: 'Gestisci le tue applicazioni web' },\n      'favorites': { title: 'App Preferite', subtitle: 'Le tue app pi amate' },\n      'recent': { title: 'App Recenti', subtitle: 'Utilizzate negli ultimi 30 giorni' }\n    };\n    \n    const titleData = titles[this.currentView] || { \n      title: this.currentView.charAt(0).toUpperCase() + this.currentView.slice(1), \n      subtitle: `App della categoria ${this.currentView}` \n    };\n    \n    if (sectionTitle) sectionTitle.textContent = titleData.title;\n    if (sectionSubtitle) sectionSubtitle.textContent = titleData.subtitle;\n  }\n\n  /**\n   * Aggiorna contatori categorie\n   */\n  updateCategoryCounts() {\n    // Contatore app totali\n    const allCount = document.getElementById('all-count');\n    if (allCount) allCount.textContent = this.apps.length;\n    \n    // Contatore preferiti\n    const favoritesCount = document.getElementById('favorites-count');\n    const favorites = this.apps.filter(app => app.favorite).length;\n    if (favoritesCount) favoritesCount.textContent = favorites;\n    \n    // Aggiorna categorie dinamiche\n    this.updateDynamicCategories();\n  }\n\n  /**\n   * Aggiorna categorie dinamiche nella sidebar\n   */\n  updateDynamicCategories() {\n    const dynamicCategories = document.getElementById('dynamic-categories');\n    if (!dynamicCategories) return;\n    \n    // Raggruppa per categoria\n    const categoryMap = new Map();\n    this.apps.forEach(app => {\n      const category = app.category || 'uncategorized';\n      categoryMap.set(category, (categoryMap.get(category) || 0) + 1);\n    });\n    \n    // Renderizza categorie\n    const categoryItems = Array.from(categoryMap.entries())\n      .sort(([a], [b]) => a.localeCompare(b))\n      .map(([category, count]) => `\n        <li class=\"nav-item\">\n          <a href=\"#\" class=\"nav-link\" data-category=\"${category}\">\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z\"/>\n            </svg>\n            ${category}\n            <span class=\"nav-badge\">${count}</span>\n          </a>\n        </li>\n      `).join('');\n    \n    dynamicCategories.innerHTML = categoryItems;\n    \n    // Riattacca event listeners\n    dynamicCategories.querySelectorAll('[data-category]').forEach(nav => {\n      nav.addEventListener('click', this.handleCategoryChange);\n    });\n  }\n\n  /**\n   * Mostra modal aggiungi app\n   */\n  showAddAppModal() {\n    console.log(' Tentativo apertura modal aggiungi app...');\n    if (this.appImporter && typeof this.appImporter.showModal === 'function') {\n      this.appImporter.showModal();\n    } else {\n      console.error(' AppImporter non disponibile o showModal non  una funzione');\n      showToast('Errore: componente importazione non disponibile', 'error');\n    }\n  }\n\n  /**\n   * Mostra modal impostazioni\n   */\n  showSettingsModal() {\n    this.settingsPanel.showModal();\n  }\n\n  /**\n   * Mostra modal about\n   */\n  showAboutModal() {\n    showModal('about-modal', `\n      <div class=\"modal-header\">\n        <h2>Su AIdeas</h2>\n        <button class=\"modal-close\" onclick=\"hideModal('about-modal')\">&times;</button>\n      </div>\n      <div class=\"modal-body\">\n        <div class=\"about-content\">\n          <div class=\"about-logo\">\n            <svg viewBox=\"0 0 100 100\" class=\"about-icon\">\n              <defs>\n                <linearGradient id=\"aboutGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                  <stop offset=\"0%\" style=\"stop-color:#2563eb\"/>\n                  <stop offset=\"100%\" style=\"stop-color:#1d4ed8\"/>\n                </linearGradient>\n              </defs>\n              <rect x=\"10\" y=\"10\" width=\"80\" height=\"80\" rx=\"16\" fill=\"url(#aboutGradient)\"/>\n              <text x=\"50\" y=\"65\" text-anchor=\"middle\" fill=\"white\" font-size=\"32\" font-weight=\"bold\">S</text>\n            </svg>\n          </div>\n          <h3>AIdeas v1.0.0</h3>\n          <p><strong>Swiss Army Knife by AI</strong></p>\n          <p>Launcher per applicazioni web generate da AI</p>\n          <div class=\"about-features\">\n            <h4>Caratteristiche:</h4>\n            <ul>\n              <li> 100% Client-side</li>\n              <li> Funziona offline</li>\n              <li> Sincronizzazione cloud opzionale</li>\n              <li> Sandbox sicuro per le app</li>\n              <li> Import/Export profili</li>\n            </ul>\n          </div>\n          <div class=\"about-links\">\n            <a href=\"https://github.com/aideas-run/aideas-run\" target=\"_blank\" rel=\"noopener\">GitHub</a>\n            <a href=\"https://aideas.run/docs\" target=\"_blank\" rel=\"noopener\">Documentazione</a>\n          </div>\n        </div>\n      </div>\n    `);\n  }\n\n  /**\n   * Mostra modal app store\n   */\n  showAppStoreModal() {\n    showModal('app-store-modal', `\n      <div class=\"modal-header\">\n        <h2>AIdeas App Store</h2>\n        <button class=\"modal-close\" onclick=\"hideModal('app-store-modal')\">&times;</button>\n      </div>\n      <div class=\"modal-body\">\n        <p>App Store in arrivo nella prossima versione...</p>\n        <p>Nel frattempo puoi aggiungere app tramite:</p>\n        <ul>\n          <li>File ZIP</li>\n          <li>URL diretto</li>\n          <li>Repository GitHub</li>\n        </ul>\n      </div>\n    `);\n  }\n\n  /**\n   * Esporta dati\n   */\n  async exportData() {\n    try {\n      const data = await StorageService.exportAllData();\n      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      \n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `aideas-backup-${new Date().toISOString().split('T')[0]}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      \n      showToast('Dati esportati con successo', 'success');\n    } catch (error) {\n      console.error('Errore export:', error);\n      showToast('Errore durante l\\'esportazione', 'error');\n    }\n  }\n\n  /**\n   * Importa dati\n   */\n  importData() {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.json';\n    \n    input.onchange = async (e) => {\n      try {\n        const file = e.target.files[0];\n        if (!file) return;\n        \n        const text = await file.text();\n        const data = JSON.parse(text);\n        \n        await StorageService.importData(data);\n        await this.loadApps();\n        \n        showToast('Dati importati con successo', 'success');\n      } catch (error) {\n        console.error('Errore import:', error);\n        showToast('Errore durante l\\'importazione', 'error');\n      }\n    };\n    \n    input.click();\n  }\n\n  /**\n   * Inizializza componenti\n   */\n  async initializeComponents() {\n    await this.appImporter.init();\n    await this.settingsPanel.init();\n  }\n\n  /**\n   * Inizializza sync\n   */\n  async initializeSync() {\n    // DISABILITATO TEMPORANEAMENTE - SyncManager non disponibile\n    /*\n    // Inizializza sync solo se configurato\n    const syncEnabled = await StorageService.getSetting('syncEnabled', false);\n    if (syncEnabled) {\n      await this.syncManager.autoSync();\n    }\n    */\n  }\n\n  /**\n   * Controlla se  la prima esecuzione\n   */\n  async checkFirstRun() {\n    const isFirstRun = await StorageService.getSetting('firstRun', true);\n    if (isFirstRun) {\n      await StorageService.setSetting('firstRun', false);\n      showToast('Benvenuto in AIdeas! Inizia aggiungendo la tua prima app.', 'info', 5000);\n    }\n  }\n\n  /**\n   * Aggiorna UI generale\n   */\n  updateUI() {\n    this.updateSectionTitle();\n    this.updateCategoryCounts();\n    \n    // Applica view mode - rimuovi active da tutti i pulsanti di vista\n    document.querySelectorAll('.view-btn[data-view]').forEach(btn => {\n      btn.classList.remove('active');\n    });\n    \n    // Aggiungi active solo al pulsante della vista corrente\n    const currentViewBtn = document.querySelector(`[data-view=\"${this.currentViewMode}\"]`);\n    if (currentViewBtn) {\n      currentViewBtn.classList.add('active');\n    }\n    \n    // Applica sort\n    const sortSelect = document.getElementById('sort-select');\n    if (sortSelect) sortSelect.value = this.currentSort;\n    \n    // Inizializza stato sidebar\n    const sidebar = document.getElementById('sidebar');\n    const layout = document.querySelector('.app-layout');\n    if (sidebar && layout) {\n      if (!sidebar.classList.contains('sidebar-open')) {\n        layout.classList.add('sidebar-collapsed');\n      } else {\n        layout.classList.remove('sidebar-collapsed');\n      }\n    }\n  }\n\n  /**\n   * Chiudi tutti i modals\n   */\n  closeAllModals() {\n    document.querySelectorAll('.modal').forEach(modal => {\n      hideModal(modal.id);\n    });\n  }\n\n  /**\n   * Mostra errore\n   */\n  showError(message) {\n    showToast(message, 'error');\n  }\n\n  /**\n   * Mostra il menu contestuale per una app (con opzione Modifica)\n   */\n  async showAppMenu(appId, targetEl) {\n    const app = await StorageService.getApp(appId);\n    if (!app) return;\n    \n    // Genera menu contestuale usando le classi CSS\n    const menuHtml = `\n      <div class=\"app-context-menu\">\n        <div class=\"context-menu-item\" data-action=\"edit\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z\"/>\n          </svg>\n          Modifica\n        </div>\n        <div class=\"context-menu-separator\"></div>\n        <div class=\"context-menu-item context-menu-danger\" data-action=\"delete\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z\"/>\n          </svg>\n          Elimina\n        </div>\n      </div>\n    `;\n    \n    // Rimuovi eventuali menu gi aperti\n    document.querySelectorAll('.app-context-menu').forEach(el => el.remove());\n    \n    // Inserisci menu nel DOM\n    const menuDiv = document.createElement('div');\n    menuDiv.innerHTML = menuHtml;\n    document.body.appendChild(menuDiv.firstElementChild);\n    const menu = document.querySelector('.app-context-menu');\n    \n    // Posiziona il menu vicino al target\n    const rect = targetEl.getBoundingClientRect();\n    const menuRect = menu.getBoundingClientRect();\n    \n    // Calcola posizione ottimale\n    let top = rect.bottom + window.scrollY + 4;\n    let left = rect.left + window.scrollX;\n    \n    // Evita che il menu esca dallo schermo\n    if (top + menuRect.height > window.innerHeight + window.scrollY) {\n      top = rect.top + window.scrollY - menuRect.height - 4;\n    }\n    \n    if (left + menuRect.width > window.innerWidth + window.scrollX) {\n      left = rect.right + window.scrollX - menuRect.width;\n    }\n    \n    menu.style.top = `${top}px`;\n    menu.style.left = `${left}px`;\n    \n    // Listener click fuori dal menu per chiuderlo\n    const closeMenu = (e) => {\n      if (!menu.contains(e.target)) {\n        menu.remove();\n        document.removeEventListener('mousedown', closeMenu);\n      }\n    };\n    \n    setTimeout(() => document.addEventListener('mousedown', closeMenu), 10);\n    \n    // Listener click su Modifica\n    menu.querySelector('[data-action=\"edit\"]').addEventListener('click', async () => {\n      menu.remove();\n      await this.showEditAppModal(app);\n    });\n    \n    // Listener per Elimina\n    menu.querySelector('[data-action=\"delete\"]').addEventListener('click', async () => {\n      menu.remove();\n      if (await showDeleteAppConfirm(app.name)) {\n        await StorageService.deleteApp(appId);\n        showToast('App eliminata', 'success');\n        this.loadApps();\n      }\n    });\n  }\n\n  /**\n   * Mostra il modale di modifica app (riutilizza la form di AppImporter)\n   */\n  async showEditAppModal(app) {\n    // Crea una copia dei dati per non modificarli direttamente\n    const appData = { ...app };\n    // Genera la form di metadati (come in AppImporter)\n    const modalContent = `\n      <div class=\"modal-header\">\n        <h2>\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"header-icon\"><path d=\"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z\"/></svg>\n          Modifica App\n        </h2>\n        <button class=\"modal-close\" id=\"close-edit-modal\">&times;</button>\n      </div>\n      <div class=\"modal-body\">\n        <form id=\"edit-app-form\">\n          <div class=\"form-group\">\n            <label for=\"edit-app-name\">Nome App</label>\n            <input type=\"text\" id=\"edit-app-name\" class=\"form-input\" value=\"${appData.name || ''}\" maxlength=\"50\" required>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"edit-app-description\">Descrizione</label>\n            <textarea id=\"edit-app-description\" class=\"form-input\" rows=\"3\" maxlength=\"200\">${appData.description || ''}</textarea>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"edit-app-version\">Versione</label>\n            <input type=\"text\" id=\"edit-app-version\" class=\"form-input\" value=\"${appData.version || '1.0.0'}\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"edit-app-category\">Categoria</label>\n            <input type=\"text\" id=\"edit-app-category\" class=\"form-input\" value=\"${appData.category || ''}\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"edit-app-tags\">Tag (separati da virgola)</label>\n            <input type=\"text\" id=\"edit-app-tags\" class=\"form-input\" value=\"${(appData.tags || []).join(', ')}\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"edit-app-icon\">Icona (URL)</label>\n            <input type=\"url\" id=\"edit-app-icon\" class=\"form-input\" value=\"${appData.icon || ''}\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"edit-app-launch-mode\">Modalit di apertura predefinita</label>\n            <select id=\"edit-app-launch-mode\" class=\"form-input\">\n              <option value=\"\">Usa impostazione globale</option>\n              <option value=\"iframe\" ${appData.metadata?.launchMode === 'iframe' ? 'selected' : ''}>Sempre in finestra modale</option>\n              <option value=\"newpage\" ${appData.metadata?.launchMode === 'newpage' ? 'selected' : ''}>Sempre in nuova pagina</option>\n            </select>\n            <p class=\"setting-description\">Scegli come questa app dovrebbe aprirsi di default</p>\n          </div>\n        </form>\n      </div>\n      <div class=\"modal-footer\">\n        <button class=\"btn btn-secondary\" id=\"cancel-edit-app\">Annulla</button>\n        <button class=\"btn btn-primary\" id=\"save-edit-app\">Salva Modifiche</button>\n      </div>\n    `;\n    showModal('edit-app-modal', modalContent, { size: 'modal-md' });\n    \n    // Listener per chiudere il modal\n    setTimeout(() => {\n      // Listener per il pulsante Annulla\n      document.getElementById('cancel-edit-app')?.addEventListener('click', () => {\n        hideModal('edit-app-modal');\n      });\n      \n      // Listener per il pulsante X\n      document.getElementById('close-edit-modal')?.addEventListener('click', () => {\n        hideModal('edit-app-modal');\n      });\n      \n      // Listener salvataggio\n      document.getElementById('save-edit-app').addEventListener('click', async (e) => {\n        e.preventDefault();\n        // Raccogli dati\n        const updates = {\n          name: document.getElementById('edit-app-name').value.trim(),\n          description: document.getElementById('edit-app-description').value.trim(),\n          version: document.getElementById('edit-app-version').value.trim(),\n          category: document.getElementById('edit-app-category').value.trim(),\n          tags: document.getElementById('edit-app-tags').value.split(',').map(t => t.trim()).filter(Boolean),\n          icon: document.getElementById('edit-app-icon').value.trim()\n        };\n        \n        // Gestione modalit di lancio\n        const launchModeEl = document.getElementById('edit-app-launch-mode');\n        if (launchModeEl && launchModeEl.value) {\n          if (!updates.metadata) updates.metadata = {};\n          updates.metadata.launchMode = launchModeEl.value;\n        } else if (appData.metadata?.launchMode) {\n          // Rimuovi la modalit specifica se  vuota\n          if (!updates.metadata) updates.metadata = {};\n          updates.metadata.launchMode = null;\n        }\n        \n        // Validazione base\n        if (!updates.name) {\n          showToast('Il nome  obbligatorio', 'error');\n          return;\n        }\n        // Aggiorna nel database\n        await StorageService.updateApp(app.id, updates);\n        hideModal('edit-app-modal');\n        showToast('App modificata con successo', 'success');\n        await this.loadApps();\n      });\n    }, 200);\n  }\n\n  /**\n   * Mostra informazioni dell'app nella vista launcher\n   */\n  async showLauncherAppInfo(appId, targetElement) {\n    const app = await StorageService.getApp(appId);\n    if (!app) return;\n\n    // Crea modal con informazioni dell'app\n    const modalContent = `\n      <div class=\"modal-header\">\n        <div class=\"app-modal-title\">\n          <div class=\"app-modal-icon\">\n            ${app.icon ? `<img src=\"${app.icon}\" alt=\"${app.name}\">` : ''}\n          </div>\n          <div>\n            <h2>${app.name}</h2>\n            <p class=\"app-modal-subtitle\">${app.description || ''}</p>\n          </div>\n        </div>\n        <button class=\"modal-close\">&times;</button>\n      </div>\n      <div class=\"modal-body\">\n        <div class=\"app-info-grid\">\n          <div class=\"app-info-section\">\n            <h4>Informazioni</h4>\n            <div class=\"app-info-item\">\n              <span class=\"info-label\">Versione:</span>\n              <span class=\"info-value\">${app.version || 'N/A'}</span>\n            </div>\n            <div class=\"app-info-item\">\n              <span class=\"info-label\">Categoria:</span>\n              <span class=\"info-value\">${app.category || 'Non categorizzata'}</span>\n            </div>\n            <div class=\"app-info-item\">\n              <span class=\"info-label\">Tipo:</span>\n              <span class=\"info-value\">${app.type || 'URL'}</span>\n            </div>\n            <div class=\"app-info-item\">\n              <span class=\"info-label\">Ultimo utilizzo:</span>\n              <span class=\"info-value\">${app.lastUsed ? new Date(app.lastUsed).toLocaleDateString('it-IT') : 'Mai'}</span>\n            </div>\n          </div>\n          \n          ${app.tags && app.tags.length > 0 ? `\n            <div class=\"app-info-section\">\n              <h4>Tag</h4>\n              <div class=\"app-tags\">\n                ${app.tags.map(tag => `<span class=\"app-tag\">${tag}</span>`).join('')}\n              </div>\n            </div>\n          ` : ''}\n        </div>\n        \n        <div class=\"app-actions\">\n          <button class=\"btn btn-primary\" id=\"launch-app-btn\" data-app-id=\"${app.id}\">\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M8,5V19L19,12M19,5V19H21V5M2,5V19H4V5H2Z\"/>\n            </svg>\n            Avvia App\n          </button>\n          <button class=\"btn btn-secondary\" id=\"edit-app-btn\" data-app-id=\"${app.id}\">\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z\"/>\n            </svg>\n            Modifica\n          </button>\n        </div>\n      </div>\n    `;\n\n    const modal = showModal('launcher-app-info', modalContent, {\n      size: 'modal-md',\n      disableBackdropClose: false,\n      disableEscapeClose: false\n    });\n\n    // Event listeners per i pulsanti\n    modal.querySelector('#launch-app-btn')?.addEventListener('click', async () => {\n      hideModal('launcher-app-info');\n      await this.launchApp(appId);\n    });\n\n    modal.querySelector('#edit-app-btn')?.addEventListener('click', async () => {\n      hideModal('launcher-app-info');\n      await this.showEditAppModal(app);\n    });\n  }\n\n  /**\n   * Testa il funzionamento delle impostazioni\n   */\n  async testSettings() {\n    console.log(' Test impostazioni...');\n    \n    try {\n      // Test salvataggio e caricamento\n      const testKey = 'test_setting';\n      const testValue = 'test_value_' + Date.now();\n      \n      await this.storage.setSetting(testKey, testValue);\n      const loadedValue = await this.storage.getSetting(testKey);\n      \n      if (loadedValue === testValue) {\n        console.log(' Test salvataggio/caricamento impostazioni: PASS');\n      } else {\n        console.log(' Test salvataggio/caricamento impostazioni: FAIL');\n      }\n      \n      // Pulisci test\n      await this.storage.setSetting(testKey, null);\n      \n      // Mostra impostazioni attuali\n      const currentSettings = await this.storage.getAllSettings();\n      console.log(' Impostazioni attuali:', currentSettings);\n      \n      // Verifica impostazioni critiche\n      const criticalSettings = ['defaultLaunchMode', 'language', 'theme'];\n      for (const setting of criticalSettings) {\n        const value = await this.storage.getSetting(setting);\n        console.log(` ${setting}: ${value}`);\n      }\n      \n    } catch (error) {\n      console.error(' Errore test impostazioni:', error);\n    }\n  }\n}\n\n/**\n * Bootstrap dell'applicazione\n */\ndocument.addEventListener('DOMContentLoaded', async () => {\n  // Inizializza app\n  const app = new AIdeasApp();\n  \n  // Rendi globale per debugging\n  window.aideasApp = app;\n  \n  // Avvia applicazione\n  await app.init();\n});\n\n// Gestione errori globali\nwindow.addEventListener('error', (e) => {\n  console.error('Errore globale:', e.error);\n  showToast('Si  verificato un errore imprevisto', 'error');\n});\n\nwindow.addEventListener('unhandledrejection', (e) => {\n  console.error('Promise rejections non gestita:', e.reason);\n  showToast('Errore durante un\\'operazione asincrona', 'error');\n});\n\n// Esporta per debug\nexport default AIdeasApp;"],"file":"js/main-BCY9yISv.js"}