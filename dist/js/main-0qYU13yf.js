const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/main-material-CPHUsr9Z.js","js/vendor-Cc5w31rP.js"])))=>i.map(i=>d[i]);
import{D as E}from"./vendor-Cc5w31rP.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();const L="modulepreload",A=function(d){return"/"+d},f={},z=function(e,t,r){let o=Promise.resolve();if(t&&t.length>0){let l=function(n){return Promise.all(n.map(c=>Promise.resolve(c).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");o=l(t.map(n=>{if(n=A(n),n in f)return;f[n]=!0;const c=n.endsWith(".css"),g=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${g}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":L,c||(u.as="script"),u.crossOrigin="",u.href=n,s&&u.setAttribute("nonce",s),document.head.appendChild(u),c)return new Promise((h,p)=>{u.addEventListener("load",h),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${n}`)))})}))}function i(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return o.then(a=>{for(const s of a||[])s.status==="rejected"&&i(s.reason);return e().catch(i)})};class m{constructor(){if(m.instance)return m.instance;this.db=new E("AIdeas_DB"),this.initDatabase(),m.instance=this}initDatabase(){this.db.version(1).stores({apps:"++id, name, description, category, version, url, type, githubUrl, installDate, lastUsed, favorite, *tags",appFiles:"++id, appId, filename, content, size, mimeType",settings:"key, value, lastModified",syncEvents:"++id, timestamp, action, data, synced, deviceId",catalog:"++id, name, description, author, githubUrl, rating, downloads, featured, *categories"}),this.db.apps.hook("creating",(e,t,r)=>{t.installDate=t.installDate||new Date,t.lastUsed=t.lastUsed||new Date,t.favorite=t.favorite||!1,t.tags=t.tags||[]}),this.db.syncEvents.hook("creating",(e,t,r)=>{t.timestamp=t.timestamp||new Date,t.synced=t.synced||!1,t.deviceId=t.deviceId||this.getDeviceId()})}async installApp(e){try{const t={name:e.name,description:e.description||"",category:e.category||"uncategorized",version:e.version||"1.0.0",url:e.url||null,type:e.type,githubUrl:e.githubUrl||null,icon:e.icon||null,manifest:e.manifest||{},permissions:e.permissions||[],tags:e.tags||[],metadata:e.metadata||{},content:e.content||null},r=await this.db.apps.add(t);return e.files&&e.files.length>0&&await this.saveAppFiles(r,e.files),await this.addSyncEvent("app_installed",{appId:r,app:t}),r}catch(t){throw console.error("Errore installazione app:",t),new Error(`Impossibile installare l'app: ${t.message}`)}}async getAllApps(e={}){try{let t=this.db.apps.orderBy("lastUsed").reverse();return e.category&&(t=t.filter(r=>r.category===e.category)),e.search&&(t=t.filter(r=>r.name.toLowerCase().includes(e.search.toLowerCase())||r.description.toLowerCase().includes(e.search.toLowerCase())||r.tags.some(o=>o.toLowerCase().includes(e.search.toLowerCase())))),e.favorite&&(t=t.filter(r=>r.favorite===!0)),await t.toArray()}catch(t){return console.error("Errore recupero app:",t),[]}}async getApp(e){try{return await this.db.apps.get(e)}catch(t){return console.error("Errore recupero app:",t),null}}async updateApp(e,t){try{return await this.db.apps.update(e,t),await this.addSyncEvent("app_updated",{appId:e,updates:t}),!0}catch(r){return console.error("Errore aggiornamento app:",r),!1}}async setAppMetadata(e,t){try{const r=await this.getApp(e);if(!r)throw new Error("App non trovata");const o={...r.metadata,...t};return await this.db.apps.update(e,{metadata:o}),console.log(`âœ… Metadati aggiornati per app ${e}:`,t),!0}catch(r){return console.error("Errore aggiornamento metadati app:",r),!1}}async getAppMetadata(e,t=null){try{const r=await this.getApp(e);return!r||!r.metadata?null:t?r.metadata[t]||null:r.metadata}catch(r){return console.error("Errore recupero metadati app:",r),null}}async migrateAppsForContent(){try{console.log("ðŸ”„ Inizio migrazione app HTML...");const e=await this.db.apps.toArray();console.log(`ðŸ“Š Trovate ${e.length} app totali`);let t=0;for(const r of e)if(console.log(`ðŸ” Controllo app: ${r.name} (tipo: ${r.type})`),r.type==="html"&&!r.content){console.log(`ðŸ“ App HTML senza contenuto trovata: ${r.name}`);const o=await this.getAppFiles(r.id);console.log(`ðŸ“ Trovati ${o.length} file per app ${r.name}`);const i=o.find(a=>a.filename.endsWith(".html"));i?(console.log(`âœ… File HTML trovato: ${i.filename}`),await this.db.apps.update(r.id,{content:i.content}),t++,console.log(`âœ… App ${r.name} migrata con successo`)):console.log(`âš ï¸ Nessun file HTML trovato per app ${r.name}`)}return t>0?console.log(`âœ… Migrate ${t} app HTML per aggiungere campo content`):console.log("â„¹ï¸ Nessuna app HTML da migrare"),t}catch(e){return console.error("âŒ Errore migrazione app:",e),console.error("Stack trace:",e.stack),0}}async deleteApp(e){try{return await this.db.transaction("rw",[this.db.apps,this.db.appFiles],async()=>{await this.db.apps.delete(e),await this.db.appFiles.where("appId").equals(e).delete()}),await this.addSyncEvent("app_deleted",{appId:e}),!0}catch(t){return console.error("Errore eliminazione app:",t),!1}}async updateLastUsed(e){try{await this.db.apps.update(e,{lastUsed:new Date})}catch(t){console.error("Errore aggiornamento ultimo utilizzo:",t)}}async toggleFavorite(e){try{const t=await this.db.apps.get(e);return t?(await this.db.apps.update(e,{favorite:!t.favorite}),!t.favorite):!1}catch(t){return console.error("Errore toggle preferito:",t),!1}}async saveAppFiles(e,t){try{const r=t.map(o=>this.db.appFiles.add({appId:e,filename:o.filename,content:o.content,size:o.size||o.content.length,mimeType:o.mimeType||this.getMimeType(o.filename)}));return await Promise.all(r),!0}catch(r){return console.error("Errore salvataggio file app:",r),!1}}async getAppFiles(e){try{return await this.db.appFiles.where("appId").equals(e).toArray()}catch(t){return console.error("Errore recupero file app:",t),[]}}async getSetting(e,t=null){try{const r=await this.db.settings.get(e);return r?r.value:t}catch(r){return console.error("Errore recupero impostazione:",r),t}}async setSetting(e,t){try{return await this.db.settings.put({key:e,value:t,lastModified:new Date}),!0}catch(r){return console.error("Errore salvataggio impostazione:",r),!1}}async getAllSettings(){try{const e=await this.db.settings.toArray(),t={};return e.forEach(r=>{t[r.key]=r.value}),t}catch(e){return console.error("Errore recupero impostazioni:",e),{}}}async setAllSettings(e){try{const t=[];for(const[r,o]of Object.entries(e))t.push(this.db.settings.put({key:r,value:o,lastModified:new Date}));return await Promise.all(t),!0}catch(t){return console.error("Errore salvataggio impostazioni:",t),!1}}async addSyncEvent(e,t){try{await this.db.syncEvents.add({action:e,data:t,timestamp:new Date,synced:!1,deviceId:await this.getDeviceId()})}catch(r){console.error("Errore aggiunta evento sync:",r)}}async getUnsyncedEvents(){try{return await this.db.syncEvents.where("synced").equals(!1).toArray()}catch(e){return console.error("Errore recupero eventi non sincronizzati:",e),[]}}async markEventsSynced(e){try{await this.db.syncEvents.where("id").anyOf(e).modify({synced:!0})}catch(t){console.error("Errore aggiornamento eventi sync:",t)}}async updateCatalog(e){try{return await this.db.catalog.clear(),await this.db.catalog.bulkAdd(e),!0}catch(t){return console.error("Errore aggiornamento catalogo:",t),!1}}async searchCatalog(e,t={}){try{let r=this.db.catalog.orderBy("downloads").reverse();return e&&(r=r.filter(o=>o.name.toLowerCase().includes(e.toLowerCase())||o.description.toLowerCase().includes(e.toLowerCase())||o.categories.some(i=>i.toLowerCase().includes(e.toLowerCase())))),t.category&&(r=r.filter(o=>o.categories.includes(t.category))),t.featured&&(r=r.filter(o=>o.featured===!0)),await r.limit(t.limit||50).toArray()}catch(r){return console.error("Errore ricerca catalogo:",r),[]}}async getDeviceId(){let e=await this.getSetting("deviceId");return e||(e="device_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),await this.setSetting("deviceId",e)),e}getMimeType(e){const t=e.split(".").pop().toLowerCase();return{html:"text/html",css:"text/css",js:"application/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",txt:"text/plain"}[t]||"application/octet-stream"}async exportAllData(){try{const[e,t,r]=await Promise.all([this.db.apps.toArray(),this.db.settings.toArray(),this.db.syncEvents.toArray()]);return{version:"1.0.0",timestamp:new Date().toISOString(),deviceId:await this.getDeviceId(),data:{apps:e,settings:t,syncEvents:r}}}catch(e){throw console.error("Errore export dati:",e),e}}async importData(e){try{if(!e.data)throw new Error("Formato dati non valido");const{apps:t,settings:r,syncEvents:o}=e.data;return await this.db.transaction("rw",[this.db.apps,this.db.settings,this.db.syncEvents],async()=>{t&&await this.db.apps.bulkPut(t),r&&await this.db.settings.bulkPut(r),o&&await this.db.syncEvents.bulkPut(o)}),!0}catch(t){throw console.error("Errore import dati:",t),t}}async ensureDbOpen(){if(!this.db.isOpen())try{await this.db.open(),console.log("ðŸ“‚ Database riaperto con successo")}catch(e){console.error("âŒ Errore riapertura database:",e)}}async getStats(){try{if(await this.ensureDbOpen(),!this.db||!this.db.isOpen())return console.warn("Database non inizializzato"),null;const t=(await this.db.apps.toArray().catch(()=>[])).filter(n=>n&&typeof n=="object"),r=t.map(n=>n.category).filter(n=>typeof n=="string"&&n.length>0),o=t.filter(n=>n.favorite===!0).length,i=t.length,a=await this.db.appFiles.count().catch(()=>0),s=await this.db.settings.count().catch(()=>0),l=t.length>0?t.reduce((n,c)=>c.installDate&&(!n||new Date(c.installDate)>new Date(n))?c.installDate:n,null):null;return{totalApps:i,totalFiles:a,settingsCount:s,favoriteApps:o,categories:Array.from(new Set(r)).length,lastInstall:l,dbSize:await this.estimateDbSize()}}catch(e){return console.error("Errore recupero statistiche:",e),null}}async estimateDbSize(){try{return"storage"in navigator&&"estimate"in navigator.storage&&(await navigator.storage.estimate()).usage||0}catch{return 0}}async close(){this.db&&this.db.close()}}const v=new m,T=Object.freeze(Object.defineProperty({__proto__:null,default:v},Symbol.toStringTag,{value:"Module"}));let M=0;function C(d,e="info",t=4e3,r={}){const o=document.getElementById("toast-container");if(!o){console.warn("Toast container non trovato");return}const i=`toast-${++M}`,a=document.createElement("div");a.id=i,a.className=`toast toast-${e}`,a.setAttribute("role","alert"),a.setAttribute("aria-live","polite");const s={success:`<svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
    </svg>`,error:`<svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
    </svg>`,warning:`<svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M13,13H11V7H13M12,17.3A1.3,1.3 0 0,1 10.7,16A1.3,1.3 0 0,1 12,14.7A1.3,1.3 0 0,1 13.3,16A1.3,1.3 0 0,1 12,17.3M15.73,3H8.27L3,8.27V15.73L8.27,21H15.73L21,15.73V8.27L15.73,3Z"/>
    </svg>`,info:`<svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
    </svg>`};a.innerHTML=`
    <div class="toast-icon">
      ${s[e]||s.info}
    </div>
    <div class="toast-content">
      <div class="toast-message">${I(d)}</div>
      ${r.action?`<button class="toast-action">${r.action}</button>`:""}
    </div>
    <button class="toast-close" aria-label="Chiudi notifica">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
      </svg>
    </button>
  `;const l=a.querySelector(".toast-close"),n=a.querySelector(".toast-action"),c=()=>{a.classList.add("toast-removing"),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)};return l.addEventListener("click",c),n&&r.onAction&&n.addEventListener("click",()=>{r.onAction(),c()}),o.appendChild(a),requestAnimationFrame(()=>{a.classList.add("toast-show")}),t>0&&setTimeout(c,t),i}function I(d){const e=document.createElement("div");return e.textContent=d,e.innerHTML}function U(d="id"){return`${d}-${Math.random().toString(36).substr(2,9)}-${Date.now()}`}function $(d={}){return new Promise(e=>{const{title:t="Conferma",message:r="Sei sicuro di voler continuare?",icon:o="question",confirmText:i="Conferma",cancelText:a="Annulla",type:s="default"}=d,l=document.createElement("div");l.className="confirm-popup";const n={question:`<svg viewBox="0 0 24 24" fill="currentColor" class="confirm-popup-icon">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
      </svg>`,warning:`<svg viewBox="0 0 24 24" fill="currentColor" class="confirm-popup-icon">
        <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
      </svg>`,danger:`<svg viewBox="0 0 24 24" fill="currentColor" class="confirm-popup-icon">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>`,info:`<svg viewBox="0 0 24 24" fill="currentColor" class="confirm-popup-icon">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
      </svg>`},c=n[o]||n.question,g=s==="danger"?"confirm-popup-btn-danger":"confirm-popup-btn-primary";l.innerHTML=`
      <div class="confirm-popup-content">
        <div class="confirm-popup-header">
          <h3 class="confirm-popup-title">
            ${c}
            ${t}
          </h3>
        </div>
        <div class="confirm-popup-body">
          ${r}
        </div>
        <div class="confirm-popup-footer">
          <button class="confirm-popup-btn confirm-popup-btn-secondary" data-action="cancel">
            ${a}
          </button>
          <button class="confirm-popup-btn ${g}" data-action="confirm">
            ${i}
          </button>
        </div>
      </div>
    `;const u=p=>{document.body.removeChild(l),e(p==="confirm")};l.addEventListener("click",p=>{p.target===l&&u("cancel")}),l.querySelectorAll("[data-action]").forEach(p=>{p.addEventListener("click",b=>{b.preventDefault(),u(p.dataset.action)})});const h=p=>{p.key==="Escape"&&(document.removeEventListener("keydown",h),u("cancel"))};document.addEventListener("keydown",h),document.body.appendChild(l),setTimeout(()=>{l.querySelector(".confirm-popup-btn-secondary").focus()},100)})}class w{constructor(){this.fallbackAttempted=!1,this.loadingTimeout=null}async init(){try{console.log("ðŸŽ¨ Inizializzazione UI Loader..."),await v.ensureDbOpen(),await this.loadMaterialUI()}catch(e){console.error("âŒ Errore inizializzazione UI Loader:",e),C("Impossibile caricare l'interfaccia Material UI","error")}}async loadUI(e){await this.loadMaterialUI()}async loadMaterialUI(){if(console.log("ðŸŽ¨ Caricamento Material UI..."),window.aideasMaterialUIInitialized){console.log("âš ï¸ Material UI giÃ  inizializzato, skip");return}this.loadingTimeout=setTimeout(()=>{throw new Error("Timeout caricamento Material UI")},1e4);try{console.log("ðŸ“¦ Importazione modulo Material UI...");const{initializeAIdeasWithMaterialUI:e}=await z(async()=>{const{initializeAIdeasWithMaterialUI:t}=await import("./main-material-CPHUsr9Z.js");return{initializeAIdeasWithMaterialUI:t}},__vite__mapDeps([0,1]));console.log("ðŸ”§ Funzione di inizializzazione ottenuta:",typeof e),console.log("ðŸš€ Avvio inizializzazione Material UI..."),e(),window.aideasMaterialUIInitialized=!0,clearTimeout(this.loadingTimeout),console.log("âœ… Material UI caricata con successo"),this.hideLoadingScreen()}catch(e){throw clearTimeout(this.loadingTimeout),console.error("âŒ Errore durante caricamento Material UI:",e),e}}hideLoadingScreen(){try{const e=document.getElementById("loading-screen");e&&(e.style.display="none",console.log("ðŸŽ¯ Loading screen nascosto"))}catch(e){console.error("âŒ Errore nascondere loading screen:",e)}}}window.UILoader=w;const y=new w;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>y.init()):y.init();export{v as S,z as _,C as a,T as b,U as g,$ as s};
//# sourceMappingURL=main-0qYU13yf.js.map
